<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="é»˜" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="ç¨‹åºå‘˜ å¾®å°˜ V">
<meta property="og:type" content="website">
<meta property="og:title" content="é»˜">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="é»˜">
<meta property="og:description" content="ç¨‹åºå‘˜ å¾®å°˜ V">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="é»˜">
<meta name="twitter:description" content="ç¨‹åºå‘˜ å¾®å°˜ V">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title> é»˜ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-79641673-1', 'auto');
  ga('send', 'pageview');
</script>











  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">é»˜</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ä¸ºäº†ç”Ÿå­˜ï¼Œè€Œä¸€ç‚¹ç‚¹æ·¡å¿˜äº†æœ€åˆçš„æœ¬æ„ã€‚</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            ç•™è¨€
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/18/linuxç¬”è®°â€”Linuxæ–‡ä»¶å¤¹æ“ä½œ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/01/18/linuxç¬”è®°â€”Linuxæ–‡ä»¶å¤¹æ“ä½œ/" itemprop="url">
                  linuxç¬”è®°â€”Linuxæ–‡ä»¶å¤¹æ“ä½œ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-18T10:17:11+08:00">
                2018-01-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linuxç¬”è®°/" itemprop="url" rel="index">
                    <span itemprop="name">linuxç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/18/linuxç¬”è®°â€”Linuxæ–‡ä»¶å¤¹æ“ä½œ/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/18/linuxç¬”è®°â€”Linuxæ–‡ä»¶å¤¹æ“ä½œ/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/01/18/linuxç¬”è®°â€”Linuxæ–‡ä»¶å¤¹æ“ä½œ/" class="leancloud_visitors" data-flag-title="linuxç¬”è®°â€”Linuxæ–‡ä»¶å¤¹æ“ä½œ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  450
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  2m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="linuxä¸‹æ–‡ä»¶å¤¹ç›¸å…³æ“ä½œ"><a href="#linuxä¸‹æ–‡ä»¶å¤¹ç›¸å…³æ“ä½œ" class="headerlink" title="linuxä¸‹æ–‡ä»¶å¤¹ç›¸å…³æ“ä½œ"></a>linuxä¸‹æ–‡ä»¶å¤¹ç›¸å…³æ“ä½œ</h2><ul>
<li>å‚è€ƒ<blockquote>
<p><a href="http://blog.csdn.net/u011118014/article/details/43232693" target="_blank" rel="external">http://blog.csdn.net/u011118014/article/details/43232693</a></p>
<h2 id="æ‰“å¼€æ–‡ä»¶å¤¹-éå†è®¿é—®æ¯ä¸ªæ–‡ä»¶"><a href="#æ‰“å¼€æ–‡ä»¶å¤¹-éå†è®¿é—®æ¯ä¸ªæ–‡ä»¶" class="headerlink" title="æ‰“å¼€æ–‡ä»¶å¤¹,éå†è®¿é—®æ¯ä¸ªæ–‡ä»¶"></a>æ‰“å¼€æ–‡ä»¶å¤¹,éå†è®¿é—®æ¯ä¸ªæ–‡ä»¶</h2><h3 id="åˆ‡æ¢åˆ°æ–‡ä»¶å¤¹è·¯å¾„ä¸‹"><a href="#åˆ‡æ¢åˆ°æ–‡ä»¶å¤¹è·¯å¾„ä¸‹" class="headerlink" title="åˆ‡æ¢åˆ°æ–‡ä»¶å¤¹è·¯å¾„ä¸‹"></a>åˆ‡æ¢åˆ°æ–‡ä»¶å¤¹è·¯å¾„ä¸‹</h3></blockquote>
</li>
<li>è°ƒç”¨ chdir å³å¯<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chdir(&quot;/info&quot;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ‰“å¼€æ–‡ä»¶å¤¹"><a href="#æ‰“å¼€æ–‡ä»¶å¤¹" class="headerlink" title="æ‰“å¼€æ–‡ä»¶å¤¹"></a>æ‰“å¼€æ–‡ä»¶å¤¹</h3><ul>
<li><p>æºç ,æ‰“å¼€æ–‡ä»¶å¤¹è¿”å›å¯¹åº”æ–‡ä»¶å¤¹çš„DIRç»“æ„ä½“</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">DIR *dir;	</div><div class="line">dir = opendir(pcDirName);</div><div class="line">if (NULL == dir)&#123;</div><div class="line">  continue ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>DIRç»“æ„ä½“ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">struct __dirstream</div><div class="line"> &#123;</div><div class="line">  void *__fd;</div><div class="line">  char *__data;</div><div class="line">  int __entry_data;</div><div class="line">  char *__ptr;</div><div class="line">  int __entry_ptr;</div><div class="line">  size_t __allocation;</div><div class="line">  size_t __size;</div><div class="line">  __libc_lock_define (, __lock)</div><div class="line"> &#125;;</div><div class="line">typedef struct __dirstream DIR;</div></pre></td></tr></table></figure>
<p>ä¿å­˜æ–‡ä»¶å¤¹ç›¸å…³å†…å®¹,æ— éœ€æ·±ç©¶</p>
</li>
<li><p>æºç ,éå†æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">struct direct    *ent;</div><div class="line">while (NULL != (ent = readdir(dir)))&#123;</div><div class="line">  /*å¦‚æœ æŒ‡å‘ . ..*/</div><div class="line">  if (0 == strcmp(ent-&gt;d_name, &quot;.&quot;) \</div><div class="line">    || 0 == strcmp(ent-&gt;d_name, &quot;..&quot;) \</div><div class="line">    || 4 == ent-&gt;d_type)&#123;</div><div class="line">      continue;</div><div class="line">  &#125;    </div><div class="line">  /*éå†*/</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>direntç»“æ„ä½“</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">struct dirent</div><div class="line">&#123;</div><div class="line">  long d_ino; /* inode number ç´¢å¼•èŠ‚ç‚¹å· */</div><div class="line">  off_t d_off; /* offset to this dirent åœ¨ç›®å½•æ–‡ä»¶ä¸­çš„åç§» */</div><div class="line">  unsigned short d_reclen; /* length of this d_name æ–‡ä»¶åé•¿ */</div><div class="line">  unsigned char d_type; /* the type of d_name æ–‡ä»¶ç±»å‹ */</div><div class="line">  char d_name [NAME_MAX+1]; /* file name (null-terminated) æ–‡ä»¶åï¼Œæœ€é•¿255å­—ç¬¦ */</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>direntæŒ‡å‘ç›®å½•å’Œç›®å½•ä¸­æŸä¸ªå…·ä½“æ–‡ä»¶,ä½†è¿˜æ˜¯æ¡¥æ¢ä½œç”¨,è®¿é—®æ–‡ä»¶å…·ä½“å†…å®¹è¿˜éœ€è¦é€šè¿‡d_nameæ‰¾åˆ°statç»“æ„ä½“æ”¯æ´.</p>
</li>
<li><p>æºç ,è·å–statç»“æ„ä½“</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">stat  f_stat;</div><div class="line">sdwRet = stat(ent-&gt;d_name, &amp;f_stat);</div></pre></td></tr></table></figure>
</li>
<li><p>statç»“æ„ä½“æ˜¯æŒ‡å‘æ–‡ä»¶çš„ç»“æ„ä½“ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">struct stat &#123;</div><div class="line">  mode_t     st_mode;       //æ–‡ä»¶è®¿é—®æƒé™</div><div class="line">  ino_t      st_ino;       //ç´¢å¼•èŠ‚ç‚¹å·</div><div class="line">  dev_t      st_dev;        //æ–‡ä»¶ä½¿ç”¨çš„è®¾å¤‡å·</div><div class="line">  dev_t      st_rdev;       //è®¾å¤‡æ–‡ä»¶çš„è®¾å¤‡å·</div><div class="line">  nlink_t    st_nlink;      //æ–‡ä»¶çš„ç¡¬è¿æ¥æ•°</div><div class="line">  uid_t      st_uid;        //æ‰€æœ‰è€…ç”¨æˆ·è¯†åˆ«å·</div><div class="line">  gid_t      st_gid;        //ç»„è¯†åˆ«å·</div><div class="line">  off_t      st_size;       //ä»¥å­—èŠ‚ä¸ºå•ä½çš„æ–‡ä»¶å®¹é‡</div><div class="line">  time_t     st_atime;      //æœ€åä¸€æ¬¡è®¿é—®è¯¥æ–‡ä»¶çš„æ—¶é—´</div><div class="line">  time_t     st_mtime;      //æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥æ–‡ä»¶çš„æ—¶é—´</div><div class="line">  time_t     st_ctime;      //æœ€åä¸€æ¬¡æ”¹å˜è¯¥æ–‡ä»¶çŠ¶æ€çš„æ—¶é—´</div><div class="line">  blksize_t st_blksize;    //åŒ…å«è¯¥æ–‡ä»¶çš„ç£ç›˜å—çš„å¤§å°</div><div class="line">  blkcnt_t   st_blocks;     //è¯¥æ–‡ä»¶æ‰€å çš„ç£ç›˜å—</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>ä¹‹åæ„‰å¿«è®¿é—®å§</p>
</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/23/Androidéšæ‰‹è®°-Android Mé—ªé€€å°è®°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/23/Androidéšæ‰‹è®°-Android Mé—ªé€€å°è®°/" itemprop="url">
                  Androidéšæ‰‹è®°â€”Android Mé—ªé€€å°è®°
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-23T12:00:00+08:00">
                2017-11-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Androidéšæ‰‹è®°/" itemprop="url" rel="index">
                    <span itemprop="name">Androidéšæ‰‹è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/23/Androidéšæ‰‹è®°-Android Mé—ªé€€å°è®°/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/23/Androidéšæ‰‹è®°-Android Mé—ªé€€å°è®°/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/23/Androidéšæ‰‹è®°-Android Mé—ªé€€å°è®°/" class="leancloud_visitors" data-flag-title="Androidéšæ‰‹è®°â€”Android Mé—ªé€€å°è®°">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  220
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  1m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 3.0.1</li>
</ul>
<hr>
<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul>
<li>MyPrivacy åœ¨android Mä¸Šé—ªé€€,åœ¨æ¨¡æ‹Ÿå™¨ä¸­å¤ç°.æç¤º<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android.util.AndroidRuntimeException: Calling startActivity() from outside of an Activity  context requires the FLAG_ACTIVITY_NEW_TASK flag. Is this really what you want?</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><ul>
<li>è¿›å…¥ç¬¬äºŒä¸ªActivityåº”ç”¨è®¾ç½®æ—¶,æ‰å‡ºç°,è€Œä¸” 7.1æ— é—®é¢˜.æ¨¡æ‹Ÿå™¨å¤ç°,æŠ“log.</li>
</ul>
<h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><ul>
<li>logçš„æ„æ€æ˜¯å¯åŠ¨activityçš„contextä¸æ˜¯ activity.</li>
<li><p>å¯¹åº”ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = new Intent(MyApplicantion.getContext(),   AppSettingActivity.class);</div><div class="line">intent.putExtra(&quot;PackageName&quot;, AppId);</div><div class="line">MyApplicantion.getContext().startActivity(intent);</div></pre></td></tr></table></figure>
</li>
<li><p>éœ€è¦å¯¹intentå£°æ˜ FLAG_ACTIVITY_NEW_TASK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h3><ul>
<li>ç½‘ä¸Šçš„åŸå› åˆ†æ:</li>
<li>å› ä¸ºstandardæ¨¡å¼çš„Activityé»˜è®¤ä¼šè¿›å…¥å¯åŠ¨å®ƒçš„Activityæ‰€å±çš„ä»»åŠ¡æ ˆä¸­ï¼Œä½†æ˜¯ç”±äºéActivityç±»å‹çš„contextï¼ˆApplicationContextï¼‰å¹¶æ²¡æœ‰æ‰€è°“çš„ä»»åŠ¡æ ˆï¼Œæ‰€ä»¥å°±å‡ºç°é—®é¢˜äº†ã€‚éœ€è¦æŒ‡å®šActivityä¸ºFLAG_ACTIVITY_NEW_TASKæ ‡è®°ä½ï¼Œè¿™æ ·å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„ä»»åŠ¡æ ˆäº†ã€‚â€“androidå¼€å‘è‰ºæœ¯æ¢ç©¶</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/12/Androidéšæ‰‹è®°-ScrollView/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/12/Androidéšæ‰‹è®°-ScrollView/" itemprop="url">
                  Androidéšæ‰‹è®°â€”ScrollView
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-12T12:00:00+08:00">
                2017-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Androidéšæ‰‹è®°/" itemprop="url" rel="index">
                    <span itemprop="name">Androidéšæ‰‹è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/12/Androidéšæ‰‹è®°-ScrollView/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/12/Androidéšæ‰‹è®°-ScrollView/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/12/Androidéšæ‰‹è®°-ScrollView/" class="leancloud_visitors" data-flag-title="Androidéšæ‰‹è®°â€”ScrollView">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  66
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  1m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 3.0</li>
</ul>
<hr>
<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul>
<li>æ¨ªå±æ¨¡å¼ä¸‹,æ˜¾ç¤ºå†…å®¹è¢«é®æŒ¡</li>
</ul>
<h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><ul>
<li>GoogleğŸ˜‚</li>
</ul>
<h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><ul>
<li>ScrollView åªå…è®¸åµŒå¥—ä¸€ä¸ªå­å¸ƒå±€.è¶…å‡ºèŒƒå›´éƒ¨åˆ†ä¼šè‡ªåŠ¨å¢åŠ æ»šåŠ¨æ¡</li>
</ul>
<h3 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h3><ul>
<li>ScrollView åªèƒ½æ·»åŠ ç«–ç›´æ–¹å‘æ»šåŠ¨æ¡.</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/06/Androidç¬”è®°â€”Rxjava2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/06/Androidç¬”è®°â€”Rxjava2/" itemprop="url">
                  Androidç¬”è®°â€”Rxjava2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-06T12:00:00+08:00">
                2017-11-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Androidç¬”è®°/" itemprop="url" rel="index">
                    <span itemprop="name">Androidç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/06/Androidç¬”è®°â€”Rxjava2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/06/Androidç¬”è®°â€”Rxjava2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/06/Androidç¬”è®°â€”Rxjava2/" class="leancloud_visitors" data-flag-title="Androidç¬”è®°â€”Rxjava2">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  2,687
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  12m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>èµ„æ–™æ¥æºå¦‚ä¸‹<br><a href="http://www.jianshu.com/u/c50b715ccaeb" target="_blank" rel="external">ç»™åˆå­¦è€…çš„RxJava2.0æ•™ç¨‹</a>(demoä»£ç æ¥æº)</p>
<blockquote>
<p><a href="http://www.jianshu.com/u/c50b715ccaeb" target="_blank" rel="external">http://www.jianshu.com/u/c50b715ccaeb</a></p>
</blockquote>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 2.2.3 </li>
</ul>
<hr>
<ul>
<li>åœ¨Gradleé…ç½®:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">compile &apos;io.reactivex.rxjava2:rxjava:2.0.1&apos;</div><div class="line">compile &apos;io.reactivex.rxjava2:rxandroid:2.0.1&apos;</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h2><ul>
<li>åœ¨Eventbusä¸­äº¦æ¶‰åŠäº†ç›¸å…³æ¦‚å¿µ,æ¯”è¾ƒç®€å•.åŒ…æ‹¬Observable(è¢«è§‚å¯Ÿè€…)ã€Observer(è§‚å¯Ÿè€…)ã€subscribe().äº‹ä»¶ç”±Observable(è¢«è§‚å¯Ÿè€…)å¼€å§‹å‘å‡º,é€šè¿‡subscribe()æœ€ç»ˆè¢«ä¼ é€’åˆ°Observer(è§‚å¯Ÿè€…).è€Œæ•´ä¸ªè¿‡ç¨‹ä¸­ä½ æ˜¯ç«™åœ¨Observer(è§‚å¯Ÿè€…)çš„ä½ç½®,ä¹Ÿå°±æ˜¯äº‹ä»¶çš„æœ«å°¾,è§‚å¯ŸObservable(è¢«è§‚å¯Ÿè€…).</li>
<li><p>ä¸Šå›¾</p>
</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123;</div><div class="line">              emitter.onNext(1);</div><div class="line">              emitter.onComplete();</div><div class="line">          &#125;</div><div class="line">      &#125;).subscribe(new Observer&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void onSubscribe(Disposable d) &#123;</div><div class="line">              Log.d(TAG, &quot;subscribe&quot;);</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onNext(Integer value) &#123;</div><div class="line">              Log.d(TAG, &quot;&quot; + value);</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onError(Throwable e) &#123;</div><div class="line">              Log.d(TAG, &quot;error&quot;);</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onComplete() &#123;</div><div class="line">              Log.d(TAG, &quot;complete&quot;);</div><div class="line">          &#125;</div><div class="line">      &#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>äº‹ä»¶ç”±<code>emitter.onNext(1);</code>å¼€å§‹,æœ€ç»ˆè¢«<code>public void onNext(Integer value)</code>ç›¸åº”.è¢«è§‚å¯Ÿè€…äº‹ä»¶å‘é€ç»“æŸè°ƒç”¨<code>emitter.onComplete();</code>,åŒæ—¶è§‚å¯Ÿè€…æœ€ç»ˆä»¥<code>public void onComplete()</code>ç›¸åº”.</p>
</li>
</ul>
<hr>
<h2 id="note-ä¸Šä¸‹æ¸¸ä»¥-subscribeå»ºç«‹è¿æ¥å-äº‹ä»¶æ‰ä¼šå¼€å§‹å‘é€"><a href="#note-ä¸Šä¸‹æ¸¸ä»¥-subscribeå»ºç«‹è¿æ¥å-äº‹ä»¶æ‰ä¼šå¼€å§‹å‘é€" class="headerlink" title="* note: ä¸Šä¸‹æ¸¸ä»¥.subscribeå»ºç«‹è¿æ¥å,äº‹ä»¶æ‰ä¼šå¼€å§‹å‘é€."></a>* note: ä¸Šä¸‹æ¸¸ä»¥<code>.subscribe</code>å»ºç«‹è¿æ¥å,äº‹ä»¶æ‰ä¼šå¼€å§‹å‘é€.</h2><h3 id="Observable-è¢«è§‚å¯Ÿè€…-Observer-è§‚å¯Ÿè€…"><a href="#Observable-è¢«è§‚å¯Ÿè€…-Observer-è§‚å¯Ÿè€…" class="headerlink" title="Observable(è¢«è§‚å¯Ÿè€…) Observer(è§‚å¯Ÿè€…)"></a>Observable(è¢«è§‚å¯Ÿè€…) Observer(è§‚å¯Ÿè€…)</h3><ul>
<li>ObservableEmitter<br>ObservableEmitterï¼š Emitteræ„ä¸ºå‘å°„å™¨,äº‹ä»¶å‘é€.onNext(T value)ã€onComplete()å’ŒonError(Throwable error)åˆ†åˆ«å¯¹åº”nextäº‹ä»¶ã€completeäº‹ä»¶å’Œerroräº‹ä»¶ã€‚</li>
<li>Observer<integer>ä¸­onNext(Integer value)ã€onError(Throwable e)ã€onComplete()å¯¹åº”æ¥å—nextäº‹ä»¶ã€completeäº‹ä»¶å’Œerroräº‹ä»¶</integer></li>
<li>è¢«è§‚å¯Ÿè€…å‘é€completeäº‹ä»¶å’Œerroräº‹ä»¶å,è§‚å¯Ÿè€…æ¥å—åä¸å†ç»§ç»­å“åº”äº‹ä»¶,å³ä½¿è¢«è§‚å¯Ÿè€…è¿˜åœ¨å‘é€äº‹ä»¶.<strong>completeäº‹ä»¶å’Œerroräº‹ä»¶äº’æ–¥.</strong></li>
<li>åœ¨Observer<integer>ä¸­,è°ƒç”¨Disposable.dispose(),åˆ‡æ–­ç®¡é“.è¢«è§‚å¯Ÿè€…ç»§ç»­å‘é€,ä½†è§‚å¯Ÿè€…ä¸å†å“åº”.</integer></li>
</ul>
<h3 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h3><ul>
<li>å»ºç«‹Observable(è¢«è§‚å¯Ÿè€…) Observer(è§‚å¯Ÿè€…)ä¹‹é—´çš„ç®¡é“.æœ‰å¤šä¸ªé‡è½½.</li>
<li><p>é‡è½½</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public final Disposable subscribe() &#123;&#125;</div><div class="line"></div><div class="line">public final Disposable subscribe(Consumer&lt;? super T&gt; onNext) &#123;&#125;</div><div class="line"></div><div class="line">public final Disposable subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError) &#123;&#125; </div><div class="line"></div><div class="line">public final Disposable subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError, Action onComplete) &#123;&#125;</div><div class="line"></div><div class="line">public final Disposable subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError, Action onComplete, Consumer&lt;? super Disposable&gt; onSubscribe) &#123;&#125;</div><div class="line"></div><div class="line">public final void subscribe(Observer&lt;? super T&gt; observer) &#123;&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>é‡è½½è¯´æ˜</p>
<ul>
<li>ä¸å¸¦å‚æ•° : è§‚å¯Ÿè€…ä¸å…³å¿ƒä»»ä½•äº‹ä»¶(æœ‰åµç”¨ğŸ˜µ)</li>
<li>åªå¸¦onNext : è§‚å¯Ÿè€…åªå“åº”nextäº‹ä»¶.</li>
<li>å…¶ä»–ç±»ä¼¼â€¦.æ¼”ç»æ¨ç†â€¦.</li>
<li>æœ€åä¸€ä¸ªæ˜¯ä¼ å…¥å®Œæ•´çš„Observerå¯¹è±¡.(demoå°±æ˜¯ğŸ™ƒ)</li>
</ul>
</li>
</ul>
<h2 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h2><ul>
<li>åŸºäºRxjavaçš„è§‚å¯Ÿè€…æ¨¡å¼å¯ä»¥æ‹†åˆ†å¤§å¤šæ•°çš„ä¸šåŠ¡é€»è¾‘,å³ä½¿å†å¢åŠ å¾ˆå¤šåŠŸèƒ½æ•´ä½“ä¹Ÿä¸ä¼šè¿‡äºæ··ä¹±.</li>
<li>ä½†Rxjavaçš„å¼ºå¤§å¹¶ä¸å±€é™åœ¨æ‹†åˆ†é€»è¾‘.ç”±è¢«è§‚å¯Ÿè€…åˆ°è§‚å¯Ÿè€…çš„æ•´ä¸ªäº‹ä»¶ä¼ é€’è¿‡ç¨‹,åŸºäºRxjavaæˆ‘ä»¬å¯ä»¥<strong>ä»»æ„æ‹†åˆ† åˆå¹¶ è½¬æ¢ äº‹ä»¶ã€åˆ‡æ¢çº¿ç¨‹ç­‰.</strong></li>
</ul>
<hr>
<h2 id="note-æ“ä½œç¬¦æ­é…-Lambda-è¡¨è¾¾å¼é£Ÿç”¨æ›´ä½³-ğŸ¤£"><a href="#note-æ“ä½œç¬¦æ­é…-Lambda-è¡¨è¾¾å¼é£Ÿç”¨æ›´ä½³-ğŸ¤£" class="headerlink" title="* note: æ“ä½œç¬¦æ­é… Lambda è¡¨è¾¾å¼é£Ÿç”¨æ›´ä½³ ğŸ¤£"></a>* note: æ“ä½œç¬¦æ­é… Lambda è¡¨è¾¾å¼é£Ÿç”¨æ›´ä½³ ğŸ¤£</h2><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><ul>
<li>äº§ç”Ÿå¹¶å‘é€ Obserable äº‹ä»¶.</li>
<li>ä»…å¸¸ç”¨,è¯¦ç»†åœ¨<a href="https://maxwell-nc.github.io/android/rxjava2-2.html#timer" target="_blank" rel="external"> RxJava 2.x ä½¿ç”¨è¯¦è§£(äºŒ) åˆ›å»ºæ“ä½œç¬¦</a> <h4 id="creat"><a href="#creat" class="headerlink" title=".creat"></a>.creat</h4></li>
<li>å‰é¢demoä¸­å·²ç»å®é™…ä½¿ç”¨è¿‡äº†</li>
<li>ç”¨äºäº§ç”Ÿä¸€ä¸ª Obserable è¢«è§‚å¯Ÿè€…å¯¹è±¡,demoå¦‚ä¸Šæ‰€ç¤º.</li>
</ul>
<h4 id="just"><a href="#just" class="headerlink" title=".just"></a>.just</h4><ul>
<li>å¯¹äºç®€å•çš„å‡ ä¸ªæ•°æ®,ç›´æ¥ä½¿ç”¨justå‘é€å³å¯,æ— éœ€åˆ›å»º Obserable å¯¹è±¡.justæœ€å¤šå¯ä»¥æ¥æ”¶ <strong>10</strong> ä¸ªå‚æ•°.</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Observable.just(&quot;test&quot;,&quot;test2&quot;)</div><div class="line">      .subscribe(str -&gt; Log.i(&quot;tag&quot;, str));</div></pre></td></tr></table></figure>
<p>ç›¸å½“äºé¡ºåºè°ƒç”¨onNext(â€œtestâ€)å’ŒonNext(â€œtest2â€)ï¼Œæœ€åè°ƒç”¨onCompleteæ–¹æ³•ã€‚</p>
</li>
</ul>
<h4 id="fromArray"><a href="#fromArray" class="headerlink" title=".fromArray"></a>.fromArray</h4><ul>
<li>åŠŸèƒ½ä¸justç±»ä¼¼ä½†fromArrayæ¥æ¥æ”¶ä»»æ„é•¿åº¦çš„æ•°æ®æ•°ç»„,ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥æ•°ç»„<code>fromArray(new int[]{1, 2, 3})</code></li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Observable.fromArray(1, 2, 3, 4, 5)</div><div class="line">      .subscribe(integer -&gt; Log.i(&quot;tag&quot;, String.valueOf(integer)));</div></pre></td></tr></table></figure>
<p>fromArrayä¸æ”¯æŒç›´æ¥ä¼ å…¥listè¿›ï¼Œlistä¼šè¢«å½“ä½œä¸€ä¸ªæ•´ä½“å‘é€.</p>
</li>
</ul>
<h4 id="fromIterable"><a href="#fromIterable" class="headerlink" title=".fromIterable"></a>.fromIterable</h4><ul>
<li>åŠŸèƒ½ä¸fromArrayç±»ä¼¼,ä½†æ˜¯å¯ä»¥æ¥æ”¶ list ç±»å‹,éå†å¯è¿­ä»£æ•°æ®é›†åˆ.</li>
<li>demo<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line">list.add(&quot;a&quot;);</div><div class="line">list.add(&quot;b&quot;);</div><div class="line">list.add(&quot;c&quot;);</div><div class="line"></div><div class="line">Flowable.fromIterable(list).subscribe(</div><div class="line">      s -&gt; Log.i(&quot;tag&quot;, s)</div><div class="line">);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="timer"><a href="#timer" class="headerlink" title=".timer"></a>.timer</h4><ul>
<li>æŒ‡å®šä¸€æ®µæ—¶é—´é—´éš”åå‘é€æ•°æ®(ä¸€æ¬¡æ€§),ä¸å¤ªå¸¸ç”¨.</li>
</ul>
<h3 id="çº¿ç¨‹åˆ‡æ¢"><a href="#çº¿ç¨‹åˆ‡æ¢" class="headerlink" title="çº¿ç¨‹åˆ‡æ¢"></a>çº¿ç¨‹åˆ‡æ¢</h3><ul>
<li>é»˜è®¤äº‹ä»¶ä¼ é€’çš„åŒæ–¹åœ¨åŒä¸€çº¿ç¨‹å·¥ä½œ.</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">observable.subscribeOn(Schedulers.newThread())     </div><div class="line">       .subscribeOn(Schedulers.io())              </div><div class="line">       .observeOn(AndroidSchedulers.mainThread()) </div><div class="line">       .observeOn(Schedulers.io())                </div><div class="line">       .subscribe(consumer);</div></pre></td></tr></table></figure>
</li>
<li><p>æ–¹æ³•:</p>
<ul>
<li>.subscribeOn() : æŒ‡å®šè¢«è§‚å¯Ÿè€…å‘é€äº‹ä»¶çº¿ç¨‹,<strong>ä»…ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æœ‰æ•ˆ!</strong>  </li>
<li>.observeOn() : æŒ‡å®šè§‚å¯Ÿè€…/æµå˜æ¢(å¯¹å‘é€çš„äº‹ä»¶å¤„ç†ğŸ––)çº¿ç¨‹,<strong>å¤šæ¬¡è°ƒç”¨,å¤šæ¬¡åˆ‡æ¢æœ‰æ•ˆ</strong></li>
</ul>
</li>
<li><p>å‚æ•°:</p>
<ul>
<li>Schedulers.io() : é€‚ç”¨äºioå¯†é›†å‹æ“ä½œ,ç½‘ç»œé€šä¿¡ã€ç£ç›˜æ“ä½œç­‰.</li>
<li>Schedulers.computation() : CPUå¯†é›†æ“ä½œ,éœ€è¦å¤§é‡CPUè®¡ç®—çš„æ“ä½œ.</li>
<li>Schedulers.newThread() : åˆ›å»ºæ–°çº¿ç¨‹.</li>
<li>AndroidSchedulers.mainThread() : Androidä¸»çº¿ç¨‹,é€šå¸¸ä¸ºæ›´æ–°UIç­‰.</li>
</ul>
</li>
</ul>
<h3 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤"></a>è¿‡æ»¤</h3><ul>
<li>å¯¹ Obserable äº‹ä»¶ç­›é€‰.</li>
<li>ä»…å¸¸ç”¨,è¯¦ç»†åœ¨<a href="https://maxwell-nc.github.io/android/rxjava2-3.html#filter" target="_blank" rel="external">RxJava 2.x ä½¿ç”¨è¯¦è§£(ä¸‰) è¿‡æ»¤æ“ä½œç¬¦</a></li>
</ul>
<h4 id="filter"><a href="#filter" class="headerlink" title=".filter"></a>.filter</h4><ul>
<li>åŸºæœ¬è¿‡æ»¤æ“ä½œç¬¦,æŒ‰ç…§ä»»æ„è‡ªå®šè§„åˆ™è¿‡æ»¤.</li>
</ul>
<h3 id="ç»„åˆ"><a href="#ç»„åˆ" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h3><h3 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h3><h4 id="map"><a href="#map" class="headerlink" title=".map"></a>.map</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯”<strong>1:1</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>ä¸å˜</strong></li>
<li>mapä½œç”¨æ˜¯å¯¹Observableå‘é€çš„æ¯ä¸€ä¸ªäº‹ä»¶,åº”ç”¨å¤„ç†å˜æ¢å‡½æ•°,å†ç»§ç»­åƒä¸‹æ¸¸å‘é€.ä¸­é—´è¿‡ç¨‹å¯ä»¥è½¬æ¢äº‹ä»¶ç±»å‹ã€æ”¹å˜äº‹ä»¶å†…å®¹ç­‰ç­‰.<strong>åªéœ€è¦å˜æ¢åçš„äº‹ä»¶ç±»å‹ä¸ä¸‹æ¸¸æ¥æ”¶çš„ç±»å‹åŒ¹é…å³å¯.</strong></li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123;</div><div class="line">              emitter.onNext(1);</div><div class="line">              emitter.onNext(2);</div><div class="line">              emitter.onNext(3);</div><div class="line">          &#125;</div><div class="line">      &#125;).map(new Function&lt;Integer, String&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public String apply(Integer integer) throws Exception &#123;</div><div class="line">              return &quot;This is result &quot; + integer;</div><div class="line">          &#125;</div><div class="line">      &#125;).subscribe(new Consumer&lt;String&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void accept(String s) throws Exception &#123;</div><div class="line">              Log.d(TAG, s);</div><div class="line">          &#125;</div><div class="line">      &#125;);</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯æŠŠintç±»å‹è½¬æ¢ä¸ºäº†stringç±»å‹,ä¸è§‚å¯Ÿè€…æ¥æ”¶çš„ç±»å‹åŒ¹é…å³å¯.</p>
</li>
</ul>
<h4 id="flatMap"><a href="#flatMap" class="headerlink" title=".flatMap"></a>.flatMap</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯” <strong>1:n</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>ä¸ä¿è¯</strong></li>
<li>flatMap,é€šä¿—ç‚¹å°±æ˜¯æŠŠObservableå‘é€çš„äº‹ä»¶æ‹†æ•£å˜æ¢å†,ç»§ç»­åƒä¸‹æ¸¸å‘é€.1ä¸ªObservableäº‹ä»¶å¯æ‹†æˆä»»æ„ä¸ª.<strong>åªéœ€è¦å˜æ¢åçš„äº‹ä»¶ç±»å‹ä¸ä¸‹æ¸¸æ¥æ”¶çš„ç±»å‹åŒ¹é…å³å¯.</strong></li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123;</div><div class="line">              emitter.onNext(1);</div><div class="line">              emitter.onNext(2);</div><div class="line">              emitter.onNext(3);</div><div class="line">          &#125;</div><div class="line">      &#125;).flatMap(new Function&lt;Integer, ObservableSource&lt;String&gt;&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public ObservableSource&lt;String&gt; apply(Integer integer) throws Exception &#123;</div><div class="line">              final List&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line">              for (int i = 0; i &lt; 3; i++) &#123;</div><div class="line">                  list.add(&quot;I am value &quot; + integer);</div><div class="line">              &#125;</div><div class="line">              return Observable.fromIterable(list).delay(10,TimeUnit.MILLISECONDS);</div><div class="line">          &#125;</div><div class="line">      &#125;).subscribe(new Consumer&lt;String&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void accept(String s) throws Exception &#123;</div><div class="line">              Log.d(TAG, s);</div><div class="line">          &#125;</div><div class="line">      &#125;);</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯flatMapæŠŠä¸€ä¸ªintç±»å‹äº‹ä»¶æ‹†æˆäº†3ä¸ªStringç±»å‹,è¿è¡Œç»“æœçœ‹,æœ€ç»ˆäº‹ä»¶åˆ°è¾¾é¡ºåºä¸onNext(1);onNext(2);çš„å‘é€é¡ºåºæ— å…³</p>
</li>
</ul>
<h4 id="concatMap"><a href="#concatMap" class="headerlink" title=".concatMap"></a>.concatMap</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯” <strong>1:n</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>æŒ‰é¡ºåº</strong></li>
<li>ä¸flatMapä½œç”¨ç›¸åŒ,åªæ˜¯ä¿è¯äº†äº‹ä»¶ä¸¥æ ¼æŒ‰é¡ºåºè¾¾åˆ°ä¸‹æ¸¸.</li>
<li>demo å°±ä¸ä¸Šäº†,ç›´æ¥æ›¿æ¢flatMapçš„ä½ç½®å°±å¥½.</li>
</ul>
<h4 id="zip"><a href="#zip" class="headerlink" title=".zip"></a>.zip</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯” <strong>n:1</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>ä¸¥æ ¼æŒ‰é¡ºåº</strong></li>
<li>zip.æœ€å¸¸è§çš„å‹ç¼©æ–‡ä»¶æ ¼å¼,åœ¨è¿™é‡Œä¹Ÿæ˜¯ç±»ä¼¼çš„æ„æ€,zipå¯ä»¥ä¸¥æ ¼æŒ‰ç…§é¡ºåºåˆå¹¶å¤šä¸ª <strong>ä¸åŒç±»å‹</strong> Observableå‘é€çš„äº‹ä»¶.æ€»çš„å‘é€äº‹ä»¶æ•°é‡ä¸ä¸Šæ¸¸Observableå‘é€æœ€å°‘çš„é‚£ä¸ªæ•°é‡ç›¸åŒ.</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">Observable&lt;Integer&gt; observable1 = Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123;         </div><div class="line">  @Override                                                                                      </div><div class="line">  public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123;                   </div><div class="line">      Log.d(TAG, &quot;emit 1&quot;);                                                                      </div><div class="line">      emitter.onNext(1);                                                                         </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit 2&quot;);                                                                      </div><div class="line">      emitter.onNext(2);                                                                         </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit 3&quot;);                                                                      </div><div class="line">      emitter.onNext(3);                                                                         </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit 4&quot;);                                                                      </div><div class="line">      emitter.onNext(4);                                                                         </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit complete1&quot;);                                                              </div><div class="line">      emitter.onComplete();                                                                      </div><div class="line">  &#125;                                                                                              </div><div class="line">&#125;).subscribeOn(Schedulers.io());                                                                   </div><div class="line"></div><div class="line">Observable&lt;String&gt; observable2 = Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;           </div><div class="line">  @Override                                                 public void subscribe(ObservableEmitter&lt;String&gt; emitter) throws Exception &#123;                    </div><div class="line">      Log.d(TAG, &quot;emit A&quot;);                                                                  </div><div class="line">      emitter.onNext(&quot;A&quot;);                                                                       </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit B&quot;);                                                                      </div><div class="line">      emitter.onNext(&quot;B&quot;);                                                                       </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit C&quot;);                                                                      </div><div class="line">      emitter.onNext(&quot;C&quot;);                                                                       </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit complete2&quot;);                                                              </div><div class="line">      emitter.onComplete();                                                                      </div><div class="line">  &#125;                                                                                              </div><div class="line">&#125;).subscribeOn(Schedulers.io());                                                                   </div><div class="line"></div><div class="line">Observable.zip(observable1, observable2, new BiFunction&lt;Integer, String, String&gt;() &#123;               </div><div class="line">  @Override                                                                                      </div><div class="line">  public String apply(Integer integer, String s) throws Exception &#123;                              </div><div class="line">      return integer + s;                                                                        </div><div class="line">  &#125;                                                                                              </div><div class="line">&#125;).subscribe(new Observer&lt;String&gt;() &#123;                    </div><div class="line">  @Override                                                                                      </div><div class="line">  public void onSubscribe(Disposable d) &#123;                                                        </div><div class="line">      Log.d(TAG, &quot;onSubscribe&quot;);                                                                 </div><div class="line">  &#125;                                                                                              </div><div class="line"></div><div class="line">  @Override                                                                                      </div><div class="line">  public void onNext(String value) &#123;                                                             </div><div class="line">      Log.d(TAG, &quot;onNext: &quot; + value);                                                            </div><div class="line">  &#125;                                                                                              </div><div class="line"></div><div class="line">  @Override                                                                                      </div><div class="line">  public void onError(Throwable e) &#123;                                                             </div><div class="line">      Log.d(TAG, &quot;onError&quot;);                                                                     </div><div class="line">  &#125;                                                                                              </div><div class="line"></div><div class="line">  @Override                                                                                      </div><div class="line">  public void onComplete() &#123;                                                                     </div><div class="line">      Log.d(TAG, &quot;onComplete&quot;);                                                                  </div><div class="line">  &#125;                                                                                              </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸¤ä¸ªäº‹ä»¶å‘é€åœ¨åŒä¸€çº¿ç¨‹ä¸­.å½“ä¸¤ä¸ªäº‹ä»¶å‘é€ä¸å†åŒä¸€çº¿ç¨‹æ—¶,æƒ…å†µç±»ä¼¼,ä¸è¿‡å½“å¼‚æ­¥æ—¶,æ•°é‡è¾ƒå°‘çš„äº‹ä»¶å‘é€å®Œæˆ,å‘é€Completeäº‹ä»¶å,é€šé“éšå³è¢«åˆ‡æ–­.</p>
</li>
</ul>
<h4 id="Concat"><a href="#Concat" class="headerlink" title=".Concat"></a>.Concat</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯” <strong>n:1</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>ä¸¥æ ¼æŒ‰é¡ºåº</strong></li>
<li>Concat,å¯ä»¥ä¸¥æ ¼æŒ‰ç…§é¡ºåºåˆå¹¶ <strong>ç›¸åŒç±»å‹</strong> Observableå‘é€çš„äº‹ä»¶.</li>
</ul>
<h2 id="Backpressure"><a href="#Backpressure" class="headerlink" title="Backpressure"></a>Backpressure</h2><hr>
<h2 id="è¢«ç¿»è¯‘ä¸ºèƒŒå‹â€¦-å¦‚æ­¤æ–‡ä¸è¾¾æ„çš„ç›´è¯‘-èƒ½å¿-å¾€ä¸‹éƒ½æ˜¯å› ä¸ºåŸæ–‡-ğŸ˜ˆ"><a href="#è¢«ç¿»è¯‘ä¸ºèƒŒå‹â€¦-å¦‚æ­¤æ–‡ä¸è¾¾æ„çš„ç›´è¯‘-èƒ½å¿-å¾€ä¸‹éƒ½æ˜¯å› ä¸ºåŸæ–‡-ğŸ˜ˆ" class="headerlink" title="* è¢«ç¿»è¯‘ä¸ºèƒŒå‹â€¦(å¦‚æ­¤æ–‡ä¸è¾¾æ„çš„ç›´è¯‘,èƒ½å¿?å¾€ä¸‹éƒ½æ˜¯å› ä¸ºåŸæ–‡..ğŸ˜ˆ)"></a>* è¢«ç¿»è¯‘ä¸ºèƒŒå‹â€¦(å¦‚æ­¤æ–‡ä¸è¾¾æ„çš„ç›´è¯‘,èƒ½å¿?å¾€ä¸‹éƒ½æ˜¯å› ä¸ºåŸæ–‡..ğŸ˜ˆ)</h2><ul>
<li>å…¶å®æ¦‚å¿µæœ‰å¤Ÿç®€å•:å°†æ•´ä¸ªäº‹ä»¶äº§ç”Ÿ/ä¼ é€’/å¤„ç†çš„è¿‡ç¨‹æƒ³è±¡ä¸ºä¸€æ¡æ²³æµç”±ä¸Šè€Œä¸‹, Backpressure æŒ‡çš„æ˜¯ä¸Šæ¸¸äº§ç”Ÿçš„äº‹ä»¶å¤ªå¿«,è¿œè¿œè¶…è¿‡äº†ä¸‹æ¸¸çš„å¤„ç†é€Ÿåº¦,ä»¥è‡³äºç¼“å†²åŒºæº¢å‡º.ä¸Šæ¸¸æ¥äº†æ´ªæ°´,ä¸‹æ¸¸å¾„æµé‡ä¸å¤Ÿ,ä»¥è‡³äºä¸­é—´æ²³é“è·¨è¿‡äº†å ¤å²¸,æº¢å‡º.</li>
</ul>
<h3 id="FlowableåŸºç¡€"><a href="#FlowableåŸºç¡€" class="headerlink" title="FlowableåŸºç¡€"></a>FlowableåŸºç¡€</h3><ul>
<li><p>Rxjava 1.xä¸­éœ€è¦è‡ªè¡Œé€šè¿‡æ“ä½œç¬¦å¤„ç†,åˆ°äº†2.0ä¸­,åˆ™æœ‰äº†ä¸“é—¨å¯¹ä»˜å‘æ´ªæ°´ä¸Šæ¸¸çš„è¢«è§‚å¯Ÿè€…- Flowable .æˆ‘ä»¬å¸¸ç”¨çš„ observable åœ¨2.xä¸­ä¸€èˆ¬ç”¨äºä¸æ¶‰åŠ Backpressure çš„æƒ…å†µ.è€Œå¯¹åº”ä¸ observable çš„ Observer ,æ”¹ä¸ºäº†  Subscriber .</p>
</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">Flowable&lt;Integer&gt; upstream = Flowable.create(new FlowableOnSubscribe&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void subscribe(FlowableEmitter&lt;Integer&gt; emitter) throws Exception &#123;</div><div class="line">              Log.d(TAG, &quot;emit 1&quot;);</div><div class="line">              emitter.onNext(1);</div><div class="line">              Log.d(TAG, &quot;emit 2&quot;);</div><div class="line">              emitter.onNext(2);</div><div class="line">              Log.d(TAG, &quot;emit 3&quot;);</div><div class="line">              emitter.onNext(3);</div><div class="line">              Log.d(TAG, &quot;emit complete&quot;);</div><div class="line">              emitter.onComplete();</div><div class="line">          &#125;</div><div class="line">      &#125;, BackpressureStrategy.ERROR); //å¢åŠ äº†ä¸€ä¸ªå‚æ•°</div><div class="line"></div><div class="line">      Subscriber&lt;Integer&gt; downstream = new Subscriber&lt;Integer&gt;() &#123;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onSubscribe(Subscription s) &#123;</div><div class="line">              Log.d(TAG, &quot;onSubscribe&quot;);</div><div class="line">              s.request(Long.MAX_VALUE);  //æ³¨æ„è¿™å¥ä»£ç </div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onNext(Integer integer) &#123;</div><div class="line">              Log.d(TAG, &quot;onNext: &quot; + integer);</div><div class="line"></div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onError(Throwable t) &#123;</div><div class="line">               Log.w(TAG, &quot;onError: &quot;, t);</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onComplete() &#123;</div><div class="line">              Log.d(TAG, &quot;onComplete&quot;);</div><div class="line">          &#125;</div><div class="line">      &#125;;</div><div class="line"></div><div class="line">      upstream.subscribe(downstream);</div></pre></td></tr></table></figure>
</li>
<li><p>æ³¨æ„ä¸¤ä¸ªåœ°æ–¹</p>
<ul>
<li>Flowableåˆ›å»ºæ—¶æ¯” observable å¤šäº†ä¸€ä¸ªå‚æ•°.(å‚æ•°ä½œç”¨ä¸‹èŠ‚è¯´æ˜)</li>
<li>Subscriberä¸­è°ƒç”¨äº† s.request .</li>
</ul>
</li>
<li><p>Flowable ä¸ Observable æœ€å¤§çš„ä¸åŒå°±æ˜¯ Flowableå†æ¬¡å‘é€äº‹ä»¶éœ€è¦ç­‰å¾… Subscriber ä¸­è°ƒç”¨ .request </p>
</li>
<li><p>.request() å®è´¨ä¸Šæ˜¯ä¸‹æ¸¸å‘ŠçŸ¥ä¸Šæ¸¸è‡ªå·±çš„å¤„ç†èƒ½åŠ›,ä½¿å¾—ä¸Šæ¸¸æ ¹æ®ä¸‹æ¸¸å¤„ç†èƒ½åŠ›å‘é€äº‹ä»¶.<strong>å¤šæ¬¡è°ƒç”¨,ä¸Šæ¸¸è¡¨ç¤ºå¤„ç†èƒ½åŠ›çš„æ•°å­—ä¼šå åŠ </strong>,ä¸Šæ¸¸æ¯å‘é€ä¸€ä¸ªäº‹ä»¶,è¯¥æ•°å­—å‡ä¸€,åˆ°0æŠ›å‡ºå¼‚å¸¸</p>
<ul>
<li>ä¸Šä¸‹æ¸¸åœ¨åŒä¸€çº¿ç¨‹æ—¶,ä¸‹æ¸¸æ²¡æœ‰æˆ–æ²¡æœ‰åŠæ—¶è°ƒç”¨ .request ,ä¸Šæ¸¸ä¼šæŠ›å‡ºå¼‚å¸¸</li>
<li>å¼‚æ­¥çº¿ç¨‹æ—¶,ä¸‹æ¸¸å³ä½¿æ²¡æœ‰è°ƒç”¨ .request ä¼šæœ‰128ä¸ªäº‹ä»¶çš„ç¼“å­˜åŒº.ä¸Šæ¸¸å¯ç»§ç»­å‘å‡ºäº‹ä»¶,ç¼“å­˜åŒºè¶…å‡º128ä¸ªäº‹ä»¶å,æŠ›å‡ºå¼‚å¸¸.</li>
</ul>
</li>
</ul>
<h3 id="Flowableæ‹“å±•"><a href="#Flowableæ‹“å±•" class="headerlink" title="Flowableæ‹“å±•"></a>Flowableæ‹“å±•</h3><h2 id="è¿™é‡Œå¯¹-Flowable-å¤šçš„å‚æ•°è¿›è¡Œè¯´æ˜"><a href="#è¿™é‡Œå¯¹-Flowable-å¤šçš„å‚æ•°è¿›è¡Œè¯´æ˜" class="headerlink" title="* è¿™é‡Œå¯¹ Flowable å¤šçš„å‚æ•°è¿›è¡Œè¯´æ˜."></a>* è¿™é‡Œå¯¹ Flowable å¤šçš„å‚æ•°è¿›è¡Œè¯´æ˜.</h2><ul>
<li>å‚æ•°<ul>
<li>BackpressureStrategy.BUFFER : é»˜è®¤ç¼“å­˜åŒº128,è¿™ä¸ªå‚æ•°æå¤§æ‹“å±•äº†ç¼“å­˜åŒº,ä½¿å¾— Flowable è¡¨ç°ä¸ Observable å·®ä¸å¤š.</li>
<li>BackpressureStrategy.DROP : 128ç¼“å­˜åŒºæ»¡äº†,å°±ä¸¢å¼ƒä¸Šæ¸¸äº‹ä»¶,ç›´åˆ°ä¸‹æ¸¸å¤„ç†äº†ä¸€ä¸ªäº‹ä»¶,ç¼“å­˜åŒº -1 ,å†å…è®¸å­˜å…¥æ–°çš„ä¸Šæ¸¸äº‹ä»¶.</li>
<li>BackpressureStrategy.LATEST : æ°¸è¿œä¿å­˜æœ€åè¾¾åˆ°çš„128ä¸ªä¸Šæ¸¸äº‹ä»¶,ä¸Šæ¸¸æœ‰æ–°çš„äº‹ä»¶åˆ°è¾¾æ»¡è½½çš„ç¼“å­˜åŒºæ—¶,ä¸¢å¼ƒç¬¬ä¸€ä¸ªå­˜å…¥ç¼“å­˜åŒºçš„ä¸Šæ¸¸äº‹ä»¶.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p>å¯¹äºä¸æ˜¯ç”±æˆ‘ä»¬ç¼–å†™çš„ Flowable ä¹Ÿå¯ä»¥é€šè¿‡ interval æ“ä½œç¬¦æ¥åŠ å·¥.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Flowable.interval(1, TimeUnit.MICROSECONDS)</div><div class="line">              .onBackpressureDrop()  //åŠ ä¸Š Backpressure ç­–ç•¥</div></pre></td></tr></table></figure>
</li>
<li><p>å¯¹åº”ä¸Šæ–‡,æŒ‡å®šå‚æ•°æœ‰3,æ„æ€åŒä¸Š.</p>
<ul>
<li>onBackpressureBuffer()</li>
<li>onBackpressureDrop()</li>
<li>onBackpressureLatest()</li>
</ul>
</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/04/Androidéšæ‰‹è®°-GlideåŠ è½½Drawableå¯¹è±¡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/04/Androidéšæ‰‹è®°-GlideåŠ è½½Drawableå¯¹è±¡/" itemprop="url">
                  Androidéšæ‰‹è®°â€”GlideåŠ è½½Drawableå¯¹è±¡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-04T12:00:00+08:00">
                2017-11-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Androidéšæ‰‹è®°/" itemprop="url" rel="index">
                    <span itemprop="name">Androidéšæ‰‹è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/04/Androidéšæ‰‹è®°-GlideåŠ è½½Drawableå¯¹è±¡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/04/Androidéšæ‰‹è®°-GlideåŠ è½½Drawableå¯¹è±¡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/11/04/Androidéšæ‰‹è®°-GlideåŠ è½½Drawableå¯¹è±¡/" class="leancloud_visitors" data-flag-title="Androidéšæ‰‹è®°â€”GlideåŠ è½½Drawableå¯¹è±¡">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  194
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  1m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 3.0</li>
</ul>
<hr>
<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul>
<li><p>Glideæ˜¯ä¸€ä¸ªé€šç”¨çš„å›¾ç‰‡ç¼“å­˜æ¡†æ¶,ä½†æ˜¯åœ¨MyPrivacyæ˜¾ç¤ºappIconæ—¶,ä¼ å…¥ ä¸€ä¸ªDrawableå¯¹è±¡,æç¤ºç±»å‹ä¸åŒ¹é…. </p>
</li>
<li><p>(æ³¨æ„: è¿™é‡Œæ˜¯ç›´æ¥ä¼ å…¥Drawableå¯¹è±¡,ä¸æ˜¯ç»è¿‡ R.xx å¼•ç”¨ !)</p>
</li>
</ul>
<h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><ul>
<li>æŸ¥é˜…èµ„æ–™å,ç¡®è®¤Glideä¸æ”¯æŒç›´æ¥åŠ è½½ä¼ å…¥çš„Drawableå¯¹è±¡,è½¬æ¢ä¸ºbitDrawableç±»å‹ä¹Ÿä¸å¯.</li>
<li><p>è§£å†³æ€è·¯æ¥è‡ª</p>
<blockquote>
<p><a href="https://github.com/bumptech/glide/issues/588" target="_blank" rel="external">https://github.com/bumptech/glide/issues/588</a></p>
</blockquote>
</li>
<li><p>ä¸æ”¯æŒç›´æ¥åŠ è½½,ä½†Glideçš„.error(Icon)é”™è¯¯æ—¶æ˜¾ç¤º   .placeholder(Icon)å ä½ç¬¦,æ”¯æŒDrawableå¯¹è±¡</p>
</li>
</ul>
<h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><ul>
<li>ä¸å†ç›´æ¥åŠ è½½ .load ä¼ å…¥ç©ºå­—ç¬¦ä¸², é€šè¿‡ .placeholder ç®€æ´åŠ è½½.</li>
<li>demo <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Drawable Iconã€€ï¼ã€€ï½˜ï½˜ï½˜ï¼›</div><div class="line"></div><div class="line">RequestOptions options = new RequestOptions()</div><div class="line">             .error(Icon)</div><div class="line">             .placeholder(Icon);</div><div class="line"></div><div class="line"> Glide.with(context)</div><div class="line">             .load(&quot;&quot;)</div><div class="line">             .apply(options)</div><div class="line">             .into(imageView);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h3><ul>
<li>placeholder åœ¨Glide 4.xç‰ˆæœ¬ä¸­,ç§»å…¥äº† RequestOptions å¯¹è±¡ä¸­.</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/10/linuxç¬”è®°â€”qemuè¿è¡Œlinux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/10/linuxç¬”è®°â€”qemuè¿è¡Œlinux/" itemprop="url">
                  linuxç¬”è®°â€”qemuè¿è¡Œlinux
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-10T10:17:11+08:00">
                2017-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linuxç¬”è®°/" itemprop="url" rel="index">
                    <span itemprop="name">Linuxç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/10/linuxç¬”è®°â€”qemuè¿è¡Œlinux/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/10/linuxç¬”è®°â€”qemuè¿è¡Œlinux/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/09/10/linuxç¬”è®°â€”qemuè¿è¡Œlinux/" class="leancloud_visitors" data-flag-title="linuxç¬”è®°â€”qemuè¿è¡Œlinux">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  965
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  5m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ul>
<li>ubuntu16.04</li>
<li>ä½¿ç”¨busyboxç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨qemuè¿è¡Œèµ·æ¥ã€‚</li>
<li>å†…å®¹æ¥è‡ª å¥”è·‘å§linuxå†…æ ¸ç¬¬6ç« </li>
<li>è¿™é‡Œå°†è¾“å…¥ä»£ç è¿‡ç¨‹é›†åˆåˆ°äº†å‡ ä¸ª.shæ–‡ä»¶,ä¸åšé‡å¤çš„å·¥ä½œ !</li>
<li>å½“ç„¶ç½‘å¥½æ˜¯å‰æ,æœ€å¥½æŒ‚ä»£ç†.</li>
</ul>
<hr>
<h2 id="å®‰è£…å·¥å…·"><a href="#å®‰è£…å·¥å…·" class="headerlink" title="å®‰è£…å·¥å…·"></a>å®‰è£…å·¥å…·</h2><ul>
<li><p>é¦–å…ˆéœ€è¦å®‰è£…qemu gcc, ubuntu16.04ä¸­è‡ªå¸¦çš„gccç‰ˆæœ¬è¾ƒä½,è¿™é‡Œæˆ‘ä»¬å®‰è£…ä¹¦ä¸­æ¨èçš„gcc-arm-linux-gnueabi </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install qemu libncurses5-dev gcc-arm-linux-gnueabi build-essential</div></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½busyboxæºç </p>
<ul>
<li>ä¹¦ä¸­æ¨èç‰ˆæœ¬æ˜¯1.24,ä½†æœ€æ–°ç‰ˆæœ¬å·²ç»åˆ°äº†busybox-1.27.2.è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€æ–°ç‰ˆ<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://busybox.net/downloads/busybox-1.27.2.tar.bz2</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>è§£å‹åˆ° busybox æ–‡ä»¶å¤¹<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -jxvf busybox-1.27.2.tar.bz2</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>ä¸‹è½½linuxå†…æ ¸æºç <ul>
<li>è¿˜æ˜¯ä»¥é…å¥—çš„4.0æºç ä¸ºä¾‹,(æé†’:å†…æ ¸è§£å‹åå¤§çº¦å 800MB,è¯·é¢„ç•™å‡ºè¶³å¤Ÿç©ºé—´)<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://www.kernel.org/pub/linux/kernel/v4.x/linux-4.0.tar.gz</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>è§£å‹åˆ°linuxæ–‡ä»¶å¤¹<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -jxvf linux-4.0.tar.gz</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿ"><a href="#ç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿ"></a>ç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿ</h2><h2 id="åˆ«é—®æˆ‘æœ€å°æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆ-æˆ‘ä¹Ÿæœ‰ç‚¹ğŸ˜µ-ä½†æ˜¯å…ˆç”¨èµ·æ¥"><a href="#åˆ«é—®æˆ‘æœ€å°æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆ-æˆ‘ä¹Ÿæœ‰ç‚¹ğŸ˜µ-ä½†æ˜¯å…ˆç”¨èµ·æ¥" class="headerlink" title="* åˆ«é—®æˆ‘æœ€å°æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆ,æˆ‘ä¹Ÿæœ‰ç‚¹ğŸ˜µ,ä½†æ˜¯å…ˆç”¨èµ·æ¥."></a>* åˆ«é—®æˆ‘æœ€å°æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆ,æˆ‘ä¹Ÿæœ‰ç‚¹ğŸ˜µ,ä½†æ˜¯å…ˆç”¨èµ·æ¥.</h2><ul>
<li><p>é¦–å…ˆåˆ©ç”¨ busybox æ‰‹å·¥ç¼–è¯‘ä¸€ä¸ªæœ€å°æ–‡ä»¶ç³»ç»Ÿã€‚<br>åœ¨busyboxæ–‡ä»¶å¤¹ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export ARCH=ARM</div><div class="line">export CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make menuconfig</div><div class="line">make install</div></pre></td></tr></table></figure>
</li>
<li><p>è¿›å…¥menuconfigå,é…ç½®é™æ€ç¼–è¯‘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Busybox Settings ---&gt;</div><div class="line">Build Options ---&gt;</div><div class="line">[*] Build BusyBox as a static binary (no shared libs)</div></pre></td></tr></table></figure>
</li>
<li><p>ç„¶å make install ç¼–è¯‘å®Œæˆã€‚ç¼–è¯‘å®Œæˆå,æŠŠ busybox æ ¹ç›®å½•ä¸‹é¢çš„_install ç›®å½•æ‹·è´åˆ° linux-4.0 ä¸‹ã€‚</p>
</li>
<li><p>è¿›å…¥_install ç›®å½•ï¼Œåˆ›å»º etcã€dev ç­‰ç›®å½•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir etc</div><div class="line">mkdir dev</div><div class="line">mkdir mnt</div><div class="line">mkdir -p etc/init.d/</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨_install /etc/init.d/ç›®å½•ä¸‹åˆ›å»º æ–‡ä»¶årcS çš„æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mkdir â€“p /proc</div><div class="line">mkdir â€“p /tmp</div><div class="line">mkdir -p /sys</div><div class="line">mkdir â€“p /mnt</div><div class="line">/bin/mount -a</div><div class="line">mkdir -p /dev/pts</div><div class="line">mount -t devpts devpts /dev/pts</div><div class="line">echo /sbin/mdev &gt; /proc/sys/kernel/hotplug</div><div class="line">mdev â€“s</div></pre></td></tr></table></figure>
<p>åŒæ—¶ä½¿ç”¨ <code>chmod +x rcS</code>ä¿®æ”¹rcSçš„å¯æ‰§è¡Œæƒé™.</p>
</li>
<li><p>åœ¨_install /etc ç›®å½•åˆ›å»ºæ–‡ä»¶å fstab çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">proc /proc proc defaults 0 0</div><div class="line">tmpfs /tmp tmpfs defaults 0 0</div><div class="line">sysfs /sys sysfs defaults 0 0</div><div class="line">tmpfs /dev tmpfs defaults 0 0</div><div class="line">debugfs /sys/kernel/debug debugfs defaults 0 0</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨_install /etc ç›®å½•åˆ›å»ºæ–‡ä»¶å inittab çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥å¦‚ä¸‹å†…å®¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">::sysinit:/etc/init.d/rcS</div><div class="line">::respawn:-/bin/sh</div><div class="line">::askfirst:-/bin/sh</div><div class="line">::ctrlaltdel:/bin/umount -a â€“r</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨_install/dev ç›®å½•ä¸‹åˆ›å»ºå¦‚ä¸‹è®¾å¤‡èŠ‚ç‚¹ï¼Œä»¥rootæƒé™æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd _install/dev/</div><div class="line">sudo mknod console c 5 1</div><div class="line">sudo mknod null c 1 3</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="sh-é…åˆchmod-xä½¿ç”¨"><a href="#sh-é…åˆchmod-xä½¿ç”¨" class="headerlink" title=".sh(é…åˆchmod +xä½¿ç”¨)"></a>.sh(é…åˆchmod +xä½¿ç”¨)</h3><ul>
<li><p>build.sh: ç¼–è¯‘busybox</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export ARCH=ARM</div><div class="line">export CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make menuconfig</div><div class="line">make install</div></pre></td></tr></table></figure>
</li>
<li><p>creat.sh: _installæ–‡ä»¶å¤¹ä¸‹å¤„ç†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">rm -rf etc </div><div class="line">rm -rf dev </div><div class="line">rm -rf mnt </div><div class="line">mkdir etc</div><div class="line">mkdir dev</div><div class="line">mkdir mnt</div><div class="line">mkdir -p etc/init.d/</div><div class="line"></div><div class="line">echo &quot;mkdir -p /proc</div><div class="line">mkdir -p /tmp</div><div class="line">mkdir -p /sys</div><div class="line">mkdir -p /mnt</div><div class="line">/bin/mount -a</div><div class="line">mkdir -p /dev/pts</div><div class="line">mount -t devpts devpts /dev/pts</div><div class="line">echo /sbin/mdev &gt; /proc/sys/kernel/hotplug</div><div class="line">mdev -s</div><div class="line">&quot; &gt; etc/init.d/rcS</div><div class="line">chmod +x etc/init.d/rcS</div><div class="line"></div><div class="line">echo &quot;proc /proc proc defaults 0 0</div><div class="line">tmpfs /tmp tmpfs defaults 0 0</div><div class="line">sysfs /sys sysfs defaults 0 0</div><div class="line">tmpfs /dev tmpfs defaults 0 0</div><div class="line">debugfs /sys/kernel/debug debugfs defaults 0 0</div><div class="line">&quot; &gt; etc/fstab</div><div class="line"></div><div class="line">echo &quot;::sysinit:/etc/init.d/rcS</div><div class="line">::respawn:-/bin/sh</div><div class="line">::askfirst:-/bin/sh</div><div class="line">::ctrlaltdel:/bin/umount -a -r</div><div class="line">&quot; &gt; etc/inittab</div><div class="line"></div><div class="line">cd dev/</div><div class="line">sudo mknod console c 5 1</div><div class="line">sudo mknod null c 1 3</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ç¼–è¯‘å†…æ ¸"><a href="#ç¼–è¯‘å†…æ ¸" class="headerlink" title="ç¼–è¯‘å†…æ ¸"></a>ç¼–è¯‘å†…æ ¸</h2><ul>
<li><p>ç¼–è¯‘å†…æ ¸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd linux-4.0</div><div class="line">export ARCH=arm</div><div class="line">export CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make vexpress_defconfig</div><div class="line">make menuconfig</div></pre></td></tr></table></figure>
</li>
<li><p>é…ç½® initramfsï¼Œåœ¨ initramfs source file ä¸­å¡«å…¥_installã€‚å¦å¤–éœ€è¦æŠŠ Default kernel command string æ¸…ç©ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">General setup ---&gt;</div><div class="line">[*] Initial RAM filesystem and RAM disk (initramfs/initrd) support</div><div class="line">(_install) Initramfs source file(s)</div><div class="line">Boot options --&gt;</div><div class="line">()Default kernel command string</div></pre></td></tr></table></figure>
</li>
<li><p>é…ç½® memory split ä¸ºâ€œ3G/1G user/kernel splitâ€ä»¥åŠæ‰“å¼€é«˜ç«¯å†…å­˜ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Kernel Features ---&gt;</div><div class="line">Memory split (3G/1G user/kernel split) ---&gt;</div><div class="line">[ *] High Memory Support</div></pre></td></tr></table></figure>
</li>
<li><p>å¼€å§‹ç¼–è¯‘ kernel</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">make bzImage -j4 ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make dtbs</div></pre></td></tr></table></figure>
</li>
<li><p>è¿è¡Œ QEMU æ¥æ¨¡æ‹Ÿ 4 æ ¸ Cortex-A9 çš„ Versatile Express å¼€å‘å¹³å°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qemu-system-arm -M vexpress-a9 -smp 4 -m 1024M -kernel arch/arm/boot/zImage -append &quot;rdinit=/linuxrc console=ttyAMA0 loglevel=8&quot; -dtb arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="sh-é…åˆchmod-x"><a href="#sh-é…åˆchmod-x" class="headerlink" title=".sh(é…åˆchmod +x)"></a>.sh(é…åˆchmod +x)</h3><ul>
<li><p>build.sh : ç¼–è¯‘å†…æ ¸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">export ARCH=arm</div><div class="line">export CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make vexpress_defconfig</div><div class="line">make menuconfig</div><div class="line">make bzImage -j4 ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make dtbs</div></pre></td></tr></table></figure>
</li>
<li><p>run.sh : è¿è¡Œarmå†…æ ¸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qemu-system-arm -M vexpress-a9 -smp 4 -m 1024M -kernel arch/arm/boot/zImage -append &quot;rdinit=/linuxrc console=ttyAMA0 loglevel=8&quot; -dtb arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographicyun</div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/23/linuxç¬”è®°â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/23/linuxç¬”è®°â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘/" itemprop="url">
                  linuxç¬”è®°â€”â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-23T17:52:16+08:00">
                2017-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linuxç¬”è®°/" itemprop="url" rel="index">
                    <span itemprop="name">Linuxç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/23/linuxç¬”è®°â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/23/linuxç¬”è®°â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/23/linuxç¬”è®°â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘/" class="leancloud_visitors" data-flag-title="linuxç¬”è®°â€”â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  2,948
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  11m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>wdtç¬¬äºŒå¼¹ï¼Œå†…æ ¸APIï¼Œå‹‰å¼ºç¿»è¯‘ä¸‹æ¥äº†ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥æ•´ç†</li>
</ul>
<hr>
<h2 id="çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API"><a href="#çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API" class="headerlink" title="çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API"></a>çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API</h2><ul>
<li>æœ€åæ›´æ–°æ—¶é—´ 2013.2.12</li>
<li>Wim Van Sebroeck <a href="&#109;&#x61;&#x69;&#108;&#x74;&#111;&#x3a;&#119;&#105;&#x6d;&#x40;&#105;&#x67;&#117;&#97;&#x6e;&#97;&#x2e;&#x62;&#x65;">&#119;&#105;&#x6d;&#x40;&#105;&#x67;&#117;&#97;&#x6e;&#97;&#x2e;&#x62;&#x65;</a></li>
</ul>
<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><ul>
<li>æœ¬æ–‡æ¡£æ²¡æœ‰æè¿°çœ‹é—¨ç‹—è®¾å¤‡æˆ–é©±åŠ¨ã€‚ä¹Ÿä¸æ¶‰åŠé‚£äº›åœ¨ç”¨æˆ·ç©ºé—´è°ƒç”¨çš„APIï¼Œå¯¹åº”åœ¨ Documentation/watchdog/watchdog-api.txt ï¼ˆä¹Ÿå°±æ˜¯<a href="">ä¸Šä¸€ç¯‡</a>ï¼‰</li>
<li>æœ¬æ–‡æ¡£æè¿°çš„æ˜¯ï¼Œåˆ©ç”¨çœ‹é—¨ç‹—å­ç³»ç»Ÿæ¡†æ¶æ–¹å¼è¿›è¡Œçœ‹é—¨ç‹—é©±åŠ¨ç¼–å†™æ—¶æ‰€ä½¿ç”¨åˆ°çš„APIã€‚çœ‹é—¨ç‹—å­ç³»ç»Ÿæ¡†æ¶æä¾›äº†æ‰€æœ‰ä¸ç”¨æˆ·ç©ºé—´äº¤äº’çš„æ¥å£ï¼Œä¸éœ€è¦æ¯æ¬¡ç¼–å†™é‡å¤çš„ä»£ç ã€‚è¿™æ„å‘³è¿™é©±åŠ¨ç¨‹åºåªéœ€è¦æä¾›å‡ ä¸ªä¸åŒçš„æ“ä½œå‡½æ•°ï¼Œå°±å¯ä»¥æ§åˆ¶WDTäº†ã€‚</li>
</ul>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><ul>
<li><p>æ¯ä¸€ä¸ªæƒ³è¦ä½¿ç”¨çœ‹é—¨ç‹—æ ¸å¿ƒå­ç³»ç»Ÿçš„é©±åŠ¨ç¨‹åºéƒ½å¿…é¡»åŒ…å«<code>#include&lt;linux/watchdog.h&gt;</code>(ç¼–å†™é©±åŠ¨ç¨‹åºæ˜¯ä¸å¾—ä¸åšçš„å·¥ä½œ)ã€‚<code>linux/watchdog.h</code>åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ³¨å†Œ/å¸è½½å‡½æ•°ï¼š</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">extern int watchdog_register_device(struct watchdog_device *);</div><div class="line">extern void watchdog_unregister_device(struct watchdog_device *);</div></pre></td></tr></table></figure>
</li>
<li><p>æ³¨å†Œå‡½æ•°å°†wdtè®¾å¤‡æ³¨å†Œè¿›wdtå­ç³»ç»Ÿï¼Œå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘struct watchdog<em>deviceçš„ç»“æ„ä½“</em>ã€‚å½“æ³¨å†ŒæˆåŠŸæ—¶è¿”å›0.æ³¨å†Œå¤±è´¥è¿”å›ä¸€ä¸ªè´Ÿå€¼ã€‚</p>
</li>
<li>å¸è½½å‡½æ•°æ˜¯å°†wdtè®¾å¤‡ä»wdtå­ç³»ç»Ÿå¸è½½ï¼Œå‡½æ•°å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘struct watchdog<em>deviceçš„ç»“æ„ä½“</em></li>
<li>çœ‹é—¨å­ç³»ç»ŸåŒ…å«äº†æ³¨å†Œæ—¶é—´è°ƒæ•´æœºåˆ¶ï¼ˆåŸæ–‡æ˜¯ an registration deferral mechanism ä¸€ç§å»¶æœŸæœºåˆ¶ï¼Ÿä¸Šä¸‹æ–‡ä¸å¤ªå¯¹å•Šï¼‰ï¼Œå…è®¸åœ¨å¼€æœºé˜¶æ®µï¼Œä½ å¯ä»¥æŒ‰ç…§ä½ è®¾å®šçš„å°½å¯æ—©çš„æ³¨å†Œä¸€ä¸ªçœ‹é—¨ç‹—è®¾å¤‡ã€‚</li>
</ul>
<h3 id="struct-watchdogdevice"><a href="#struct-watchdogdevice" class="headerlink" title="struct watchdogdevice"></a>struct watchdog<em>device</em></h3><ul>
<li>è¿™é‡Œç²˜è´´çš„æ˜¯linux4.1é‡Œå®šä¹‰çš„watchdog_deviceï¼ŒåŸæ–‡çš„watchdog_deviceæ›´é•¿ä½†è·Ÿæºç å¯¹ä¸èµ·æ¥ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»¥å†…æ ¸4.1é‡Œå®šä¹‰çš„ä¸ºå‡†äº†ğŸ˜‘ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"> struct watchdog_device &#123;</div><div class="line">int id;</div><div class="line">struct cdev cdev;</div><div class="line">struct device *dev;</div><div class="line">struct device *parent;</div><div class="line">const struct watchdog_info *info;</div><div class="line">const struct watchdog_ops *ops;</div><div class="line">unsigned int bootstatus;</div><div class="line">unsigned int timeout;</div><div class="line">unsigned int min_timeout;</div><div class="line">unsigned int max_timeout;</div><div class="line">void *driver_data;</div><div class="line">struct mutex lock;</div><div class="line">unsigned long status;</div><div class="line">/* Bit numbers for status flags */</div><div class="line">#define WDOG_ACTIVE		0	/* Is the watchdog running/active */</div><div class="line">#define WDOG_DEV_OPEN		1	/* Opened via /dev/watchdog ? */</div><div class="line">#define WDOG_ALLOW_RELEASE	2	/* Did we receive the magic char ? */</div><div class="line">#define WDOG_NO_WAY_OUT		3	/* Is &apos;nowayout&apos; feature set ? */</div><div class="line">#define WDOG_UNREGISTERED	4	/* Has the device been unregistered */</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>åŒ…å«ä»¥ä¸‹å­—æ®µï¼š<ul>
<li>idï¼šç”±watchdog_register_deviceå‡½æ•°æ³¨å†Œã€‚id 0æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ï¼Œid 0 æœ‰/dev/watchdog0 cdevï¼ˆåŠ¨æ€ä¸»è®¾å¤‡å·ï¼Œæ¬¡è®¾å¤‡å·0ï¼‰ å’Œ /dev/watchdog miscdevã€‚id åœ¨è°ƒç”¨åˆ°watchdog_register_deviceæ—¶è‡ªåŠ¨æ³¨å†Œã€‚<ul>
<li><strong>NOTE</strong>çœ‹æºç ï¼Œwdtå­ç³»ç»Ÿæ˜¯åŸºäºmiscå­ç³»ç»Ÿçš„ï¼Œæ³¨å†Œwdtè®¾å¤‡è°ƒç”¨çš„æ˜¯<code>misc_register(&amp;watchdog_miscdev);</code>è€Œmiscè®¾å¤‡ä¸»è®¾å¤‡å·åªèƒ½ä¸º10,è¿™é‡Œç»“è®ºæœ‰å†²çªï¼Œç­‰å¾…è§£å†³ä¸­ã€‚ã€‚ã€‚<ul>
<li>parentï¼šåœ¨è°ƒç”¨watchdog_register_deviceå‡½æ•°å‰ï¼Œè®¾ç½®çˆ¶è®¾å¤‡ï¼ˆæˆ–è€…è®¾ç½®ä¸ºnullï¼‰</li>
<li>infoï¼šæŒ‡å‘watchdog_infoç»“æ„ä½“çš„æŒ‡é’ˆï¼Œwatchdog_infoæä¾›äº†çœ‹é—¨ç‹—æœ¬èº«çš„ä¸€äº›é™„åŠ ä¿¡æ¯ï¼ˆåƒæ˜¯çœ‹é—¨ç‹—ç‹¬æœ‰çš„åç§°ä¹‹ç±»çš„ï¼‰</li>
<li>opsï¼šæŒ‡å‘watchdog_opsç»“æ„ä½“çš„æŒ‡é’ˆï¼Œwatchdog_opsæ˜¯çœ‹é—¨ç‹—æ”¯æŒæ“ä½œ(å‡½æ•°)çš„é›†åˆã€‚</li>
<li>bootstatus:å¯åŠ¨åè®¾å¤‡çŠ¶æ€(ä¸çœ‹é—¨ç‹—WDIOF<em>* æ ‡å¿—ä½ä¸€åŒå¼€å¯)</em></li>
<li>timeout:çœ‹é—¨ç‹—è¶…æ—¶çš„æ—¶é—´(ç§’ä¸ºå•ä½).å¦‚æœè®¾ç½®äº†WDOG<em>ACTIVE </em>å¯ç”¨äº†çœ‹é—¨ç‹—,åœ¨è¿™ä¸ªæ—¶é—´é•¿åº¦å,ç”¨æˆ·ç©ºé—´è¿˜æ²¡æœ‰å‘é€å¿ƒè·³åŒ…,çœ‹é—¨ç‹—ä¼šå°†ç³»ç»Ÿå¤ä½é‡å¯.</li>
<li>min<em>timeout:</em>å¯è®¾ç½®çš„çœ‹é—¨ç‹—æœ€å°è¶…æ—¶æ—¶é—´</li>
<li>max<em>timeout:</em>å¯è®¾ç½®çš„çœ‹é—¨ç‹—æœ€å¤§è¶…æ—¶æ—¶é—´</li>
<li>driver<em>data:</em>æŒ‡å‘çœ‹é—¨ç‹—è®¾å¤‡ç§æœ‰æ•°æ®çš„æŒ‡é’ˆ,è¿™ä¸ªdataåªèƒ½ç”±watchdog_set_drvdata å’Œ watchdog_get_drvdata routineså‡½æ•°è®¿é—®.</li>
<li>struct mutex lock; <strong>åŸæ–‡æ¡£æ²¡æœ‰ğŸ™„</strong></li>
<li>status:è¿™ä¸ªå­—æ®µåŒ…å«äº†è®¸å¤šçŠ¶æ€ä½,æä¾›æœ‰å…³è®¾å¤‡çš„é¢å¤–ä¿¡æ¯(ä¾‹å¦‚:çœ‹é—¨ç‹—çš„æ´»åŠ¨çŠ¶æ€\é™åˆ¶,ç°åœ¨nowayout ä½è®¾ç½®ä¸å¦)(æ‹¬å·é‡Œç¿»è¯‘æ˜¯å¦å‡†ç¡®å­˜ç–‘)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="struct-watchdog-ops"><a href="#struct-watchdog-ops" class="headerlink" title="struct watchdog_ops"></a>struct watchdog_ops</h3><ul>
<li><p>watchdog<em>ops</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> struct watchdog_ops &#123;</div><div class="line">struct module *owner;</div><div class="line">/* mandatory operations */</div><div class="line">int (*start)(struct watchdog_device *);</div><div class="line">int (*stop)(struct watchdog_device *);</div><div class="line">/* optional operations */</div><div class="line">int (*ping)(struct watchdog_device *);</div><div class="line">unsigned int (*status)(struct watchdog_device *);</div><div class="line">int (*set_timeout)(struct watchdog_device *, unsigned int);</div><div class="line">unsigned int (*get_timeleft)(struct watchdog_device *);</div><div class="line">void (*ref)(struct watchdog_device *);</div><div class="line">void (*unref)(struct watchdog_device *);</div><div class="line">long (*ioctl)(struct watchdog_device *, unsigned int, unsigned long);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>ä½ ä¸€å¼€å§‹å®šä¹‰çš„çœ‹é—¨ç‹—çš„module owneræ˜¯éå¸¸é‡è¦çš„,module owner åœ¨ä½¿ç”¨çœ‹é—¨ç‹—æ—¶ä¼šåŒæ—¶é”å®šçœ‹é—¨ç‹—è®¾å¤‡.(è¿™æ ·é¿å…äº†åœ¨å¸è½½æ¨¡å—æ—¶/dev/watchdogä¾ç„¶æ˜¯æ‰“å¼€çŠ¶æ€å¼•èµ·çš„ç³»ç»Ÿå´©æºƒ)</p>
</li>
<li><p>æŸäº›å‡½æ•°æ˜¯å¿…é¡»å®ç°çš„,å…¶ä»–æ˜¯å¯é€‰çš„,å¿…é¡»å®ç°çš„å‡½æ•°å¦‚ä¸‹:</p>
<ul>
<li><em>start  :</em>æŒ‡å‘çœ‹é—¨ç‹—è®¾å¤‡å¯åŠ¨å‡½æ•°çš„æŒ‡é’ˆ.è¿™ä¸ªå‡½æ•°å‚æ•°ä¸ºä¸€ä¸ª struct watchdog<em>device,</em>æˆåŠŸè¿”å›0,å¤±è´¥è¿”å›è´Ÿæ•°.</li>
<li><em>stop :</em>é€šè¿‡è¿™ä¸ªå‡½æ•°å…³é—­çœ‹é—¨ç‹—è®¾å¤‡.è¿™ä¸ªå‡½æ•°å‚æ•°ä¸ºä¸€ä¸ª struct watchdog<em>device,</em>æˆåŠŸè¿”å›0,å¤±è´¥è¿”å›è´Ÿæ•°.<ul>
<li>ä¸€äº›ç¡¬ä»¶çœ‹é—¨ç‹—è®¾å¤‡åªèƒ½å¯åŠ¨,æ²¡æœ‰å…³é—­é€‰é¡¹.å¯¹åº”è¿™äº›è®¾å¤‡çš„é©±åŠ¨,ä¸ç”¨å®ç° <em>stop  ,</em>å¦‚æœé©±åŠ¨ç¨‹åºæ²¡æœ‰å…³é—­è®¾å¤‡åŠŸèƒ½,çœ‹é—¨ç‹—æ ¸å¿ƒå±‚ä¼šåœ¨è®¾å¤‡å…³é—­åè®¾ç½® WDOG_HW_RUNNING å¹¶è°ƒç”¨é©±åŠ¨ç¨‹åºçš„ keepalive pingsåŠŸèƒ½.</li>
<li>å¦‚æœçœ‹é—¨ç‹—é©±åŠ¨æ²¡æœ‰å®ç°<em>stop  </em>å¿…é¡»è®¾ç½®max_hw_heartbeat<em>ms</em></li>
</ul>
</li>
</ul>
</li>
<li><p>ä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶çœ‹é—¨ç‹—éƒ½æœ‰ç›¸åŒçš„åŠŸèƒ½,è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰å¯é€‰å‡½æ•°äº†,åªæœ‰ä½†è¿™é¡¹åŠŸèƒ½è¢«ç¡¬ä»¶çœ‹é—¨ğŸ¶æ”¯æŒæ—¶,æ‰ç¼–å†™å¯¹åº”å‡½æ•°.</p>
<ul>
<li>ping:è¿™æ˜¯çœ‹é—¨ç‹—é©±åŠ¨å®ç°çš„å–‚ç‹—å‡½æ•°,è¿™ä¸ªå‡½æ•°çš„å‚æ•°æ—¶ä¸€ä¸ªæŒ‡å‘struct watchdog<em>deviceçš„æŒ‡é’ˆ</em>.å‡½æ•°æ‰§è¡ŒæˆåŠŸè¿”å›0,å¤±è´¥è¿”å›è´Ÿæ•°.<ul>
<li>å¤§å¤šæ•°çš„ç¡¬ä»¶ä¸æ”¯æŒç›´æ¥å–‚ç‹—çš„ç‰¹æ®ŠåŠŸèƒ½,ä¸€èˆ¬æ˜¯ç›´æ¥é‡å¯ç¡¬ä»¶çœ‹é—¨ç‹—.</li>
<li>çœ‹é—¨ç‹—å­ç³»ç»Ÿçš„æ ¸å¿ƒå±‚ä¹Ÿæ˜¯è¿™æ ·åšçš„:ä½†å®šæœŸå–‚ç‹—çš„æ“ä½œè½¬å‘åˆ°ç¡¬ä»¶çœ‹é—¨ç‹—æ—¶,æ ¸å¿ƒå±‚åœ¨ <em>ping å®ç°</em>æ—¶è°ƒç”¨å–‚ç‹—å‡½æ•°,ä½†å–‚ç‹—å‡½æ•°æ²¡æœ‰å®ç°æ—¶,ä½¿ç”¨ start  å¯¹åº”å‡½æ•°</li>
<li>( WDIOC_KEEPALIVEå¯¹åº”çš„ ioctlå‘½ä»¤åªæœ‰åœ¨içœ‹é—¨ç‹—infoé‡Œçš„WDIOF_KEEPALIVEPINGè¢«è®¾ç½®ä¸º1åæ‰ä¼šç”Ÿæ•ˆ )</li>
</ul>
</li>
<li>status: è¿™ä¸ªå‡½æ•°ç”¨æ¥æ£€æŸ¥çœ‹é—¨ç‹—è®¾å¤‡çš„çŠ¶æ€,é€šè¿‡çœ‹é—¨ç‹—çš„WDIOF<em>*</em>çŠ¶æ€æ ‡å¿—ä½æŠ¥å‘Š.WDIOF_MAGICCLOSE and WDIOF_KEEPALIVEPINGç”±çœ‹é—¨ç‹—æ ¸å¿ƒå±‚æŠ¥å‘Š.æ²¡æœ‰å¿…è¦åœ¨é©±åŠ¨ç¨‹åºä¸­æŠ¥å‘Š.æ­¤å¤–å¦‚æœé©±åŠ¨ç¨‹åºæ²¡æœ‰å®ç°è¯¥å‡½æ•°,çœ‹é—¨ç‹—æ ¸å¿ƒå±‚ä¼šè¿”å› struct watchdog<em>device</em>ä¸­çš„bootstatusçŠ¶æ€ä½.</li>
<li>set_timeout:è¿™ä¸ªå‡½æ•°è®¾ç½®å’Œæ£€æŸ¥ è¶…æ—¶æ—¶é—´çš„å˜åŒ–,è¿”å›0è¡¨ç¤ºæˆåŠŸ,è¿”å›-EINVALè¡¨ç¤ºè¶…å‡ºèŒƒå›´,è¿”å›-EIOè¡¨ç¤ºæ— æ³•å†™å…¥çœ‹é—¨ç‹—.è®¾ç½®æˆåŠŸå,å‡½æ•°åº”è¯¥å°†è®¾å®šçš„è¶…æ—¶æ—¶é—´å†™å…¥çœ‹é—¨ç‹—.(æˆ–è®¸ä¸é€šè¿‡æ¥å£è·å–çš„è¶…æ—¶æ—¶é—´ä¸åŒ,å› ä¸ºçœ‹é—¨ç‹—çš„åˆ†è¾¨ç‡ä¸ä¸€å®šèƒ½åˆ°1s). <ul>
<li>å®ç°äº†max_hw_heartbeat_msçš„é©±åŠ¨å°†ç¡¬ä»¶çœ‹é—¨ç‹—å¿ƒè·³å€¼è®¾ç½®ä¸ºè¶…æ—¶æ—¶é—´å’Œmax_hw_heartbeat_msä¹‹é—´çš„æœ€å°å€¼.Those drivers set the timeout value of the watchdog_device either to the requested timeout value (if it is larger than max_hw_heartbeat_ms), or to the achieved timeout value.</li>
<li>å¦‚æœçœ‹é—¨ç‹—é©±åŠ¨ç¨‹åºæ²¡æœ‰æ‰§è¡Œä»»ä½•æ“ä½œ,ä½†è®¾ç½®äº†watchdog<em>device.timeout</em>,æ­¤å›æ‰å‡½æ•°å¿½ç•¥.</li>
<li>å¦‚æœæ²¡æœ‰è®¾ç½® set_timeout,ä½†è®¾ç½®äº†WDIOF_SETTIMEOUT,çœ‹é—¨ç‹—æ¶æ„ä¼šå°† watchdog_deviceä¸­timeoutå€¼æ›´æ–°ä¸ºè¯·æ±‚çš„å€¼.</li>
<li>å¦‚æœä½¿ç”¨äº†pretimeout feature (WDIOF_PRETIMEOUT),é‚£ä¹ˆset_timeout å¿…é¡»åŒæ—¶æ£€æŸ¥ pretimeout æ˜¯å¦æœ‰æ•ˆ ,è®¾ç½®ç›¸åº”å®šæ—¶å™¨. è¿™äº›æ“ä½œåœ¨æ ¸å¿ƒå±‚æ²¡æœ‰racesæ— æ³•å®Œæˆ,æ‰€ä»¥å¿…é¡»åœ¨é©±åŠ¨ä¸­å®Œæˆ.</li>
</ul>
</li>
<li>set<em>pretimeout</em>:è¿™ä¸ªå‡½æ•°æ”¯æŒæ£€æŸ¥/æ”¹å˜çœ‹é—¨ç‹—ä¸­pretimeoutå€¼(pretimeoutè¯¦æƒ…è§wdtç”¨æˆ·å±‚apiç¿»è¯‘).è¿™ä¸ªå‡½æ•°æ˜¯å¯é€‰æ”¯æŒçš„,å› ä¸ºä¸æ˜¯æ‰€æœ‰çš„çœ‹é—¨ç‹—éƒ½æ”¯æŒè¿™ä¸ªåŠŸèƒ½.pretimeout ä¸æ˜¯ç»å¯¹æ—¶é—´,å…¶æ•°å€¼æ˜¯åœ¨è¶…æ—¶æ—¶é—´ä¹‹å‰å‡ ç§’å‘ç”Ÿ.<ul>
<li>è¿”å›0è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸ,è¿”å›-EINVAL,è¡¨ç¤ºè¶…å‡ºèŒƒå›´,è¿”å›-EIOè¡¨ç¤ºæœªèƒ½æˆåŠŸå‘çœ‹é—¨ç‹—å†™å…¥.</li>
<li>è®¾ç½®pretimeouä¸º0å€¼,ä»£è¡¨ç¦ç”¨pretimeoutåŠŸèƒ½.(WDIOF<em>PRETIMEOUT</em>éœ€è¦åœ¨çœ‹é—¨ç‹—çš„info ç»“æ„ä½“ä¸­è®¾ç½®)</li>
<li>å¦‚æœé©±åŠ¨æ²¡æœ‰å®ç°ä»»ä½•åŠŸèƒ½,ä½†è®¾å®šäº† watchdog<em>device.pretimeout</em>,æ­¤å›æ‰å‡½æ•°å¿½ç•¥.è¿™æ„å‘³è¿™,å¦‚æœæ²¡æœ‰æä¾›set<em>pretimeout</em>å‡½æ•°,ä½†è®¾å®šäº†WDIOF<em>PRETIMEOUT</em>,çœ‹é—¨ç‹—æ¶æ„ä¼šå°†pretimeoutçš„å€¼æ›´æ–°ä¸ºè¯·æ±‚å€¼.</li>
</ul>
</li>
<li>get<em>timeleft:</em>è¿™ä¸ªå‡½æ•°è¿”å›å¤ä½å‰å‰©ä½™æ—¶é—´.</li>
<li>restart:æ­¤å‡½æ•°é‡å¯çœ‹é—¨ç‹—ç¡¬ä»¶,è¿”å›0è¡¨ç¤ºæˆåŠŸ,å¤±è´¥è¿”å›å¯¹åº”é”™è¯¯ç .</li>
<li>ioctl:å¦‚æœè¿™ä¸ªå‡½æ•°å­˜åœ¨,åœ¨ç³»ç»Ÿè¿›è¡Œå†…éƒ¨ioctlå‘½ä»¤å¤„ç†å‰,ä¼šé¦–å…ˆè°ƒç”¨æ­¤å‡½æ•°.å¦‚æœä¸æ”¯æŒioctrlå‘½ä»¤,åº”è¯¥è¿”å› -ENOIOCTLCMD .è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸º(watchdog<em>device, cmd and arg)</em></li>
<li>refå’Œunref å·²ç»ä¸å†è¢«æ”¯æŒ.</li>
</ul>
</li>
<li><p>The status bits should (preferably) be set with the set_bit and clear_bit alike bit-operations. The status bits that are defined are:</p>
<ul>
<li>WDOG<em>ACTIVE:</em>è¿™ä¸ªçŠ¶æ€ä½æ ‡è¯†ç€ä»ç”¨æˆ·ç©ºé—´çœ‹ä¸€ä¸ªçœ‹é—¨ç‹—è®¾å¤‡æ˜¯å¦è¢«æ¿€æ´»,å¦‚æœè¢«æ¿€æ´»,ç”¨æˆ·ç©ºé—´éœ€è¦æ‰§è¡Œå–‚ç‹—åŠ¨ä½œ</li>
<li>WDOG_NO_WAY<em>OUT:</em>è¿™ä¸ªçŠ¶æ€ä½æ ‡è¯†è¿™nowayoutçš„è®¾ç½®,å¦‚æœè¢«æ¿€æ´»,é‚£çœ‹é—¨ç‹—å¯åŠ¨å,æ— æ³•è¢«åœæ­¢.</li>
<li>WDOG_HW_RUNNING:å¦‚æœç¡¬ä»¶çœ‹é—¨ç‹—è¿è¡Œ,æ­¤çŠ¶æ€ä½è¢«ç½®1.<ul>
<li>å½“ç¡¬ä»¶çœ‹é—¨ç‹—ä¸èƒ½è¢«åœæ­¢æ—¶,è¿™ä¸ªçŠ¶æ€ä½å¿…é¡»è¢«ç½®1.</li>
<li>å¦‚æœç³»ç»Ÿå¯åŠ¨åè‡ªåŠ¨å¯åŠ¨çœ‹é—¨ç‹—,åœ¨çœ‹é—¨ç‹—æ‰“å¼€å‰,å¿…é¡»è®¾ç½®æ­¤çŠ¶æ€ä½.</li>
<li>å½“æ­¤çŠ¶æ€ä½è¢«ç½®1,å³ä½¿WDOG<em>ACTIVEä¸º0</em>.çœ‹é—¨ç‹—æ¶æ„ä¹Ÿä¼šæ‰§è¡Œå–‚ç‹—åŠ¨ä½œ.</li>
<li>(å½“ä½ ç›´æ¥æ³¨å†Œè®¾ç½®äº† WDOG_HW_RUNNINGä½çš„çœ‹é—¨ç‹—è®¾å¤‡æ—¶,æ‰§è¡Œopen /dev/watchdogåŠ¨ä½œ,ç³»ç»Ÿä¼šç›´æ¥è·³è¿‡å¯åŠ¨æ“ä½œ,ç›´æ¥æ‰§è¡Œå–‚ç‹—æ“ä½œ )</li>
</ul>
</li>
</ul>
<ul>
<li><p>è¦è®¾ç½®WDOG_NO_WAY<em>OUT</em>çŠ¶æ€ä½(åœ¨æ³¨å†Œçœ‹é—¨ç‹—è®¾å¤‡å‰)ä½ å¯ä»¥:</p>
<ul>
<li><p>åœ¨watchdog<em>device</em>çš„ç»“æ„ä½“ä¸­è®¾ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.status = WATCHDOG_NOWAYOUT_INIT_STATUS,</div></pre></td></tr></table></figure>
<p>è¿™æ ·ç­‰åŒäºå°†WDOG_NO_WAY<em>OUT</em>å€¼è®¾ç½®ä¸ºCONFIG_WATCHDOG_NOWAYOUT</p>
</li>
<li>ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">static inline void watchdog_set_nowayout(struct watchdog_device *wdd, int nowayout)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>(note:)   wdté©±åŠ¨ç¨‹åºæ ¸å¿ƒæ”¯æŒmagic closeå’Œ nowayoutåŠŸèƒ½.è¦ä½¿ç”¨magic close,éœ€è¦åœ¨çœ‹é—¨ç‹—çš„ infoä¸­è®¾ç½®WDIOF<em>MAGICCLOSE </em>ä½.å¼€å¯ nowayout ä¼šè¦†ç›–magic close.</p>
</li>
<li><p>è·å–æˆ–è®¾å®šé©±åŠ¨ç¨‹åºç‰¹æ®Šæ•°æ®,åº”è¯¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">static inline void watchdog_set_drvdata(struct watchdog_device *wdd, void *data)</div><div class="line">static inline void *watchdog_get_drvdata(struct watchdog_device *wdd)</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>watchdog_set_drvdataå‡½æ•°å…è®¸ä½ æ·»åŠ å‘é©±åŠ¨ç¨‹åºæ·»åŠ ç‰¹æ®Šæ•°æ®,æ­¤å‡½æ•°çš„å‚æ•°ä¸ºæŒ‡å‘çœ‹é—¨ç‹—è®¾å¤‡çš„æŒ‡é’ˆ,å’ŒæŒ‡å‘éœ€è¦æ·»åŠ æ•°æ®çš„æŒ‡é’ˆ.</li>
<li>watchdog_get_drvdataå‡½æ•°è¿è¡Œä½ è¯»å–é©±åŠ¨ç¨‹åºä¸­çš„ç‰¹æ®Šæ•°æ®,æ­¤å‡½æ•°çš„å‚æ•°ä¸ºæŒ‡å‘ä½ æƒ³è¯»å–çš„çœ‹é—¨ç‹—è®¾å¤‡çš„æŒ‡é’ˆ.</li>
</ul>
<ul>
<li><p>åˆå§‹åŒ– timeout ,ä¼šç”¨åˆ°ä¸‹é¢çš„å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  extern int watchdog_init_timeout(struct watchdog_device *wdd,unsigned int timeout_parm, struct device *dev);</div><div class="line">  ``` </div><div class="line">  </div><div class="line">  * watchdog_init_timeoutå…è®¸ä½¿ç”¨æ¨¡å—çš„ timeout å­—æ®µåˆå§‹åŒ– timeout ,å½“æ¨¡å—çš„ timeout å­—æ®µæ— æ•ˆæ—¶,è®¾å¤‡æ ‘ä¸­çš„timeout-secä¹Ÿå¯.æœ€å¥½çš„åšæ³•æ˜¯å°†watchdog_device_ä¸­timeoutçš„å€¼,è®¾ç½®ä¸ºåˆå§‹é»˜è®¤å€¼,ç„¶åä½¿ç”¨åˆ°å‡½æ•°çš„ç”¨æˆ·å¯ä»¥åˆ†åˆ«è®¾ç½®è‡ªå®šä¹‰å€¼.</div><div class="line"></div><div class="line">* é‡å¯åç¦ç”¨çœ‹é—¨ç‹—,éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‡½æ•°:</div></pre></td></tr></table></figure>
<p>static inline void watchdog_stop_on_reboot(struct watchdog_device *wdd);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">* å¸è½½çœ‹é—¨ç‹—è®¾å¤‡æ—¶ç¦ç”¨çœ‹é—¨ç‹—,å¿…é¡»è°ƒç”¨æ­¤å‡½æ•°,å¦‚æœ nowayout æ²¡æœ‰è®¾ç½®,è¿™ä¸ªå‡½æ•°åªä¼šåœæ­¢çœ‹é—¨ç‹—.</div></pre></td></tr></table></figure>
<p>static inline void watchdog_stop_on_unregister(struct watchdog_device *wdd);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">* æ›´æ”¹é‡å¯å¤„ç†ç¨‹åºçš„ä¼˜å…ˆçº§,(çŒœæµ‹æ˜¯ä¸åŒçœ‹é—¨ç‹—çš„ä¼˜å…ˆçº§)è°ƒç”¨ä¸‹é¢çš„å‡½æ•°:</div></pre></td></tr></table></figure>
<p>oid watchdog_set_restart_priority(struct watchdog_device *wdd, int priority);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  * è®¾å®šä¼˜å…ˆçº§æ—¶,ç”¨æˆ·éœ€è¦éµå¾ªä»¥ä¸‹è§„åˆ™</div><div class="line">    * 0:ä¼˜å…ˆçº§æœ€ä½,éå¸¸æœ‰é™çš„é‡å¯èƒ½åŠ›</div><div class="line">    * 128:é‡å¯å¤„ç†çš„é»˜è®¤é€‰æ‹©,å¦‚æœæ²¡æœ‰å…¶ä»–çš„é‡å¯å¤„ç†ç¨‹åºå¯ç”¨,æˆ–è€…æ²¡æœ‰é‡å¯æ•´ä¸ªç³»ç»Ÿçš„é‡å¯å¤„ç†ç¨‹åºå¯ç”¨.</div><div class="line">    * 255:æœ€é«˜ä¼˜å…ˆçº§,ä¼šè¦†ç›–å…¶ä»–æ‰€æœ‰é‡å¯å¤„ç†ç¨‹åº</div><div class="line"></div><div class="line">* ä½¿ç”¨pretimeout é€šçŸ¥åŠŸèƒ½,éœ€è¦åˆ©ç”¨ä»¥ä¸‹å‡½æ•°:</div></pre></td></tr></table></figure>
<p>void watchdog_notify_pretimeout(struct watchdog_device *wdd)<br>```</p>
<ul>
<li>è¿™ä¸ªå‡½æ•°å¯ä»¥åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨,å¦‚æœå¯ç”¨äº†watchdog pretimeout governor æ¡†æ¶(kbuild CONFIG_WATCHDOG_PRETIMEOUT_GOV),å°±ä¼šé‡‡ç”¨è¿›å…¥é©±åŠ¨ç¨‹åºåˆ†é…å¥½çš„å¤„ç†ç¨‹åº,å¦‚æœæ²¡æœ‰å¯ç”¨watchdog pretimeout governor æ¡†æ¶,watchdog_notify_pretimeout()ä¼šå°†ä¿¡æ¯è¾“å‡ºåˆ°å†…æ ¸æ—¥å¿—ç¼“å­˜.</li>
</ul>
</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/22/linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/22/linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘/" itemprop="url">
                  linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-22T17:52:16+08:00">
                2017-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linuxç¬”è®°/" itemprop="url" rel="index">
                    <span itemprop="name">Linuxç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/22/linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/22/linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/22/linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘/" class="leancloud_visitors" data-flag-title="linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  1,662
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  7m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ul>
<li>éšæ‰‹ç¿»è¯‘çš„æ–‡æ¡£ï¼Œè¦çœ‹æ‡‚linuxå†…æ ¸ï¼Œå†…æ ¸é™„å¸¦çš„æ–‡æ¡£è‡ªç„¶æ˜¯é€ƒä¸è¿‡ğŸ˜‚ï¼Œå…¨è‹±æ–‡é…åˆGoogleç¿»è¯‘ä¹Ÿå¾—ä¸Šã€‚ã€‚ã€‚ã€‚</li>
</ul>
<hr>
<ul>
<li><p>æœ€åæ›´æ–°æ—¶é—´ 10/05/2007</p>
</li>
<li><p>linuxçœ‹é—¨ç‹—è®¾å¤‡API</p>
</li>
<li>Copyright 2002 Christer Weingel <a href="&#x6d;&#x61;&#x69;&#108;&#x74;&#x6f;&#x3a;&#119;&#x69;&#x6e;&#x67;&#101;&#x6c;&#x40;&#x6e;&#x61;&#x6e;&#x6f;&#45;&#x73;&#121;&#x73;&#x74;&#x65;&#109;&#x2e;&#x63;&#111;&#x6d;">&#119;&#x69;&#x6e;&#x67;&#101;&#x6c;&#x40;&#x6e;&#x61;&#x6e;&#x6f;&#45;&#x73;&#121;&#x73;&#x74;&#x65;&#109;&#x2e;&#x63;&#111;&#x6d;</a></li>
<li><p>æœ¬æ–‡æ¡£çš„ä¸€äº›å†…å®¹æ¥è‡ª sbc60xxwdt ï¼Œç‰ˆæƒå±äº Copyright 2000 Jakob Oestergaard <a href="&#109;&#x61;&#105;&#x6c;&#x74;&#x6f;&#x3a;&#106;&#97;&#x6b;&#111;&#x62;&#x40;&#111;&#x73;&#x74;&#x65;&#110;&#102;&#x65;&#108;&#100;&#46;&#100;&#107;">&#106;&#97;&#x6b;&#111;&#x62;&#x40;&#111;&#x73;&#x74;&#x65;&#110;&#102;&#x65;&#108;&#100;&#46;&#100;&#107;</a></p>
</li>
<li><p>æœ¬æ–‡æ¡£åŸºäºlinuxå†…æ ¸ 2.4.18</p>
</li>
</ul>
<hr>
<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><ul>
<li>ä½ åº”è¯¥å·²ç»çŸ¥é“äº†ï¼Œçœ‹é—¨ç‹—å®šæ—¶å™¨ï¼ˆWDTï¼‰æ˜¯ä¸€ä¸ªç¡¬ä»¶å¤ä½ç”µè·¯ï¼Œåœ¨ç³»ç»Ÿè½¯ä»¶å‡ºç°æ•…éšœæ—¶å¤ä½ç³»ç»Ÿã€‚</li>
<li>é€šå¸¸ï¼Œç”¨æˆ·ç©ºé—´çš„å®šæœŸå–‚ç‹—ç¨‹åºé€šè¿‡/dev/watchdogçš„è®¾å¤‡æ–‡ä»¶é€šçŸ¥å†…æ ¸çœ‹é—¨ç‹—é©±åŠ¨ç¨‹åºã€‚é©±åŠ¨æ”¶åˆ°é€šçŸ¥ï¼Œä¼šå‘ŠçŸ¥ç¡¬ä»¶çœ‹é—¨ç‹—ä¸€åˆ‡æ­£å¸¸ï¼Œç¡¬ä»¶çœ‹é—¨ç‹—éœ€è¦ç­‰ä¸€ä¼šå†å¤ä½ç³»ç»Ÿã€‚å¦‚æœç”¨æˆ·ç©ºé—´é€šçŸ¥å¤±è´¥ï¼ˆRAMé”™è¯¯ã€å†…æ ¸æ¼æ´ç­‰ç­‰ï¼‰ï¼Œé€šçŸ¥å°†åœæ­¢ã€‚è¶…æ—¶åï¼Œç¡¬ä»¶çœ‹é—¨ç‹—å°†å¤ä½ç³»ç»Ÿï¼ˆé‡å¯ï¼‰ã€‚</li>
<li>linuxçœ‹é—¨ç‹—çš„APIæ˜¯ç›¸å½“ç‰¹æ®Šçš„ç»“æ„ï¼Œä¸åŒçš„é©±åŠ¨ç¨‹åºå¯¹APIçš„æ‰§è¡Œå„ä¸ç›¸åŒï¼Œæœ‰æ—¶ä¼šç¢°åˆ°ä¸å…¼å®¹çš„æƒ…å†µã€‚æœ¬æ–‡æ¡£å‚æ•°è®°å½•ç°æœ‰çš„æƒ…å†µï¼Œä»¥ä¾›æœªæ¥çš„é©±åŠ¨å¼€å‘å‚è€ƒã€‚<h3 id="æœ€ç®€å•çš„API"><a href="#æœ€ç®€å•çš„API" class="headerlink" title="æœ€ç®€å•çš„API"></a>æœ€ç®€å•çš„API</h3></li>
<li>æ‰€æœ‰é©±åŠ¨éƒ½æ”¯æŒçš„åŸºæœ¬æ“ä½œæ¨¡å¼ã€‚/dev/watchdogè¢«æ‰“å¼€åï¼Œçœ‹é—¨ç‹—è¢«æ¿€æ´»å¹¶å¤ä½ç³»ç»Ÿï¼Œé™¤éåœ¨ä¸€å°æ®µæ—¶é—´å†…è¢«pingé€šï¼Ÿï¼ˆå–‚ç‹—ï¼‰ï¼Œè¿™æ®µæ—¶é—´è¢«ç§°ä¸ºè¶…æ—¶æ—¶é—´æˆ–é—´æ–­æ—¶é—´ã€‚ç®€å•çš„å–‚ç‹—çš„æ–¹å¼æ˜¯å‘é©±åŠ¨ç¨‹åºå†™å…¥ä¸€äº›æ•°æ®ï¼Œä¸€ä¸ªéå¸¸ç®€å•çš„å®ä¾‹åœ¨<code>see samples/watchdog/watchdog-simple.c</code>ä¸‹.</li>
<li>æ›´é«˜çº§çš„é©±åŠ¨ç¨‹åºå¯ä»¥åšåˆ°ä¾‹å¦‚æ£€æŸ¥ä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œåœ¨æ‰§è¡Œå–‚ç‹—æ“ä½œä¹‹å‰ï¼Œåšå‡ºå›åº”ã€‚</li>
<li>/dev/ä¸‹è®¾å¤‡èŠ‚ç‚¹è¢«å…³é—­åï¼Œçœ‹é—¨ç‹—ä¹ŸåŒæ—¶è¢«ç¦ç”¨ï¼Œé™¤éæ”¯æŒâ€œMagic Closeâ€ï¼ˆè§ä¸‹æ–‡ï¼‰ï¼Œè¿™å¹¶ä¸æ˜¯ä¸ªå¥½åŠæ³•ã€‚å› ä¸ºå¦‚æœçœ‹çœ‹é—¨ç‹—demoæœ‰bugå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œä½†ç³»ç»Ÿä¸ä¼šé‡å¯ã€‚å› ä¸ºè¿™æ ·ä¸€äº›é©±åŠ¨æ”¯æŒâ€Disable watchdog shutdown on closeâ€, CONFIG_WATCHDOG_NOWAYOUTâ€è¿™æ ·çš„é…ç½®é€‰é¡¹ã€‚ä¸€æ—¦ç¼–è¯‘å†…æ ¸æ—¶å€™å¯ç”¨è¿™äº›é€‰é¡¹ï¼Œä¸€æ—¦çœ‹é—¨ç‹—ç¨‹åºæ¿€æ´»ï¼Œå°±ä¸å¯èƒ½ç¦ç”¨çœ‹é—¨ç‹—ã€‚å¦‚æœçœ‹é—¨ç‹—demoå´©æºƒï¼Œç³»ç»Ÿä¼šåœ¨è¶…æ—¶åè‡ªåŠ¨é‡å¯ã€‚çœ‹é—¨ç‹—é©±åŠ¨é€šå¸¸ä¹Ÿæ”¯æŒnowayout module parameterï¼Œä»¥ä¾¿åœ¨è¿è¡Œæ—¶æ§åˆ¶nowayout moduleã€‚</li>
</ul>
<h3 id="Magic-Close-feature"><a href="#Magic-Close-feature" class="headerlink" title="Magic Close feature"></a>Magic Close feature</h3><ul>
<li>å¦‚æœé©±åŠ¨ç¨‹åºæ”¯æŒ<code>Magic Close</code>,é‚£ä¹ˆè®¾å¤‡å°†ä¸æ”¯æŒç¦ç”¨çœ‹é—¨ç‹—ï¼Œé™¤éåœ¨å…³é—­è®¾å¤‡æ–‡ä»¶å‰ï¼Œå‘/dev/watchdogä¸‹è®¾å¤‡æ–‡ä»¶å†™å…¥ç‰¹å®šçš„magic å­—ç¬¦ â€˜Vâ€™ã€‚å¦‚æœç”¨æˆ·ç©ºé—´çš„ daemonå…³é—­äº†çœ‹é—¨çš„è®¾å¤‡æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰å‘é€é‚£ä¸ªç‰¹å®šçš„å­—ç¬¦ï¼Œé©±åŠ¨ä¼šè®¤ä¸ºdaemonè¿›ç¨‹å·²ç»è¢«æ€ï¼Œå¹¶ä¸”åœæ­¢äº†å®šæœŸå–‚ç‹—è¡Œä¸ºã€‚è¿™æ ·ä¼šå¯¼è‡´è¶…æ—¶åç³»ç»Ÿé‡å¯ã€‚<h3 id="ioctl-API"><a href="#ioctl-API" class="headerlink" title="ioctl API"></a>ioctl API</h3></li>
<li>æ‰€æœ‰çš„é©±åŠ¨ç¨‹åºéƒ½æ”¯æŒioctl API</li>
<li><strong>å–‚ç‹—æ“ä½œä½¿ç”¨ioctlå®Œæˆ</strong></li>
<li>æ‰€æœ‰çš„é©±åŠ¨éƒ½è¦æ”¯æŒä¸€ä¸ªKEEPALIVEçš„ioctlå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥èµ·åˆ°å‘é©±åŠ¨å†™å…¥æ•°æ®ä¸€æ ·çš„ä½œç”¨ã€‚æ‰€ä»¥watchdog daemonçš„ä¸»å‡½æ•°å¾ªç¯å¯ä»¥è¿™æ ·å®ç°<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> while (1) &#123;</div><div class="line">	ioctl(fd, WDIOC_KEEPALIVE, 0);</div><div class="line">	sleep(10);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Setting-and-getting-the-timeout"><a href="#Setting-and-getting-the-timeout" class="headerlink" title="Setting and getting the timeout"></a>Setting and getting the timeout</h3><ul>
<li>æŸäº›é©±åŠ¨æ”¯æŒè¿è¡Œæ—¶é€šè¿‡SETTIMEOUT ioctlå‘½ä»¤ä¿®æ”¹è¶…æ—¶æ—¶é—´ï¼Œè¿™äº›é©±åŠ¨éƒ½æœ‰WDIOF<em>SETTIMEOUTçš„æ ‡å¿—ä½</em>ã€‚è¶…æ—¶æ—¶é—´æ˜¯ä¸€ä¸ªå•ä½ä¸ºç§’çš„æ•´æ•°ï¼Œé©±åŠ¨ç¨‹åºä¼šè¿”å›è¿™ä¸ªå˜é‡å®é™…è®¾ç½®çš„æ•°å€¼ï¼Œä½†æ˜¯ç”±äºç¡¬ä»¶é™åˆ¶ï¼Œè¿”å›çš„æ•°å€¼å¯èƒ½ä¸è®¾ç½®æ•°å€¼ä¸åŒã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">int timeout = 45;</div><div class="line">ioctl(fd, WDIOC_SETTIMEOUT, &amp;timeout);</div><div class="line">printf(&quot;The timeout was set to %d seconds\n&quot;, timeout);</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>è¿™ä¸ªå®ä¾‹æˆ–è®¸ä¼šè¾“å‡ºâ€The timeout was set to 60 secondsâ€ï¼Œå¦‚æœè®¾å¤‡è¶…æ—¶æ—¶é—´ä¸ºåˆ†é’Ÿã€‚</p>
</li>
<li><p>è‡ªä»2.4.18å†…æ ¸å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨GETTIMEOUT ioctlå‘½ä»¤ï¼Œè·å–è¶…æ—¶æ—¶é—´ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ioctl(fd, WDIOC_GETTIMEOUT, &amp;timeout);</div><div class="line"><span class="built_in">printf</span>(<span class="string">"The timeout was is %d seconds\n"</span>, timeout);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Pretimeouts"><a href="#Pretimeouts" class="headerlink" title="Pretimeouts"></a>Pretimeouts</h3><ul>
<li><p>ä¸€äº›çœ‹é—¨ç‹—å®šæ—¶å™¨å¯ä»¥åœ¨ç³»ç»Ÿé‡å¯å‰ä¸€æ®µæ—¶é—´è®¾ç½®ä¸€ä¸ªè§¦å‘å™¨ã€‚è¿™æ ·è¿è¡Œlinuxåœ¨ç³»ç»Ÿä»å‰è®°å½•ä¸€äº›é‡è¦çš„ä¿¡æ¯ï¼ˆåƒpanicä¿¡æ¯å’Œkernel coredumpsï¼‰ï¼Œå…·ä½“å¯ä»¥é€šè¿‡NMTã€ä¸­æ–­ç­‰æœºåˆ¶å®ç°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pretimeout = 10;</div><div class="line">ioctl(fd, WDIOC_SETPRETIMEOUT, &amp;pretimeout);</div></pre></td></tr></table></figure>
</li>
<li><p>è¯·æ³¨æ„ï¼Œpretimeout æ—¶é—´æ˜¯åœ¨ è¶…æ—¶å…³é—­ç³»ç»Ÿ ä¹‹å‰çš„ç§’æ•°ã€‚ä¸æ˜¯ç›´åˆ°å‘ç”Ÿpretimeout äº‹ä»¶çš„ç§’æ•°ã€‚ä¾‹å¦‚è®¾å®šçš„è¶…æ—¶æ—¶é—´æ˜¯60sï¼Œ pretimeoutæ˜¯10sã€‚pretimeoutäº‹ä»¶ä¼šåœ¨50sæ—¶å‘ç”Ÿã€‚pretimeoutè®¾ç½®ä¸º0ä»£è¡¨ç¦ç”¨pretimeoutã€‚</p>
</li>
<li><p>åŒæ ·å­˜åœ¨ä¸€ä¸ªè·å–pretimeoutçš„ioctlå‘½ä»¤ã€‚</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ioctl(fd, WDIOC_GETPRETIMEOUT, &amp;timeout);</div><div class="line">printf(&quot;The pretimeout was is %d seconds\n&quot;, timeout);</div></pre></td></tr></table></figure>
</li>
<li><p>ä¸æ˜¯æ‰€æœ‰çœ‹é—¨ç‹—é©±åŠ¨éƒ½æ”¯æŒ pretimeout</p>
</li>
</ul>
<h3 id="è·å–é‡å¯å‰ç§’æ•°"><a href="#è·å–é‡å¯å‰ç§’æ•°" class="headerlink" title="è·å–é‡å¯å‰ç§’æ•°"></a>è·å–é‡å¯å‰ç§’æ•°</h3><ul>
<li>ä¸€äº›çœ‹é—¨ç‹—é©±åŠ¨æ”¯æŒè·å–ç³»ç»Ÿé‡å¯å‰ç§’æ•°ã€‚é€šè¿‡WDIOC<em>GETTIMELEFT  ioctl  </em>å‘½ä»¤å¯ä»¥è¿”å›ç³»ç»Ÿé‡å¯å‰ç§’æ•°ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ioctl(fd, WDIOC_GETTIMELEFT, &amp;timeleft);</div><div class="line">printf(&quot;The timeout was is %d seconds\n&quot;, timeleft);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="ç¯å¢ƒç›‘æµ‹"><a href="#ç¯å¢ƒç›‘æµ‹" class="headerlink" title="ç¯å¢ƒç›‘æµ‹"></a>ç¯å¢ƒç›‘æµ‹</h3><ul>
<li><p>æ‰€æœ‰çš„çœ‹é—¨ç‹—é©±åŠ¨éƒ½è¢«è¦æ±‚è¿”å›æ›´å¤šå…³äºç³»ç»Ÿæœ€åä¸€æ¬¡é‡å¯çš„ä¿¡æ¯ï¼Œåƒæ˜¯æ¸©åº¦ã€é£æ‰‡è½¬é€Ÿã€ç”µæºç­‰ã€‚GETSUPPORT ioctl çš„å‘½ä»¤å¯ä»¥è¿”å› è®¾å¤‡å¯ä»¥æ”¯æŒçš„ä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">struct watchdog_info ident;</div><div class="line">ioctl(fd, WDIOC_GETSUPPORT, &amp;ident);</div></pre></td></tr></table></figure>
</li>
<li><p>è¿”å›çš„ç»“æ„identä¸­çš„å­—æ®µå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">   identity		æè¿°watchdog driverçš„å­—ç¬¦ä¸²</div><div class="line">firmware_version	the firmware version of the card if available</div><div class="line">options			è®¾å¤‡æ”¯æŒæƒ…å†µçš„æ ‡å¿—ä½</div></pre></td></tr></table></figure>
</li>
<li><p>optionsæè¿°äº†GET_STATUS å’ŒGET_BOOT<em>STATUS ioctlå‘½ä»¤</em>å¯ä»¥è¿”å›é‚£äº›ä¿¡æ¯ã€‚å¹¶ä¸”å¯ä»¥è®¾ç½®ã€‚ï¼ˆï¼‰<strong>??æ— æ³•ç†è§£ä»€ä¹ˆæ„æ€??</strong></p>
</li>
</ul>
<ul>
<li>WDIOF<em>OVERHEAT     cpuè¿‡çƒ­å¤ä½</em><br>ç³»ç»Ÿé‡å¯å› ä¸ºï¼Œè¶…è¿‡äº†æ¸©åº¦é™åˆ¶ä¸Šé™ã€‚</li>
<li><p>WDIOF<em>FANFAULT        é£æ‰‡å¤±æ•ˆå¤ä½</em></p>
</li>
<li><p>WDIOF<em>EXTERN1        External relay 1 </em><br>å¤–éƒ¨ç›‘æ§ç”µæº1è¢«è§¦å‘ï¼Œï¼Ÿï¼Ÿï¼ŸControllers intended for real world applications include external monitoring pins that will trigger a reset.ï¼Ÿï¼Ÿï¼ˆä¸æ˜ç™½ä»€ä¹ˆæ„æ€ï¼‰</p>
</li>
<li><p>WDIOF_EXTERN2        External relay 2<br>å¤–éƒ¨ç›‘æ§ç”µæº2è¢«è§¦å‘</p>
</li>
<li><p>WDIOF_POWERUNDER    ç”µæºåäº†ï¼Œç”µæºå¸¦ä¸åŠ¨äº†<br>æœºå™¨æ˜¾ç¤ºæ¬ å‹ã€‚</p>
</li>
</ul>
<hr>
<ul>
<li>åé¢ä¸€ç‚¹ä¸ç¿»äº†ï¼Œæœ‰æ—¶é—´å†æ·»å‘</li>
</ul>
<hr>
<ul>
<li><p>WDIOF_CARDRESET        Card previously reset the CPU<br>The last reboot was caused by the watchdog card</p>
</li>
<li><p>WDIOF_POWEROVER        Power over voltage<br>The machine is showing an overvoltage status. Note that if one level is under and one over both bits will be set - this may seem odd but makes sense.</p>
</li>
<li><p>WDIOF_KEEPALIVEPING    Keep alive ping reply<br>The watchdog saw a keepalive ping since it was last queried.</p>
</li>
<li><p>WDIOF_SETTIMEOUT    Can set/get the timeout<br>The watchdog can do pretimeouts.</p>
</li>
<li><p>WDIOF_PRETIMEOUT    Pretimeout (in seconds), get/set<br>For those drivers that return any bits set in the option field, the GETSTATUS and GETBOOTSTATUS ioctls can be used to ask for the current status, and the status at the last reboot, respectively.  </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int flags;</div><div class="line">ioctl(fd, WDIOC_GETSTATUS, &amp;flags);</div></pre></td></tr></table></figure>
<p>  or</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ioctl(fd, WDIOC_GETBOOTSTATUS, &amp;flags);</div></pre></td></tr></table></figure>
</li>
<li><p>Note that not all devices support these two calls, and some only support the GETBOOTSTATUS call.</p>
</li>
<li><p>Some drivers can measure the temperature using the GETTEMP ioctl.  The returned value is the temperature in degrees fahrenheit.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int temperature;</div><div class="line">ioctl(fd, WDIOC_GETTEMP, &amp;temperature);</div></pre></td></tr></table></figure>
</li>
<li><p>Finally the SETOPTIONS ioctl can be used to control some aspects of the cards operation.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int options = 0;</div><div class="line">ioctl(fd, WDIOC_SETOPTIONS, &amp;options);</div></pre></td></tr></table></figure>
</li>
<li><p>The following options are available:</p>
<ul>
<li>WDIOS_DISABLECARD    Turn off the watchdog timer</li>
<li>WDIOS_ENABLECARD    Turn on the watchdog timer</li>
<li>WDIOS_TEMPPANIC        Kernel panic on temperature trip</li>
</ul>
</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/19/linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/19/linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ/" itemprop="url">
                  linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-19T10:17:11+08:00">
                2017-08-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linuxç¬”è®°/" itemprop="url" rel="index">
                    <span itemprop="name">Linuxç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/19/linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/19/linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/19/linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ/" class="leancloud_visitors" data-flag-title="linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  4,057
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  16m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>æ­£å¼å¼€å§‹è®©äººå´©æºƒçš„linuxç³»åˆ—ï¼Œå¸Œæœ›è‡ªå·±èƒ½å†™å®Œã€‚<br>å…ˆæ‹¿rtcå¼€åˆ€ã€‚</li>
<li><p>è¿™é‡Œæˆ‘å°½å¯èƒ½è®°å½•ä¸‹æ€ç»´çš„ç»†èŠ‚ï¼Œè€Œä¸æ˜¯ä»…å±€é™äºä»£ç ï¼Œå¸Œæœ›è‡ªå·±èƒ½é¢†ä¼šLinuxå†…æ ¸å¼€å‘è€…çš„æƒ³æ³•ã€‚</p>
</li>
<li><p>å†…æ ¸ç‰ˆæœ¬ï¼šlinux4.1</p>
</li>
<li>éœ€è¦äº†è§£ï¼šç®€ç•¥äº†è§£å­—ç¬¦é©±åŠ¨ å’Œ Linuxè®¾å¤‡é©±åŠ¨æ¨¡å‹</li>
</ul>
<hr>
<h3 id="RTC"><a href="#RTC" class="headerlink" title="RTC"></a>RTC</h3><ul>
<li>rtcå³real time clockï¼Œå®æ—¶æ—¶é’Ÿã€‚</li>
<li>rtcä¸€èˆ¬è´Ÿè´£ç³»ç»Ÿå…³æœºåè®¡æ—¶ï¼Œé¢å¯¹ç¹å¤šçš„Linux RTCè®¾å¤‡ï¼Œå†…æ ¸å¹²è„†æä¾›äº†ä¸€ä¸ªrtcå­ç³»ç»Ÿï¼Œæ¥æ”¯æŒæ‰€æœ‰çš„rtcè®¾å¤‡ã€‚</li>
<li>å‚è€ƒèµ„æ–™ </li>
</ul>
<h3 id="rtcå­ç³»ç»Ÿ"><a href="#rtcå­ç³»ç»Ÿ" class="headerlink" title="rtcå­ç³»ç»Ÿ"></a>rtcå­ç³»ç»Ÿ</h3><ul>
<li>rtcè®¾å¤‡æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ï¼Œrtcå­ç³»ç»Ÿåœ¨å­—ç¬¦è®¾å¤‡çš„åŸºç¡€ä¸ŠæŠ½è±¡ä¸ç¡¬ä»¶æ— å…³çš„éƒ¨åˆ†ï¼Œå¹¶åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ‹“å±•sysfså’Œprocæ–‡ä»¶ç³»ç»Ÿä¸‹çš„è®¿é—®ã€‚</li>
<li>åˆ†ææ—¶å€™å§‹ç»ˆè®°ä½ä¸¤ç‚¹ï¼š<ul>
<li>rtcå­ç³»ç»Ÿæ˜¯ä¸ºäº†è®©rtcè®¾å¤‡é©±åŠ¨ç¼–å†™æ›´ä¸ºç®€å•ï¼Œä¸ç¡¬ä»¶æ— å…³éƒ¨åˆ†å·²è¢«æŠ½ç¦»ã€‚</li>
<li>rtcå­ç³»ç»Ÿæ˜¯åŸºäºå­—ç¬¦è®¾å¤‡è€Œæ¥çš„ã€‚<h3 id="æ–‡ä»¶æ¡†æ¶"><a href="#æ–‡ä»¶æ¡†æ¶" class="headerlink" title="æ–‡ä»¶æ¡†æ¶"></a>æ–‡ä»¶æ¡†æ¶</h3></li>
</ul>
</li>
<li><p>rtcå­ç³»ç»Ÿçš„æºç åœ¨ /drivers/rtc<br><img src="https://my.mixtape.moe/anynhb.jpg" alt="1.jpg"><br>åˆ å‡äº†å¾ˆå¤šrtc-xxx.cçš„é©±åŠ¨ï¼Œåªç•™ä¸‹äº†ds1307ä½œä¸ºç¤ºä¾‹ï¼Œè¿™é‡Œçœ‹åˆ°å®é™…ä¸Šä»£ç å¹¶ä¸å¤šã€‚</p>
</li>
<li><p>å…·ä½“æ–‡ä»¶åˆ†æ</p>
<ul>
<li><p>rtc.hï¼šå®šä¹‰ä¸RTCæœ‰å…³çš„æ•°æ®ç»“æ„ã€‚</p>
</li>
<li><p>class.cï¼šå‘å†…æ ¸æ³¨å†ŒRTCç±»ï¼Œä¸ºåº•å±‚é©±åŠ¨æä¾›rtc_device_registerä¸rtc_device_unregisteræ¥å£ç”¨äºRTCè®¾å¤‡çš„æ³¨å†Œ/æ³¨é”€ã€‚åˆå§‹åŒ–RTCè®¾å¤‡ç»“æ„ã€sysfsã€procã€‚</p>
</li>
<li>Interface.cï¼šæä¾›ç”¨æˆ·ç¨‹åºä¸RTCçš„æ¥å£å‡½æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬ioctlå‘½ä»¤ã€‚</li>
<li>rtc-dev.cï¼šå°†RTCè®¾å¤‡æŠ½è±¡ä¸ºé€šç”¨çš„å­—ç¬¦è®¾å¤‡ï¼Œæä¾›æ–‡ä»¶æ“ä½œå‡½æ•°é›†ã€‚</li>
<li>rtc-sysfs.cï¼šç®¡ç†RTCè®¾å¤‡çš„sysfså±æ€§ï¼Œè·å–RTCè®¾å¤‡åã€æ—¥æœŸã€æ—¶é—´ç­‰ã€‚</li>
<li>rtc-proc.cï¼šç®¡ç†RTCè®¾å¤‡çš„procfså±æ€§ï¼Œæä¾›ä¸­æ–­çŠ¶æ€å’Œæ ‡å¿—æŸ¥è¯¢ã€‚</li>
<li>rtc-lib.cï¼šæä¾›RTCã€Dataå’ŒTimeä¹‹é—´çš„è½¬æ¢å‡½æ•°ã€‚</li>
<li>rtc-xxx,cï¼šRTCè®¾å¤‡çš„å®é™…é©±åŠ¨ï¼Œæ­¤å¤„ä»¥rtc-ds1307ä¸ºä¾‹ã€‚</li>
<li>hctosys.cï¼šå¼€æœºæ—¶è·å–RTCæ—¶é—´ã€‚</li>
</ul>
</li>
<li><p>æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿæ¡†æ¶<br><img src="https://my.mixtape.moe/fdixml.jpg" alt=""></p>
</li>
<li><p>RTCå­ç³»ç»Ÿå…·ä½“å¯åˆ†ä¸º3å±‚ï¼š</p>
<ul>
<li>ç”¨æˆ·å±‚ï¼šRTCå­ç³»ç»Ÿå‘ä¸Šå±‚æä¾›äº†æ¥å£ï¼Œç”¨æˆ·é€šè¿‡è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œé—´æ¥è°ƒç”¨RTCè®¾å¤‡ï¼Œå…·ä½“æœ‰3ç§æ–¹å¼ã€‚<ul>
<li>/dev/rtc  RTCè®¾å¤‡æŠ½è±¡è€Œæ¥çš„å­—ç¬¦è®¾å¤‡ï¼Œå¸¸è§„æ–‡ä»¶æ“ä½œé›†åˆã€‚</li>
<li>/sys/class/rtc/rtcx é€šè¿‡sysfsæ–‡ä»¶ç³»ç»Ÿè¿›è¡ŒRTCæ“ä½œï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚</li>
<li>/proc/driver/rtc  é€šè¿‡procæ–‡ä»¶ç³»ç»Ÿè·å–RTCç›¸å…³ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li>RTCæ ¸å¿ƒå±‚ï¼šä¸ç¡¬ä»¶æ— å…³ï¼Œç”¨äºç®¡ç†RTCè®¾å¤‡æ³¨å†Œ/æ³¨é”€ã€æä¾›ä¸Šå±‚æ–‡ä»¶æ“ä½œçš„æ¥å£ç­‰ã€‚</li>
<li>RTCé©±åŠ¨ï¼šç‰¹å®šRTCè®¾å¤‡çš„é©±åŠ¨ç¨‹åºï¼Œå®ç°RTCæ ¸å¿ƒå±‚çš„å›æ‰å‡½æ•°ã€‚ç¼–å†™RTCé©±åŠ¨éœ€è¦æŒ‰ç…§RTCå­ç³»ç»Ÿçš„æ¥å£å¡«å†™å¯¹åº”å‡½æ•°å¹¶å»ºç«‹æ˜ å°„å³å¯ã€‚RTCæ ¸å¿ƒå±‚å‡½æ•°å®ç°çš„è¿‡ç¨‹å’Œæ•°é‡ä¸ç‰¹å®šç¡¬ä»¶ç´§å¯†ç›¸å…³ã€‚</li>
</ul>
</li>
</ul>
<ul>
<li>åˆçœ‹linuxç³»ç»Ÿçš„äººæ¥è¯´ï¼Œè¿™ä¸ªå›¾å¤Ÿå¤´æ™•çš„äº†ï¼Œä½†æ˜¯å‘¢ï¼Œå®é™…ä¸Šæ²¡é‚£ä¹ˆéº»çƒ¦ã€‚ç”±æµ…å…¥æ·±ï¼Œä¸€ç‚¹ä¸€ç‚¹æ¥åˆ†æã€‚</li>
</ul>
<h3 id="rtcå­ç³»ç»Ÿåˆ†æ"><a href="#rtcå­ç³»ç»Ÿåˆ†æ" class="headerlink" title="rtcå­ç³»ç»Ÿåˆ†æ"></a>rtcå­ç³»ç»Ÿåˆ†æ</h3><h4 id="rtc-dev"><a href="#rtc-dev" class="headerlink" title="rtc-dev"></a>rtc-dev</h4><ul>
<li>rtcå­ç³»ç»ŸåŸºäºå­—ç¬¦è®¾å¤‡ï¼Œå­—ç¬¦è®¾å¤‡å¯¹åº”çš„è‚¯å®šæ˜¯rtc-dev.cäº†ï¼Œæˆ‘ä»¬çš„åˆ†æç”±rtc-devèµ·æ­¥ã€‚</li>
<li><p>rtc-dev.c<br><img src="https://my.mixtape.moe/ukpdro.jpg" alt=""></p>
</li>
<li><p>å…¸å‹çš„å­—ç¬¦è®¾å¤‡ï¼Œæ¨¡å—çš„åˆå§‹åŒ–/å¸è½½è‡ªç„¶æ˜¯ rtc_dev_init(void) å’Œ  rtc_dev_exit(void)ã€‚<br>è®¾å¤‡æ¥å…¥ï¼Œæ·»åŠ /åˆ é™¤è®¾å¤‡ rtc_dev_add_device(struct rtc_device <em>rtc) å’Œ  e)    void rtc_dev_del_device(struct rtc_device </em>rtc)<br>è¿˜æœ‰ioctlå’Œopenç­‰å‡½æ•°ï¼Œç†Ÿæ‚‰å­—ç¬¦è®¾å¤‡é©±åŠ¨çš„ä¸ç”¨å¤šè¯´ã€‚</p>
</li>
<li><p>è¿½è¸ªä¸€ä¸‹è¿™ä¸¤ç»„å‡½æ•°åœ¨å“ªé‡Œè°ƒç”¨çš„ã€‚</p>
<ul>
<li>rtc_dev_init(void)å¯¹åº”åœ¨ class.cçš„rtc_init(void)å‡½æ•°</li>
<li>rtc_dev_add_deviceå¯¹åº”åœ¨class.cçš„ rtc_device_register()å‡½æ•°ã€‚</li>
</ul>
</li>
<li><p>rtc_dev_init(void)å¯¹åº”å®åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶ä½¿ç”¨ï¼Œå¯¹åº”rtc_init(void)ä¹Ÿæ˜¯åœ¨ç³»ç»Ÿåˆå§‹åŒ–ä¹‹åè°ƒç”¨ã€‚</p>
</li>
<li>rtc_dev_add_device()æ˜¯åœ¨é©±åŠ¨åŒ¹é…åè°ƒç”¨ï¼Œrtc_device_register()ä¹Ÿæ˜¯åœ¨é©±åŠ¨åŒ¹é…åè°ƒç”¨ã€‚æ‰“å¼€rtc-ds1307.c&gt;-probå‡½æ•°ï¼Œèƒ½æ‰¾åˆ°rtc_device_register()ä¹Ÿå°±è¯å®äº†è¿™ä¸ªæ€è·¯ã€‚</li>
<li>æ¥ä¸‹æ¥è½¬å…¥class.c</li>
</ul>
<h4 id="class-c"><a href="#class-c" class="headerlink" title="class.c"></a>class.c</h4><ul>
<li><p>linuxé©±åŠ¨æ¨¡å‹ä¸­class.cå¯¹åº”ç±»çš„æ„æ€ï¼Œæ˜¯rtcç±»ã€‚<br>æ¯ä¸ªclasså¯¹åº”éƒ½æœ‰è‡ªå·±æ ¸å¿ƒæ•°æ®ç»“æœï¼Œå¯¹åº”rtcç±»å°±æ˜¯rtc-device</p>
</li>
<li><p>rtc_device<br> rtc_deviceä»£è¡¨ RTCè®¾å¤‡åŸºç¡€çš„æ•°æ®ç»“æ„</p>
<ul>
<li>æ•°æ®ç»“æ„<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">rtc_device</span>  &#123;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">device</span> <span class="title">dev</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">module</span> *<span class="title">owner</span>;</span>  </div><div class="line">   <span class="keyword">int</span> id;                                   <span class="comment">//RTCè®¾å¤‡çš„æ¬¡è®¾å¤‡å·  </span></div><div class="line">   <span class="keyword">char</span> name[RTC_DEVICE_NAME_SIZE];  </div><div class="line">   <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rtc_class_ops</span> *<span class="title">ops</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">ops_lock</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">cdev</span> <span class="title">char_dev</span>;</span>  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">long</span> flags;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">long</span> irq_data;  </div><div class="line">   <span class="keyword">spinlock_t</span> irq_lock;  </div><div class="line">   <span class="keyword">wait_queue_head_t</span> irq_queue;  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">fasync_struct</span> *<span class="title">async_queue</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">rtc_task</span> *<span class="title">irq_task</span>;</span>  </div><div class="line">   <span class="keyword">spinlock_t</span> irq_task_lock;  </div><div class="line">   <span class="keyword">int</span> irq_freq;  </div><div class="line">   <span class="keyword">int</span> max_user_freq;  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RTC_INTF_DEV_UIE_EMUL  </span></div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">work_struct</span> <span class="title">uie_task</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">timer_list</span> <span class="title">uie_timer</span>;</span>  </div><div class="line">   <span class="comment">/* Those fields are protected by rtc-&gt;irq_lock */</span>  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> oldsecs;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> uie_irq_active:<span class="number">1</span>;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> stop_uie_polling:<span class="number">1</span>;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> uie_task_active:<span class="number">1</span>;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> uie_timer_active:<span class="number">1</span>;  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>å¾ˆé•¿ï¼Ÿå¾ˆğŸ˜µå¯¹ä¸å¯¹ï¼Ÿåªè¦å…³æ³¨ä¸€ç‚¹å°±è¡Œ_</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">int id;                                              //ä»£è¡¨æ˜¯é‚£ä¸ªrtcè®¾å¤‡  </div><div class="line">char name[RTC_DEVICE_NAME_SIZE];                     //ä»£è¡¨rtcè®¾å¤‡çš„åç§°  </div><div class="line">const struct rtc_class_ops *ops;                     //rtcæ“ä½œå‡½æ•°é›†ï¼Œéœ€è¦é©±åŠ¨å®ç°  </div><div class="line">struct mutex ops_lock;                               //æ“ä½œå‡½æ•°é›†çš„äº’æ–¥é”  </div><div class="line">  </div><div class="line">struct cdev char_dev;                                //ä»£è¡¨rtcå­—ç¬¦è®¾å¤‡ï¼Œå› ä¸ºrtcå°±æ˜¯ä¸ªå­—ç¬¦è®¾å¤‡  </div><div class="line">unsigned long flags;                                 //rtcçš„çŠ¶æ€æ ‡å¿—ï¼Œä¾‹å¦‚RTC_DEV_BUSY</div></pre></td></tr></table></figure>
</li>
<li><p>ä¸Šæ–‡ä¹¦è¯´åˆ°ï¼Œé©±åŠ¨ç¨‹åºçš„probå‡½æ•°é‡Œé¢è°ƒç”¨äº†rtc_device_register()è¿™è´§çš„ç±»å‹å°±æ˜¯rtc_deviceã€‚å‚åŠ é©±åŠ¨ç¨‹åºæ€æ ·è°ƒç”¨rtc_device<em>register(),</em>ä¸å…¶ä»–æ ¸å¿ƒçš„åŸºæœ¬ç»“æ„ä¸åŒçš„æ˜¯ï¼Œé©±åŠ¨ç¨‹åºä»¥ä¸æ˜¯ä»¥rtc-deviceä¸ºå‚æ•°æ³¨å†Œè®¾å¤‡åˆ°å­ç³»ç»Ÿï¼Œè€Œæ˜¯æ³¨å†Œå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªrtc<em>deivceçš„ç»“æ„ç»™é©±åŠ¨ã€‚</em></p>
</li>
</ul>
</li>
<li><p>rtc_class_ops<br>  è¿™ä¸ªæ˜¯rtc<em>deviceçš„ä¸€éƒ¨åˆ†ã€‚</em></p>
<ul>
<li><p>æ•°æ®ç»“æ„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">   struct rtc_class_ops &#123;  </div><div class="line">   int (*open)(struct device *);     //æ‰“å¼€è®¾å¤‡æ—¶çš„å›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥åˆå§‹åŒ–ç¡¬ä»¶å¹¶ç”³è¯·èµ„æº  </div><div class="line">   void (*release)(struct device *); //è¿™ä¸ªå‡½æ•°æ˜¯è®¾å¤‡å…³é—­æ—¶è¢«è°ƒç”¨çš„ï¼Œåº”è¯¥æ³¨é”€ç”³è¯·çš„èµ„æº  </div><div class="line">   int (*ioctl)(struct device *, unsigned int, unsigned long); //ioctlå‡½æ•°ï¼Œå¯¹æƒ³è®©RTCè‡ªå·±å®ç°çš„å‘½ä»¤åº”è¿”å›ENOIOCTLCMD  </div><div class="line">   int (*read_time)(struct device *, struct rtc_time *);       //è¯»å–æ—¶é—´  </div><div class="line">   int (*set_time)(struct device *, struct rtc_time *);        //è®¾ç½®æ—¶é—´  </div><div class="line">   int (*read_alarm)(struct device *, struct rtc_wkalrm *);    //è¯»å–ä¸‹ä¸€æ¬¡å®šæ—¶ä¸­æ–­çš„æ—¶é—´  </div><div class="line">   int (*set_alarm)(struct device *, struct rtc_wkalrm *);     //è®¾ç½®ä¸‹ä¸€æ¬¡å®šæ—¶ä¸­æ–­çš„æ—¶é—´  </div><div class="line">   int (*proc)(struct device *, struct seq_file *);            //procfsæ¥å£  </div><div class="line">   int (*set_mmss)(struct device *, unsigned long secs);       //å°†ä¼ å…¥çš„å‚æ•°secsè½¬æ¢ä¸ºstruct rtc_timeç„¶åè°ƒç”¨set_timeå‡½æ•°ã€‚ç¨‹åºå‘˜å¯ä»¥ä¸å®ç°è¿™ä¸ªå‡½æ•°ï¼Œä½†  å‰ææ˜¯å®šä¹‰å¥½äº†read_time/set_timeï¼Œå› ä¸ºRTCæ¡†æ¶éœ€è¦ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚  </div><div class="line">   int (*irq_set_state)(struct device *, int enabled);         //å‘¨æœŸé‡‡æ ·ä¸­æ–­çš„å¼€å…³ï¼Œæ ¹æ®enabledçš„å€¼æ¥è®¾ç½®  </div><div class="line">   int (*irq_set_freq)(struct device *, int freq);             //è®¾ç½®å‘¨æœŸä¸­æ–­çš„é¢‘ç‡  </div><div class="line">   int (*read_callback)(struct device *, int data);            ///ç”¨æˆ·ç©ºé—´è·å¾—æ•°æ®åä¼šä¼ å…¥è¯»å–çš„æ•°æ®ï¼Œå¹¶ç”¨è¿™ä¸ªå‡½æ•°è¿”å›çš„æ•°æ®æ›´æ–°æ•°æ®ã€‚  </div><div class="line">   int (*alarm_irq_enable)(struct device *, unsigned int enabled);  //alarmä¸­æ–­ä½¿èƒ½å¼€å…³ï¼Œæ ¹æ®enabledçš„å€¼æ¥è®¾ç½®  </div><div class="line">   int (*update_irq_enable)(struct device *, unsigned int enabled); //æ›´æ–°ä¸­æ–­ä½¿èƒ½å¼€å…³ï¼Œæ ¹æ®enabledçš„å€¼æ¥è®¾ç½®  </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>è¯¥ç»“æ„ä½“ä¸­å‡½æ•°å¤§å¤šæ•°éƒ½æ˜¯å’ŒrtcèŠ¯ç‰‡çš„æ“ä½œæœ‰å…³ï¼Œéœ€è¦é©±åŠ¨ç¨‹åºå®ç°ã€‚<br>æ‰€æœ‰RTCé©±åŠ¨éƒ½å¿…é¡»å®ç°read_timeã€set_timeå‡½æ•°ï¼Œå…¶ä»–å‡½æ•°å¯é€‰ã€‚</p>
</li>
</ul>
</li>
<li><p>å‚è€ƒå…¶ä»–çš„èµ„æ–™ï¼Œclassçš„åˆ†æå¦‚ä¸‹<br><img src="https://my.mixtape.moe/xrsnkw.jpg" alt=""></p>
</li>
<li><p>static int __init rtc_init(void)</p>
<ul>
<li>è°ƒç”¨class_createåˆ›å»ºRTCç±»ï¼Œåˆ›å»º/sys/class/rtcç›®å½•ï¼Œåˆå§‹åŒ–RTCç±»ç›¸å…³æˆå‘˜ï¼Œå‘ç”¨æˆ·ç©ºé—´æä¾›è®¾å¤‡ä¿¡æ¯ã€‚</li>
<li>è°ƒç”¨rtc-dev.cå®ç°çš„rtc_dev_init();åŠ¨æ€åˆ†é…RTCå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ã€‚</li>
<li>è°ƒç”¨rtc_sysfs_init(rtc<em>class)ï¼›åˆ›å»º/sys/class/rtcä¸‹å±æ€§æ–‡ä»¶</em></li>
</ul>
</li>
<li><p>static void __exit rtc<em>exit(void)</em></p>
<ul>
<li>è°ƒç”¨rtc-dev.cå®ç°çš„rtc_dev_exit()ï¼›æ³¨é”€è®¾å¤‡å·ã€‚</li>
<li>è°ƒç”¨class_destroy(rtc_class)ï¼›æ³¨é”€/sys/classä¸‹çš„rtcç›®å½•</li>
</ul>
</li>
</ul>
<ul>
<li>struct rtc_device <em>rtc_device_register(const char </em>name, struct device <em>dev,const struct rtc_class_ops </em>ops,struct module *ownerï¼‰_<ul>
<li>ç”³è¯·ä¸€ä¸ªidræ•´æ•°IDç®¡ç†æœºåˆ¶ç»“æ„ä½“ï¼Œå¹¶ä¸”åˆå§‹åŒ–ç›¸å…³æˆå‘˜</li>
<li>å°†è®¾å¤‡devå…³è”sysfsä¸‹çš„rtcç±»</li>
<li>åˆå§‹åŒ–rtcç»“æ„ä½“çš„ä¿¡å·é‡</li>
<li>åˆå§‹åŒ–rtcç»“æ„ä½“ä¸­çš„ä¸­æ–­</li>
<li>è®¾ç½®rtcçš„åå­—</li>
<li>åˆå§‹åŒ–rtcå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ï¼Œç„¶åæ³¨å†Œrtcè®¾å¤‡,è‡ªåŠ¨åˆ›å»º/dev/rtc(n)è®¾å¤‡èŠ‚ç‚¹æ–‡ä»¶</li>
<li>æ³¨å†Œå­—ç¬¦è®¾å¤‡</li>
<li>åœ¨/sys/rtc/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªé—¹é’Ÿå±æ€§æ–‡ä»¶</li>
<li>åˆ›å»º/proc/driver/rtcç›®å½•</li>
</ul>
</li>
<li>void rtc_device_unregister(struct rtc_device *rtc)<ul>
<li>åˆ é™¤sysfsä¸­çš„rtcè®¾å¤‡,å³åˆ é™¤/sys/class/rtcç›®å½•</li>
<li>åˆ é™¤devä¸‹çš„/dev/rtc(n)è®¾å¤‡èŠ‚ç‚¹æ–‡ä»¶</li>
<li>åˆ é™¤è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ¥å£,å³åˆ é™¤/proc/driver/rtcç›®å½•</li>
<li>å¸è½½å­—ç¬¦è®¾å¤‡</li>
<li>æ¸…ç©ºrtcçš„æ“ä½œå‡½æ•°æŒ‡é’ˆrtc-&gt;ops</li>
<li>é‡Šæ”¾rtcçš„deviceç»“æ„ä½“_</li>
</ul>
</li>
<li>static void rtc_device_release(struct device <em>dev)    </em><ul>
<li>å¸è½½idræ•°å­—ç®¡ç†æœºåˆ¶ç»“æ„ä½“</li>
<li>é‡Šæ”¾rtcç»“æ„ä½“çš„å†…å­˜</li>
</ul>
</li>
</ul>
<h4 id="Rtcå­ç³»ç»Ÿåˆå§‹åŒ–"><a href="#Rtcå­ç³»ç»Ÿåˆå§‹åŒ–" class="headerlink" title="Rtcå­ç³»ç»Ÿåˆå§‹åŒ–"></a>Rtcå­ç³»ç»Ÿåˆå§‹åŒ–</h4><ul>
<li>ä¸Šå›¾<br><img src="https://my.mixtape.moe/driyxr.jpg" alt=""></li>
</ul>
<ul>
<li>ä½¿ç”¨rtcå­ç³»ç»Ÿé¦–å…ˆéœ€è¦åœ¨å†…æ ¸ç¼–è¯‘é€‰é¡¹ä¸­å¯ç”¨RTCå­ç³»ç»Ÿæ”¯æŒã€‚<ul>
<li>å¿…é¡»å¯ç”¨Real Time Clock</li>
<li>ä½¿ç”¨/devä¸‹çš„è®¾å¤‡æ–‡ä»¶å¯¹åº”å¼€å¯CONFIG_RTC_INTF_DEV</li>
<li>ä½¿ç”¨/procä¸‹çš„æ¥å£å¯¹åº”å¼€å¯CONFIG_RTC_INTF_PROC</li>
<li>ä½¿ç”¨/sysfsä¸‹çš„æ¥å£å¯¹åº”å¼€å¯CONFIG_RTC_INTF_SYSFS</li>
</ul>
</li>
<li>_ç³»ç»Ÿå¯åŠ¨åï¼Œå¦‚é…ç½®å¯ç”¨rtcå­ç³»ç»Ÿï¼Œåˆ™ä¼šé¦–å…ˆæ‰§è¡Œrtc<em>init</em>å‡½æ•°ï¼Œåˆ›å»ºrtcç±»ã€åˆå§‹åŒ–ç›¸å…³æˆå‘˜ã€åˆ†é…è®¾å¤‡å·ç­‰</li>
<li>åˆ›å»ºrtcç±»åï¼Œä¹‹åè°ƒç”¨rtc_dev_init()åŠ¨æ€åˆ†é…rtcå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ã€‚ä¹‹åè°ƒç”¨rtc_sysfs_init()åˆå§‹åŒ–/sys/class/rtcç›®å½•ä¸­çš„å±æ€§æ–‡ä»¶</li>
</ul>
<h4 id="Rtcè®¾å¤‡æ³¨å†Œ"><a href="#Rtcè®¾å¤‡æ³¨å†Œ" class="headerlink" title="Rtcè®¾å¤‡æ³¨å†Œ"></a>Rtcè®¾å¤‡æ³¨å†Œ</h4><ul>
<li>Rtcè®¾å¤‡æœ¬è´¨ä¸Šå±äºå­—ç¬¦è®¾å¤‡ï¼Œä¾é™„äºç³»ç»Ÿå†…æ€»çº¿ã€‚ä¸€èˆ¬æ¥è¯´cpuå†…éƒ¨rtcä¾é™„äºplatformæ€»çº¿ï¼Œå¤–ç½®rtcèŠ¯ç‰‡åˆ™ä¾é™„äºé€šä¿¡æ–¹å¼å¯¹åº”æ€»çº¿ã€‚å…¶è¿‡ç¨‹ä¸é€šç”¨å­—ç¬¦è®¾å¤‡ç›¸ä¼¼ï¼Œrtcå­ç³»ç»Ÿåœ¨è®¾å¤‡æ³¨å†Œè¿‡ç¨‹ä¸­é™„åŠ äº†probå’Œsysfsç›¸å…³çš„æ³¨å†Œå’Œåˆå§‹åŒ–æ“ä½œã€‚</li>
<li><p>ä¸Šå›¾<br><img src="https://my.mixtape.moe/urumgu.jpg" alt=""></p>
<ul>
<li>Rtcè®¾å¤‡æŒ‚è½½åï¼Œç›¸åº”æ€»çº¿ä¼šæœç´¢åŒ¹é…çš„é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ç¨‹åºæˆåŠŸmatchåï¼Œè¿›å…¥é©±åŠ¨å®ç°çš„probeå‡½æ•°ï¼Œæ‰§è¡Œè®¾å¤‡æ³¨å†Œç­‰æ“ä½œã€‚</li>
</ul>
</li>
<li>å®Œæˆæ€»çº¿è®¾å¤‡æ³¨å†Œåï¼Œprobeä¼šè·³è½¬åˆ°rtc_device_register()å‡½æ•°ï¼Œå°†è®¾å¤‡æ³¨å†Œåˆ°rtcå­ç³»ç»Ÿã€‚</li>
<li>Rtcè®¾å¤‡æœ¬è´¨å±äºå­—ç¬¦è®¾å¤‡ï¼Œä¼šè°ƒç”¨rtc_dev_prepare()å‡½æ•°ï¼Œåˆå§‹åŒ–å­—ç¬¦è®¾å¤‡ï¼Œè®¾ç½®rtcç›¸å…³çš„file operationå‡½æ•°é›†åˆã€‚</li>
<li>ä¹‹åä¾æ¬¡è°ƒç”¨rtc_dev_add_device(rtc)ã€rtc_sysfs_add_device(rtc)ã€rtc_proc_add_device(rtc) ï¼Œè¿›è¡Œæ³¨å†Œå­—ç¬¦è®¾å¤‡ã€åœ¨/sys/rtc/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªé—¹é’Ÿå±æ€§æ–‡ä»¶ã€åˆ›å»º/proc/driver/rtcç›®å½•ç­‰æ“ä½œã€‚</li>
<li>rtc_device_register()ä¼šå°†é©±åŠ¨å®ç°çš„rtc_class_opsç»“æ„ä½“ä¸å…·ä½“è®¾å¤‡è”ç³»èµ·æ¥ã€‚</li>
</ul>
<h4 id="interface-c"><a href="#interface-c" class="headerlink" title="interface.c"></a>interface.c</h4><ul>
<li>åœ¨rtc-proc.cã€rtc_sysfså’Œioctlå‘½ä»¤ä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œè°ƒç”¨çš„éƒ½æ˜¯interface.cæä¾›çš„æ¥å£ï¼Œè¿™é‡Œä»¥ioctlçš„ä¸€ä¸ªä¾‹å­è¯´æ˜æ•´ä¸ªè°ƒç”¨çš„è¿‡ç¨‹</li>
<li><p>ä¸Šå›¾<br><img src="https://my.mixtape.moe/bvtlqf.jpg" alt=""></p>
</li>
<li><p>ä»¥icotlå‘½ä»¤RTC_RD_TIMEä¸ºä¾‹ï¼Œè¯´æ˜å‘½ä»¤è°ƒç”¨çš„æµç¨‹ã€‚</p>
<ul>
<li>RTC_RD_TIMEå¯¹åº”çš„æ˜¯/devä¸‹ioctlå‘½ä»¤ï¼Œè°ƒç”¨è¢«è½¬å‘è‡³/rtc-dev.c</li>
<li>rtc-dev.c-&gt;rtc_dev_ioctl(struct file *file,unsigned int cmd, unsigned long arg)å‡½æ•°ä¸­ã€‚RTC_RD_TIMEå¯¹åº”çš„ä»£ç ä¸ºerr = rtc_read_time(rtc, &amp;tm); rtc_read_timeæ˜¯interface.cæ–‡ä»¶æä¾›çš„æ¥å£ä¹‹ä¸€ã€‚</li>
<li>interface.c-&gt;rtc_read_time(struct rtc_device <em>rtc, struct rtc_time </em>tm)å‡½æ•°ä¸­å¯¹åº”rtc_class_opsè½¬å‘ä»£ç ä¸ºerr = rtc-&gt;ops-&gt;read_time(rtc-&gt;dev.parent, tm);å°†æ“ä½œè½¬å‘è‡³åŒ¹é…çš„rtcè®¾å¤‡ã€‚</li>
<li><p>è®¾å¤‡é©±åŠ¨è¿™é‡Œä»¥rtc-ds1307ä¸ºä¾‹ï¼Œä½†è®¾å¤‡æ³¨å†Œæ—¶é€šè¿‡mcp794xx_rtc_opsç»“æ„ä½“å°†rtc_class_opså¯¹åº”å‡½æ•°ä¸é©±åŠ¨ç¨‹åºå®ç°çš„å‡½æ•°ç»‘å®š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">static const struct rtc_class_ops mcp794xx_rtc_ops = &#123;</div><div class="line">.read_time  = ds1307_get_time,</div><div class="line">.set_time   = ds1307_set_time,</div><div class="line">.read_alarm = mcp794xx_read_alarm,</div><div class="line">.set_alarm  = mcp794xx_set_alarm,</div><div class="line">.alarm_irq_enable = mcp794xx_alarm_irq_enable,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>æœ€ç»ˆæ‰§è¡Œè½¬å…¥ds1307.c-&gt; ds1307_get_timeå‡½æ•°ï¼Œæ‰§è¡Œä¸ç¡¬ä»¶ç›¸å…³çš„æ“ä½œã€‚</p>
<h4 id="rtc-sysfs-c"><a href="#rtc-sysfs-c" class="headerlink" title="rtc-sysfs.c"></a>rtc-sysfs.c</h4></li>
</ul>
</li>
<li><p>ç”±å‰åŠéƒ¨åˆ†å¯çŸ¥ï¼Œ/sys/class/rtc/æ˜¯åœ¨rtc-initè°ƒç”¨rtc_sysfs_initåç”Ÿæˆã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">void __init rtc_sysfs_init(struct class *rtc_class) &#123;</div><div class="line">	rtc_class-&gt;dev_groups = rtc_groups;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>è¿™é‡Œçš„rtc_groupsæ˜¯rtc-sysfs.cä¸­å®šä¹‰äº†è¿™æ ·ä¸€ä¸ªattributeå‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">static struct attribute *rtc_attrs[] = &#123;</div><div class="line">&amp;dev_attr_name.attr,</div><div class="line">&amp;dev_attr_date.attr,</div><div class="line">&amp;dev_attr_time.attr,</div><div class="line">&amp;dev_attr_since_epoch.attr,</div><div class="line">&amp;dev_attr_max_user_freq.attr,</div><div class="line">&amp;dev_attr_hctosys.attr,</div><div class="line">NULL,</div><div class="line">&#125;;</div><div class="line">ATTRIBUTE_GROUPS(rtc);</div></pre></td></tr></table></figure>
</li>
<li><p>_åœ¨rtc_sysfs_initå‡½æ•°è°ƒç”¨åç»‘å®šäº†sysfsèŠ‚ç‚¹æ“ä½œå‡½æ•°çš„é›†åˆï¼Œä½¿å¾—è®¾å¤‡åŒ¹é…é©±åŠ¨ç¨‹åºåè€Œç”Ÿæˆå¯¹åº”çš„rtcnæ–‡ä»¶å¤¹ã€‚</p>
</li>
<li><code>dev_attr_nameå’Œdev_attr_data</code>ç”±å®<code>DEVICE_ATTR_RO</code>å’ŒDEVICE_ATTR_RWç”Ÿæˆï¼Œä»–ä»¬åˆ†åˆ«å®šä¹‰äº†åªè¯»çš„å’Œå¯è¯»å¯å†™çš„attributeèŠ‚ç‚¹ã€‚æ¯ä¸ªå±æ€§å‡½æ•°ä¸‹éƒ½æœ‰DEVICE_ATTR_XX()å®å£°æ˜ï¼Œç»‘å®šåˆ°å¯¹åº”attributeèŠ‚ç‚¹ã€‚</li>
</ul>
<h4 id="rtc-proc-c"><a href="#rtc-proc-c" class="headerlink" title="rtc-proc.c"></a>rtc-proc.c</h4><ul>
<li>procæ–‡ä»¶ç³»ç»Ÿæ˜¯è½¯ä»¶åˆ›å»ºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå†…æ ¸é€šè¿‡ä»–å‘å¤–ç•Œå¯¼å‡ºä¿¡æ¯ï¼Œä¸‹é¢çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ç»‘å®šä¸€ä¸ªå‡½æ•°ï¼Œå½“ç”¨æˆ·è¯»å–è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå‘æ–‡ä»¶å†™å…¥ä¿¡æ¯ã€‚</li>
<li><p>rtc-proc.cä¸­åˆå§‹åŒ–äº†file_operationsç»“æ„ä½“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">static const struct file_operations rtc_proc_fops = &#123;  </div><div class="line">  .open       = rtc_proc_open,  </div><div class="line">  .read       = seq_read,  </div><div class="line">  .llseek     = seq_lseek,  </div><div class="line">  .release    = rtc_proc_release,  </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>_RTCé©±åŠ¨åœ¨å‘RTCæ ¸å¿ƒæ³¨å†Œè‡ªå·±çš„æ—¶å€™ï¼Œç”±æ³¨å†Œå‡½æ•°rtc_device_resgisterè°ƒç”¨rtc_proc_add_deviceæ¥å®ç°procæ¥å£çš„åˆå§‹åŒ–ï¼Œè¿™ä¸ªå‡½æ•°å¦‚ä¸‹å®šä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">void rtc_proc_add_device(struct rtc_device *rtc)  </div><div class="line">&#123;	  </div><div class="line">   	if (rtc-&gt;id == 0)  </div><div class="line">       	proc_create_data(&quot;driver/rtc&quot;, 0, NULL, &amp;rtc_proc_fops, rtc);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸»è¦æ˜¯å®Œæˆåˆ›å»ºæ–‡ä»¶èŠ‚ç‚¹ï¼Œå¹¶å°†æ–‡ä»¶çš„æ“ä½œå‡½æ•°ä¸èŠ‚ç‚¹è”ç³»èµ·æ¥ã€‚è°ƒç”¨è¿™ä¸ªå‡½æ•°åï¼Œåœ¨/proc/driverç›®å½•ä¸‹å°±ä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶rtc</p>
</li>
</ul>
<h3 id="rtcè®¾å¤‡è®¿é—®"><a href="#rtcè®¾å¤‡è®¿é—®" class="headerlink" title="rtcè®¾å¤‡è®¿é—®"></a>rtcè®¾å¤‡è®¿é—®</h3><ul>
<li>rtcå­ç³»ç»Ÿæœ€å¤šå¯ä»¥æ”¯æŒ16ä¸ªrtcè®¾å¤‡ï¼Œå¤šä¸ªrtcè®¾å¤‡ä¼šåœ¨/dev/å’Œ /sys/class/rtc/ä¸‹ç”Ÿæˆrtc0ã€rtc1â€¦ç­‰ä¸åŒèŠ‚ç‚¹(ä¸‹æ–‡ä»¥rtcnä»£ç§°)ã€‚è€Œç³»ç»Ÿå¯åŠ¨æ—¶ä¼šé€‰æ‹©ä¸€ä¸ªrtcè®¾å¤‡è¯»å–è®¡æ—¶ï¼Œåœ¨/devä¸‹æœ‰rtcæ–‡ä»¶ï¼Œrtcæ–‡ä»¶æŒ‡å‘ç³»ç»Ÿé€‰æ‹©çš„rtcè®¾å¤‡å¯¹åº”çš„rtcnï¼ˆä¸€èˆ¬ä¸ºrtc0ï¼‰ã€‚</li>
<li>ç”¨æˆ·å±‚è®¿é—®rtcè®¾å¤‡æœ‰3ç§é€”å¾„ï¼š<ul>
<li>/dev/rtcn openç­‰å­—ç¬¦è®¾å¤‡æ“ä½œå’Œioctlå‘½ä»¤ã€‚</li>
<li>/sys/class/rtc/rtcn   sysfs å±æ€§ï¼Œä¸€äº›å±æ€§æ˜¯åªè¯»ã€‚</li>
<li>/proc/driver/rtc ç¬¬ä¸€ä¸ªrtcä¼šå ç”¨procfsæ¥å£ï¼Œåœ¨procfsä¸‹æš´éœ²æ›´å¤šä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<h4 id="dev"><a href="#dev" class="headerlink" title="/dev"></a>/dev</h4><ul>
<li>åœ¨/devä¸‹ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è®¿é—®rtcè®¾å¤‡ï¼Œç¬¬ä¸€ä¸ªæ˜¯é€šè¿‡å­—ç¬¦è®¾å¤‡å®šä¹‰çš„openã€readç­‰å‡½æ•°ï¼ˆéœ€è¦é©±åŠ¨ç¨‹åºå®ç°ï¼‰ã€å¦ä¸€ä¸ªæ˜¯é€šè¿‡å®šä¹‰çš„ioctlå‘½ä»¤ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥æ‰“å¼€rtc-dev.cå®šä¹‰çš„openç­‰å‡½æ•°ï¼Œåœ¨openç­‰ä¸­ç›´æ¥è°ƒç”¨é©±åŠ¨ç¨‹åºå®ç°çš„å‡½æ•°ã€‚é€šè¿‡ioctlå‘½ä»¤è®¿é—®åˆ™æ˜¯å°†æ“ä½œè½¬å‘åˆ°äº†interface.cå®šä¹‰çš„æ¥å£ï¼Œé—´æ¥è°ƒç”¨é©±åŠ¨ç¨‹åºå®ç°çš„å‡½æ•°ã€‚</li>
<li><p>ioctl()å‡½æ•°è®¿é—®/devä¸‹çš„è®¾å¤‡ã€‚ä»¥ä¸‹æ˜¯å…¸å‹å‡½æ•°ï¼š_</p>
<ul>
<li><p>ioctl(fd,RTC_ALM_SET, &amp;rtc_tm);<br>è®¾ç½®alarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ï¼Œä¸è¶…è¿‡24å°æ—¶ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºstructrtc_timeç»“æ„ä½“ï¼Œè¯»å–æ—¶ä¼šå¿½ç•¥å¹´æœˆæ—¥ä¿¡æ¯ã€‚alarmä¸­æ–­ä¸wakeupalarmä¸­æ–­åªèƒ½åŒæ—¶ä½¿ç”¨1ä¸ªï¼Œä»¥æœ€åä¸€æ¬¡è®¾å®šä¸ºå‡†ã€‚</p>
<ul>
<li>ioctl(fd,RTC_ALM_READ, &amp;rtc_tm)<br>è¯»å–alarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ã€‚</li>
</ul>
</li>
<li><p>ioctl(fd,RTC_WKALM_SET, &amp;alarm);<br>è®¾ç½®wakeupalarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ï¼Œ wakeupalarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»å¯ä»¥åœ¨æœªæ¥çš„ä»»æ„æ—¶åˆ»ã€‚alarmä¸­æ–­ä¸wakeupalarmä¸­æ–­åªèƒ½åŒæ—¶ä½¿ç”¨1ä¸ªï¼Œä»¥æœ€åä¸€æ¬¡è®¾å®šä¸ºå‡†ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_WKALM_RD, &amp;alarm);<br>è¯»å–wakeupalarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_IRQP_SET, tmp);<br>è®¾ç½®å‘¨æœŸä¸­æ–­çš„é¢‘ç‡ï¼Œtmpçš„å€¼å¿…é¡»æ˜¯2çš„å¹‚ï¼ŒéRootç”¨æˆ·æ— æ³•ä½¿ç”¨64HZä»¥ä¸Šçš„å‘¨æœŸä¸­æ–­ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_IRQP_READ, &amp;tmp);<br>è¯»å–å‘¨æœŸä¸­æ–­çš„é¢‘ç‡ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_SET_TIME, &amp;rtc_tm)<br>æ›´æ–°RTCèŠ¯ç‰‡çš„å½“å‰æ—¶é—´ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_RD_TIME, &amp;rtc_tm);<br>è¯»å–RTCç¡¬ä»¶ä¸­çš„å½“å‰æ—¶é—´ã€‚</p>
</li>
</ul>
</li>
<li><p>ä»¥openæ“ä½œä¸ºä¾‹ï¼Œåœ¨ç”¨æˆ·å±‚å¯¹/devä¸‹è®¾å¤‡æ‰§è¡Œopenä¼šè¢«è½¬å‘è‡³<code>rtc_dev_open(struct inode *inode, struct file *file)</code>å‡½æ•°ï¼Œé€šè¿‡err<code>= ops-&gt;open ? ops-&gt;open(rtc-&gt;dev.parent) : 0;</code>åˆ¤æ–­é©±åŠ¨ç¨‹åºæ˜¯å¦é€šè¿‡è¿æ¥çš„rtc_class_opsç»“æ„ä½“å®ç°äº†openå‡½æ•°ï¼Œé©±åŠ¨ç¨‹åºå®ç°äº†openå‡½æ•°ï¼Œåˆ™å°†openæ“ä½œè½¬å‘è‡³é©±åŠ¨ç¨‹åºã€‚</p>
</li>
</ul>
<h4 id="sys"><a href="#sys" class="headerlink" title="/sys"></a>/sys</h4><ul>
<li>/sys/class/rtc/rtcnä¸‹é¢çš„sysfsæ¥å£æä¾›äº†æ“ä½œrtcå±æ€§çš„æ–¹æ³•ï¼Œæ‰€æœ‰çš„æ—¥æœŸæ—¶é—´éƒ½æ˜¯å¢™ä¸Šæ—¶é—´ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿæ—¶é—´ã€‚<ul>
<li>date:    RTCæä¾›çš„æ—¥æœŸ</li>
<li>hctosys:    å¦‚æœåœ¨å†…æ ¸é…ç½®é€‰é¡¹ä¸­é…ç½®äº†CONFIG_RTC_HCTOSYSï¼ŒRTCä¼šåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™æä¾›ç³»ç»Ÿæ—¶é—´ï¼Œè¿™ç§æƒ…å†µä¸‹è¿™ä¸ªä½å°±æ˜¯1,å¦åˆ™ä¸º0</li>
<li>max_user_freq:    éç‰¹æƒç”¨æˆ·å¯ä»¥ä»RTCå¾—åˆ°çš„æœ€å¤§ä¸­æ–­é¢‘</li>
<li>name:     RTCçš„åå­—ï¼Œä¸sysfsç›®å½•ç›¸å…³</li>
<li>since_epoch:    ä»çºªå…ƒå¼€å§‹æ‰€ç»å†çš„ç§’æ•°</li>
<li>time:    RTCæä¾›çš„æ—¶é—´</li>
<li>wakealarm:    å”¤é†’æ—¶é—´çš„æ—¶é—´äº‹ä»¶ã€‚ è¿™æ˜¯ä¸€ç§å•æ¬¡çš„å”¤é†’äº‹ä»¶ï¼Œæ‰€ä»¥å¦‚æœè¿˜éœ€è¦å”¤é†’ï¼Œåœ¨å”¤é†’å‘ç”Ÿåå¿…é¡»å¤ä½ã€‚è¿™ä¸ªåŸŸçš„æ•°æ®ç»“æ„æˆ–è€…æ˜¯ä»çºªå…ƒå¼€å§‹ç»å†çš„å¦™æ•°ï¼Œæˆ–è€…æ˜¯ç›¸å¯¹çš„ç§’æ•°</li>
</ul>
</li>
</ul>
<h4 id="proc"><a href="#proc" class="headerlink" title="/proc"></a>/proc</h4><ul>
<li>/proc/driver/rtcä¸‹åªå¯¹åº”ç¬¬ä¸€ä¸ªrtcè®¾å¤‡ï¼Œä¸sysfsä¸‹ç›¸æ¯”ï¼Œè¯¥è®¾å¤‡æš´éœ²æ›´å¤šä¿¡æ¯</li>
<li>å¯¹åº”æˆªå›¾<br><img src="https://my.mixtape.moe/qbuavl.jpg" alt=""></li>
</ul>
<h3 id="RTCå­ç³»ç»Ÿæµ‹è¯•"><a href="#RTCå­ç³»ç»Ÿæµ‹è¯•" class="headerlink" title="RTCå­ç³»ç»Ÿæµ‹è¯•"></a>RTCå­ç³»ç»Ÿæµ‹è¯•</h3><p><strong>Hwclockå‘½ä»¤æˆ–ä½¿ç”¨æµ‹è¯•æ–‡ä»¶ã€‚</strong></p>
<ul>
<li>Hwclockå‘½ä»¤å¯ä»¥æ‰§è¡Œæœ€ç®€å•çš„RTCæµ‹è¯•ã€‚å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹<ul>
<li>hwclock #æŸ¥çœ‹RTCæ—¶é—´</li>
<li>hwclock -set -date=â€07/07/17 10:10â€ #è®¾ç½®ç¡¬ä»¶RTCæ—¶é—´ï¼ˆæœˆ/æ—¥/å¹´ æ—¶:åˆ†:ç§’ï¼‰</li>
<li>hwclock -w #ç³»ç»Ÿæ—¶é—´åŒæ­¥è‡³RTC</li>
<li>hwclock -s #åŒæ­¥RTCåˆ°ç³»ç»Ÿæ—¶é—´</li>
</ul>
</li>
<li>Linuxå†…æ ¸æä¾›äº†RTCå­ç³»ç»Ÿçš„æµ‹è¯•ç¤ºä¾‹æ–‡ä»¶ï¼Œä½äºtools/testing/selftests/timers/rtctest.cï¼ŒåŒ…å«äº†åŸºäºioctlå‘½ä»¤çš„å®Œæ•´æµ‹è¯•ã€‚</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  
  
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/15/linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jasper">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/v.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="é»˜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/15/linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰/" itemprop="url">
                  linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-15T17:52:16+08:00">
                2017-08-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linuxç¬”è®°/" itemprop="url" rel="index">
                    <span itemprop="name">Linuxç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/15/linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/15/linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/08/15/linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰/" class="leancloud_visitors" data-flag-title="linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  1
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  1m
                </span>
              
            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>ss</li>
</ul>

          
        
      
    </div>

	

	
    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

	
	
	<div>
	    <p id="div-border-left-blue">
	   <b>æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href="http://creativecommons.org/licenses/by-sa/4.0/"> çŸ¥è¯†å…±äº«ç½²å-ç›¸åŒæ–¹å¼å…±äº« 4.0 </a>å›½é™…è®¸å¯åè®®å‘å¸ƒ</b><br/>
	    <span>
	    <b>æœ¬æ–‡åœ°å€ï¼š</b><a href="/page/2/index.html" title=""></a><br/><b>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</b>
	    </span>
	    </p>
	</div>
	

	
    <footer class="post-footer">
	
	
	
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/v.png"
               alt="Jasper" />
          <p class="site-author-name" itemprop="name">Jasper</p>
           
              <p class="site-description motion-element" itemprop="description">ç¨‹åºå‘˜ å¾®å°˜ V</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">46</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jasper-1024" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016.6.2 - 
  <span itemprop="copyrightYear">2018.3.24</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jasper</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://jasper1024.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("8AEPwU1rVoSnwxtOrX35u23j-gzGzoHsz", "SBLr7EMdL83IXCfJSbydMdll");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  
</body>
</html>

<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[linuxç¬”è®°â€”qemuè¿è¡Œlinux]]></title>
    <url>%2F2017%2F09%2F10%2Flinux%E7%AC%94%E8%AE%B0%E2%80%94qemu%E8%BF%90%E8%A1%8Clinux%2F</url>
    <content type="text"><![CDATA[ubuntu16.04 ä½¿ç”¨busyboxç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨qemuè¿è¡Œèµ·æ¥ã€‚ å†…å®¹æ¥è‡ª å¥”è·‘å§linuxå†…æ ¸ç¬¬6ç«  è¿™é‡Œå°†è¾“å…¥ä»£ç è¿‡ç¨‹é›†åˆåˆ°äº†å‡ ä¸ª.shæ–‡ä»¶,ä¸åšé‡å¤çš„å·¥ä½œ ! å½“ç„¶ç½‘å¥½æ˜¯å‰æ,æœ€å¥½æŒ‚ä»£ç†. å®‰è£…å·¥å…· é¦–å…ˆéœ€è¦å®‰è£…qemu gcc, ubuntu16.04ä¸­è‡ªå¸¦çš„gccç‰ˆæœ¬è¾ƒä½Ž,è¿™é‡Œæˆ‘ä»¬å®‰è£…ä¹¦ä¸­æŽ¨èçš„gcc-arm-linux-gnueabi 1sudo apt-get install qemu libncurses5-dev gcc-arm-linux-gnueabi build-essential ä¸‹è½½busyboxæºç  ä¹¦ä¸­æŽ¨èç‰ˆæœ¬æ˜¯1.24,ä½†æœ€æ–°ç‰ˆæœ¬å·²ç»åˆ°äº†busybox-1.27.2.è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€æ–°ç‰ˆ1wget https://busybox.net/downloads/busybox-1.27.2.tar.bz2 è§£åŽ‹åˆ° busybox æ–‡ä»¶å¤¹1tar -jxvf busybox-1.27.2.tar.bz2 ä¸‹è½½linuxå†…æ ¸æºç  è¿˜æ˜¯ä»¥é…å¥—çš„4.0æºç ä¸ºä¾‹,(æé†’:å†…æ ¸è§£åŽ‹åŽå¤§çº¦å 800MB,è¯·é¢„ç•™å‡ºè¶³å¤Ÿç©ºé—´)1wget https://www.kernel.org/pub/linux/kernel/v4.x/linux-4.0.tar.gz è§£åŽ‹åˆ°linuxæ–‡ä»¶å¤¹1tar -jxvf linux-4.0.tar.gz ç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿ* åˆ«é—®æˆ‘æœ€å°æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆ,æˆ‘ä¹Ÿæœ‰ç‚¹ðŸ˜µ,ä½†æ˜¯å…ˆç”¨èµ·æ¥. é¦–å…ˆåˆ©ç”¨ busybox æ‰‹å·¥ç¼–è¯‘ä¸€ä¸ªæœ€å°æ–‡ä»¶ç³»ç»Ÿã€‚åœ¨busyboxæ–‡ä»¶å¤¹ä¸‹ 1234export ARCH=ARMexport CROSS_COMPILE=arm-linux-gnueabi-make menuconfigmake install è¿›å…¥menuconfigåŽ,é…ç½®é™æ€ç¼–è¯‘ 123Busybox Settings ---&gt;Build Options ---&gt;[*] Build BusyBox as a static binary (no shared libs) ç„¶åŽ make install ç¼–è¯‘å®Œæˆã€‚ç¼–è¯‘å®ŒæˆåŽ,æŠŠ busybox æ ¹ç›®å½•ä¸‹é¢çš„_install ç›®å½•æ‹·è´åˆ° linux-4.0 ä¸‹ã€‚ è¿›å…¥_install ç›®å½•ï¼Œåˆ›å»º etcã€dev ç­‰ç›®å½•ã€‚ 1234mkdir etcmkdir devmkdir mntmkdir -p etc/init.d/ åœ¨_install /etc/init.d/ç›®å½•ä¸‹åˆ›å»º æ–‡ä»¶årcS çš„æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š 123456789mkdir â€“p /procmkdir â€“p /tmpmkdir -p /sysmkdir â€“p /mnt/bin/mount -amkdir -p /dev/ptsmount -t devpts devpts /dev/ptsecho /sbin/mdev &gt; /proc/sys/kernel/hotplugmdev â€“s åŒæ—¶ä½¿ç”¨ chmod +x rcSä¿®æ”¹rcSçš„å¯æ‰§è¡Œæƒé™. åœ¨_install /etc ç›®å½•åˆ›å»ºæ–‡ä»¶å fstab çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ã€‚ 12345proc /proc proc defaults 0 0tmpfs /tmp tmpfs defaults 0 0sysfs /sys sysfs defaults 0 0tmpfs /dev tmpfs defaults 0 0debugfs /sys/kernel/debug debugfs defaults 0 0 åœ¨_install /etc ç›®å½•åˆ›å»ºæ–‡ä»¶å inittab çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥å¦‚ä¸‹å†…å®¹ã€‚ 1234::sysinit:/etc/init.d/rcS::respawn:-/bin/sh::askfirst:-/bin/sh::ctrlaltdel:/bin/umount -a â€“r åœ¨_install/dev ç›®å½•ä¸‹åˆ›å»ºå¦‚ä¸‹è®¾å¤‡èŠ‚ç‚¹ï¼Œä»¥rootæƒé™æ‰§è¡Œ 123cd _install/dev/sudo mknod console c 5 1sudo mknod null c 1 3 .sh(é…åˆchmod +xä½¿ç”¨) build.sh: ç¼–è¯‘busybox 1234export ARCH=ARMexport CROSS_COMPILE=arm-linux-gnueabi-make menuconfigmake install creat.sh: _installæ–‡ä»¶å¤¹ä¸‹å¤„ç† 123456789101112131415161718192021222324252627282930313233343536rm -rf etc rm -rf dev rm -rf mnt mkdir etcmkdir devmkdir mntmkdir -p etc/init.d/echo &quot;mkdir -p /procmkdir -p /tmpmkdir -p /sysmkdir -p /mnt/bin/mount -amkdir -p /dev/ptsmount -t devpts devpts /dev/ptsecho /sbin/mdev &gt; /proc/sys/kernel/hotplugmdev -s&quot; &gt; etc/init.d/rcSchmod +x etc/init.d/rcSecho &quot;proc /proc proc defaults 0 0tmpfs /tmp tmpfs defaults 0 0sysfs /sys sysfs defaults 0 0tmpfs /dev tmpfs defaults 0 0debugfs /sys/kernel/debug debugfs defaults 0 0&quot; &gt; etc/fstabecho &quot;::sysinit:/etc/init.d/rcS::respawn:-/bin/sh::askfirst:-/bin/sh::ctrlaltdel:/bin/umount -a -r&quot; &gt; etc/inittabcd dev/sudo mknod console c 5 1sudo mknod null c 1 3 ç¼–è¯‘å†…æ ¸ ç¼–è¯‘å†…æ ¸ 12345cd linux-4.0export ARCH=armexport CROSS_COMPILE=arm-linux-gnueabi-make vexpress_defconfigmake menuconfig é…ç½® initramfsï¼Œåœ¨ initramfs source file ä¸­å¡«å…¥_installã€‚å¦å¤–éœ€è¦æŠŠ Default kernel command string æ¸…ç©ºã€‚ 12345General setup ---&gt;[*] Initial RAM filesystem and RAM disk (initramfs/initrd) support(_install) Initramfs source file(s)Boot options --&gt;()Default kernel command string é…ç½® memory split ä¸ºâ€œ3G/1G user/kernel splitâ€ä»¥åŠæ‰“å¼€é«˜ç«¯å†…å­˜ã€‚ 123Kernel Features ---&gt;Memory split (3G/1G user/kernel split) ---&gt;[ *] High Memory Support å¼€å§‹ç¼–è¯‘ kernel 12make bzImage -j4 ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-make dtbs è¿è¡Œ QEMU æ¥æ¨¡æ‹Ÿ 4 æ ¸ Cortex-A9 çš„ Versatile Express å¼€å‘å¹³å°ã€‚ 1qemu-system-arm -M vexpress-a9 -smp 4 -m 1024M -kernel arch/arm/boot/zImage -append &quot;rdinit=/linuxrc console=ttyAMA0 loglevel=8&quot; -dtb arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic .sh(é…åˆchmod +x) build.sh : ç¼–è¯‘å†…æ ¸ 123456export ARCH=armexport CROSS_COMPILE=arm-linux-gnueabi-make vexpress_defconfigmake menuconfigmake bzImage -j4 ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-make dtbs run.sh : è¿è¡Œarmå†…æ ¸ 1qemu-system-arm -M vexpress-a9 -smp 4 -m 1024M -kernel arch/arm/boot/zImage -append &quot;rdinit=/linuxrc console=ttyAMA0 loglevel=8&quot; -dtb arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographicyun]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ è®°å½•</tag>
        <tag>Linux</tag>
        <tag>qemu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linuxç¬”è®°â€”â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘]]></title>
    <url>%2F2017%2F08%2F23%2Flinux%E7%AC%94%E8%AE%B0%E2%80%94%E7%9C%8B%E9%97%A8%E7%8B%97%E5%86%85%E6%A0%B8API%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91%2F</url>
    <content type="text"><![CDATA[wdtç¬¬äºŒå¼¹ï¼Œå†…æ ¸APIï¼Œå‹‰å¼ºç¿»è¯‘ä¸‹æ¥äº†ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥æ•´ç† çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API æœ€åŽæ›´æ–°æ—¶é—´ 2013.2.12 Wim Van Sebroeck &#x77;&#x69;&#109;&#64;&#105;&#103;&#x75;&#97;&#110;&#x61;&#x2e;&#98;&#101; ä»‹ç» æœ¬æ–‡æ¡£æ²¡æœ‰æè¿°çœ‹é—¨ç‹—è®¾å¤‡æˆ–é©±åŠ¨ã€‚ä¹Ÿä¸æ¶‰åŠé‚£äº›åœ¨ç”¨æˆ·ç©ºé—´è°ƒç”¨çš„APIï¼Œå¯¹åº”åœ¨ Documentation/watchdog/watchdog-api.txt ï¼ˆä¹Ÿå°±æ˜¯ä¸Šä¸€ç¯‡ï¼‰ æœ¬æ–‡æ¡£æè¿°çš„æ˜¯ï¼Œåˆ©ç”¨çœ‹é—¨ç‹—å­ç³»ç»Ÿæ¡†æž¶æ–¹å¼è¿›è¡Œçœ‹é—¨ç‹—é©±åŠ¨ç¼–å†™æ—¶æ‰€ä½¿ç”¨åˆ°çš„APIã€‚çœ‹é—¨ç‹—å­ç³»ç»Ÿæ¡†æž¶æä¾›äº†æ‰€æœ‰ä¸Žç”¨æˆ·ç©ºé—´äº¤äº’çš„æŽ¥å£ï¼Œä¸éœ€è¦æ¯æ¬¡ç¼–å†™é‡å¤çš„ä»£ç ã€‚è¿™æ„å‘³è¿™é©±åŠ¨ç¨‹åºåªéœ€è¦æä¾›å‡ ä¸ªä¸åŒçš„æ“ä½œå‡½æ•°ï¼Œå°±å¯ä»¥æŽ§åˆ¶WDTäº†ã€‚ API æ¯ä¸€ä¸ªæƒ³è¦ä½¿ç”¨çœ‹é—¨ç‹—æ ¸å¿ƒå­ç³»ç»Ÿçš„é©±åŠ¨ç¨‹åºéƒ½å¿…é¡»åŒ…å«#include&lt;linux/watchdog.h&gt;(ç¼–å†™é©±åŠ¨ç¨‹åºæ˜¯ä¸å¾—ä¸åšçš„å·¥ä½œ)ã€‚linux/watchdog.håŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ³¨å†Œ/å¸è½½å‡½æ•°ï¼š 12extern int watchdog_register_device(struct watchdog_device *);extern void watchdog_unregister_device(struct watchdog_device *); æ³¨å†Œå‡½æ•°å°†wdtè®¾å¤‡æ³¨å†Œè¿›wdtå­ç³»ç»Ÿï¼Œå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘struct watchdogdeviceçš„ç»“æž„ä½“ã€‚å½“æ³¨å†ŒæˆåŠŸæ—¶è¿”å›ž0.æ³¨å†Œå¤±è´¥è¿”å›žä¸€ä¸ªè´Ÿå€¼ã€‚ å¸è½½å‡½æ•°æ˜¯å°†wdtè®¾å¤‡ä»Žwdtå­ç³»ç»Ÿå¸è½½ï¼Œå‡½æ•°å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘struct watchdogdeviceçš„ç»“æž„ä½“ çœ‹é—¨å­ç³»ç»ŸåŒ…å«äº†æ³¨å†Œæ—¶é—´è°ƒæ•´æœºåˆ¶ï¼ˆåŽŸæ–‡æ˜¯ an registration deferral mechanism ä¸€ç§å»¶æœŸæœºåˆ¶ï¼Ÿä¸Šä¸‹æ–‡ä¸å¤ªå¯¹å•Šï¼‰ï¼Œå…è®¸åœ¨å¼€æœºé˜¶æ®µï¼Œä½ å¯ä»¥æŒ‰ç…§ä½ è®¾å®šçš„å°½å¯æ—©çš„æ³¨å†Œä¸€ä¸ªçœ‹é—¨ç‹—è®¾å¤‡ã€‚ struct watchdogdevice è¿™é‡Œç²˜è´´çš„æ˜¯linux4.1é‡Œå®šä¹‰çš„watchdog_deviceï¼ŒåŽŸæ–‡çš„watchdog_deviceæ›´é•¿ä½†è·Ÿæºç å¯¹ä¸èµ·æ¥ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»¥å†…æ ¸4.1é‡Œå®šä¹‰çš„ä¸ºå‡†äº†ðŸ˜‘ï¼š123456789101112131415161718192021 struct watchdog_device &#123;int id;struct cdev cdev;struct device *dev;struct device *parent;const struct watchdog_info *info;const struct watchdog_ops *ops;unsigned int bootstatus;unsigned int timeout;unsigned int min_timeout;unsigned int max_timeout;void *driver_data;struct mutex lock;unsigned long status;/* Bit numbers for status flags */#define WDOG_ACTIVE 0 /* Is the watchdog running/active */#define WDOG_DEV_OPEN 1 /* Opened via /dev/watchdog ? */#define WDOG_ALLOW_RELEASE 2 /* Did we receive the magic char ? */#define WDOG_NO_WAY_OUT 3 /* Is &apos;nowayout&apos; feature set ? */#define WDOG_UNREGISTERED 4 /* Has the device been unregistered */&#125;; åŒ…å«ä»¥ä¸‹å­—æ®µï¼š idï¼šç”±watchdog_register_deviceå‡½æ•°æ³¨å†Œã€‚id 0æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ï¼Œid 0 æœ‰/dev/watchdog0 cdevï¼ˆåŠ¨æ€ä¸»è®¾å¤‡å·ï¼Œæ¬¡è®¾å¤‡å·0ï¼‰ å’Œ /dev/watchdog miscdevã€‚id åœ¨è°ƒç”¨åˆ°watchdog_register_deviceæ—¶è‡ªåŠ¨æ³¨å†Œã€‚ NOTEçœ‹æºç ï¼Œwdtå­ç³»ç»Ÿæ˜¯åŸºäºŽmiscå­ç³»ç»Ÿçš„ï¼Œæ³¨å†Œwdtè®¾å¤‡è°ƒç”¨çš„æ˜¯misc_register(&amp;watchdog_miscdev);è€Œmiscè®¾å¤‡ä¸»è®¾å¤‡å·åªèƒ½ä¸º10,è¿™é‡Œç»“è®ºæœ‰å†²çªï¼Œç­‰å¾…è§£å†³ä¸­ã€‚ã€‚ã€‚ parentï¼šåœ¨è°ƒç”¨watchdog_register_deviceå‡½æ•°å‰ï¼Œè®¾ç½®çˆ¶è®¾å¤‡ï¼ˆæˆ–è€…è®¾ç½®ä¸ºnullï¼‰ infoï¼šæŒ‡å‘watchdog_infoç»“æž„ä½“çš„æŒ‡é’ˆï¼Œwatchdog_infoæä¾›äº†çœ‹é—¨ç‹—æœ¬èº«çš„ä¸€äº›é™„åŠ ä¿¡æ¯ï¼ˆåƒæ˜¯çœ‹é—¨ç‹—ç‹¬æœ‰çš„åç§°ä¹‹ç±»çš„ï¼‰ opsï¼šæŒ‡å‘watchdog_opsç»“æž„ä½“çš„æŒ‡é’ˆï¼Œwatchdog_opsæ˜¯çœ‹é—¨ç‹—æ”¯æŒæ“ä½œ(å‡½æ•°)çš„é›†åˆã€‚ bootstatus:å¯åŠ¨åŽè®¾å¤‡çŠ¶æ€(ä¸Žçœ‹é—¨ç‹—WDIOF* æ ‡å¿—ä½ä¸€åŒå¼€å¯) timeout:çœ‹é—¨ç‹—è¶…æ—¶çš„æ—¶é—´(ç§’ä¸ºå•ä½).å¦‚æžœè®¾ç½®äº†WDOGACTIVE å¯ç”¨äº†çœ‹é—¨ç‹—,åœ¨è¿™ä¸ªæ—¶é—´é•¿åº¦åŽ,ç”¨æˆ·ç©ºé—´è¿˜æ²¡æœ‰å‘é€å¿ƒè·³åŒ…,çœ‹é—¨ç‹—ä¼šå°†ç³»ç»Ÿå¤ä½é‡å¯. mintimeout:å¯è®¾ç½®çš„çœ‹é—¨ç‹—æœ€å°è¶…æ—¶æ—¶é—´ maxtimeout:å¯è®¾ç½®çš„çœ‹é—¨ç‹—æœ€å¤§è¶…æ—¶æ—¶é—´ driverdata:æŒ‡å‘çœ‹é—¨ç‹—è®¾å¤‡ç§æœ‰æ•°æ®çš„æŒ‡é’ˆ,è¿™ä¸ªdataåªèƒ½ç”±watchdog_set_drvdata å’Œ watchdog_get_drvdata routineså‡½æ•°è®¿é—®. struct mutex lock; åŽŸæ–‡æ¡£æ²¡æœ‰ðŸ™„ status:è¿™ä¸ªå­—æ®µåŒ…å«äº†è®¸å¤šçŠ¶æ€ä½,æä¾›æœ‰å…³è®¾å¤‡çš„é¢å¤–ä¿¡æ¯(ä¾‹å¦‚:çœ‹é—¨ç‹—çš„æ´»åŠ¨çŠ¶æ€\é™åˆ¶,çŽ°åœ¨nowayout ä½è®¾ç½®ä¸Žå¦)(æ‹¬å·é‡Œç¿»è¯‘æ˜¯å¦å‡†ç¡®å­˜ç–‘) struct watchdog_ops watchdogops 1234567891011121314 struct watchdog_ops &#123;struct module *owner;/* mandatory operations */int (*start)(struct watchdog_device *);int (*stop)(struct watchdog_device *);/* optional operations */int (*ping)(struct watchdog_device *);unsigned int (*status)(struct watchdog_device *);int (*set_timeout)(struct watchdog_device *, unsigned int);unsigned int (*get_timeleft)(struct watchdog_device *);void (*ref)(struct watchdog_device *);void (*unref)(struct watchdog_device *);long (*ioctl)(struct watchdog_device *, unsigned int, unsigned long);&#125;; ä½ ä¸€å¼€å§‹å®šä¹‰çš„çœ‹é—¨ç‹—çš„module owneræ˜¯éžå¸¸é‡è¦çš„,module owner åœ¨ä½¿ç”¨çœ‹é—¨ç‹—æ—¶ä¼šåŒæ—¶é”å®šçœ‹é—¨ç‹—è®¾å¤‡.(è¿™æ ·é¿å…äº†åœ¨å¸è½½æ¨¡å—æ—¶/dev/watchdogä¾ç„¶æ˜¯æ‰“å¼€çŠ¶æ€å¼•èµ·çš„ç³»ç»Ÿå´©æºƒ) æŸäº›å‡½æ•°æ˜¯å¿…é¡»å®žçŽ°çš„,å…¶ä»–æ˜¯å¯é€‰çš„,å¿…é¡»å®žçŽ°çš„å‡½æ•°å¦‚ä¸‹: start :æŒ‡å‘çœ‹é—¨ç‹—è®¾å¤‡å¯åŠ¨å‡½æ•°çš„æŒ‡é’ˆ.è¿™ä¸ªå‡½æ•°å‚æ•°ä¸ºä¸€ä¸ª struct watchdogdevice,æˆåŠŸè¿”å›ž0,å¤±è´¥è¿”å›žè´Ÿæ•°. stop :é€šè¿‡è¿™ä¸ªå‡½æ•°å…³é—­çœ‹é—¨ç‹—è®¾å¤‡.è¿™ä¸ªå‡½æ•°å‚æ•°ä¸ºä¸€ä¸ª struct watchdogdevice,æˆåŠŸè¿”å›ž0,å¤±è´¥è¿”å›žè´Ÿæ•°. ä¸€äº›ç¡¬ä»¶çœ‹é—¨ç‹—è®¾å¤‡åªèƒ½å¯åŠ¨,æ²¡æœ‰å…³é—­é€‰é¡¹.å¯¹åº”è¿™äº›è®¾å¤‡çš„é©±åŠ¨,ä¸ç”¨å®žçŽ° stop ,å¦‚æžœé©±åŠ¨ç¨‹åºæ²¡æœ‰å…³é—­è®¾å¤‡åŠŸèƒ½,çœ‹é—¨ç‹—æ ¸å¿ƒå±‚ä¼šåœ¨è®¾å¤‡å…³é—­åŽè®¾ç½® WDOG_HW_RUNNING å¹¶è°ƒç”¨é©±åŠ¨ç¨‹åºçš„ keepalive pingsåŠŸèƒ½. å¦‚æžœçœ‹é—¨ç‹—é©±åŠ¨æ²¡æœ‰å®žçŽ°stop å¿…é¡»è®¾ç½®max_hw_heartbeatms ä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶çœ‹é—¨ç‹—éƒ½æœ‰ç›¸åŒçš„åŠŸèƒ½,è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰å¯é€‰å‡½æ•°äº†,åªæœ‰ä½†è¿™é¡¹åŠŸèƒ½è¢«ç¡¬ä»¶çœ‹é—¨ðŸ¶æ”¯æŒæ—¶,æ‰ç¼–å†™å¯¹åº”å‡½æ•°. ping:è¿™æ˜¯çœ‹é—¨ç‹—é©±åŠ¨å®žçŽ°çš„å–‚ç‹—å‡½æ•°,è¿™ä¸ªå‡½æ•°çš„å‚æ•°æ—¶ä¸€ä¸ªæŒ‡å‘struct watchdogdeviceçš„æŒ‡é’ˆ.å‡½æ•°æ‰§è¡ŒæˆåŠŸè¿”å›ž0,å¤±è´¥è¿”å›žè´Ÿæ•°. å¤§å¤šæ•°çš„ç¡¬ä»¶ä¸æ”¯æŒç›´æŽ¥å–‚ç‹—çš„ç‰¹æ®ŠåŠŸèƒ½,ä¸€èˆ¬æ˜¯ç›´æŽ¥é‡å¯ç¡¬ä»¶çœ‹é—¨ç‹—. çœ‹é—¨ç‹—å­ç³»ç»Ÿçš„æ ¸å¿ƒå±‚ä¹Ÿæ˜¯è¿™æ ·åšçš„:ä½†å®šæœŸå–‚ç‹—çš„æ“ä½œè½¬å‘åˆ°ç¡¬ä»¶çœ‹é—¨ç‹—æ—¶,æ ¸å¿ƒå±‚åœ¨ ping å®žçŽ°æ—¶è°ƒç”¨å–‚ç‹—å‡½æ•°,ä½†å–‚ç‹—å‡½æ•°æ²¡æœ‰å®žçŽ°æ—¶,ä½¿ç”¨ start å¯¹åº”å‡½æ•° ( WDIOC_KEEPALIVEå¯¹åº”çš„ ioctlå‘½ä»¤åªæœ‰åœ¨içœ‹é—¨ç‹—infoé‡Œçš„WDIOF_KEEPALIVEPINGè¢«è®¾ç½®ä¸º1åŽæ‰ä¼šç”Ÿæ•ˆ ) status: è¿™ä¸ªå‡½æ•°ç”¨æ¥æ£€æŸ¥çœ‹é—¨ç‹—è®¾å¤‡çš„çŠ¶æ€,é€šè¿‡çœ‹é—¨ç‹—çš„WDIOF*çŠ¶æ€æ ‡å¿—ä½æŠ¥å‘Š.WDIOF_MAGICCLOSE and WDIOF_KEEPALIVEPINGç”±çœ‹é—¨ç‹—æ ¸å¿ƒå±‚æŠ¥å‘Š.æ²¡æœ‰å¿…è¦åœ¨é©±åŠ¨ç¨‹åºä¸­æŠ¥å‘Š.æ­¤å¤–å¦‚æžœé©±åŠ¨ç¨‹åºæ²¡æœ‰å®žçŽ°è¯¥å‡½æ•°,çœ‹é—¨ç‹—æ ¸å¿ƒå±‚ä¼šè¿”å›ž struct watchdogdeviceä¸­çš„bootstatusçŠ¶æ€ä½. set_timeout:è¿™ä¸ªå‡½æ•°è®¾ç½®å’Œæ£€æŸ¥ è¶…æ—¶æ—¶é—´çš„å˜åŒ–,è¿”å›ž0è¡¨ç¤ºæˆåŠŸ,è¿”å›ž-EINVALè¡¨ç¤ºè¶…å‡ºèŒƒå›´,è¿”å›ž-EIOè¡¨ç¤ºæ— æ³•å†™å…¥çœ‹é—¨ç‹—.è®¾ç½®æˆåŠŸåŽ,å‡½æ•°åº”è¯¥å°†è®¾å®šçš„è¶…æ—¶æ—¶é—´å†™å…¥çœ‹é—¨ç‹—.(æˆ–è®¸ä¸Žé€šè¿‡æŽ¥å£èŽ·å–çš„è¶…æ—¶æ—¶é—´ä¸åŒ,å› ä¸ºçœ‹é—¨ç‹—çš„åˆ†è¾¨çŽ‡ä¸ä¸€å®šèƒ½åˆ°1s). å®žçŽ°äº†max_hw_heartbeat_msçš„é©±åŠ¨å°†ç¡¬ä»¶çœ‹é—¨ç‹—å¿ƒè·³å€¼è®¾ç½®ä¸ºè¶…æ—¶æ—¶é—´å’Œmax_hw_heartbeat_msä¹‹é—´çš„æœ€å°å€¼.Those drivers set the timeout value of the watchdog_device either to the requested timeout value (if it is larger than max_hw_heartbeat_ms), or to the achieved timeout value. å¦‚æžœçœ‹é—¨ç‹—é©±åŠ¨ç¨‹åºæ²¡æœ‰æ‰§è¡Œä»»ä½•æ“ä½œ,ä½†è®¾ç½®äº†watchdogdevice.timeout,æ­¤å›žæŽ‰å‡½æ•°å¿½ç•¥. å¦‚æžœæ²¡æœ‰è®¾ç½® set_timeout,ä½†è®¾ç½®äº†WDIOF_SETTIMEOUT,çœ‹é—¨ç‹—æž¶æž„ä¼šå°† watchdog_deviceä¸­timeoutå€¼æ›´æ–°ä¸ºè¯·æ±‚çš„å€¼. å¦‚æžœä½¿ç”¨äº†pretimeout feature (WDIOF_PRETIMEOUT),é‚£ä¹ˆset_timeout å¿…é¡»åŒæ—¶æ£€æŸ¥ pretimeout æ˜¯å¦æœ‰æ•ˆ ,è®¾ç½®ç›¸åº”å®šæ—¶å™¨. è¿™äº›æ“ä½œåœ¨æ ¸å¿ƒå±‚æ²¡æœ‰racesæ— æ³•å®Œæˆ,æ‰€ä»¥å¿…é¡»åœ¨é©±åŠ¨ä¸­å®Œæˆ. setpretimeout:è¿™ä¸ªå‡½æ•°æ”¯æŒæ£€æŸ¥/æ”¹å˜çœ‹é—¨ç‹—ä¸­pretimeoutå€¼(pretimeoutè¯¦æƒ…è§wdtç”¨æˆ·å±‚apiç¿»è¯‘).è¿™ä¸ªå‡½æ•°æ˜¯å¯é€‰æ”¯æŒçš„,å› ä¸ºä¸æ˜¯æ‰€æœ‰çš„çœ‹é—¨ç‹—éƒ½æ”¯æŒè¿™ä¸ªåŠŸèƒ½.pretimeout ä¸æ˜¯ç»å¯¹æ—¶é—´,å…¶æ•°å€¼æ˜¯åœ¨è¶…æ—¶æ—¶é—´ä¹‹å‰å‡ ç§’å‘ç”Ÿ. è¿”å›ž0è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸ,è¿”å›ž-EINVAL,è¡¨ç¤ºè¶…å‡ºèŒƒå›´,è¿”å›ž-EIOè¡¨ç¤ºæœªèƒ½æˆåŠŸå‘çœ‹é—¨ç‹—å†™å…¥. è®¾ç½®pretimeouä¸º0å€¼,ä»£è¡¨ç¦ç”¨pretimeoutåŠŸèƒ½.(WDIOFPRETIMEOUTéœ€è¦åœ¨çœ‹é—¨ç‹—çš„info ç»“æž„ä½“ä¸­è®¾ç½®) å¦‚æžœé©±åŠ¨æ²¡æœ‰å®žçŽ°ä»»ä½•åŠŸèƒ½,ä½†è®¾å®šäº† watchdogdevice.pretimeout,æ­¤å›žæŽ‰å‡½æ•°å¿½ç•¥.è¿™æ„å‘³è¿™,å¦‚æžœæ²¡æœ‰æä¾›setpretimeoutå‡½æ•°,ä½†è®¾å®šäº†WDIOFPRETIMEOUT,çœ‹é—¨ç‹—æž¶æž„ä¼šå°†pretimeoutçš„å€¼æ›´æ–°ä¸ºè¯·æ±‚å€¼. gettimeleft:è¿™ä¸ªå‡½æ•°è¿”å›žå¤ä½å‰å‰©ä½™æ—¶é—´. restart:æ­¤å‡½æ•°é‡å¯çœ‹é—¨ç‹—ç¡¬ä»¶,è¿”å›ž0è¡¨ç¤ºæˆåŠŸ,å¤±è´¥è¿”å›žå¯¹åº”é”™è¯¯ç . ioctl:å¦‚æžœè¿™ä¸ªå‡½æ•°å­˜åœ¨,åœ¨ç³»ç»Ÿè¿›è¡Œå†…éƒ¨ioctlå‘½ä»¤å¤„ç†å‰,ä¼šé¦–å…ˆè°ƒç”¨æ­¤å‡½æ•°.å¦‚æžœä¸æ”¯æŒioctrlå‘½ä»¤,åº”è¯¥è¿”å›ž -ENOIOCTLCMD .è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸º(watchdogdevice, cmd and arg) refå’Œunref å·²ç»ä¸å†è¢«æ”¯æŒ. The status bits should (preferably) be set with the set_bit and clear_bit alike bit-operations. The status bits that are defined are: WDOGACTIVE:è¿™ä¸ªçŠ¶æ€ä½æ ‡è¯†ç€ä»Žç”¨æˆ·ç©ºé—´çœ‹ä¸€ä¸ªçœ‹é—¨ç‹—è®¾å¤‡æ˜¯å¦è¢«æ¿€æ´»,å¦‚æžœè¢«æ¿€æ´»,ç”¨æˆ·ç©ºé—´éœ€è¦æ‰§è¡Œå–‚ç‹—åŠ¨ä½œ WDOG_NO_WAYOUT:è¿™ä¸ªçŠ¶æ€ä½æ ‡è¯†è¿™nowayoutçš„è®¾ç½®,å¦‚æžœè¢«æ¿€æ´»,é‚£çœ‹é—¨ç‹—å¯åŠ¨åŽ,æ— æ³•è¢«åœæ­¢. WDOG_HW_RUNNING:å¦‚æžœç¡¬ä»¶çœ‹é—¨ç‹—è¿è¡Œ,æ­¤çŠ¶æ€ä½è¢«ç½®1. å½“ç¡¬ä»¶çœ‹é—¨ç‹—ä¸èƒ½è¢«åœæ­¢æ—¶,è¿™ä¸ªçŠ¶æ€ä½å¿…é¡»è¢«ç½®1. å¦‚æžœç³»ç»Ÿå¯åŠ¨åŽè‡ªåŠ¨å¯åŠ¨çœ‹é—¨ç‹—,åœ¨çœ‹é—¨ç‹—æ‰“å¼€å‰,å¿…é¡»è®¾ç½®æ­¤çŠ¶æ€ä½. å½“æ­¤çŠ¶æ€ä½è¢«ç½®1,å³ä½¿WDOGACTIVEä¸º0.çœ‹é—¨ç‹—æž¶æž„ä¹Ÿä¼šæ‰§è¡Œå–‚ç‹—åŠ¨ä½œ. (å½“ä½ ç›´æŽ¥æ³¨å†Œè®¾ç½®äº† WDOG_HW_RUNNINGä½çš„çœ‹é—¨ç‹—è®¾å¤‡æ—¶,æ‰§è¡Œopen /dev/watchdogåŠ¨ä½œ,ç³»ç»Ÿä¼šç›´æŽ¥è·³è¿‡å¯åŠ¨æ“ä½œ,ç›´æŽ¥æ‰§è¡Œå–‚ç‹—æ“ä½œ ) è¦è®¾ç½®WDOG_NO_WAYOUTçŠ¶æ€ä½(åœ¨æ³¨å†Œçœ‹é—¨ç‹—è®¾å¤‡å‰)ä½ å¯ä»¥: åœ¨watchdogdeviceçš„ç»“æž„ä½“ä¸­è®¾ç½® 1.status = WATCHDOG_NOWAYOUT_INIT_STATUS, è¿™æ ·ç­‰åŒäºŽå°†WDOG_NO_WAYOUTå€¼è®¾ç½®ä¸ºCONFIG_WATCHDOG_NOWAYOUT ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°1static inline void watchdog_set_nowayout(struct watchdog_device *wdd, int nowayout) (note:) wdté©±åŠ¨ç¨‹åºæ ¸å¿ƒæ”¯æŒmagic closeå’Œ nowayoutåŠŸèƒ½.è¦ä½¿ç”¨magic close,éœ€è¦åœ¨çœ‹é—¨ç‹—çš„ infoä¸­è®¾ç½®WDIOFMAGICCLOSE ä½.å¼€å¯ nowayout ä¼šè¦†ç›–magic close. èŽ·å–æˆ–è®¾å®šé©±åŠ¨ç¨‹åºç‰¹æ®Šæ•°æ®,åº”è¯¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°: 12static inline void watchdog_set_drvdata(struct watchdog_device *wdd, void *data)static inline void *watchdog_get_drvdata(struct watchdog_device *wdd) watchdog_set_drvdataå‡½æ•°å…è®¸ä½ æ·»åŠ å‘é©±åŠ¨ç¨‹åºæ·»åŠ ç‰¹æ®Šæ•°æ®,æ­¤å‡½æ•°çš„å‚æ•°ä¸ºæŒ‡å‘çœ‹é—¨ç‹—è®¾å¤‡çš„æŒ‡é’ˆ,å’ŒæŒ‡å‘éœ€è¦æ·»åŠ æ•°æ®çš„æŒ‡é’ˆ. watchdog_get_drvdataå‡½æ•°è¿è¡Œä½ è¯»å–é©±åŠ¨ç¨‹åºä¸­çš„ç‰¹æ®Šæ•°æ®,æ­¤å‡½æ•°çš„å‚æ•°ä¸ºæŒ‡å‘ä½ æƒ³è¯»å–çš„çœ‹é—¨ç‹—è®¾å¤‡çš„æŒ‡é’ˆ. åˆå§‹åŒ– timeout ,ä¼šç”¨åˆ°ä¸‹é¢çš„å‡½æ•° 123456 extern int watchdog_init_timeout(struct watchdog_device *wdd,unsigned int timeout_parm, struct device *dev); ``` * watchdog_init_timeoutå…è®¸ä½¿ç”¨æ¨¡å—çš„ timeout å­—æ®µåˆå§‹åŒ– timeout ,å½“æ¨¡å—çš„ timeout å­—æ®µæ— æ•ˆæ—¶,è®¾å¤‡æ ‘ä¸­çš„timeout-secä¹Ÿå¯.æœ€å¥½çš„åšæ³•æ˜¯å°†watchdog_device_ä¸­timeoutçš„å€¼,è®¾ç½®ä¸ºåˆå§‹é»˜è®¤å€¼,ç„¶åŽä½¿ç”¨åˆ°å‡½æ•°çš„ç”¨æˆ·å¯ä»¥åˆ†åˆ«è®¾ç½®è‡ªå®šä¹‰å€¼.* é‡å¯åŽç¦ç”¨çœ‹é—¨ç‹—,éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‡½æ•°: static inline void watchdog_stop_on_reboot(struct watchdog_device *wdd); 1* å¸è½½çœ‹é—¨ç‹—è®¾å¤‡æ—¶ç¦ç”¨çœ‹é—¨ç‹—,å¿…é¡»è°ƒç”¨æ­¤å‡½æ•°,å¦‚æžœ nowayout æ²¡æœ‰è®¾ç½®,è¿™ä¸ªå‡½æ•°åªä¼šåœæ­¢çœ‹é—¨ç‹—. static inline void watchdog_stop_on_unregister(struct watchdog_device *wdd); 12 * æ›´æ”¹é‡å¯å¤„ç†ç¨‹åºçš„ä¼˜å…ˆçº§,(çŒœæµ‹æ˜¯ä¸åŒçœ‹é—¨ç‹—çš„ä¼˜å…ˆçº§)è°ƒç”¨ä¸‹é¢çš„å‡½æ•°: oid watchdog_set_restart_priority(struct watchdog_device *wdd, int priority); 123456 * è®¾å®šä¼˜å…ˆçº§æ—¶,ç”¨æˆ·éœ€è¦éµå¾ªä»¥ä¸‹è§„åˆ™ * 0:ä¼˜å…ˆçº§æœ€ä½Ž,éžå¸¸æœ‰é™çš„é‡å¯èƒ½åŠ› * 128:é‡å¯å¤„ç†çš„é»˜è®¤é€‰æ‹©,å¦‚æžœæ²¡æœ‰å…¶ä»–çš„é‡å¯å¤„ç†ç¨‹åºå¯ç”¨,æˆ–è€…æ²¡æœ‰é‡å¯æ•´ä¸ªç³»ç»Ÿçš„é‡å¯å¤„ç†ç¨‹åºå¯ç”¨. * 255:æœ€é«˜ä¼˜å…ˆçº§,ä¼šè¦†ç›–å…¶ä»–æ‰€æœ‰é‡å¯å¤„ç†ç¨‹åº* ä½¿ç”¨pretimeout é€šçŸ¥åŠŸèƒ½,éœ€è¦åˆ©ç”¨ä»¥ä¸‹å‡½æ•°: void watchdog_notify_pretimeout(struct watchdog_device *wdd)``` è¿™ä¸ªå‡½æ•°å¯ä»¥åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨,å¦‚æžœå¯ç”¨äº†watchdog pretimeout governor æ¡†æž¶(kbuild CONFIG_WATCHDOG_PRETIMEOUT_GOV),å°±ä¼šé‡‡ç”¨è¿›å…¥é©±åŠ¨ç¨‹åºåˆ†é…å¥½çš„å¤„ç†ç¨‹åº,å¦‚æžœæ²¡æœ‰å¯ç”¨watchdog pretimeout governor æ¡†æž¶,watchdog_notify_pretimeout()ä¼šå°†ä¿¡æ¯è¾“å‡ºåˆ°å†…æ ¸æ—¥å¿—ç¼“å­˜.]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ è®°å½•</tag>
        <tag>Linux</tag>
        <tag>ç¿»è¯‘</tag>
        <tag>wdt</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘]]></title>
    <url>%2F2017%2F08%2F22%2Flinux%E7%AC%94%E8%AE%B0%E2%80%94%E7%9C%8B%E9%97%A8%E7%8B%97API%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91%2F</url>
    <content type="text"><![CDATA[éšæ‰‹ç¿»è¯‘çš„æ–‡æ¡£ï¼Œè¦çœ‹æ‡‚linuxå†…æ ¸ï¼Œå†…æ ¸é™„å¸¦çš„æ–‡æ¡£è‡ªç„¶æ˜¯é€ƒä¸è¿‡ðŸ˜‚ï¼Œå…¨è‹±æ–‡é…åˆGoogleç¿»è¯‘ä¹Ÿå¾—ä¸Šã€‚ã€‚ã€‚ã€‚ æœ€åŽæ›´æ–°æ—¶é—´ 10/05/2007 linuxçœ‹é—¨ç‹—è®¾å¤‡API Copyright 2002 Christer Weingel &#x77;&#x69;&#x6e;&#103;&#x65;&#x6c;&#x40;&#x6e;&#x61;&#110;&#x6f;&#x2d;&#115;&#121;&#115;&#x74;&#x65;&#109;&#46;&#x63;&#111;&#x6d; æœ¬æ–‡æ¡£çš„ä¸€äº›å†…å®¹æ¥è‡ª sbc60xxwdt ï¼Œç‰ˆæƒå±žäºŽ Copyright 2000 Jakob Oestergaard &#x6a;&#97;&#x6b;&#111;&#x62;&#x40;&#x6f;&#115;&#x74;&#101;&#110;&#x66;&#x65;&#x6c;&#100;&#x2e;&#100;&#107; æœ¬æ–‡æ¡£åŸºäºŽlinuxå†…æ ¸ 2.4.18 ä»‹ç» ä½ åº”è¯¥å·²ç»çŸ¥é“äº†ï¼Œçœ‹é—¨ç‹—å®šæ—¶å™¨ï¼ˆWDTï¼‰æ˜¯ä¸€ä¸ªç¡¬ä»¶å¤ä½ç”µè·¯ï¼Œåœ¨ç³»ç»Ÿè½¯ä»¶å‡ºçŽ°æ•…éšœæ—¶å¤ä½ç³»ç»Ÿã€‚ é€šå¸¸ï¼Œç”¨æˆ·ç©ºé—´çš„å®šæœŸå–‚ç‹—ç¨‹åºé€šè¿‡/dev/watchdogçš„è®¾å¤‡æ–‡ä»¶é€šçŸ¥å†…æ ¸çœ‹é—¨ç‹—é©±åŠ¨ç¨‹åºã€‚é©±åŠ¨æ”¶åˆ°é€šçŸ¥ï¼Œä¼šå‘ŠçŸ¥ç¡¬ä»¶çœ‹é—¨ç‹—ä¸€åˆ‡æ­£å¸¸ï¼Œç¡¬ä»¶çœ‹é—¨ç‹—éœ€è¦ç­‰ä¸€ä¼šå†å¤ä½ç³»ç»Ÿã€‚å¦‚æžœç”¨æˆ·ç©ºé—´é€šçŸ¥å¤±è´¥ï¼ˆRAMé”™è¯¯ã€å†…æ ¸æ¼æ´žç­‰ç­‰ï¼‰ï¼Œé€šçŸ¥å°†åœæ­¢ã€‚è¶…æ—¶åŽï¼Œç¡¬ä»¶çœ‹é—¨ç‹—å°†å¤ä½ç³»ç»Ÿï¼ˆé‡å¯ï¼‰ã€‚ linuxçœ‹é—¨ç‹—çš„APIæ˜¯ç›¸å½“ç‰¹æ®Šçš„ç»“æž„ï¼Œä¸åŒçš„é©±åŠ¨ç¨‹åºå¯¹APIçš„æ‰§è¡Œå„ä¸ç›¸åŒï¼Œæœ‰æ—¶ä¼šç¢°åˆ°ä¸å…¼å®¹çš„æƒ…å†µã€‚æœ¬æ–‡æ¡£å‚æ•°è®°å½•çŽ°æœ‰çš„æƒ…å†µï¼Œä»¥ä¾›æœªæ¥çš„é©±åŠ¨å¼€å‘å‚è€ƒã€‚æœ€ç®€å•çš„API æ‰€æœ‰é©±åŠ¨éƒ½æ”¯æŒçš„åŸºæœ¬æ“ä½œæ¨¡å¼ã€‚/dev/watchdogè¢«æ‰“å¼€åŽï¼Œçœ‹é—¨ç‹—è¢«æ¿€æ´»å¹¶å¤ä½ç³»ç»Ÿï¼Œé™¤éžåœ¨ä¸€å°æ®µæ—¶é—´å†…è¢«pingé€šï¼Ÿï¼ˆå–‚ç‹—ï¼‰ï¼Œè¿™æ®µæ—¶é—´è¢«ç§°ä¸ºè¶…æ—¶æ—¶é—´æˆ–é—´æ–­æ—¶é—´ã€‚ç®€å•çš„å–‚ç‹—çš„æ–¹å¼æ˜¯å‘é©±åŠ¨ç¨‹åºå†™å…¥ä¸€äº›æ•°æ®ï¼Œä¸€ä¸ªéžå¸¸ç®€å•çš„å®žä¾‹åœ¨see samples/watchdog/watchdog-simple.cä¸‹. æ›´é«˜çº§çš„é©±åŠ¨ç¨‹åºå¯ä»¥åšåˆ°ä¾‹å¦‚æ£€æŸ¥ä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œåœ¨æ‰§è¡Œå–‚ç‹—æ“ä½œä¹‹å‰ï¼Œåšå‡ºå›žåº”ã€‚ /dev/ä¸‹è®¾å¤‡èŠ‚ç‚¹è¢«å…³é—­åŽï¼Œçœ‹é—¨ç‹—ä¹ŸåŒæ—¶è¢«ç¦ç”¨ï¼Œé™¤éžæ”¯æŒâ€œMagic Closeâ€ï¼ˆè§ä¸‹æ–‡ï¼‰ï¼Œè¿™å¹¶ä¸æ˜¯ä¸ªå¥½åŠžæ³•ã€‚å› ä¸ºå¦‚æžœçœ‹çœ‹é—¨ç‹—demoæœ‰bugå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œä½†ç³»ç»Ÿä¸ä¼šé‡å¯ã€‚å› ä¸ºè¿™æ ·ä¸€äº›é©±åŠ¨æ”¯æŒâ€Disable watchdog shutdown on closeâ€, CONFIG_WATCHDOG_NOWAYOUTâ€è¿™æ ·çš„é…ç½®é€‰é¡¹ã€‚ä¸€æ—¦ç¼–è¯‘å†…æ ¸æ—¶å€™å¯ç”¨è¿™äº›é€‰é¡¹ï¼Œä¸€æ—¦çœ‹é—¨ç‹—ç¨‹åºæ¿€æ´»ï¼Œå°±ä¸å¯èƒ½ç¦ç”¨çœ‹é—¨ç‹—ã€‚å¦‚æžœçœ‹é—¨ç‹—demoå´©æºƒï¼Œç³»ç»Ÿä¼šåœ¨è¶…æ—¶åŽè‡ªåŠ¨é‡å¯ã€‚çœ‹é—¨ç‹—é©±åŠ¨é€šå¸¸ä¹Ÿæ”¯æŒnowayout module parameterï¼Œä»¥ä¾¿åœ¨è¿è¡Œæ—¶æŽ§åˆ¶nowayout moduleã€‚ Magic Close feature å¦‚æžœé©±åŠ¨ç¨‹åºæ”¯æŒMagic Close,é‚£ä¹ˆè®¾å¤‡å°†ä¸æ”¯æŒç¦ç”¨çœ‹é—¨ç‹—ï¼Œé™¤éžåœ¨å…³é—­è®¾å¤‡æ–‡ä»¶å‰ï¼Œå‘/dev/watchdogä¸‹è®¾å¤‡æ–‡ä»¶å†™å…¥ç‰¹å®šçš„magic å­—ç¬¦ â€˜Vâ€™ã€‚å¦‚æžœç”¨æˆ·ç©ºé—´çš„ daemonå…³é—­äº†çœ‹é—¨çš„è®¾å¤‡æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰å‘é€é‚£ä¸ªç‰¹å®šçš„å­—ç¬¦ï¼Œé©±åŠ¨ä¼šè®¤ä¸ºdaemonè¿›ç¨‹å·²ç»è¢«æ€ï¼Œå¹¶ä¸”åœæ­¢äº†å®šæœŸå–‚ç‹—è¡Œä¸ºã€‚è¿™æ ·ä¼šå¯¼è‡´è¶…æ—¶åŽç³»ç»Ÿé‡å¯ã€‚ioctl API æ‰€æœ‰çš„é©±åŠ¨ç¨‹åºéƒ½æ”¯æŒioctl API å–‚ç‹—æ“ä½œä½¿ç”¨ioctlå®Œæˆ æ‰€æœ‰çš„é©±åŠ¨éƒ½è¦æ”¯æŒä¸€ä¸ªKEEPALIVEçš„ioctlå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥èµ·åˆ°å‘é©±åŠ¨å†™å…¥æ•°æ®ä¸€æ ·çš„ä½œç”¨ã€‚æ‰€ä»¥watchdog daemonçš„ä¸»å‡½æ•°å¾ªçŽ¯å¯ä»¥è¿™æ ·å®žçŽ°1234 while (1) &#123; ioctl(fd, WDIOC_KEEPALIVE, 0); sleep(10);&#125; Setting and getting the timeout æŸäº›é©±åŠ¨æ”¯æŒè¿è¡Œæ—¶é€šè¿‡SETTIMEOUT ioctlå‘½ä»¤ä¿®æ”¹è¶…æ—¶æ—¶é—´ï¼Œè¿™äº›é©±åŠ¨éƒ½æœ‰WDIOFSETTIMEOUTçš„æ ‡å¿—ä½ã€‚è¶…æ—¶æ—¶é—´æ˜¯ä¸€ä¸ªå•ä½ä¸ºç§’çš„æ•´æ•°ï¼Œé©±åŠ¨ç¨‹åºä¼šè¿”å›žè¿™ä¸ªå˜é‡å®žé™…è®¾ç½®çš„æ•°å€¼ï¼Œä½†æ˜¯ç”±äºŽç¡¬ä»¶é™åˆ¶ï¼Œè¿”å›žçš„æ•°å€¼å¯èƒ½ä¸Žè®¾ç½®æ•°å€¼ä¸åŒã€‚123int timeout = 45;ioctl(fd, WDIOC_SETTIMEOUT, &amp;timeout);printf(&quot;The timeout was set to %d seconds\n&quot;, timeout); è¿™ä¸ªå®žä¾‹æˆ–è®¸ä¼šè¾“å‡ºâ€The timeout was set to 60 secondsâ€ï¼Œå¦‚æžœè®¾å¤‡è¶…æ—¶æ—¶é—´ä¸ºåˆ†é’Ÿã€‚ è‡ªä»Ž2.4.18å†…æ ¸å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨GETTIMEOUT ioctlå‘½ä»¤ï¼ŒèŽ·å–è¶…æ—¶æ—¶é—´ã€‚ 12ioctl(fd, WDIOC_GETTIMEOUT, &amp;timeout);printf("The timeout was is %d seconds\n", timeout); Pretimeouts ä¸€äº›çœ‹é—¨ç‹—å®šæ—¶å™¨å¯ä»¥åœ¨ç³»ç»Ÿé‡å¯å‰ä¸€æ®µæ—¶é—´è®¾ç½®ä¸€ä¸ªè§¦å‘å™¨ã€‚è¿™æ ·è¿è¡Œlinuxåœ¨ç³»ç»Ÿä»Žå‰è®°å½•ä¸€äº›é‡è¦çš„ä¿¡æ¯ï¼ˆåƒpanicä¿¡æ¯å’Œkernel coredumpsï¼‰ï¼Œå…·ä½“å¯ä»¥é€šè¿‡NMTã€ä¸­æ–­ç­‰æœºåˆ¶å®žçŽ°ã€‚ 12pretimeout = 10;ioctl(fd, WDIOC_SETPRETIMEOUT, &amp;pretimeout); è¯·æ³¨æ„ï¼Œpretimeout æ—¶é—´æ˜¯åœ¨ è¶…æ—¶å…³é—­ç³»ç»Ÿ ä¹‹å‰çš„ç§’æ•°ã€‚ä¸æ˜¯ç›´åˆ°å‘ç”Ÿpretimeout äº‹ä»¶çš„ç§’æ•°ã€‚ä¾‹å¦‚è®¾å®šçš„è¶…æ—¶æ—¶é—´æ˜¯60sï¼Œ pretimeoutæ˜¯10sã€‚pretimeoutäº‹ä»¶ä¼šåœ¨50sæ—¶å‘ç”Ÿã€‚pretimeoutè®¾ç½®ä¸º0ä»£è¡¨ç¦ç”¨pretimeoutã€‚ åŒæ ·å­˜åœ¨ä¸€ä¸ªèŽ·å–pretimeoutçš„ioctlå‘½ä»¤ã€‚ 12ioctl(fd, WDIOC_GETPRETIMEOUT, &amp;timeout);printf(&quot;The pretimeout was is %d seconds\n&quot;, timeout); ä¸æ˜¯æ‰€æœ‰çœ‹é—¨ç‹—é©±åŠ¨éƒ½æ”¯æŒ pretimeout èŽ·å–é‡å¯å‰ç§’æ•° ä¸€äº›çœ‹é—¨ç‹—é©±åŠ¨æ”¯æŒèŽ·å–ç³»ç»Ÿé‡å¯å‰ç§’æ•°ã€‚é€šè¿‡WDIOCGETTIMELEFT ioctl å‘½ä»¤å¯ä»¥è¿”å›žç³»ç»Ÿé‡å¯å‰ç§’æ•°ã€‚12ioctl(fd, WDIOC_GETTIMELEFT, &amp;timeleft);printf(&quot;The timeout was is %d seconds\n&quot;, timeleft); çŽ¯å¢ƒç›‘æµ‹ æ‰€æœ‰çš„çœ‹é—¨ç‹—é©±åŠ¨éƒ½è¢«è¦æ±‚è¿”å›žæ›´å¤šå…³äºŽç³»ç»Ÿæœ€åŽä¸€æ¬¡é‡å¯çš„ä¿¡æ¯ï¼Œåƒæ˜¯æ¸©åº¦ã€é£Žæ‰‡è½¬é€Ÿã€ç”µæºç­‰ã€‚GETSUPPORT ioctl çš„å‘½ä»¤å¯ä»¥è¿”å›ž è®¾å¤‡å¯ä»¥æ”¯æŒçš„ä¿¡æ¯ã€‚ 12struct watchdog_info ident;ioctl(fd, WDIOC_GETSUPPORT, &amp;ident); è¿”å›žçš„ç»“æž„identä¸­çš„å­—æ®µå¦‚ä¸‹ï¼š 123 identity æè¿°watchdog driverçš„å­—ç¬¦ä¸²firmware_version the firmware version of the card if availableoptions è®¾å¤‡æ”¯æŒæƒ…å†µçš„æ ‡å¿—ä½ optionsæè¿°äº†GET_STATUS å’ŒGET_BOOTSTATUS ioctlå‘½ä»¤å¯ä»¥è¿”å›žé‚£äº›ä¿¡æ¯ã€‚å¹¶ä¸”å¯ä»¥è®¾ç½®ã€‚ï¼ˆï¼‰??æ— æ³•ç†è§£ä»€ä¹ˆæ„æ€?? WDIOFOVERHEAT cpuè¿‡çƒ­å¤ä½ç³»ç»Ÿé‡å¯å› ä¸ºï¼Œè¶…è¿‡äº†æ¸©åº¦é™åˆ¶ä¸Šé™ã€‚ WDIOFFANFAULT é£Žæ‰‡å¤±æ•ˆå¤ä½ WDIOFEXTERN1 External relay 1 å¤–éƒ¨ç›‘æŽ§ç”µæº1è¢«è§¦å‘ï¼Œï¼Ÿï¼Ÿï¼ŸControllers intended for real world applications include external monitoring pins that will trigger a reset.ï¼Ÿï¼Ÿï¼ˆä¸æ˜Žç™½ä»€ä¹ˆæ„æ€ï¼‰ WDIOF_EXTERN2 External relay 2å¤–éƒ¨ç›‘æŽ§ç”µæº2è¢«è§¦å‘ WDIOF_POWERUNDER ç”µæºåäº†ï¼Œç”µæºå¸¦ä¸åŠ¨äº†æœºå™¨æ˜¾ç¤ºæ¬ åŽ‹ã€‚ åŽé¢ä¸€ç‚¹ä¸ç¿»äº†ï¼Œæœ‰æ—¶é—´å†æ·»å‘ WDIOF_CARDRESET Card previously reset the CPUThe last reboot was caused by the watchdog card WDIOF_POWEROVER Power over voltageThe machine is showing an overvoltage status. Note that if one level is under and one over both bits will be set - this may seem odd but makes sense. WDIOF_KEEPALIVEPING Keep alive ping replyThe watchdog saw a keepalive ping since it was last queried. WDIOF_SETTIMEOUT Can set/get the timeoutThe watchdog can do pretimeouts. WDIOF_PRETIMEOUT Pretimeout (in seconds), get/setFor those drivers that return any bits set in the option field, the GETSTATUS and GETBOOTSTATUS ioctls can be used to ask for the current status, and the status at the last reboot, respectively. 12int flags;ioctl(fd, WDIOC_GETSTATUS, &amp;flags); or 1ioctl(fd, WDIOC_GETBOOTSTATUS, &amp;flags); Note that not all devices support these two calls, and some only support the GETBOOTSTATUS call. Some drivers can measure the temperature using the GETTEMP ioctl. The returned value is the temperature in degrees fahrenheit. 12int temperature;ioctl(fd, WDIOC_GETTEMP, &amp;temperature); Finally the SETOPTIONS ioctl can be used to control some aspects of the cards operation. 12int options = 0;ioctl(fd, WDIOC_SETOPTIONS, &amp;options); The following options are available: WDIOS_DISABLECARD Turn off the watchdog timer WDIOS_ENABLECARD Turn on the watchdog timer WDIOS_TEMPPANIC Kernel panic on temperature trip]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ è®°å½•</tag>
        <tag>Linux</tag>
        <tag>ç¿»è¯‘</tag>
        <tag>wdt</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ]]></title>
    <url>%2F2017%2F08%2F19%2Flinux%E7%AC%94%E8%AE%B0%E2%80%94rtc%E5%AD%90%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[æ­£å¼å¼€å§‹è®©äººå´©æºƒçš„linuxç³»åˆ—ï¼Œå¸Œæœ›è‡ªå·±èƒ½å†™å®Œã€‚å…ˆæ‹¿rtcå¼€åˆ€ã€‚ è¿™é‡Œæˆ‘å°½å¯èƒ½è®°å½•ä¸‹æ€ç»´çš„ç»†èŠ‚ï¼Œè€Œä¸æ˜¯ä»…å±€é™äºŽä»£ç ï¼Œå¸Œæœ›è‡ªå·±èƒ½é¢†ä¼šLinuxå†…æ ¸å¼€å‘è€…çš„æƒ³æ³•ã€‚ å†…æ ¸ç‰ˆæœ¬ï¼šlinux4.1 éœ€è¦äº†è§£ï¼šç®€ç•¥äº†è§£å­—ç¬¦é©±åŠ¨ å’Œ Linuxè®¾å¤‡é©±åŠ¨æ¨¡åž‹ RTC rtcå³real time clockï¼Œå®žæ—¶æ—¶é’Ÿã€‚ rtcä¸€èˆ¬è´Ÿè´£ç³»ç»Ÿå…³æœºåŽè®¡æ—¶ï¼Œé¢å¯¹ç¹å¤šçš„Linux RTCè®¾å¤‡ï¼Œå†…æ ¸å¹²è„†æä¾›äº†ä¸€ä¸ªrtcå­ç³»ç»Ÿï¼Œæ¥æ”¯æŒæ‰€æœ‰çš„rtcè®¾å¤‡ã€‚ å‚è€ƒèµ„æ–™ rtcå­ç³»ç»Ÿ rtcè®¾å¤‡æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ï¼Œrtcå­ç³»ç»Ÿåœ¨å­—ç¬¦è®¾å¤‡çš„åŸºç¡€ä¸ŠæŠ½è±¡ä¸Žç¡¬ä»¶æ— å…³çš„éƒ¨åˆ†ï¼Œå¹¶åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ‹“å±•sysfså’Œprocæ–‡ä»¶ç³»ç»Ÿä¸‹çš„è®¿é—®ã€‚ åˆ†æžæ—¶å€™å§‹ç»ˆè®°ä½ä¸¤ç‚¹ï¼š rtcå­ç³»ç»Ÿæ˜¯ä¸ºäº†è®©rtcè®¾å¤‡é©±åŠ¨ç¼–å†™æ›´ä¸ºç®€å•ï¼Œä¸Žç¡¬ä»¶æ— å…³éƒ¨åˆ†å·²è¢«æŠ½ç¦»ã€‚ rtcå­ç³»ç»Ÿæ˜¯åŸºäºŽå­—ç¬¦è®¾å¤‡è€Œæ¥çš„ã€‚æ–‡ä»¶æ¡†æž¶ rtcå­ç³»ç»Ÿçš„æºç åœ¨ /drivers/rtcåˆ å‡äº†å¾ˆå¤šrtc-xxx.cçš„é©±åŠ¨ï¼Œåªç•™ä¸‹äº†ds1307ä½œä¸ºç¤ºä¾‹ï¼Œè¿™é‡Œçœ‹åˆ°å®žé™…ä¸Šä»£ç å¹¶ä¸å¤šã€‚ å…·ä½“æ–‡ä»¶åˆ†æž rtc.hï¼šå®šä¹‰ä¸ŽRTCæœ‰å…³çš„æ•°æ®ç»“æž„ã€‚ class.cï¼šå‘å†…æ ¸æ³¨å†ŒRTCç±»ï¼Œä¸ºåº•å±‚é©±åŠ¨æä¾›rtc_device_registerä¸Žrtc_device_unregisteræŽ¥å£ç”¨äºŽRTCè®¾å¤‡çš„æ³¨å†Œ/æ³¨é”€ã€‚åˆå§‹åŒ–RTCè®¾å¤‡ç»“æž„ã€sysfsã€procã€‚ Interface.cï¼šæä¾›ç”¨æˆ·ç¨‹åºä¸ŽRTCçš„æŽ¥å£å‡½æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬ioctlå‘½ä»¤ã€‚ rtc-dev.cï¼šå°†RTCè®¾å¤‡æŠ½è±¡ä¸ºé€šç”¨çš„å­—ç¬¦è®¾å¤‡ï¼Œæä¾›æ–‡ä»¶æ“ä½œå‡½æ•°é›†ã€‚ rtc-sysfs.cï¼šç®¡ç†RTCè®¾å¤‡çš„sysfså±žæ€§ï¼ŒèŽ·å–RTCè®¾å¤‡åã€æ—¥æœŸã€æ—¶é—´ç­‰ã€‚ rtc-proc.cï¼šç®¡ç†RTCè®¾å¤‡çš„procfså±žæ€§ï¼Œæä¾›ä¸­æ–­çŠ¶æ€å’Œæ ‡å¿—æŸ¥è¯¢ã€‚ rtc-lib.cï¼šæä¾›RTCã€Dataå’ŒTimeä¹‹é—´çš„è½¬æ¢å‡½æ•°ã€‚ rtc-xxx,cï¼šRTCè®¾å¤‡çš„å®žé™…é©±åŠ¨ï¼Œæ­¤å¤„ä»¥rtc-ds1307ä¸ºä¾‹ã€‚ hctosys.cï¼šå¼€æœºæ—¶èŽ·å–RTCæ—¶é—´ã€‚ æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿæ¡†æž¶ RTCå­ç³»ç»Ÿå…·ä½“å¯åˆ†ä¸º3å±‚ï¼š ç”¨æˆ·å±‚ï¼šRTCå­ç³»ç»Ÿå‘ä¸Šå±‚æä¾›äº†æŽ¥å£ï¼Œç”¨æˆ·é€šè¿‡è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œé—´æŽ¥è°ƒç”¨RTCè®¾å¤‡ï¼Œå…·ä½“æœ‰3ç§æ–¹å¼ã€‚ /dev/rtc RTCè®¾å¤‡æŠ½è±¡è€Œæ¥çš„å­—ç¬¦è®¾å¤‡ï¼Œå¸¸è§„æ–‡ä»¶æ“ä½œé›†åˆã€‚ /sys/class/rtc/rtcx é€šè¿‡sysfsæ–‡ä»¶ç³»ç»Ÿè¿›è¡ŒRTCæ“ä½œï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚ /proc/driver/rtc é€šè¿‡procæ–‡ä»¶ç³»ç»ŸèŽ·å–RTCç›¸å…³ä¿¡æ¯ã€‚ RTCæ ¸å¿ƒå±‚ï¼šä¸Žç¡¬ä»¶æ— å…³ï¼Œç”¨äºŽç®¡ç†RTCè®¾å¤‡æ³¨å†Œ/æ³¨é”€ã€æä¾›ä¸Šå±‚æ–‡ä»¶æ“ä½œçš„æŽ¥å£ç­‰ã€‚ RTCé©±åŠ¨ï¼šç‰¹å®šRTCè®¾å¤‡çš„é©±åŠ¨ç¨‹åºï¼Œå®žçŽ°RTCæ ¸å¿ƒå±‚çš„å›žæŽ‰å‡½æ•°ã€‚ç¼–å†™RTCé©±åŠ¨éœ€è¦æŒ‰ç…§RTCå­ç³»ç»Ÿçš„æŽ¥å£å¡«å†™å¯¹åº”å‡½æ•°å¹¶å»ºç«‹æ˜ å°„å³å¯ã€‚RTCæ ¸å¿ƒå±‚å‡½æ•°å®žçŽ°çš„è¿‡ç¨‹å’Œæ•°é‡ä¸Žç‰¹å®šç¡¬ä»¶ç´§å¯†ç›¸å…³ã€‚ åˆçœ‹linuxç³»ç»Ÿçš„äººæ¥è¯´ï¼Œè¿™ä¸ªå›¾å¤Ÿå¤´æ™•çš„äº†ï¼Œä½†æ˜¯å‘¢ï¼Œå®žé™…ä¸Šæ²¡é‚£ä¹ˆéº»çƒ¦ã€‚ç”±æµ…å…¥æ·±ï¼Œä¸€ç‚¹ä¸€ç‚¹æ¥åˆ†æžã€‚ rtcå­ç³»ç»Ÿåˆ†æžrtc-dev rtcå­ç³»ç»ŸåŸºäºŽå­—ç¬¦è®¾å¤‡ï¼Œå­—ç¬¦è®¾å¤‡å¯¹åº”çš„è‚¯å®šæ˜¯rtc-dev.cäº†ï¼Œæˆ‘ä»¬çš„åˆ†æžç”±rtc-devèµ·æ­¥ã€‚ rtc-dev.c å…¸åž‹çš„å­—ç¬¦è®¾å¤‡ï¼Œæ¨¡å—çš„åˆå§‹åŒ–/å¸è½½è‡ªç„¶æ˜¯ rtc_dev_init(void) å’Œ rtc_dev_exit(void)ã€‚è®¾å¤‡æŽ¥å…¥ï¼Œæ·»åŠ /åˆ é™¤è®¾å¤‡ rtc_dev_add_device(struct rtc_device rtc) å’Œ e) void rtc_dev_del_device(struct rtc_device rtc)è¿˜æœ‰ioctlå’Œopenç­‰å‡½æ•°ï¼Œç†Ÿæ‚‰å­—ç¬¦è®¾å¤‡é©±åŠ¨çš„ä¸ç”¨å¤šè¯´ã€‚ è¿½è¸ªä¸€ä¸‹è¿™ä¸¤ç»„å‡½æ•°åœ¨å“ªé‡Œè°ƒç”¨çš„ã€‚ rtc_dev_init(void)å¯¹åº”åœ¨ class.cçš„rtc_init(void)å‡½æ•° rtc_dev_add_deviceå¯¹åº”åœ¨class.cçš„ rtc_device_register()å‡½æ•°ã€‚ rtc_dev_init(void)å¯¹åº”å®žåœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶ä½¿ç”¨ï¼Œå¯¹åº”rtc_init(void)ä¹Ÿæ˜¯åœ¨ç³»ç»Ÿåˆå§‹åŒ–ä¹‹åŽè°ƒç”¨ã€‚ rtc_dev_add_device()æ˜¯åœ¨é©±åŠ¨åŒ¹é…åŽè°ƒç”¨ï¼Œrtc_device_register()ä¹Ÿæ˜¯åœ¨é©±åŠ¨åŒ¹é…åŽè°ƒç”¨ã€‚æ‰“å¼€rtc-ds1307.c&gt;-probå‡½æ•°ï¼Œèƒ½æ‰¾åˆ°rtc_device_register()ä¹Ÿå°±è¯å®žäº†è¿™ä¸ªæ€è·¯ã€‚ æŽ¥ä¸‹æ¥è½¬å…¥class.c class.c linuxé©±åŠ¨æ¨¡åž‹ä¸­class.cå¯¹åº”ç±»çš„æ„æ€ï¼Œæ˜¯rtcç±»ã€‚æ¯ä¸ªclasså¯¹åº”éƒ½æœ‰è‡ªå·±æ ¸å¿ƒæ•°æ®ç»“æžœï¼Œå¯¹åº”rtcç±»å°±æ˜¯rtc-device rtc_device rtc_deviceä»£è¡¨ RTCè®¾å¤‡åŸºç¡€çš„æ•°æ®ç»“æž„ æ•°æ®ç»“æž„12345678910111213141516171819202122232425262728 struct rtc_device &#123; struct device dev; struct module *owner; int id; //RTCè®¾å¤‡çš„æ¬¡è®¾å¤‡å· char name[RTC_DEVICE_NAME_SIZE]; const struct rtc_class_ops *ops; struct mutex ops_lock; struct cdev char_dev; unsigned long flags; unsigned long irq_data; spinlock_t irq_lock; wait_queue_head_t irq_queue; struct fasync_struct *async_queue; struct rtc_task *irq_task; spinlock_t irq_task_lock; int irq_freq; int max_user_freq; #ifdef CONFIG_RTC_INTF_DEV_UIE_EMUL struct work_struct uie_task; struct timer_list uie_timer; /* Those fields are protected by rtc-&gt;irq_lock */ unsigned int oldsecs; unsigned int uie_irq_active:1; unsigned int stop_uie_polling:1; unsigned int uie_task_active:1; unsigned int uie_timer_active:1; #endif &#125;; å¾ˆé•¿ï¼Ÿå¾ˆðŸ˜µå¯¹ä¸å¯¹ï¼Ÿåªè¦å…³æ³¨ä¸€ç‚¹å°±è¡Œ_ 1234567int id; //ä»£è¡¨æ˜¯é‚£ä¸ªrtcè®¾å¤‡ char name[RTC_DEVICE_NAME_SIZE]; //ä»£è¡¨rtcè®¾å¤‡çš„åç§° const struct rtc_class_ops *ops; //rtcæ“ä½œå‡½æ•°é›†ï¼Œéœ€è¦é©±åŠ¨å®žçŽ° struct mutex ops_lock; //æ“ä½œå‡½æ•°é›†çš„äº’æ–¥é” struct cdev char_dev; //ä»£è¡¨rtcå­—ç¬¦è®¾å¤‡ï¼Œå› ä¸ºrtcå°±æ˜¯ä¸ªå­—ç¬¦è®¾å¤‡ unsigned long flags; //rtcçš„çŠ¶æ€æ ‡å¿—ï¼Œä¾‹å¦‚RTC_DEV_BUSY ä¸Šæ–‡ä¹¦è¯´åˆ°ï¼Œé©±åŠ¨ç¨‹åºçš„probå‡½æ•°é‡Œé¢è°ƒç”¨äº†rtc_device_register()è¿™è´§çš„ç±»åž‹å°±æ˜¯rtc_deviceã€‚å‚åŠ é©±åŠ¨ç¨‹åºæ€Žæ ·è°ƒç”¨rtc_deviceregister(),ä¸Žå…¶ä»–æ ¸å¿ƒçš„åŸºæœ¬ç»“æž„ä¸åŒçš„æ˜¯ï¼Œé©±åŠ¨ç¨‹åºä»¥ä¸æ˜¯ä»¥rtc-deviceä¸ºå‚æ•°æ³¨å†Œè®¾å¤‡åˆ°å­ç³»ç»Ÿï¼Œè€Œæ˜¯æ³¨å†Œå‡½æ•°ä¼šè¿”å›žä¸€ä¸ªrtcdeivceçš„ç»“æž„ç»™é©±åŠ¨ã€‚ rtc_class_ops è¿™ä¸ªæ˜¯rtcdeviceçš„ä¸€éƒ¨åˆ†ã€‚ æ•°æ®ç»“æž„ 12345678910111213141516 struct rtc_class_ops &#123; int (*open)(struct device *); //æ‰“å¼€è®¾å¤‡æ—¶çš„å›žè°ƒå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥åˆå§‹åŒ–ç¡¬ä»¶å¹¶ç”³è¯·èµ„æº void (*release)(struct device *); //è¿™ä¸ªå‡½æ•°æ˜¯è®¾å¤‡å…³é—­æ—¶è¢«è°ƒç”¨çš„ï¼Œåº”è¯¥æ³¨é”€ç”³è¯·çš„èµ„æº int (*ioctl)(struct device *, unsigned int, unsigned long); //ioctlå‡½æ•°ï¼Œå¯¹æƒ³è®©RTCè‡ªå·±å®žçŽ°çš„å‘½ä»¤åº”è¿”å›žENOIOCTLCMD int (*read_time)(struct device *, struct rtc_time *); //è¯»å–æ—¶é—´ int (*set_time)(struct device *, struct rtc_time *); //è®¾ç½®æ—¶é—´ int (*read_alarm)(struct device *, struct rtc_wkalrm *); //è¯»å–ä¸‹ä¸€æ¬¡å®šæ—¶ä¸­æ–­çš„æ—¶é—´ int (*set_alarm)(struct device *, struct rtc_wkalrm *); //è®¾ç½®ä¸‹ä¸€æ¬¡å®šæ—¶ä¸­æ–­çš„æ—¶é—´ int (*proc)(struct device *, struct seq_file *); //procfsæŽ¥å£ int (*set_mmss)(struct device *, unsigned long secs); //å°†ä¼ å…¥çš„å‚æ•°secsè½¬æ¢ä¸ºstruct rtc_timeç„¶åŽè°ƒç”¨set_timeå‡½æ•°ã€‚ç¨‹åºå‘˜å¯ä»¥ä¸å®žçŽ°è¿™ä¸ªå‡½æ•°ï¼Œä½† å‰ææ˜¯å®šä¹‰å¥½äº†read_time/set_timeï¼Œå› ä¸ºRTCæ¡†æž¶éœ€è¦ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ¥å®žçŽ°è¿™ä¸ªåŠŸèƒ½ã€‚ int (*irq_set_state)(struct device *, int enabled); //å‘¨æœŸé‡‡æ ·ä¸­æ–­çš„å¼€å…³ï¼Œæ ¹æ®enabledçš„å€¼æ¥è®¾ç½® int (*irq_set_freq)(struct device *, int freq); //è®¾ç½®å‘¨æœŸä¸­æ–­çš„é¢‘çŽ‡ int (*read_callback)(struct device *, int data); ///ç”¨æˆ·ç©ºé—´èŽ·å¾—æ•°æ®åŽä¼šä¼ å…¥è¯»å–çš„æ•°æ®ï¼Œå¹¶ç”¨è¿™ä¸ªå‡½æ•°è¿”å›žçš„æ•°æ®æ›´æ–°æ•°æ®ã€‚ int (*alarm_irq_enable)(struct device *, unsigned int enabled); //alarmä¸­æ–­ä½¿èƒ½å¼€å…³ï¼Œæ ¹æ®enabledçš„å€¼æ¥è®¾ç½® int (*update_irq_enable)(struct device *, unsigned int enabled); //æ›´æ–°ä¸­æ–­ä½¿èƒ½å¼€å…³ï¼Œæ ¹æ®enabledçš„å€¼æ¥è®¾ç½® &#125;; è¯¥ç»“æž„ä½“ä¸­å‡½æ•°å¤§å¤šæ•°éƒ½æ˜¯å’ŒrtcèŠ¯ç‰‡çš„æ“ä½œæœ‰å…³ï¼Œéœ€è¦é©±åŠ¨ç¨‹åºå®žçŽ°ã€‚æ‰€æœ‰RTCé©±åŠ¨éƒ½å¿…é¡»å®žçŽ°read_timeã€set_timeå‡½æ•°ï¼Œå…¶ä»–å‡½æ•°å¯é€‰ã€‚ å‚è€ƒå…¶ä»–çš„èµ„æ–™ï¼Œclassçš„åˆ†æžå¦‚ä¸‹ static int __init rtc_init(void) è°ƒç”¨class_createåˆ›å»ºRTCç±»ï¼Œåˆ›å»º/sys/class/rtcç›®å½•ï¼Œåˆå§‹åŒ–RTCç±»ç›¸å…³æˆå‘˜ï¼Œå‘ç”¨æˆ·ç©ºé—´æä¾›è®¾å¤‡ä¿¡æ¯ã€‚ è°ƒç”¨rtc-dev.cå®žçŽ°çš„rtc_dev_init();åŠ¨æ€åˆ†é…RTCå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ã€‚ è°ƒç”¨rtc_sysfs_init(rtcclass)ï¼›åˆ›å»º/sys/class/rtcä¸‹å±žæ€§æ–‡ä»¶ static void __exit rtcexit(void) è°ƒç”¨rtc-dev.cå®žçŽ°çš„rtc_dev_exit()ï¼›æ³¨é”€è®¾å¤‡å·ã€‚ è°ƒç”¨class_destroy(rtc_class)ï¼›æ³¨é”€/sys/classä¸‹çš„rtcç›®å½• struct rtc_device rtc_device_register(const char name, struct device dev,const struct rtc_class_ops ops,struct module *ownerï¼‰_ ç”³è¯·ä¸€ä¸ªidræ•´æ•°IDç®¡ç†æœºåˆ¶ç»“æž„ä½“ï¼Œå¹¶ä¸”åˆå§‹åŒ–ç›¸å…³æˆå‘˜ å°†è®¾å¤‡devå…³è”sysfsä¸‹çš„rtcç±» åˆå§‹åŒ–rtcç»“æž„ä½“çš„ä¿¡å·é‡ åˆå§‹åŒ–rtcç»“æž„ä½“ä¸­çš„ä¸­æ–­ è®¾ç½®rtcçš„åå­— åˆå§‹åŒ–rtcå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ï¼Œç„¶åŽæ³¨å†Œrtcè®¾å¤‡,è‡ªåŠ¨åˆ›å»º/dev/rtc(n)è®¾å¤‡èŠ‚ç‚¹æ–‡ä»¶ æ³¨å†Œå­—ç¬¦è®¾å¤‡ åœ¨/sys/rtc/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªé—¹é’Ÿå±žæ€§æ–‡ä»¶ åˆ›å»º/proc/driver/rtcç›®å½• void rtc_device_unregister(struct rtc_device *rtc) åˆ é™¤sysfsä¸­çš„rtcè®¾å¤‡,å³åˆ é™¤/sys/class/rtcç›®å½• åˆ é™¤devä¸‹çš„/dev/rtc(n)è®¾å¤‡èŠ‚ç‚¹æ–‡ä»¶ åˆ é™¤è™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸæŽ¥å£,å³åˆ é™¤/proc/driver/rtcç›®å½• å¸è½½å­—ç¬¦è®¾å¤‡ æ¸…ç©ºrtcçš„æ“ä½œå‡½æ•°æŒ‡é’ˆrtc-&gt;ops é‡Šæ”¾rtcçš„deviceç»“æž„ä½“_ static void rtc_device_release(struct device dev) å¸è½½idræ•°å­—ç®¡ç†æœºåˆ¶ç»“æž„ä½“ é‡Šæ”¾rtcç»“æž„ä½“çš„å†…å­˜ Rtcå­ç³»ç»Ÿåˆå§‹åŒ– ä¸Šå›¾ ä½¿ç”¨rtcå­ç³»ç»Ÿé¦–å…ˆéœ€è¦åœ¨å†…æ ¸ç¼–è¯‘é€‰é¡¹ä¸­å¯ç”¨RTCå­ç³»ç»Ÿæ”¯æŒã€‚ å¿…é¡»å¯ç”¨Real Time Clock ä½¿ç”¨/devä¸‹çš„è®¾å¤‡æ–‡ä»¶å¯¹åº”å¼€å¯CONFIG_RTC_INTF_DEV ä½¿ç”¨/procä¸‹çš„æŽ¥å£å¯¹åº”å¼€å¯CONFIG_RTC_INTF_PROC ä½¿ç”¨/sysfsä¸‹çš„æŽ¥å£å¯¹åº”å¼€å¯CONFIG_RTC_INTF_SYSFS _ç³»ç»Ÿå¯åŠ¨åŽï¼Œå¦‚é…ç½®å¯ç”¨rtcå­ç³»ç»Ÿï¼Œåˆ™ä¼šé¦–å…ˆæ‰§è¡Œrtcinitå‡½æ•°ï¼Œåˆ›å»ºrtcç±»ã€åˆå§‹åŒ–ç›¸å…³æˆå‘˜ã€åˆ†é…è®¾å¤‡å·ç­‰ åˆ›å»ºrtcç±»åŽï¼Œä¹‹åŽè°ƒç”¨rtc_dev_init()åŠ¨æ€åˆ†é…rtcå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ã€‚ä¹‹åŽè°ƒç”¨rtc_sysfs_init()åˆå§‹åŒ–/sys/class/rtcç›®å½•ä¸­çš„å±žæ€§æ–‡ä»¶ Rtcè®¾å¤‡æ³¨å†Œ Rtcè®¾å¤‡æœ¬è´¨ä¸Šå±žäºŽå­—ç¬¦è®¾å¤‡ï¼Œä¾é™„äºŽç³»ç»Ÿå†…æ€»çº¿ã€‚ä¸€èˆ¬æ¥è¯´cpuå†…éƒ¨rtcä¾é™„äºŽplatformæ€»çº¿ï¼Œå¤–ç½®rtcèŠ¯ç‰‡åˆ™ä¾é™„äºŽé€šä¿¡æ–¹å¼å¯¹åº”æ€»çº¿ã€‚å…¶è¿‡ç¨‹ä¸Žé€šç”¨å­—ç¬¦è®¾å¤‡ç›¸ä¼¼ï¼Œrtcå­ç³»ç»Ÿåœ¨è®¾å¤‡æ³¨å†Œè¿‡ç¨‹ä¸­é™„åŠ äº†probå’Œsysfsç›¸å…³çš„æ³¨å†Œå’Œåˆå§‹åŒ–æ“ä½œã€‚ ä¸Šå›¾ Rtcè®¾å¤‡æŒ‚è½½åŽï¼Œç›¸åº”æ€»çº¿ä¼šæœç´¢åŒ¹é…çš„é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ç¨‹åºæˆåŠŸmatchåŽï¼Œè¿›å…¥é©±åŠ¨å®žçŽ°çš„probeå‡½æ•°ï¼Œæ‰§è¡Œè®¾å¤‡æ³¨å†Œç­‰æ“ä½œã€‚ å®Œæˆæ€»çº¿è®¾å¤‡æ³¨å†ŒåŽï¼Œprobeä¼šè·³è½¬åˆ°rtc_device_register()å‡½æ•°ï¼Œå°†è®¾å¤‡æ³¨å†Œåˆ°rtcå­ç³»ç»Ÿã€‚ Rtcè®¾å¤‡æœ¬è´¨å±žäºŽå­—ç¬¦è®¾å¤‡ï¼Œä¼šè°ƒç”¨rtc_dev_prepare()å‡½æ•°ï¼Œåˆå§‹åŒ–å­—ç¬¦è®¾å¤‡ï¼Œè®¾ç½®rtcç›¸å…³çš„file operationå‡½æ•°é›†åˆã€‚ ä¹‹åŽä¾æ¬¡è°ƒç”¨rtc_dev_add_device(rtc)ã€rtc_sysfs_add_device(rtc)ã€rtc_proc_add_device(rtc) ï¼Œè¿›è¡Œæ³¨å†Œå­—ç¬¦è®¾å¤‡ã€åœ¨/sys/rtc/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªé—¹é’Ÿå±žæ€§æ–‡ä»¶ã€åˆ›å»º/proc/driver/rtcç›®å½•ç­‰æ“ä½œã€‚ rtc_device_register()ä¼šå°†é©±åŠ¨å®žçŽ°çš„rtc_class_opsç»“æž„ä½“ä¸Žå…·ä½“è®¾å¤‡è”ç³»èµ·æ¥ã€‚ interface.c åœ¨rtc-proc.cã€rtc_sysfså’Œioctlå‘½ä»¤ä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œè°ƒç”¨çš„éƒ½æ˜¯interface.cæä¾›çš„æŽ¥å£ï¼Œè¿™é‡Œä»¥ioctlçš„ä¸€ä¸ªä¾‹å­è¯´æ˜Žæ•´ä¸ªè°ƒç”¨çš„è¿‡ç¨‹ ä¸Šå›¾ ä»¥icotlå‘½ä»¤RTC_RD_TIMEä¸ºä¾‹ï¼Œè¯´æ˜Žå‘½ä»¤è°ƒç”¨çš„æµç¨‹ã€‚ RTC_RD_TIMEå¯¹åº”çš„æ˜¯/devä¸‹ioctlå‘½ä»¤ï¼Œè°ƒç”¨è¢«è½¬å‘è‡³/rtc-dev.c rtc-dev.c-&gt;rtc_dev_ioctl(struct file *file,unsigned int cmd, unsigned long arg)å‡½æ•°ä¸­ã€‚RTC_RD_TIMEå¯¹åº”çš„ä»£ç ä¸ºerr = rtc_read_time(rtc, &amp;tm); rtc_read_timeæ˜¯interface.cæ–‡ä»¶æä¾›çš„æŽ¥å£ä¹‹ä¸€ã€‚ interface.c-&gt;rtc_read_time(struct rtc_device rtc, struct rtc_time tm)å‡½æ•°ä¸­å¯¹åº”rtc_class_opsè½¬å‘ä»£ç ä¸ºerr = rtc-&gt;ops-&gt;read_time(rtc-&gt;dev.parent, tm);å°†æ“ä½œè½¬å‘è‡³åŒ¹é…çš„rtcè®¾å¤‡ã€‚ è®¾å¤‡é©±åŠ¨è¿™é‡Œä»¥rtc-ds1307ä¸ºä¾‹ï¼Œä½†è®¾å¤‡æ³¨å†Œæ—¶é€šè¿‡mcp794xx_rtc_opsç»“æž„ä½“å°†rtc_class_opså¯¹åº”å‡½æ•°ä¸Žé©±åŠ¨ç¨‹åºå®žçŽ°çš„å‡½æ•°ç»‘å®š 1234567static const struct rtc_class_ops mcp794xx_rtc_ops = &#123;.read_time = ds1307_get_time,.set_time = ds1307_set_time,.read_alarm = mcp794xx_read_alarm,.set_alarm = mcp794xx_set_alarm,.alarm_irq_enable = mcp794xx_alarm_irq_enable,&#125;; æœ€ç»ˆæ‰§è¡Œè½¬å…¥ds1307.c-&gt; ds1307_get_timeå‡½æ•°ï¼Œæ‰§è¡Œä¸Žç¡¬ä»¶ç›¸å…³çš„æ“ä½œã€‚ rtc-sysfs.c ç”±å‰åŠéƒ¨åˆ†å¯çŸ¥ï¼Œ/sys/class/rtc/æ˜¯åœ¨rtc-initè°ƒç”¨rtc_sysfs_initåŽç”Ÿæˆã€‚ 123void __init rtc_sysfs_init(struct class *rtc_class) &#123; rtc_class-&gt;dev_groups = rtc_groups;&#125; è¿™é‡Œçš„rtc_groupsæ˜¯rtc-sysfs.cä¸­å®šä¹‰äº†è¿™æ ·ä¸€ä¸ªattributeå‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼š 12345678910static struct attribute *rtc_attrs[] = &#123;&amp;dev_attr_name.attr,&amp;dev_attr_date.attr,&amp;dev_attr_time.attr,&amp;dev_attr_since_epoch.attr,&amp;dev_attr_max_user_freq.attr,&amp;dev_attr_hctosys.attr,NULL,&#125;;ATTRIBUTE_GROUPS(rtc); _åœ¨rtc_sysfs_initå‡½æ•°è°ƒç”¨åŽç»‘å®šäº†sysfsèŠ‚ç‚¹æ“ä½œå‡½æ•°çš„é›†åˆï¼Œä½¿å¾—è®¾å¤‡åŒ¹é…é©±åŠ¨ç¨‹åºåŽè€Œç”Ÿæˆå¯¹åº”çš„rtcnæ–‡ä»¶å¤¹ã€‚ dev_attr_nameå’Œdev_attr_dataç”±å®DEVICE_ATTR_ROå’ŒDEVICE_ATTR_RWç”Ÿæˆï¼Œä»–ä»¬åˆ†åˆ«å®šä¹‰äº†åªè¯»çš„å’Œå¯è¯»å¯å†™çš„attributeèŠ‚ç‚¹ã€‚æ¯ä¸ªå±žæ€§å‡½æ•°ä¸‹éƒ½æœ‰DEVICE_ATTR_XX()å®å£°æ˜Žï¼Œç»‘å®šåˆ°å¯¹åº”attributeèŠ‚ç‚¹ã€‚ rtc-proc.c procæ–‡ä»¶ç³»ç»Ÿæ˜¯è½¯ä»¶åˆ›å»ºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå†…æ ¸é€šè¿‡ä»–å‘å¤–ç•Œå¯¼å‡ºä¿¡æ¯ï¼Œä¸‹é¢çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ç»‘å®šä¸€ä¸ªå‡½æ•°ï¼Œå½“ç”¨æˆ·è¯»å–è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå‘æ–‡ä»¶å†™å…¥ä¿¡æ¯ã€‚ rtc-proc.cä¸­åˆå§‹åŒ–äº†file_operationsç»“æž„ä½“ï¼š 123456static const struct file_operations rtc_proc_fops = &#123; .open = rtc_proc_open, .read = seq_read, .llseek = seq_lseek, .release = rtc_proc_release, &#125;; _RTCé©±åŠ¨åœ¨å‘RTCæ ¸å¿ƒæ³¨å†Œè‡ªå·±çš„æ—¶å€™ï¼Œç”±æ³¨å†Œå‡½æ•°rtc_device_resgisterè°ƒç”¨rtc_proc_add_deviceæ¥å®žçŽ°procæŽ¥å£çš„åˆå§‹åŒ–ï¼Œè¿™ä¸ªå‡½æ•°å¦‚ä¸‹å®šä¹‰ï¼š 12345void rtc_proc_add_device(struct rtc_device *rtc) &#123; if (rtc-&gt;id == 0) proc_create_data(&quot;driver/rtc&quot;, 0, NULL, &amp;rtc_proc_fops, rtc); &#125; ä¸»è¦æ˜¯å®Œæˆåˆ›å»ºæ–‡ä»¶èŠ‚ç‚¹ï¼Œå¹¶å°†æ–‡ä»¶çš„æ“ä½œå‡½æ•°ä¸ŽèŠ‚ç‚¹è”ç³»èµ·æ¥ã€‚è°ƒç”¨è¿™ä¸ªå‡½æ•°åŽï¼Œåœ¨/proc/driverç›®å½•ä¸‹å°±ä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶rtc rtcè®¾å¤‡è®¿é—® rtcå­ç³»ç»Ÿæœ€å¤šå¯ä»¥æ”¯æŒ16ä¸ªrtcè®¾å¤‡ï¼Œå¤šä¸ªrtcè®¾å¤‡ä¼šåœ¨/dev/å’Œ /sys/class/rtc/ä¸‹ç”Ÿæˆrtc0ã€rtc1â€¦ç­‰ä¸åŒèŠ‚ç‚¹(ä¸‹æ–‡ä»¥rtcnä»£ç§°)ã€‚è€Œç³»ç»Ÿå¯åŠ¨æ—¶ä¼šé€‰æ‹©ä¸€ä¸ªrtcè®¾å¤‡è¯»å–è®¡æ—¶ï¼Œåœ¨/devä¸‹æœ‰rtcæ–‡ä»¶ï¼Œrtcæ–‡ä»¶æŒ‡å‘ç³»ç»Ÿé€‰æ‹©çš„rtcè®¾å¤‡å¯¹åº”çš„rtcnï¼ˆä¸€èˆ¬ä¸ºrtc0ï¼‰ã€‚ ç”¨æˆ·å±‚è®¿é—®rtcè®¾å¤‡æœ‰3ç§é€”å¾„ï¼š /dev/rtcn openç­‰å­—ç¬¦è®¾å¤‡æ“ä½œå’Œioctlå‘½ä»¤ã€‚ /sys/class/rtc/rtcn sysfs å±žæ€§ï¼Œä¸€äº›å±žæ€§æ˜¯åªè¯»ã€‚ /proc/driver/rtc ç¬¬ä¸€ä¸ªrtcä¼šå ç”¨procfsæŽ¥å£ï¼Œåœ¨procfsä¸‹æš´éœ²æ›´å¤šä¿¡æ¯ã€‚ /dev åœ¨/devä¸‹ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è®¿é—®rtcè®¾å¤‡ï¼Œç¬¬ä¸€ä¸ªæ˜¯é€šè¿‡å­—ç¬¦è®¾å¤‡å®šä¹‰çš„openã€readç­‰å‡½æ•°ï¼ˆéœ€è¦é©±åŠ¨ç¨‹åºå®žçŽ°ï¼‰ã€å¦ä¸€ä¸ªæ˜¯é€šè¿‡å®šä¹‰çš„ioctlå‘½ä»¤ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯ç›´æŽ¥æ‰“å¼€rtc-dev.cå®šä¹‰çš„openç­‰å‡½æ•°ï¼Œåœ¨openç­‰ä¸­ç›´æŽ¥è°ƒç”¨é©±åŠ¨ç¨‹åºå®žçŽ°çš„å‡½æ•°ã€‚é€šè¿‡ioctlå‘½ä»¤è®¿é—®åˆ™æ˜¯å°†æ“ä½œè½¬å‘åˆ°äº†interface.cå®šä¹‰çš„æŽ¥å£ï¼Œé—´æŽ¥è°ƒç”¨é©±åŠ¨ç¨‹åºå®žçŽ°çš„å‡½æ•°ã€‚ ioctl()å‡½æ•°è®¿é—®/devä¸‹çš„è®¾å¤‡ã€‚ä»¥ä¸‹æ˜¯å…¸åž‹å‡½æ•°ï¼š_ ioctl(fd,RTC_ALM_SET, &amp;rtc_tm);è®¾ç½®alarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ï¼Œä¸è¶…è¿‡24å°æ—¶ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºstructrtc_timeç»“æž„ä½“ï¼Œè¯»å–æ—¶ä¼šå¿½ç•¥å¹´æœˆæ—¥ä¿¡æ¯ã€‚alarmä¸­æ–­ä¸Žwakeupalarmä¸­æ–­åªèƒ½åŒæ—¶ä½¿ç”¨1ä¸ªï¼Œä»¥æœ€åŽä¸€æ¬¡è®¾å®šä¸ºå‡†ã€‚ ioctl(fd,RTC_ALM_READ, &amp;rtc_tm)è¯»å–alarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ã€‚ ioctl(fd,RTC_WKALM_SET, &amp;alarm);è®¾ç½®wakeupalarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ï¼Œ wakeupalarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»å¯ä»¥åœ¨æœªæ¥çš„ä»»æ„æ—¶åˆ»ã€‚alarmä¸­æ–­ä¸Žwakeupalarmä¸­æ–­åªèƒ½åŒæ—¶ä½¿ç”¨1ä¸ªï¼Œä»¥æœ€åŽä¸€æ¬¡è®¾å®šä¸ºå‡†ã€‚ ioctl(fd,RTC_WKALM_RD, &amp;alarm);è¯»å–wakeupalarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ã€‚ ioctl(fd,RTC_IRQP_SET, tmp);è®¾ç½®å‘¨æœŸä¸­æ–­çš„é¢‘çŽ‡ï¼Œtmpçš„å€¼å¿…é¡»æ˜¯2çš„å¹‚ï¼ŒéžRootç”¨æˆ·æ— æ³•ä½¿ç”¨64HZä»¥ä¸Šçš„å‘¨æœŸä¸­æ–­ã€‚ ioctl(fd,RTC_IRQP_READ, &amp;tmp);è¯»å–å‘¨æœŸä¸­æ–­çš„é¢‘çŽ‡ã€‚ ioctl(fd,RTC_SET_TIME, &amp;rtc_tm)æ›´æ–°RTCèŠ¯ç‰‡çš„å½“å‰æ—¶é—´ã€‚ ioctl(fd,RTC_RD_TIME, &amp;rtc_tm);è¯»å–RTCç¡¬ä»¶ä¸­çš„å½“å‰æ—¶é—´ã€‚ ä»¥openæ“ä½œä¸ºä¾‹ï¼Œåœ¨ç”¨æˆ·å±‚å¯¹/devä¸‹è®¾å¤‡æ‰§è¡Œopenä¼šè¢«è½¬å‘è‡³rtc_dev_open(struct inode *inode, struct file *file)å‡½æ•°ï¼Œé€šè¿‡err= ops-&gt;open ? ops-&gt;open(rtc-&gt;dev.parent) : 0;åˆ¤æ–­é©±åŠ¨ç¨‹åºæ˜¯å¦é€šè¿‡è¿žæŽ¥çš„rtc_class_opsç»“æž„ä½“å®žçŽ°äº†openå‡½æ•°ï¼Œé©±åŠ¨ç¨‹åºå®žçŽ°äº†openå‡½æ•°ï¼Œåˆ™å°†openæ“ä½œè½¬å‘è‡³é©±åŠ¨ç¨‹åºã€‚ /sys /sys/class/rtc/rtcnä¸‹é¢çš„sysfsæŽ¥å£æä¾›äº†æ“ä½œrtcå±žæ€§çš„æ–¹æ³•ï¼Œæ‰€æœ‰çš„æ—¥æœŸæ—¶é—´éƒ½æ˜¯å¢™ä¸Šæ—¶é—´ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿæ—¶é—´ã€‚ date: RTCæä¾›çš„æ—¥æœŸ hctosys: å¦‚æžœåœ¨å†…æ ¸é…ç½®é€‰é¡¹ä¸­é…ç½®äº†CONFIG_RTC_HCTOSYSï¼ŒRTCä¼šåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™æä¾›ç³»ç»Ÿæ—¶é—´ï¼Œè¿™ç§æƒ…å†µä¸‹è¿™ä¸ªä½å°±æ˜¯1,å¦åˆ™ä¸º0 max_user_freq: éžç‰¹æƒç”¨æˆ·å¯ä»¥ä»ŽRTCå¾—åˆ°çš„æœ€å¤§ä¸­æ–­é¢‘ name: RTCçš„åå­—ï¼Œä¸Žsysfsç›®å½•ç›¸å…³ since_epoch: ä»Žçºªå…ƒå¼€å§‹æ‰€ç»åŽ†çš„ç§’æ•° time: RTCæä¾›çš„æ—¶é—´ wakealarm: å”¤é†’æ—¶é—´çš„æ—¶é—´äº‹ä»¶ã€‚ è¿™æ˜¯ä¸€ç§å•æ¬¡çš„å”¤é†’äº‹ä»¶ï¼Œæ‰€ä»¥å¦‚æžœè¿˜éœ€è¦å”¤é†’ï¼Œåœ¨å”¤é†’å‘ç”ŸåŽå¿…é¡»å¤ä½ã€‚è¿™ä¸ªåŸŸçš„æ•°æ®ç»“æž„æˆ–è€…æ˜¯ä»Žçºªå…ƒå¼€å§‹ç»åŽ†çš„å¦™æ•°ï¼Œæˆ–è€…æ˜¯ç›¸å¯¹çš„ç§’æ•° /proc /proc/driver/rtcä¸‹åªå¯¹åº”ç¬¬ä¸€ä¸ªrtcè®¾å¤‡ï¼Œä¸Žsysfsä¸‹ç›¸æ¯”ï¼Œè¯¥è®¾å¤‡æš´éœ²æ›´å¤šä¿¡æ¯ å¯¹åº”æˆªå›¾ RTCå­ç³»ç»Ÿæµ‹è¯•Hwclockå‘½ä»¤æˆ–ä½¿ç”¨æµ‹è¯•æ–‡ä»¶ã€‚ Hwclockå‘½ä»¤å¯ä»¥æ‰§è¡Œæœ€ç®€å•çš„RTCæµ‹è¯•ã€‚å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ hwclock #æŸ¥çœ‹RTCæ—¶é—´ hwclock -set -date=â€07/07/17 10:10â€ #è®¾ç½®ç¡¬ä»¶RTCæ—¶é—´ï¼ˆæœˆ/æ—¥/å¹´ æ—¶:åˆ†:ç§’ï¼‰ hwclock -w #ç³»ç»Ÿæ—¶é—´åŒæ­¥è‡³RTC hwclock -s #åŒæ­¥RTCåˆ°ç³»ç»Ÿæ—¶é—´ Linuxå†…æ ¸æä¾›äº†RTCå­ç³»ç»Ÿçš„æµ‹è¯•ç¤ºä¾‹æ–‡ä»¶ï¼Œä½äºŽtools/testing/selftests/timers/rtctest.cï¼ŒåŒ…å«äº†åŸºäºŽioctlå‘½ä»¤çš„å®Œæ•´æµ‹è¯•ã€‚]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ è®°å½•</tag>
        <tag>Linux</tag>
        <tag>rtc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2017%2F08%2F15%2Flinux%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E6%97%B6%E9%97%B4%E5%AD%90%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ss]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ è®°å½•</tag>
        <tag>Linux</tag>
        <tag>timer</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå†…æ ¸Cè¯­è¨€ä¸­çš„é¢å‘å¯¹è±¡]]></title>
    <url>%2F2017%2F07%2F11%2FLinux%E5%86%85%E6%A0%B8C%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%2F</url>
    <content type="text"><![CDATA[è½¬è½½è‡ªâ€Blog of UnicornXâ€ (http://unicornx.github.io/) é¢å‘å¯¹è±¡çš„æ€æƒ³åœ¨cè¯­è¨€ä¸­çš„åº”ç”¨ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°æ‰çŸ¥é“cè¯­è¨€è¿˜èƒ½è¿™ä¹ˆç”¨ã€‚ã€‚ã€‚ å‰è¨€ è¯­è¨€åªæ˜¯å·¥å…·ï¼Œé‡è¦çš„æ˜¯æ€æƒ³ã€‚ä½†æ˜¯ï¼ï¼Cè¯­è¨€ç”¨é¢å‘å¯¹è±¡ï¼Ÿï¼Ÿçœ‹äº†å†…æ ¸ä»£ç ï¼ŒçœŸç»™é‚£äº›å†™Linuxã€å†…æ ¸çš„å¤§ç¥žè·ªäº†ã€‚ã€‚ã€‚ å½“ç„¶å› ä¸ºCè¯­è¨€çš„å±€é™æ€§ï¼Œå¹¶éžå®Œå…¨é¢å‘å¯¹è±¡çš„å®žçŽ°ï¼Œç§æœ‰æˆå‘˜ç­‰å°±æ²¡æœ‰äº†ã€‚ å°è£… æ—¢ç±»åœ¨Cè¯­è¨€ä¸­çš„å®žçŽ°ï¼Œå®žé™…ä¸Šæ˜¯ struct + å‡½æ•°ä½“ = å‡½æ•°è¡¨ç»“æž„ä½“é‡Œä¸å…è®¸å­˜åœ¨æˆå‘˜å‡½æ•°ï¼Œä½†æ˜¯æ¢æˆæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆæ˜¯å¯ä»¥æ»´ã€‚ ç¤ºä¾‹12345struct foo_operations &#123; void (*op_a) (struct foo *, loff_t, int); void (*op_b) (struct foo *, char __user *, size_t, loff_t *); void (*op_c) (struct foo *, const char __user *, size_t, loff_t *); &#125;; ç»§æ‰¿ è¿™ä¸ªç®€å•ç‚¹ï¼Œ struct é‡Œé¢å¥— struct ï¼Œè­¦å‘Šç†Ÿæ‚‰cè¯­è¨€çš„åº”è¯¥éƒ½æ¸…é™¤ã€‚ã€‚ã€‚è¿™é‡Œæ²¡æœ‰çˆ¶ç±»å­ç±»çš„ä¸¥æ ¼åŒºåˆ†ï¼Œå®žé™…ä¸Šæ˜¯å®Œå…¨è‡ªç”±çš„ã€‚ ç¤ºä¾‹123456struct foo &#123; int a; int b; int c; struct foo_operations ops;&#125;; å¤šæ€ è¿™ä¸ªæ˜¯æœ€æœ‰æ„æ€çš„ï¼Œcè¯­è¨€ä¸­ä¸¥æ ¼è§„å®šåŒä¸€ä¸ª.cæ–‡ä»¶/å·¥ç¨‹ä¸­ä¸èƒ½å­˜åœ¨é‡åå‡½æ•°ï¼Œä½†æ˜¯cè¯­è¨€çš„ç²¾åŽ-æŒ‡é’ˆç»™äº†æ€è·¯ï¼Œå€ŸåŠ©ç»“æž„ä½“ï¼Œæˆ‘å‡½æ•°åä¸å˜ï¼Œæ¯æŒ‡å‘ä¸åŒçš„ç»“æž„ä½“å˜é‡å°±è¡Œäº†ã€‚ã€‚ã€‚è™½ç„¶è¿˜æ˜¯å¾ˆéº»çƒ¦ã€‚ã€‚ ç¤ºä¾‹123456struct foo a;a-&gt;ops = ops1;a-&gt;ops-&gt;op_a(a);//åˆ‡æ¢a-&gt;ops = ops2;a-&gt;ops-&gt;op_a(a); é“¾è¡¨ å†…æ ¸å†…å¤§é‡è¿ç”¨é“¾è¡¨ï¼Œå¼€å§‹ä¸æ¸…æ¥šçœŸæ˜¯å¤´æ™•ã€‚ã€‚ ç¤ºä¾‹ 123 struct list_head &#123;struct list_head *next, *prev; &#125;; ä¸€ä¸ªæŒ‡å‘è‡ªèº«çš„ç»“æž„ä½“ï¼ŒåŒ…å«ä¸‹ä¸€ä¸ªä¸Žè‡ªèº«çš„æŒ‡é’ˆã€‚ä½¿ç”¨ 1234struct A_LIST &#123; data_t data; struct list_head *list;&#125;; offsetofå® 1#define offsetof(type, member) (size_t)&amp;(((type*)0)-&gt;member) offsetofæ˜¯ç”¨æ¥åˆ¤æ–­ç»“æž„ä½“ä¸­æˆå‘˜çš„åç§»ä½ç½® containerofå® 123#define container_of(ptr, type, member) (&#123; \ const typeof( ((type *)0)-&gt;member ) *__mptr = (ptr); \ (type *)( (char *)__mptr - offsetof(type,member) );&#125;) æ ¹æ®ä¸€ä¸ªç»“æž„ä½“å˜é‡ä¸­çš„ä¸€ä¸ªåŸŸæˆå‘˜å˜é‡çš„æŒ‡é’ˆæ¥èŽ·å–æŒ‡å‘æ•´ä¸ªç»“æž„ä½“å˜é‡çš„æŒ‡é’ˆ..é“¾è¡¨å…ƒç´ å¸¸ç”¨]]></content>
      <categories>
        <category>Linuxç¬”è®°</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>cè¯­è¨€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”ä¹è”ç½‘ä¸Šä¼ æ•°æ® TCPé•¿è¿žæŽ¥æ€»ç»“]]></title>
    <url>%2F2017%2F06%2F11%2FAndroid%E7%AC%94%E8%AE%B0-%E4%B9%90%E8%81%94%E7%BD%91%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE%20TCP%E9%95%BF%E8%BF%9E%E6%8E%A5%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ä¹è”ç½‘ ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 å¯¼è¯­ æ¯•è®¾ä¸­çš„ä¹è”ç½‘éƒ¨åˆ†,è®°å½•ä»¥ä¾›å¤ä¹  å¼€æºåœ¨githubä¸Š https://github.com/Jasper-1024/HbuLeWei æœ€ç»ˆæ•ˆæžœ ä½¿ç”¨okhttpä¸Šä¼ æ•°æ®ã€‚ Tcpé•¿è¿žæŽ¥å®žçŽ°æ–¹å‘æŽ§åˆ¶ ä»¥ä»£ç ä¸ºä¸» ç›¸å…³æ•™ç¨‹ okhttpå…¥é—¨ http://blog.csdn.net/biezhihua/article/details/50603624 ä¹è”ç½‘ https://www.lewei50.com/dev/doc/176https://www.lewei50.com/dev/doc/155 Tcpé•¿è¿žæŽ¥ http://ls15114843569.blog.51cto.com/11015399/1767195 ç®€æ˜“ä¸Šä¼  http://ls15114843569.blog.51cto.com/11015399/1767195 ä¸Šä¼ æ•°æ® APIä»‹ç» https://www.lewei50.com/dev/apiinfo/3 APIæµ‹è¯• https://www.lewei50.com/dev/apitest/3 åœ°å€ï¼šhttp://www.lewei50.com/api/v1/gateway/updatesensors/ä½ çš„ç½‘å…³å· POSTæ–¹å¼ éœ€è¦é…ç½®headerå¤´ Userkey æ•°æ®å‘é€/è¿”å›žæ–¹å¼JSON 12345678910[ &#123; "Name":"T1", "Value":"1" &#125;, &#123; "Name":"01H1", "Value":"96.2" &#125;] è¿”å›žæ ¼å¼ 1234&#123; "Successful": true, "Message": null&#125; okhttp POST ä¼ æ„Ÿå™¨æ•°æ® è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849 //è¿”å›žæ•°æ®å¤„ç† public okhttp3.Callback callback = new okhttp3.Callback() &#123; @Override public void onResponse(Call call, Response response) throws IOException &#123; //è¿”å›žæœåŠ¡å™¨å†…å®¹ String responsedata = response.body().string(); LogUtil.d("okHttp", responsedata); &#125; @Override public void onFailure(Call call, IOException e) &#123; //å¼‚å¸¸å¤„ç† LogUtil.d("okHttp", "POSTé”™è¯¯"); &#125; &#125;;//å†…éƒ¨ç±» public static class Http &#123; public static final MediaType MEDIA_TYPE_MARKDOWN = MediaType.parse("text/x-markdown; charset=utf-8");//POSTæ•°æ®ï¼ŒæŒ‡å®šæŽ¥æ”¶å›žæŽ‰ public static void postData(String sensor_name, String sensor_data, okhttp3.Callback callback) &#123; OkHttpClient client = new OkHttpClient(); final String value = "[" + " &#123;" + " \"Name\":\"" + sensor_name + "\"," + " \"Value\":\"" + sensor_data + "\"" + " &#125;" + "]"; RequestBody requestBody = new RequestBody() &#123; @Override public MediaType contentType() &#123; return MEDIA_TYPE_MARKDOWN; &#125; @Override public void writeTo(BufferedSink sink) throws IOException &#123; sink.write(value.getBytes()); &#125; &#125;; Request request = new Request.Builder() .url("http://www.lewei50.com/api/V1/gateway/UpdateSensors/01") .header("userkey", "ä½ çš„userkey") .post(requestBody) .build(); client.newCall(request).enqueue(callback); &#125; &#125; å®žé™…ä½¿ç”¨ æ”¾åœ¨ä¸€ä¸ªåŽå°æœåŠ¡å†…ï¼Œè°ƒç”¨ç›¸å½“ç®€å•1Http.postData("PM2.5", "ä½ çš„æ•°æ®è½¬ä¸ºString", callback); Tcpé•¿è¿žæŽ¥ï¼Œè¿œç¨‹æŽ§åˆ¶ é¦–å…ˆå‚è€ƒä¹è”ç½‘åå‘æŽ§åˆ¶æ•™ç¨‹ï¼Œæ–°å»ºä¸€ä¸ªæŽ§åˆ¶å™¨ï¼Œè¿™é‡Œä»¥å¼€å…³ä¸ºä¾‹ã€‚ åŽŸç†æ˜¯ä¸ŽæœåŠ¡å™¨ä¿æŒä¸€ä¸ªTCPé•¿è¿žæŽ¥ï¼Œä¸åˆ°40såˆ·æ–°ä¸€æ¬¡ï¼Œä»¥æ­¤ä¿æŒé€šé“ï¼Œä¸Žè¢«æŽ§åˆ¶æ®µé€šä¿¡ï¼Œå‘é€æŽ§åˆ¶ä¿¡æ¯ã€‚ Tcpé•¿è¿žæŽ¥å‚è€ƒäº†@å¢¨è¿¹æµéŸ¶çš„AndroidåŸºäºŽTcpåè®®çš„Socketé•¿é“¾æŽ¥å°è£… åœ°å€ tcp.lewei50.comç«¯å£å· 9960å¿ƒè·³åŒ…é—´éš” 1minä»¥å†… å‘é€/æŽ¥æ”¶æ•°æ®æ ¼å¼ Jsonæœ¬åœ°å‘é€æ•°æ®æ ¼å¼ 123456789&#123; "method": "update", "gatewayNo": "ä½ çš„ç½‘å…³å·", "userkey": "ä½ çš„userkey"&#125;&amp;^! æœåŠ¡å™¨å‘é€æŽ§åˆ¶å‘½ä»¤æ ¼å¼ï¼Œæ•°æ®å¤„ç†æ—¶éœ€è¦åŽ»æŽ‰å­—ç¬¦ä¸²æœ€åŽçš„&amp;^! 12345678910111213141516&#123;"method":"send","gatewayNo":"01","userkey":"6d16ddb3c58c4e448a7e15e7acxxxxxx","f":" updateSensor","p1":"D1","p2":"1"&#125;&amp;^! æœ¬åœ°å“åº”æŽ§åˆ¶å‘½ä»¤åŽè¿”å›žæ•°æ®æ ¼å¼ 12345678910111213141516171819&#123;"method":"response","result":&#123; "successful":true, "message":"ok!", "data":[&#123; "id":"D1", "value":"1" &#125;, &#125;&amp;^! TCPè¿žæŽ¥ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166public class TcpSocketHelper &#123; private String mTag = "TcpSocketHelper"; private Socket socket; private boolean _connect; private ReceiveThread mReceiveThread; private boolean receiveStop; private Date lastKeepAliveOkTime; private OnRecivedListener mRecivedListener; //åœ°å€ private String mIpAddr = "http://tcp.lewei50.com"; //ç«¯å£ private int mPort = 9960; /** * å¼€å¯é“¾æŽ¥socket * @param ipAddr * @param port */ public void startConnect(String ipAddr, int port)&#123; LogUtil.d(mTag, "å‡†å¤‡é“¾æŽ¥..."); this.mIpAddr = ipAddr; this.mPort = port; InetAddress serverAddr; try &#123; socket = new Socket(ipAddr, port); LogUtil.d(mTag, "å‡†å¤‡é“¾æŽ¥..."); _connect = true; mReceiveThread = new ReceiveThread(); receiveStop = false; mReceiveThread.start(); LogUtil.d(mTag, "é“¾æŽ¥æˆåŠŸ..."); &#125; catch (Exception e) &#123; LogUtil.d(mTag, "é“¾æŽ¥å‡ºé”™..." + e.getMessage()); e.printStackTrace(); &#125; &#125; /** * å…³é—­é“¾æŽ¥ */ public void closeConnect()&#123; if (socket != null)&#123; try &#123; socket.close(); socket = null; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; /** * ä¿æŒå¿ƒè·³ */ public void KeepAlive() &#123; // åˆ¤æ–­socketæ˜¯å¦å·²æ–­å¼€,æ–­å¼€å°±é‡è¿ž if (lastKeepAliveOkTime != null) &#123; LogUtil.d(mTag, "ä¸Šæ¬¡å¿ƒè·³æˆåŠŸæ—¶é—´:"+ DateFormat.format("yyyy-MM-dd HH:mm:ss", lastKeepAliveOkTime)); Date now = Calendar.getInstance().getTime(); long between = (now.getTime() - lastKeepAliveOkTime.getTime());// å¾—åˆ°ä¸¤è€…çš„æ¯«ç§’æ•° if (between &gt; 60 * 1000) &#123; LogUtil.d(mTag, "å¿ƒè·³å¼‚å¸¸è¶…è¿‡40,é‡æ–°è¿žæŽ¥:"); lastKeepAliveOkTime = null; socket = null; &#125; &#125; else &#123; lastKeepAliveOkTime = Calendar.getInstance().getTime(); &#125; if (!checkIsAlive()) &#123; LogUtil.d(mTag, "é“¾æŽ¥å·²æ–­å¼€,é‡æ–°è¿žæŽ¥."); startConnect(mIpAddr, mPort); &#125; &#125; /** * æ­¤æ–¹æ³•æ˜¯æ£€æµ‹æ˜¯å¦è¿žæŽ¥ * @return */ public boolean checkIsAlive() &#123; if (socket == null||!socket.isConnected()) return false; return true; &#125; /** * å‘é€æ•°æ®çš„æ–¹æ³• * @param msg */ public void sendmessage(String msg) &#123; boolean isAlive = checkIsAlive(); if (!isAlive) return; LogUtil.d(mTag, "å‡†å¤‡å‘é€æ¶ˆæ¯:" + msg); try &#123; if (socket != null &amp;&amp; socket.isConnected()) &#123; if (!socket.isOutputShutdown()) &#123; //2.å¾—åˆ°socketè¯»å†™æµ OutputStream os=socket.getOutputStream(); //true:æ˜¯å¦è‡ªåŠ¨flush PrintWriter outStream=new PrintWriter(os, true); outStream.print(msg); outStream.flush(); &#125; &#125; LogUtil.d(mTag, "å‘é€æˆåŠŸ!"); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; /** * è®¾ç½®æŽ¥æ”¶æ•°æ®ç›‘å¬å™¨ * @param mRecivedListener */ public void setmRecivedListener(OnRecivedListener mRecivedListener) &#123; this.mRecivedListener = mRecivedListener; &#125; /** * æ•°æ®æŽ¥æ”¶çº¿ç¨‹ */ class ReceiveThread extends Thread&#123; @Override public void run() &#123; while (true) &#123; try &#123; sleep(2000); // åˆ¤æ–­ Socket æ˜¯å¦å¤„äºŽè¿žæŽ¥çŠ¶æ€ if (socket != null &amp;&amp; socket.isConnected()) &#123; // å®¢æˆ·ç«¯æŽ¥æ”¶æœåŠ¡å™¨ç«¯çš„å“åº”ï¼Œè¯»å–æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯çš„è¾“å…¥æµ InputStream isRead = socket.getInputStream(); // ç¼“å†²åŒº byte[] buffer = new byte[isRead.available()]; // è¯»å–ç¼“å†²åŒº isRead.read(buffer); // è½¬æ¢ä¸ºå­—ç¬¦ä¸² String responseInfo = new String(buffer); // æ—¥å¿—ä¸­è¾“å‡º if(responseInfo != null&amp;&amp;!responseInfo.equals(""))&#123; LogUtil.d("TcpManager", "è¿”å›žï¼š"+responseInfo); mRecivedListener.onRecived(responseInfo); &#125; lastKeepAliveOkTime = Calendar.getInstance().getTime(); KeepAlive(); continue; &#125; else &#123; if (socket != null) LogUtil.d(mTag, "é“¾æŽ¥çŠ¶æ€:" + socket.isConnected()); &#125; &#125; catch (Exception e) &#123; LogUtil.d(mTag, "ç›‘å¬å‡ºé”™:" + e.toString()); e.printStackTrace(); &#125; &#125; &#125; &#125;&#125; ä½¿ç”¨,åŒ…è£…åœ¨ä¸€ä¸ªåŽå°serviceä¸­ï¼Œåœ¨serviceä¸­å®žçŽ°TcpSocketHelperçš„onRecivedæ–¹æ³• 1234567891011 //tcpè¿”å›žä¿¡æ¯ @Override public void onRecived(String data) &#123; LogUtil.d(&quot;okHttpService&quot;, data); //å¤„ç†æœåŠ¡å™¨å‘å›žçš„æ•°æ® &#125;TcpSocketHelper tcpSocketHelper = new TcpSocketHelper();tcpSocketHelper.startConnect(&quot;tcp.lewei50.com&quot;, 9960);//è®¾ç½®ç›‘å¬tcpSocketHelper.setmRecivedListener(this); å‘é€å¿ƒè·³åŒ…12345678String value = " &#123;" + " \"method\":\"update\"," + " \"gatewayNo\":\"01\"," + " \"userkey\":\"ä½ çš„userkey\"" + " &#125;&amp;^!"; //å‘é€æ•°æ® tcpSocketHelper.sendmessage(value); å¤„ç†æ•°æ® åœ¨serviceçš„onRecivedä¸­ æœ¬åœ°å¤„ç†å®Œæ¯•åŽï¼Œå‘æœåŠ¡å™¨è¿”å›žè¢«æŽ§åˆ¶å™¨çŠ¶æ€ 123String value5 = "&#123;\"method\":\"response\",\"result\":&#123;\"successful\":true,\"message\":\"ok!\",\"data\":[&#123;\"id\":\"D1\",\"value \":\"1\"&#125;]&#125;&#125;&amp;^! "; tcpSocketHelper.sendmessage(value6);]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
        <tag>æ¯•è®¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°-è‡ªç”¨MVPæ¡†æž¶]]></title>
    <url>%2F2017%2F05%2F08%2FAndroid%E7%AC%94%E8%AE%B0-%E8%87%AA%E7%94%A8MVP%E6%A1%86%E6%9E%B6%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç½‘ç»œ ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 å¯¼è¯­ è½¬çœ¼åˆšç”¨ä¸Šæ‰‹çš„MVPåˆä¸ç¬¦åˆéœ€æ±‚äº†ï¼Œè¿˜æ˜¯æ€»ç»“ä¸€ä¸‹ï¼Œç»§ç»­MVVMå§ã€‚ èµ· ä¸»è¦å†…å®¹æ˜¯è½¬è½½ï¼Œæ­å»ºå°å·¥ç¨‹åº”è¯¥è¶³å¤Ÿäº†ã€‚Android mvp æž¶æž„çš„è‡ªè¿°å¦‚ä½•æ›´é«˜æ•ˆçš„ä½¿ç”¨MVPä»¥åŠå®˜æ–¹MVPæž¶æž„è§£æž æ¡†æž¶å¼€æºåœ¨GitHub åœ°å€ç‚¹æˆ‘ç›´è¾¾ å¥½ï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼ MVC MVP MVVM çœç•¥200è¡Œï¼Œè¯¦æƒ…çœ‹Android Appçš„è®¾è®¡æž¶æž„ï¼šMVC,MVP,MVVMä¸Žæž¶æž„ç»éªŒè°ˆ å†ç´¯èµ˜å±žäºŽæŽ‰ä¹¦è¢‹äº†ï¼Œä½œè€…å†™çš„æ˜¯å¾ˆç”¨å¿ƒï¼Œæ©ï¼ŒMVVMä¹Ÿæœ‰ã€‚ æ¡†æž¶è¯¦è§£ æ•´ä¸ªæ¡†æž¶æˆªå›¾ æ•´ä½“å±‚æ¬¡æ¯”è¾ƒæ˜Žç¡®äº†ï¼ŒBaseClass é‡Œå­˜æ”¾åŸºç±»ï¼ŒModelå±‚å­˜æ”¾æ•°æ®å­˜å‚¨æœ‰å…³ç±»ã€Presenterå±‚å­˜æ”¾é€»è¾‘ä»£ç ã€Viewå±‚å­˜æ”¾Activityã€framentç­‰ã€‚ è¿™ä¸ªæ¡†æž¶æ˜¯ç”±MVPåœ¨Androidä¸­åº”ç”¨å­˜åœ¨çš„é—®é¢˜è€Œæ­å»ºçš„ï¼ŒåŸºç±»ä¸­ä»£ç ä¹Ÿç”±æ­¤è€Œæ¥ã€‚ é—®é¢˜ presenterä¸€ç›´æŒæœ‰Activityå¯¹è±¡å¯¼è‡´çš„å†…å­˜æ³„æ¼é—®é¢˜ ä½¿ç”¨mvpçš„æ—¶å€™ï¼Œpresenterä¼šæŒæœ‰viewï¼Œå¦‚æžœpresenteræœ‰åŽå°å¼‚æ­¥çš„é•¿æ—¶é—´çš„åŠ¨ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¿™æ—¶å¦‚æžœè¿”å›žé€€å‡ºäº†Activityï¼ŒåŽå°å¼‚æ­¥çš„åŠ¨ä½œä¸ä¼šç«‹å³åœæ­¢ï¼Œè¿™é‡Œå°±ä¼šæœ‰å†…å­˜æ³„æ¼çš„éšæ‚£ã€‚ éœ€è¦ä¸€ä¸ªé”€æ¯viewçš„æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯åœ¨åŸºç±»ä¸­å®Œæˆçš„ã€‚ presenterç»‘å®šå’Œè§£ç»‘ç¹ç ä¸€èˆ¬ä¸€ä¸ªpresenterå¯¹åº”ä¸€ä¸ªActivityï¼Œä¸€èˆ¬åº”ç”¨å†…å­˜åœ¨å¤šä¸ªActiivityï¼Œç»‘å®šä¸Žè§£ç»‘ç›¸å½“ç¹çã€‚ ç»Ÿä¸€åœ¨ Basepresenter ä¸Ž BaseActivityä¸­è¿›è¡Œï¼ŒåŒæ—¶è§£å†³å†…å­˜æ³„æ¼é—®é¢˜ï¼Œè¿˜æœ‰å…¶ä»–å¸¸ç”¨å†…å®¹ä¸€å¹¶æ·»åŠ ã€‚ presenter ä¸Ž Model çš„é€šä¿¡é—®é¢˜ã€‚ presenterå·²ç»ä¸ŽViewå±‚ å¼ºè€¦åˆäº†ï¼Œæ¡†æž¶ä¸­éœ€è¦è§£è€¦presenter ä¸Ž Model ï¼Œä½¿ç”¨å¼‚æ­¥é€šä¿¡ã€‚Handleç­‰éƒ½å¤ªå¤æ‚äº†ã€‚ã€‚ã€‚ å¼€å§‹æ²¡æœ‰ä»€ä¹ˆå¥½çš„è§£å†³åŠžæ³•ï¼Œç›´åˆ°é‡åˆ°äº†EventBusï¼Œå½“ç„¶EventBusä¹Ÿä¸æ˜¯ä¸‡èƒ½è§£å†³æ–¹æ¡ˆï¼Œè·¨è¿›ç¨‹ï¼Œè¿˜æ˜¯è¦å¦è¾Ÿè¹Šå¾„ï¼Œä¸è¿‡EventBusè¶³å¤Ÿè‡ªå·±å†™ç€å®Œäº†ã€‚è¿˜æœ‰Rxjavaï¼Œæ©ï¼Œè¿˜åœ¨çŽ©ç€ï¼Œæ²¡æžå¤ªæ‡‚ã€‚ ä»£ç  BasePresenter123456789101112 public abstract class BasePresenter&lt;Viewinterface&gt; &#123; //ä¼ å…¥æ³›åž‹ public Viewinterface mView; //ç»‘å®š public void attach(Viewinterface mView) &#123; this.mView = mView; &#125; //è§£ç»‘ï¼Œé˜²æ­¢viewä¸ºç©ºæ˜¯å†…å­˜æ³„æ¼ public void dettach() &#123; mView = null; &#125;&#125; BaseActivity1234567891011121314151617181920212223242526272829303132 public abstract class BaseActivity &lt;Viewinterface,mPresenter extends BasePresenter&lt;Viewinterface&gt;&gt;extends AppCompatActivity &#123; //èŽ·å–Presenterå¯¹è±¡ public mPresenter mpresenter; @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); //Presenterå®žä¾‹åŒ– mpresenter = initPresenter(); //æ‰“å°å½“å‰activity LogUtil.d("Activity", getClass().getSimpleName()+"onCreate"); &#125; @Override protected void onResume() &#123; //é‡æ–°åˆ·æ–°æ—¶é‡æ–°ç»‘å®šview mpresenter.attach((Viewinterface) this); super.onResume(); LogUtil.d("Activity", getClass().getSimpleName()+"onResume"); &#125; @Override protected void onDestroy() &#123; //è§£ç»‘presenteræŒæœ‰çš„view mpresenter.dettach(); super.onDestroy(); LogUtil.d("Activity", getClass().getSimpleName()+"onDestroy"); &#125; public abstract mPresenter initPresenter();&#125; Presenter12 public interface Presenter &#123;&#125; mPresenter12345678 public class mPresenter extends BasePresenter&lt;Viewif&gt; implements Presenter &#123; private Model mModel; public mPresenter(Viewif view) &#123; this.attach(view); this.mModel = new mModel(); &#125;&#125; BaseView 123 public interface BaseView&lt;T&gt; &#123;&#125; Viewif 123 public interface Viewif extends BaseView &#123;&#125; MainActivity12345678910111213141516 public class MainActivity extends BaseActivity&lt;Viewif, mPresenter&gt; implements Viewif&#123; Presenter presenter; //Presenteråˆå§‹åŒ– public mPresenter initPresenter() &#123; return new mPresenter(this); &#125; @Override protected void onCreate(Bundle savedInstanceState) &#123; //presenteråˆå§‹åŒ– presenter = mpresenter; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); &#125;&#125; LogUtil123456789101112131415161718192021222324252627282930313233343536373839 public class LogUtil &#123; public static final int VERBOSE = 1;//å•°å—¦ï¼Œç­‰çº§æœ€ä½Žçš„ public static final int DEBUG = 2;//è°ƒè¯• public static final int INFO = 3;//ä¿¡æ¯ public static final int WARN = 4;//è­¦å‘Š public static final int ERROR = 5;//é”™è¯¯ public static final int NOTHING = 6;//ä»€ä¹ˆä¹Ÿä¸æ‰“å°å‡ºæ¥ public static final int level = VERBOSE;//LEVEL:æ ‡å‡† public static void v(String tag, String msg) &#123; if (level &lt;= VERBOSE) &#123;//å¦‚æžœå¤§äºŽæˆ–è€…ç­‰äºŽå®šä¹‰çš„æ ‡å‡†å°±æ‰“å°å‡ºæ¥ Log.v(tag, msg); &#125; &#125; public static void d(String tag, String msg) &#123; if (level &lt;= DEBUG) &#123; Log.d(tag, msg); &#125; &#125; public static void i(String tag, String msg) &#123; if (level &lt;= INFO) &#123; Log.i(tag, msg); &#125; &#125; public static void w(String tag, String msg) &#123; if (level &lt;= WARN) &#123; Log.w(tag, msg); &#125; &#125; public static void e(String tag, String msg) &#123; if (level &lt;= ERROR) &#123; Log.e(tag, msg); &#125; &#125;&#125;]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”è“ç‰™ä¸²å£(BlueTooth+EventBus)]]></title>
    <url>%2F2017%2F04%2F17%2FAndroid%E7%AC%94%E8%AE%B0-%E8%93%9D%E7%89%99%E4%B8%B2%E5%8F%A3%E4%B8%80%E7%A7%8D%E6%96%B9%E6%A1%88BlueTooth%2BEventBus%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 å¯¼è¯­ æ¯•è®¾ä¸­çš„è“ç‰™éƒ¨åˆ†,è®°å½•ä»¥ä¾›å¤ä¹  æ¦‚è¿°æœ€ç»ˆæ•ˆæžœ Androidåº”ç”¨ ä¸Ž Hc-05 è“ç‰™æ¨¡å—è¿žæŽ¥,å•ç‰‡æœºä¸Ž Android ç«¯ å¯ä»¥é€šè¿‡ä¸²å£æ­£å¸¸æ”¶å‘æ•°æ®. é¢„ç•™è¶³å¤Ÿçµæ´»çš„æŽ¥å£, Android åº”ç”¨ä¸­å¯ä»¥åœ¨ä»»æ„ä½ç½®èŽ·å–åˆ°è“ç‰™æ•°æ® Activityåˆ‡æ¢æ—¶,è“ç‰™è¿žæŽ¥ä¸æ–­å¼€. ç”¨åˆ°çš„å¼€æºåº“/çŸ¥è¯†ç‚¹èµ„æ–™ ç®€ä»‹/æ¥æº è“ç‰™:Android API æŒ‡å— https://developer.android.com/guide/topics/connectivity/bluetooth.html EventBus:EventBus-GitHub æ˜¯ä¸€ä¸ªAndroidç«¯ä¼˜åŒ–çš„publish/subscribeæ¶ˆæ¯æ€»çº¿,ç”¨æ¥æ›¿ä»£ Intent ã€ Handler ã€ Broadcast ç­‰åœ¨ Actvity ã€ Fragment ã€ Service ç­‰ç»„ä»¶ä¹‹é—´ä¼ é€’ä¿¡æ¯ . EventBus å¯ä»¥ä¼ é€’ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡,ç®€å•é«˜æ•ˆ, æ³¨æ„ EventBus åªèƒ½åœ¨å¤šçº¿ç¨‹ä¹‹é—´ä¼ é€’æ¶ˆæ¯,æ— æ³•åœ¨ä¸åŒè¿›ç¨‹ä¹‹é—´ä¼ é€’æ¶ˆæ¯ ,EventBus 3.0 ä»¥åŽè¿›ä¸€æ­¥ç®€åŒ–äº†ä¼ é€’æ–¹å¼,çœŸçš„æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ä¸€ä¸ªå¼€æºåº“! å‚è€ƒèµ„æ–™å¦‚ä¸‹: EventBus 3.0åˆæŽ¢: å…¥é—¨ä½¿ç”¨åŠå…¶ä½¿ç”¨ å®Œå…¨è§£æž EventBus3(3.0.0)æºç è§£æž åŸºç¡€éƒ¨åˆ† è“ç‰™ ä¸Ž EventBus åŸºç¡€éƒ¨åˆ† BlueTooth å¤‡æ³¨ : è¿™é‡Œä½¿ç”¨çš„æ˜¯ ä¼ ç»Ÿè“ç‰™ å³ è“ç‰™4.0ä»¥å‰ç‰ˆæœ¬, è€Œä¸æ˜¯ è“ç‰™4.0 ( bleä½ŽåŠŸè€—è“ç‰™)åŠä»¥åŽç‰ˆæœ¬ Android å¯¹ Bluetooth åšäº†å¾ˆå¥½çš„å°è£…,æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒè½»æ¾çš„åœ¨ Android Bluetooth API ä¸Šè¿›è¡Œå¼€å‘. Androidä¸­æ‰€æœ‰è“ç‰™APIå‡æ¥è‡ª android.bluetooth åŒ… BlueToothåŸºç¡€ BluetoothAdapter æœ¬åœ°è“ç‰™é€‚é…å™¨BluetoothAdapter æ˜¯æ‰€æœ‰è“ç‰™äº¤äº’çš„å…¥å£ç‚¹, åœ¨åˆå§‹åŒ–è“ç‰™åŠè“ç‰™é…å¯¹é˜¶æ®µä½¿ç”¨1.å‘çŽ°å…¶ä»–è“ç‰™è®¾å¤‡2.æŸ¥è¯¢ç»‘å®šï¼ˆé…å¯¹ï¼‰è®¾å¤‡çš„åˆ—è¡¨3.ä½¿ç”¨å·²çŸ¥çš„ MAC åœ°å€å®žä¾‹åŒ– BluetoothDevice4.åˆ›å»º BluetoothServerSocket ä¾¦å¬æ¥è‡ªå…¶ä»–è®¾å¤‡çš„é€šä¿¡ã€‚ BluetoothDevice è¿œç¨‹è“ç‰™è®¾å¤‡å«æœ‰è¯¥è®¾å¤‡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚è®¾å¤‡çš„åç§°ã€åœ°å€ã€ç±»å’Œç»‘å®šçŠ¶æ€ç­‰ã€‚ BluetoothSocket è“ç‰™å¥—æŽ¥å­—æŽ¥å£ï¼ˆä¸Ž TCP Socket ç›¸ä¼¼ï¼‰ä¸Ž BluetoothDevice é…åˆå»ºç«‹è¿œç¨‹è¿žæŽ¥,å…è®¸åº”ç”¨é€šè¿‡ InputStream å’Œ OutputStream ä¸Žå…¶ä»–è“ç‰™è®¾å¤‡äº¤æ¢æ•°æ®. åˆå§‹åŒ–è“ç‰™ å£°æ˜Žè“ç‰™æƒé™Android åº”ç”¨ä½¿ç”¨è“ç‰™å‰éƒ½éœ€è¦å£°æ˜Žè“ç‰™æƒé™ä¸€èˆ¬åªéœ€è¦ BLUETOOTH æƒé™å³å¯,ä½†æ˜¯è€ƒè™‘åˆ°ä¹‹åŽæœ‰æ›´å¤šçš„éœ€æ±‚,éœ€è¦æ›´æ”¹ç³»ç»Ÿè“ç‰™è®¾ç½®,ç”±æ­¤éœ€è¦ BLUETOOTHADMIN æƒé™ä¹Ÿä¸€èµ·å£°æ˜Ž 12345&lt;manifest ... &gt;&lt;uses-permission android:name="android.permission.BLUETOOTH" /&gt;&lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN" /&gt;...&lt;/manifest&gt; è“ç‰™è®¾å¤‡å¯ç”¨æ€§ èŽ·å– BluetoothAdapterèŽ·å– BluetoothAdapterï¼Œéœ€è¦é™æ€ getDefaultAdapter() æ–¹æ³•ã€‚getDefaultAdapter() ä¼šè¿”å›žä¸€ä¸ªè¡¨ç¤ºè®¾å¤‡è‡ªèº«çš„è“ç‰™é€‚é…å™¨çš„ BluetoothAdapter è®¾å¤‡ä¸æ”¯æŒè“ç‰™ åˆ™è¿”å›ž null 1234BluetoothAdapter mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();if (mBluetoothAdapter == null) &#123; // è“ç‰™ä¸å¯ç”¨æ“ä½œ&#125; å¼€å¯è“ç‰™BluetoothAdapter çš„ .isEnabled() å¯ä»¥åˆ¤æ–­ç³»ç»Ÿè“ç‰™æ˜¯å¦å¼€å¯.æ²¡æœ‰å¼€å¯æ—¶ startActivityForResult() å‘é€åŒ…å« ACTION_REQUEST_ENABLE çš„ Intent è¯·æ±‚ç³»ç»Ÿå¼€å¯è“ç‰™,å¹¶åœ¨ onActivityResult() è¿”å›žçš„æ•°æ®ä¸­ RESULT_CANCELED è¡¨ç¤ºå¼€å¯å¤±è´¥ RESULT_OK è¡¨ç¤ºå¼€å¯æˆåŠŸ,è¿™é‡Œæˆ‘ä»¬åªæ£€æµ‹å¼€å¯å¤±è´¥æƒ…å†µ,å¹¶æç¤ºç”¨æˆ· 1234567891011121314if (!mBluetoothAdapter.isEnabled()) &#123; Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE); startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);&#125; protected void onActivityResult(int requestCode, int resultCode, Intent data) &#123; if (requestCode == REQUEST_ENABLE_BT &amp;&amp; resultCode == RESULT_CANCELED) &#123; Toast.makeText(MyApplication.getContext(),R.string.Bluetooth_openfail, Toast.LENGTH_SHORT).show(); &#125; BluetoothAdapter mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter(); if (mBluetoothAdapter == null) &#123; //è®¾å¤‡ä¸æ”¯æŒè“ç‰™æ—¶å¤„ç† &#125; &#125; æŸ¥è¯¢å·²é…å¯¹çš„è®¾å¤‡è°ƒç”¨ getBondedDevices(),è¿”å›žå·²é…å¯¹è®¾å¤‡çš„ä¸€ç»„ BluetoothDevice.ä¹‹åŽä½¿ç”¨forå¾ªçŽ¯éåŽ† 123456789Set&lt;BluetoothDevice&gt; pairedDevices = mBluetoothAdapter.getBondedDevices();if (pairedDevices.size() &gt; 0) &#123; //é‡æ–°åŠ è½½bluetoothDeviceList bluetoothDeviceList.clear(); //BluetoothDeviceåˆ—è¡¨å¾ªçŽ¯ for (BluetoothDevice device : pairedDevices) &#123; bluetoothDeviceList.add(device); &#125; &#125; æ‰«æè®¾å¤‡æŸ¥æ‰¾è®¾å¤‡æ˜¯éžå¸¸è€—è´¹ç³»ç»Ÿèµ„æºçš„äº‹é¡¹ï¼Œéœ€è¦å®‰æŽ’åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¿™é‡Œæ²¡æœ‰ç”¨åˆ°ï¼Œç”±éœ€è¦è¯·å‚è€ƒGoogleå®˜æ–¹è“ç‰™æ•™ç¨‹ è¿žæŽ¥è®¾å¤‡è“ç‰™åˆ†ä¸»ä»Žæœºï¼Œé“¾æŽ¥ä¸ºæœåŠ¡å™¨/å®¢æˆ·ç«¯ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯è¿žæŽ¥ä¸ºå®¢æˆ·ç«¯ã€‚ é¦–å…ˆèŽ·å–è¿œç¨‹è®¾å¤‡çš„ BluetoothDevice å¯¹è±¡ï¼Œå³åœ¨é€‰æ‹©è®¾å¤‡é˜¶æ®µçš„BluetoothDevice è°ƒç”¨ createRfcommSocketToServiceRecord(UUID) èŽ·å– BluetoothSocketï¼ŒUUIDé€šç”¨å”¯ä¸€è¯†åˆ«ç  åœ¨è“ç‰™ä¸­å…·ä½“æ˜¯ä»€ä¹ˆæ²¡æœ‰å¾ˆå¥½çš„è§£é‡Šã€‚è¿™é‡Œçš„å€¼å–çš„æ˜¯&quot;00001101-0000-1000-8000-00805F9B34FB&quot; è°ƒç”¨ connect() å‘èµ·è¿žæŽ¥,é˜»å¡žè°ƒç”¨ï¼Œéœ€è¦åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051//è“ç‰™è¿žæŽ¥å­çº¿ç¨‹private class ConnectThread extends Thread &#123; private final BluetoothSocket mmSocket; //è§£æžå‡½æ•° ConnectThread(BluetoothDevice bluetoothDevice) &#123; // ä½¿ç”¨ä¸€ä¸ªä¸­é—´å˜é‡ tmp // mmSocket ç±»åž‹æ˜¯ final BluetoothSocket tmp = null; // èŽ·å– BluetoothSocket try &#123; // MY_UUID is the app's UUID string, also used by the server code tmp = bluetoothDevice.createRfcommSocketToServiceRecord(UUID.fromString(MyApplication.MY_UUID)); &#125; catch (IOException ignored) &#123; &#125; //èµ‹å€¼ç»™ mmSocket mmSocket = tmp; &#125; public void run() &#123; // å…³é—­è“ç‰™æ‰«æ MyApplication.getBluetoothAdapter().cancelDiscovery(); try &#123; // é€šè¿‡ socket è¿žæŽ¥åˆ°è®¾å¤‡. connect() ä¼šä¸€ç›´æ‰§è¡Œç›´åˆ°æˆåŠŸè¿žæŽ¥æˆ–è€…æŠ›å‡ºå¼‚å¸¸ mmSocket.connect(); &#125; catch (IOException connectException) &#123; //æ— æ³•è¿žæŽ¥åˆ°è“ç‰™,å…³é—­è¿žæŽ¥å¹¶é€€å‡º try &#123; mmSocket.close(); &#125; //æ²¡æœ‰æ­£å¸¸å…³é—­ catch (IOException ignored) &#123; &#125; return; &#125; // Do work to manage the connection (in a separate thread) mConnectedThread = new ConnectedThread(mmSocket); mConnectedThread.start(); &#125; /** * å…³é—­è“ç‰™è¿žæŽ¥ */ void cancel() &#123; try &#123; mmSocket.close(); &#125; catch (IOException ignored) &#123; &#125; &#125;&#125; ç®¡ç†è¿žæŽ¥èŽ·å–BluetoothSocketèŽ·å– InputStream å’Œ OutputStreamï¼Œ getInputStream() å’Œ getOutputStream() æ¥å¤„ç†æ•°æ®ä¼ è¾“ã€‚read(byte[]) å’Œ write(byte[]) è¯»å–æ•°æ®å¹¶å†™å…¥åˆ°æµå¼ä¼ è¾“ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162private class ConnectedThread extends Thread &#123; //BluetoothSocket private final BluetoothSocket mmSocket; //è¾“å…¥æµ private final InputStream mmInStream; //è¾“å‡ºæµ private final OutputStream mmOutStream; ConnectedThread(BluetoothSocket socket) &#123; //ä¼ å…¥BluetoothSocketï¼Œå®žä¾‹åŒ–mmSocket mmSocket = socket; //è¾“å…¥/è¾“å‡ºæµ ä¸­é—´å˜é‡ InputStream tmpIn = null; OutputStream tmpOut = null; // è¾“å…¥è¾“å‡ºæµå®žä¾‹åŒ– try &#123; tmpIn = socket.getInputStream(); tmpOut = socket.getOutputStream(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; mmInStream = tmpIn; mmOutStream = tmpOut; &#125; public void run() &#123; byte[] buffer = new byte[1024]; int bytes; // è¿žæŽ¥æˆåŠŸæ—¶ while (true) &#123; try &#123; // åœ¨InputStreamè¯»æ•°æ® bytes = mmInStream.read(); //å‘é€æ•°æ® Events.bluetooth_Recycle bluetooth_recycle = new Events.bluetooth_Recycle(); bluetooth_recycle.s = bytes; bluetooth_recycle.bytes = String.valueOf((char) bytes); EventBus.getDefault().post(bluetooth_recycle); &#125; catch (IOException e) &#123; break; &#125; &#125; &#125; //å†™æ–¹æ³• void write(byte[] bytes) &#123; try &#123; mmOutStream.write(bytes); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; //å…³é—­æµè¿žæŽ¥ void cancel() &#123; try &#123; mmSocket.close(); &#125; catch (IOException e) &#123; &#125; &#125; &#125; EventBus ç›´æŽ¥æ”¾é“¾æŽ¥äº† http://www.jianshu.com/p/a040955194fchttp://www.jianshu.com/p/acfe78296bb5http://www.ff50.net/view/40565212977623506063.html æ­£æ–‡ è“ç‰™è¿žæŽ¥å­çº¿ç¨‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950 private class ConnectThread extends Thread &#123; private final BluetoothSocket mmSocket; //è§£æžå‡½æ•° ConnectThread(BluetoothDevice bluetoothDevice) &#123; // ä½¿ç”¨ä¸€ä¸ªä¸­é—´å˜é‡ tmp // mmSocket ç±»åž‹æ˜¯ final BluetoothSocket tmp = null; // èŽ·å– BluetoothSocket try &#123; // MY_UUID is the app's UUID string, also used by the server code tmp = bluetoothDevice.createRfcommSocketToServiceRecord(UUID.fromString(MyApplication.MY_UUID)); &#125; catch (IOException ignored) &#123; &#125; //èµ‹å€¼ç»™ mmSocket mmSocket = tmp; &#125; public void run() &#123; // å…³é—­è“ç‰™æ‰«æ MyApplication.getBluetoothAdapter().cancelDiscovery(); try &#123; // é€šè¿‡ socket è¿žæŽ¥åˆ°è®¾å¤‡. connect() ä¼šä¸€ç›´æ‰§è¡Œç›´åˆ°æˆåŠŸè¿žæŽ¥æˆ–è€…æŠ›å‡ºå¼‚å¸¸ mmSocket.connect(); &#125; catch (IOException connectException) &#123; //æ— æ³•è¿žæŽ¥åˆ°è“ç‰™,å…³é—­è¿žæŽ¥å¹¶é€€å‡º try &#123; mmSocket.close(); &#125; //æ²¡æœ‰æ­£å¸¸å…³é—­ catch (IOException ignored) &#123; &#125; return; &#125; // Do work to manage the connection (in a separate thread) mConnectedThread = new ConnectedThread(mmSocket); mConnectedThread.start(); &#125; /** * å…³é—­è“ç‰™è¿žæŽ¥ */ void cancel() &#123; try &#123; mmSocket.close(); &#125; catch (IOException ignored) &#123; &#125; &#125;&#125; ç®¡ç†è¿žæŽ¥å­çº¿ç¨‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263 //ç®¡ç†è¿žæŽ¥å­çº¿ç¨‹private class ConnectedThread extends Thread &#123; //BluetoothSocket private final BluetoothSocket mmSocket; //è¾“å…¥æµ private final InputStream mmInStream; //è¾“å‡ºæµ private final OutputStream mmOutStream; ConnectedThread(BluetoothSocket socket) &#123; //ä¼ å…¥BluetoothSocketï¼Œå®žä¾‹åŒ–mmSocket mmSocket = socket; //è¾“å…¥/è¾“å‡ºæµ ä¸­é—´å˜é‡ InputStream tmpIn = null; OutputStream tmpOut = null; // è¾“å…¥è¾“å‡ºæµå®žä¾‹åŒ– try &#123; tmpIn = socket.getInputStream(); tmpOut = socket.getOutputStream(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; mmInStream = tmpIn; mmOutStream = tmpOut; &#125; public void run() &#123; byte[] buffer = new byte[1024]; int bytes; // è¿žæŽ¥æˆåŠŸæ—¶ while (true) &#123; try &#123; // åœ¨InputStreamè¯»æ•°æ® bytes = mmInStream.read(); //å‘é€æ•°æ® Events.bluetooth_Recycle bluetooth_recycle = new Events.bluetooth_Recycle(); bluetooth_recycle.s = bytes; bluetooth_recycle.bytes = String.valueOf((char) bytes); EventBus.getDefault().post(bluetooth_recycle); &#125; catch (IOException e) &#123; break; &#125; &#125; &#125; //å†™æ–¹æ³• void write(byte[] bytes) &#123; try &#123; mmOutStream.write(bytes); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; //å…³é—­æµè¿žæŽ¥ void cancel() &#123; try &#123; mmSocket.close(); &#125; catch (IOException e) &#123; &#125; &#125;&#125; è¿žæŽ¥è“ç‰™123456789//è¿žæŽ¥çº¿ç¨‹private ConnectThread mConnectThread;//ç®¡ç†è¿žæŽ¥è¿›ç¨‹private ConnectedThread mConnectedThread;//åˆ›å»ºè¿žæŽ¥å­çº¿ç¨‹mConnectThread = new ConnectThread(bluetoothDevice);//å¯åŠ¨è¿žæŽ¥å­çº¿ç¨‹mConnectThread.start(); å‘è“ç‰™å†™å…¥æ•°æ®1234567 //å‘é€æ•°æ®String, ä¸»çº¿ç¨‹ ä¼˜å…ˆçº§4 éžç²˜æ€§äº‹ä»¶@Subscribe(threadMode = ThreadMode.MAIN, priority = 4, sticky = false)public void onEvent(Events.bluetooth_Send bluetoothSend) &#123; String bytes = bluetoothSend.bytes; mConnectedThread.write(bytes.getBytes()); LogUtil.d(Tag, "onEvent:Send" + bluetoothSend.bytes);&#125; æŽ¥æ”¶æ•°æ®å¤„ç†123456 //æ•°æ®è½¬æ¢ åŽå°è¿›ç¨‹ ä¼˜å…ˆçº§3 éžç²˜æ€§äº‹ä»¶@Subscribe(threadMode = ThreadMode.BACKGROUND, priority = 3, sticky = false)public void onEvent(Events.bluetooth_Transformers bluetoothTransformers) &#123; int bytes = bluetoothTransformers.bytes; //å¤„ç†æ•°æ®&#125;]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
        <tag>æ¯•è®¾</tag>
        <tag>BlueTooth</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ï¼ˆä¸‰ï¼‰â€”â€”VPSå®‰å…¨åŠ å›º]]></title>
    <url>%2F2017%2F04%2F08%2FVPS%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E6%95%99%E7%A8%8B3%2F</url>
    <content type="text"><![CDATA[123æ›´æ–°2017.04.08 VPSæ—¥å¸¸ä¸€äº›å®‰å…¨æŽªæ–½2017.08.22 æ›´æ–°å®‰å…¨æŽªæ–½ï¼Œè¯»è€…åé¦ˆï¼Œæ²¡æœ‰debiançš„ï¼Œè¿™é‡ŒåŠ ä¸Šã€‚ å¯¼è¯­ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ç³»åˆ—ï¼Œå¾ˆä¹…æ²¡æœ‰æ›´æ–°æ–°å†…å®¹äº†ã€‚æ›´æ–°å¸¸ç”¨å®‰å…¨æŽªæ–½ï¼Œè‡³å°‘ä¿è¯ï¼Œä¸ä¼šè¢«è½»æ˜“çš„å½“ä½œè‚‰é¸¡ã€‚éƒ½æ˜¯ä¸€äº›å¸¸ç”¨çš„å®‰å…¨æŽªæ–½ã€‚ ç³»ç»ŸçŽ¯å¢ƒï¼šCentOS/debian 7 SSH æœ‰ä¸¤ç§æ–¹æ¡ˆ å½»åº•å…³é—­SSHç™»é™†ï¼Œæ”¹ä¸ºå¯†é’¥ç™»é™†ï¼Œå®‰å…¨æ€§æœ€é«˜ï¼Œä½†é…ç½®è¾ƒä¸ºå¤æ‚ ä¿®æ”¹SSHç™»é™†ç«¯å£ï¼ŒåŒæ—¶å¼€æ”¾é»˜è®¤ç«¯å£ï¼Œå°†çˆ†ç ´ ssh å¯†ç çš„ IP å°åœå¯†é’¥ç™»é™† ä¸»è¦æ­¥éª¤åœ¨è¿™é‡Œ,æœ‰æ—¶é—´å†æ›´æ–° https://ttt.tt/104/ ä¿®æ”¹ç«¯å£ CentOS å‘½ä»¤ å¦‚ä¸‹ï¼Œä»¥ä¸‹æ˜¯å°† SSH ç«¯å£æ”¹ä¸º 999 ç«¯å£ 1sed -i &apos;s/#Port 22/Port 999/g&apos; /etc/ssh/sshd_config debianéœ€è¦æ‰“å¼€/etc/ssh/sshdconfig æ–‡ä»¶ï¼Œä¿®æ”¹å…¶ä¸­çš„portåŽé¢çš„æ•°å­—, 1nano /etc/ssh/sshd_config ä¿®æ”¹å…¶ä¸­çš„portåŽé¢çš„æ•°å­—ï¼Œä¸ºä½ è¦sshç™»é™†çš„ç«¯å£ï¼Œcltrl + xä¿å­˜ï¼Œå›žè½¦é€€å‡ºã€‚ å®‰è£… fail2ban å°æŽ‰ æš´åŠ›ç ´è§£ip fail2ban fail2ban æ˜¯ Linux ä¸Šçš„ä¸€ä¸ªè‘—åçš„å…¥ä¾µä¿æŠ¤çš„å¼€æºæ¡†æž¶ï¼Œå®ƒä¼šç›‘æŽ§å¤šä¸ªç³»ç»Ÿçš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ£€æµ‹åˆ°çš„ä»»ä½•å¯ç–‘çš„è¡Œä¸ºè‡ªåŠ¨è§¦å‘ä¸åŒçš„é˜²å¾¡åŠ¨ä½œã€‚å°†å°è¯•çˆ†ç ´ ssh å¯†ç çš„ IP å°åœï¼Œé»˜è®¤10åˆ†é’Ÿã€‚ è¯¦ç»†é…ç½®å®‰è£…æ–¹æ³•åœ¨å¦‚ä¸‹ç½‘å€ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤é…ç½®å³å¯ã€‚ https://linux.cn/article-5067-1.html å®‰è£… fail2banCentOS éœ€è¦æå‰ è®¾ç½® EPEL ä»“åº“ ä»¥ root ç”¨æˆ·ç™»é™†ï¼Œéž root ç”¨æˆ·éœ€è¦ å‘½ä»¤å‰ å¢žåŠ  sudo å®‰è£…å‘½ä»¤ 1234//CentOSyum install fail2ban//Debian / ubuntuapt-get install fail2ban å…¶ä»–å‘½ä»¤ é‡å¯ 1service fail2ban restart éªŒè¯çŠ¶æ€ 1fail2ban-client ping è¿”å›ž 1Server replied: pong è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ï¼ˆdebianä¸ç”¨å‰é¢éªŒè¯å®Œæˆï¼Œå·²åŠ å…¥å¼€æœºå¯åŠ¨ï¼‰ 1234// CentOS/RHEL 6chkconfig fail2ban on// CentOS/RHEL 7systemctl enable fail2ban ç¦ç”¨Linuxå¤šä½™ç«¯å£ å…³é—­å¤šä½™ç«¯å£æ˜¯æ°¸è¿œæ­£ç¡®çš„é€‰æ‹©ï¼åªç•™ä¸‹å¸¸ç”¨ç«¯å£ å’Œ SSRç«¯å£ é…ç½® iptables è­¦å‘Š iptables é…ç½®ä¸æ˜¯ä¸€èˆ¬çš„å¤æ‚ï¼Œè°¨æ…Žæ“ä½œ æ¸…ç©ºé»˜è®¤è§„åˆ™ 1iptables -F å…è®¸22ç«¯å£ï¼Œç»™æš´åŠ›ç ´è§£ç•™ç‚¹ç©ºé—´ //doge 12iptables -A INPUT -p tcp --dport 22 -j ACCEPTiptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT å…è®¸53ç«¯å£ udp ï¼Œä¸€èˆ¬ç”¨åšDNSæœåŠ¡å™¨ï¼Œå¦‚æžœä½ ä¸éœ€è¦åˆ™å¿½ç•¥æ­¤æ¡ 12iptables -A OUTPUT -p udp --dport 53 -j ACCEPTiptables -A INPUT -p udp --sport 53 -j ACCEPT å…è®¸æœ¬æœºè®¿é—®æœ¬æœº 12iptables -A INPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPTiptables -A OUTPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT å…è®¸çœŸæ­£ SSH ç«¯å£ 12iptables -A INPUT -p tcp -s 0/0 --dport 999 -j ACCEPTiptables -A OUTPUT -p tcp --sport 99 -m state --state ESTABLISHED -j ACCEPT å…è®¸ 80 443 ç«¯å£ï¼Œhttp å’Œ https 1234iptables -A INPUT -p tcp -s 0/0 --dport 80 -j ACCEPTiptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPTiptables -A INPUT -p tcp -s 0/0 --dport 443 -j ACCEPTiptables -A OUTPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT å…è®¸ SSRç«¯å£ ä»¥888 xxx ä¸ºä¾‹ ä½ æœ‰å‡ ä¸ªç«¯å£ï¼Œå°±æ·»åŠ å‡ ä¸ª 12345iptables -A INPUT -p tcp -s 0/0 --dport 888 -j ACCEPTiptables -A OUTPUT -p tcp --sport 888 -m state --state ESTABLISHED -j ACCEPTiptables -A INPUT -p tcp -s 0/0 --dport xxx -j ACCEPTiptables -A OUTPUT -p tcp --sport xxx -m state --state ESTABLISHED -j ACCEPT CentOS ä¿å­˜é…ç½® 123iptables-save &gt; /etc/sysconfig/iptables``` é‡è½½ iptables iptables -L 12 * debian 7 ä¿å­˜é…ç½® iptables-save &gt; /etc/iptables-rulesip6tables-save &gt; /etc/ip6tables-rules 1éšåŽä¿®æ”¹/etc/network/interfacesæ–‡ä»¶ï¼Œæœ€åŽåŠ å…¥ pre-up iptables-restore &lt; /etc/iptables-rulespre-up ip6tables-restore &lt; /etc/ip6tables-rules 1234 é‡å¯æ‰§è¡Œ`iptables -L`ï¼Œçœ‹åˆ°é…ç½®å·²ç”Ÿæ•ˆã€‚## å®‰è£… CSF é˜²ç«å¢™* å‘½ä»¤ rm -fv csf.tgzwget http://download.configserver.com/csf.tgztar -xzf csf.tgzcd csfsh install.sh//ä½¿ç”¨ä¸‹è¾¹çš„å‘½ä»¤æ¥éªŒè¯csfæ­£ç¡®å®‰è£…å¹¶å·²ç»è¿è¡Œperl /usr/local/csf/bin/csftest.pl 1234567891011## autoban è¡¥ä¸ï¼ˆ8.22ï¼‰æŽ¨è* æ¥è‡ªssåŽŸä½œè€…@clowwindy çš„è¡¥ä¸ï¼ŒbanæŽ‰é‚£äº›å°è¯•ç ´è¯‘sså¯†ç çš„ipï¼Œåœ¨æ­¤å¯¹åŽŸä½œè€…è¡¨ç¤ºæ•¬æ„ï¼* åŽŸç†æ˜¯åŒä¸€ä¸ªipå‡ºçŽ°3æ¬¡ä»¥ä¸Šå°è¯•ç ´è¯‘sså¯†ç ä¼šè¢«æ°¸ä¹…banæŽ‰ï¼Œssrä¹Ÿå¯ç”¨* æµ‹è¯•åªåœ¨debian 7ä¸Šè¿›è¡Œï¼Œéœ€è¦pythonçŽ¯å¢ƒï¼Œä½†æ˜¯é€šè¿‡ç§‹æ°´é€¸å†°è„šæœ¬å®‰è£…ssr å·²ç»å®‰è£…å¥½äº†pythonçŽ¯å¢ƒã€‚* ä»¥ä¸‹å†…å®¹å‚è€ƒ &gt;https://plus.google.com/104980438521301094845/posts/9zypCffhdZu---* ä¸‹è½½è„šæœ¬ wget https://raw.githubusercontent.com/Jasper-1024/shadowsocksr/manyuser/utils/autoban.py 12 * ssrè¿è¡Œ python autoban.py &lt; /var/log/shadowsocksr.log 1234 æŸ¥çœ‹å“ªäº›ipè¯•å›¾è¿žæŽ¥ç ´è§£ssrå¯†ç ã€‚åŽŸç‰ˆsså°†logæ–‡ä»¶è·¯å¾„æ›¿æ¢å³å¯ã€‚ * è‡ªåŠ¨ban ip ç¼–è¾‘/etc/init.d/rc.localï¼ŒåŠ å…¥ python /root/autoban.py &lt; /var/log/shadowsocksr.log nohup tail -F /var/log/shadowsocksr.log | python /root/autoban.py &gt;log 2&gt;log &amp;```ä¿å­˜é€€å‡ºå³å¯ã€‚]]></content>
      <categories>
        <category>ç§‘å­¦ä¸Šç½‘</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>VPS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”ä»¿ç»¿è‰²å®ˆæŠ¤å—œç¡æ¨¡å¼é€šçŸ¥]]></title>
    <url>%2F2017%2F03%2F07%2FAndroid%E7%AC%94%E8%AE%B0%E2%80%94%E4%BB%BF%E7%BB%BF%E8%89%B2%E5%AE%88%E6%8A%A4%E5%97%9C%E7%9D%A1%E6%A8%A1%E5%BC%8F%E9%80%9A%E7%9F%A5%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) Android Training Notifying the User Android API é€šçŸ¥ ã€Androidã€‘çŠ¶æ€æ é€šçŸ¥Notificationã€NotificationManagerè¯¦è§£ ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 å¯¼è¯­ OneTapDozeé‡åˆ°çš„ç¬¬ä¸€ä¸ªéš¾é¢˜ï¼Œé¡ºå¸¦è®°å½•Android é€šçŸ¥ç›¸å…³å†…å®¹ æœ€ç»ˆæ•ˆæžœ ç»¿è‰²å®ˆæŠ¤è¿›å…¥dozeæ¨¡å¼åŽï¼Œä¼šåœ¨é€šçŸ¥æ åˆ›å»ºä¸€ä¸ªè®¡æ—¶é€šçŸ¥ å¦‚ä¸‹å›¾ é€€å‡ºdozeæ¨¡å¼åŽï¼Œä¼šæŒ‡ç¤ºè¿›å…¥dozeå’Œé€€å‡ºdozeçš„æ—¶é—´æ®µã€‚ æˆ‘ä»¬è¦ä»¿ç…§çš„æ ·å¼å°±æ˜¯è¿™æ ·ï¼Œè¿›å…¥é€€å‡ºdozeï¼Œå¯¹åº”åˆ›å»ºé€šçŸ¥çš„ä»£ç éƒ½åœ¨dozeæ¨¡å¼æ”¹å˜çš„Broadcastä¸­ã€‚ åŸºç¡€éƒ¨åˆ†åˆ›å»ºé€šçŸ¥ è¡Œæ–‡å‰ï¼šAndroidæ¯æ¬¡ç‰ˆæœ¬å‡ ä¹Žéƒ½ä¼šæœ‰é€šçŸ¥APIçš„æ”¹åŠ¨ï¼Œä¸åŒç‰ˆæœ¬ä¹‹é—´é€šçŸ¥å…¼å®¹æ€§å¾ˆæ˜¯é—®é¢˜ï¼Œä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨support_v7 åº“ä¸­çš„NotificationCompat.Builderä»£æ›¿Notification.BuilderäºŒè€…ä½¿ç”¨æ–¹å¼ç›¸åŒ æ¶‰åŠåˆ°çš„ä¸¤ä¸ªç±» NotificationManager Notification (supportåº“ä¸­å¯¹åº”NotificationCompat) NotificationManager çŠ¶æ€æ é€šçŸ¥çš„ç®¡ç†ç±»ï¼Œè´Ÿè´£å‘é€šçŸ¥ã€æ¸…é™¤é€šçŸ¥ç­‰ NotificationManager æ˜¯ä¸€ä¸ªç³»ç»ŸServiceï¼Œå¿…é¡»é€šè¿‡ getSystemService()æ–¹æ³•æ¥èŽ·å– Notification å…·ä½“çš„çŠ¶æ€æ é€šçŸ¥å¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®iconã€æ–‡å­—ã€æç¤ºå£°éŸ³ã€æŒ¯åŠ¨ç­‰å‚æ•° ä¸€ä¸ªBuilderå¯¹è±¡è‡³å°‘åŒ…å«ä¸‰ä¸ªæ–¹é¢ ä¸€ä¸ªå°å›¾æ ‡ï¼Œé€šè¿‡setSmallIcon()æ–¹æ³•è®¾ç½®ã€‚ é€šçŸ¥æ ‡é¢˜ï¼Œé€šè¿‡setContentTitle()æ–¹æ³•è®¾ç½®ã€‚ è¯¦ç»†æ–‡æœ¬ï¼Œé€šè¿‡setContentText()æ–¹æ³•è®¾ç½®ã€‚ ç®€å•ç¤ºä¾‹ åˆ›å»ºé€šçŸ¥æž„å»ºå™¨ ä»£ç  123456Notification notification = new NotificationCompat.Builder(this) .setContentTitle("è¿™æ˜¯é€šçŸ¥æ ‡é¢˜") .setContentText("è¿™æ˜¯é€šçŸ¥å†…å®¹") //è¿™é‡Œä½¿ç”¨çš„æ˜¯åº”ç”¨å›¾æ ‡ï¼Œä¸€èˆ¬æ²¡äººè¿™ä¹ˆå¹²ï¼Œå°±æ˜¯ä¸ºäº†æ–¹ä¾¿ .setSmallIcon(R.mipmap.ic_launcher) .build(); å‘å¸ƒé€šçŸ¥ èŽ·å¾—NotificationManagerçš„å®žä¾‹ ä½¿ç”¨notify()æ–¹æ³•å‘å¸ƒé€šçŸ¥ã€‚åœ¨è°ƒç”¨notify()æ–¹æ³• æŒ‡å®šé€šçŸ¥çš„IDï¼Œ(IDç”¨äºŽé€šçŸ¥æ›´æ–°) åŠ è½½Notificationå®žä¾‹ 1234int mNotificationId = 001;NotificationManager manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);manager.notify(mNotificationId, notification); æ•ˆæžœå¦‚ä¸‹ android 7.0 / 6.0 /4.0 é€šè¿‡ æ›´æ–°é€šçŸ¥ å¯ä»¥åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„NotificationCompatå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åœ¨åŽŸNotificationCompatå¯¹è±¡åŸºç¡€ä¸Šä¿®æ”¹ï¼Œæœ€åŽåªè¦ .notify æ–¹æ³•ä¸­å¯¹åº”åŒä¸€ä¸ª mNotificationId ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æ›´æ–°å·²æœ‰é€šçŸ¥ï¼Œä»£ç ä¸åœ¨ç´¯èµ˜ã€‚ åŸºç¡€éƒ¨åˆ†åˆ°æ­¤ï¼Œè¶³çŸ£ æ­£é¢˜ å®žçŽ°æ—¶é—´æ®µçš„æ˜¾ç¤ºï¼Œè‚¯å®šä¼šä¿å­˜ç³»ç»Ÿè¿›å…¥doze é€€å‡ºdozeå¯¹åº”çš„æ—¶é—´ç‚¹ã€‚å†è®¡ç®—å‡ºä¸­é—´ç»åŽ†çš„æ—¶é—´ã€‚ æå–ç³»ç»Ÿæ—¶é—´ java.util.Dateè¿™é‡Œç”¨åˆ°äº†javaä¸­çš„ æ—¶é—´ç±»åž‹ java.util.Datejava.util.Date æ˜¯javaä¸­å¸¸ç”¨æ—¶é—´ç±»åž‹ï¼Œå¯ä»¥è¢«SimpleDateFormatæ ¼å¼åŒ–format() æŒ‡å®šè¾“å‡ºçš„æ—¶é—´æ ¼å¼æ¯”å¦‚æˆ‘ä»¬éœ€è¦ å°æ—¶ï¼šåˆ†ï¼šç§’SimpleDateFormat scanf = new SimpleDateFormat(&quot;HH:mm:ss&quot;);scanf.format(java.util.Date) å³å¯ã€‚ æå‰å½“å‰ç³»ç»Ÿæ—¶é—´ 12java.util.Date time_after = null;time_after = new java.util.Date(System.currentTimeMillis()); è®¡ç®—æ—¶é—´å·®ç†è®ºä¸Šæ˜¯ä¸¤ä¸ªæ—¶é—´ç›¸å‡å†æ ¼å¼åŒ–è¾“å‡ºå³å¯ï¼Œå¯æƒœæ²¡æˆï¼ŒåŽŸå› è¿˜æ²¡æ‰¾åˆ°ã€‚äºŽæ˜¯åœŸåŠžæ³•ï¼š è°ƒç”¨ .getTime() æ–¹æ³•ï¼Œå°† java.util.Date è½¬åŒ–ä¸ºæ¯«ç§’è®¡æ—¶(long) å–ä¸¤è€…å·®å€¼ è½¬åŒ–ä¸º æ—¶é—´é•¿çŸ­ å­—ç¬¦ä¸²è¿”å›žï¼Œ ä»£ç å¦‚ä¸‹123456789101112131415161718192021 size = (time_after.getTime() - time_befor.getTime()); string = scanf.format(time_befor) + "-" + scanf.format(time_after) + "="+ trform(size); String trform(long size) &#123; long day, hour, min, secone; day = size / (1000 * 60 * 60 * 24); //ä»¥å¤©æ•°ä¸ºå•ä½å–æ•´ hour = (size / (60 * 60 * 1000) - day * 24); //ä»¥å°æ—¶ä¸ºå•ä½å–æ•´ min = ((size / (60 * 1000)) - day * 24 * 60 - hour * 60); //ä»¥åˆ†é’Ÿä¸ºå•ä½å–æ•´ secone = (size / 1000 - day * 24 * 60 * 60 - hour * 60 * 60 - min * 60);if (day != 0) &#123; return day + "d" + hour + "h" + min + "m" + secone + "s"; &#125; else if (hour != 0) &#123; return hour + "h" + min + "m" + secone + "s"; &#125; else if (min != 0) &#123; return min + "m" + secone + "s"; &#125; else &#123; return secone + "s"; &#125; &#125; é€šçŸ¥æ‰©å±•å¸ƒå±€ åœ¨å¦‚ä¸‹å›¾ç‰‡ä¸­ï¼Œå¯ä»¥å‘çŽ°ï¼Œé€šçŸ¥åœ¨å‘å‡ºåŽï¼Œåªé»˜è®¤æ˜¾ç¤ºæœ€è¿‘ä¸€æ¬¡çš„æ—¶é—´è®°å½•ï¼Œå…¶ä»–æ—¶é—´è®°å½•å¯ä»¥åœ¨æ­¤æ¡é€šçŸ¥ä¸Šä¸‹æ»‘æŸ¥çœ‹ã€‚æ˜Žæ˜¾ä¸ŽåŸºç¡€éƒ¨åˆ†ä¸åŒã€‚ æ­¤å¤„åº”ç”¨äº† Builder.setStyle() æ‹“å±•å¸ƒå±€ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ç”¨äºŽæ‹“å±•é€šçŸ¥æ˜¾ç¤ºèŒƒå›´ ä½¿ç”¨æ‰©å±•å¸ƒå±€ ä½¿ç”¨æ‹“å±•å¸ƒå±€ æž„å»ºä¸€ä¸ª inboxStyle å¯¹è±¡ .addLineæ–¹æ³• æ·»åŠ  String inboxStyle è¡Œ ä½¿ç”¨ Builder.setStyle( inboxStyle )åŠ è½½åˆ°é€šçŸ¥ ç­‰å¾…é€šçŸ¥å‘å¸ƒå³å¯ã€‚ ç®€å•ä¾‹ç¨‹å¦‚ä¸‹ 123456//åˆ›å»º inboxStyle NotificationCompat.InboxStyle inboxStyle = new NotificationCompat.InboxStyle(); //æ·»åŠ  String è¡Œ ï¼Œå‰ææ˜¯ æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ª String inboxStyle.addLine(string); // åœ¨notification è®¾ç½® inboxStyle åœ¨ä¸€å † build é‡Œé¢ .setStyle(inboxStyle) æ¸…é™¤åŽŸæœ‰å†…å®¹ï¼Œå‘å¸ƒæ–°çš„ inboxStyle åªéœ€è¦ inboxStyle = new NotificationCompat.InboxStyle(); Dozeæ¨¡å¼æ”¹å˜å¹¿æ’­* å¯¹åº” ACTION_DEVICE_IDLE_MODE_CHANGED å‘ï¼šåªèƒ½åŠ¨æ€æ³¨å†Œï¼Œé™æ€æ³¨å†Œæ— æ•ˆï¼Œå…·ä½“ä»£ç ä¸­powermanger.ACTION_DEVICE_IDLE_MODE_CHANGED éœ€è¦å®žä¾‹åŒ– PowerManger ï¼Œè€Œ PowerManger åˆæ˜¯ä¸Ž Activityç»‘å®šï¼Œæ‰€ä»¥åªæœ‰åº”ç”¨ä¿æŒåŽå°å­˜æ´»æ—¶æ‰ä¼šè¿›å…¥å¹¿æ’­ã€‚ ä¾‹ç¨‹å¦‚ä¸‹12345678//å®žä¾‹åŒ– PowerManagerPowerManager powermanger = (PowerManager) getApplicationContext().getSystemService(Context.POWER_SERVICE);//åŠ¨æ€æ³¨å†Œå¹¿æ’­intentFilter = new IntentFilter();intentFilter.addAction(powermanger.ACTION_DEVICE_IDLE_MODE_CHANGED);//idlemodechage æ˜¯ BroadcastReceiver idlemodechage = new IdleModeChange();registerReceiver(idlemodechage, intentFilter);]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”ContentResolver]]></title>
    <url>%2F2017%2F01%2F19%2FAndroid%E7%AC%94%E8%AE%B0-ContentResolver%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) android6.0è¿è¡Œæ—¶æƒé™è¯¦è§£ ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 å¯¼è¯­ å†…å®¹æä¾›å™¨æ˜¯å®‰å…¨çš„åº”ç”¨é—´å…±äº«æ•°æ®é€”å¾„ï¼Œåœ¨æ­£å¼è¿›å…¥ä¹‹å‰éœ€è¦äº†è§£ä¸€ä¸‹ Android è‡ª6.0ä»¥æ¥æƒé™çš„å˜åŒ– Android æƒé™è¯¦è§£ èµ„æ–™æ¥æºï¼š android6.0è¿è¡Œæ—¶æƒé™è¯¦è§£ Develop-API Guides-ç³»ç»Ÿæƒé™ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) Androidæƒé™ä»‹ç» Android æ˜¯ä¸€ä¸ªæƒé™åˆ†éš”çš„æ“ä½œç³»ç»Ÿæ¯ä¸ªåº”ç”¨ç³»ç»Ÿæ ‡è¯†ï¼ˆLinux ç”¨æˆ· ID å’Œç»„ IDï¼‰ä¸åŒã€‚ç³»ç»Ÿå„éƒ¨åˆ†æ ‡è¯†äº¦ä¸ç›¸åŒã€‚Linux æ®æ­¤å°†ä¸åŒçš„åº”ç”¨ä»¥åŠåº”ç”¨ä¸Žç³»ç»Ÿåˆ†éš”å¼€æ¥ã€‚æ›´è¯¦ç»†çš„å®‰å…¨åŠŸèƒ½é€šè¿‡â€œæƒé™â€æä¾›ï¼Œæƒé™ ä¼šé™åˆ¶ç‰¹å®šè¿›ç¨‹å¯ä»¥æ‰§è¡Œçš„å…·ä½“æ“ä½œï¼Œå¹¶ä¸”æ ¹æ® URI æƒé™æŽˆæƒä¸´æ—¶è®¿é—®ç‰¹å®šçš„æ•°æ®æ®µ æƒé™å£°æ˜Žæœ€å¸¸è§çš„æƒé™å£°æ˜Žåœ¨ AndroidManifest.xml æ–‡ä»¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªuses-permission æ ‡è®°, ä¾‹å¦‚ å£°æ˜ŽçŸ­ä¿¡æƒé™ 12345&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.android.app.myapp" &gt; &lt;uses-permission android:name="android.permission.RECEIVE_SMS" /&gt; ... &lt;/manifest&gt; android 6.0 æƒé™æœºåˆ¶android 6.0ä¹‹å‰ æƒé™åŠåœ¨å®‰è£…çš„æ—¶å€™ï¼Œæ ¹æ®æƒé™å£°æ˜Žäº§ç”Ÿä¸€ä¸ªæƒé™åˆ—è¡¨ï¼Œç”¨æˆ·åªæœ‰åœ¨åŒæ„ä¹‹åŽæ‰èƒ½å®Œæˆappçš„å®‰è£…ã€‚android 6.0 ä»¥åŽ å¼•å…¥äº† è¿è¡Œæ—¶æƒé™ åŠŸèƒ½ï¼Œåº”ç”¨æ‰€éœ€æƒé™ä¸å†ä¸€æ¬¡æ€§åœ¨å®‰è£…æ—¶ç”³è¯·ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶éœ€è¦ç”¨åˆ°é‚£ç§æƒé™å‘ç”¨æˆ·ç”³è¯·ï¼ŒåŒæ—¶ç”¨æˆ·ä¹Ÿå¯ä»¥éšæ—¶å–æ¶ˆè¯¥æŽˆæƒ æƒé™åˆ†ç±» Normal Permissions(æ™®é€šæƒé™)ä¸æ¶‰åŠç”¨æˆ·éšç§ï¼Œä¸éœ€è¦ç”¨æˆ·è¿›è¡ŒæŽˆæƒçš„ï¼Œä¾‹å¦‚ æ‰‹æœºéœ‡åŠ¨ã€è®¿é—®ç½‘ç»œç­‰ Dangerous Permission(å±é™©æƒé™)æ¶‰åŠåˆ°ç”¨æˆ·éšç§çš„ï¼Œéœ€è¦ç”¨æˆ·è¿›è¡ŒæŽˆæƒï¼Œä¾‹å¦‚ è¯»å–sdcardã€è®¿é—®é€šè®¯å½•ç­‰å±é™©æƒé™ç»„å¦‚è¡¨1 åº”ç”¨è¿è¡Œæ—¶ç”³è¯·æƒé™ï¼ˆé€‚ç”¨äºŽ Android6.0 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ é€šè¿‡ä¸€ä¸ªç®€å•çš„å®žä¾‹æ¥è¯´æ˜Žè¿‡ç¨‹å®žä¾‹ï¼š æ‹¨æ‰“ç”µè¯ CALLPHONE æƒé™ä¸ºä¾‹ æƒé™å£°æ˜Ž1&lt;uses-permission android:name="android.permission.CALL_PHONE"/&gt; æ‹¨æ‰“10010 ä»£ç å¦‚ä¸‹ æž„å»ºä¸€ä¸ªéšå¼intent å¯åŠ¨æ‹¨æ‰“ç”µè¯123Intent intent = new Intent(Intent.ACTION_CALL);intent.setData(Uri.parse("tel:10010"));startActivity(intent); åœ¨ä¸»ç•Œé¢ä¸Šæ·»åŠ ä¸€ä¸ªButton åœ¨å…¶onClickæ–¹æ³•ä¸­æ‹¨æ‰“ç”µè¯ï¼Œè¿è¡Œç¨‹åº! åœ¨Anâ€™dâ€™roid 6.0 ä»¥ä¸‹ç‰ˆæœ¬ä¸­ ç”µè¯éƒ½å¯ä»¥æ­£å¸¸æ‹¨å‡ºã€‚Android 6.0 ä»¥ä¸Šç‰ˆæœ¬ä¸­ åˆ™å¯èƒ½ä¼šåº”ç”¨å´©æºƒ/æ— ååº”ï¼ŒæŸ¥çœ‹logcatçš„æ‰“å°æ—¥å¿—å¯ä»¥çœ‹åˆ° â€œPermission Denialâ€æƒé™è¢«ç¦æ­¢çš„ä¿¡æ¯ï¼ŒæŽ¥ä¸‹æ¥å°è¯•ä½¿ç”¨ è¿è¡Œæ—¶ç”³è¯·æƒé™ æ£€æŸ¥æ˜¯å¦å·²èŽ·å¾—æŽˆæƒint checkSelfPermission(Context context, String permission)æ–¹æ³• Context context contextString permission æƒé™å…·ä½“åç§°æ‰“ç”µè¯å¯¹åº” Manifest.permission.CALLPHONE æ–¹æ³•è¿”å›ž PERMISSION_GRANTED / PERMISSION_DENIED ä¾‹ç¨‹12345678if(ContextCompat.checkSelfPermission(MainActivity.this,Manifest.permission.CALL_PHONE) !=PackageManager.PERMISSION_GRANTED)&#123; ;&#125;else &#123; ;&#125; ç”³è¯·æƒé™void ActivityCompat.requestPermissions (Activity activity, String[] permissions, int requestCode)æ–¹æ³• Activity activity Activityå®žä¾‹String[] permissions è¯·æ±‚æƒé™åint requestCode è¯·æ±‚ç ï¼Œå¤§äºŽ0å³å¯ï¼Œå¯¹åº”åœ¨onRequestPermissionsResult å›žæŽ‰æ–¹æ³•ä¸­çš„requestCode ä¾‹ç¨‹ 12ActivityCompat.requestPermissions(MainActivity.this,new String[]&#123;Manifest.permission.CALL_PHONE&#125;,1 ); æŽˆæƒåŽå›žæŽ‰æ— è®ºç”¨æˆ·æ˜¯å¦æŽˆæƒéƒ½ä¼šè¿›å…¥å›žæŽ‰æ–¹æ³•ï¼Œéœ€è¦é‡å†™è¯¥æ–¹æ³•ã€‚void onRequestPermissionsResult (int requestCode, String[] permissions, int[] grantResults)æ–¹æ³• int requestCode åœ¨ requestPermissions ä¸­ä¼ å…¥çš„è¯·æ±‚ç String[] permissions è¯·æ±‚çš„æƒé™ï¼Œä¸ä¸ºç©ºint[] grantResults æŽˆæƒç»“æžœ åªæœ‰ PERMISSION_GRANTED / PERMISSION_DENIED ä¸¤ä¸ªå€¼ ä¾‹ç¨‹ 123456789101112131415@Overridepublic void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) &#123; switch (requestCode) &#123; //è¯·æ±‚ç  1 case 1: //æŽˆæƒç»“æžœ(int) çš„ é•¿åº¦æ˜¯å¦å¤§äºŽ0 ä¸Žä¸Š æŽˆæƒç»“æžœæ˜¯å¦ç­‰äºŽ PackageManager.PERMISSION_GRANTED if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) &#123; //æŽˆæƒé€šè¿‡æ‰§è¡Œ &#125; else &#123; //æŽˆæƒæ²¡æœ‰é€šè¿‡ &#125; break; default: &#125;&#125; å½“ç”¨æˆ·æ‹’ç»åŽå†æ¬¡è¯¢é—® boolean ActivityCompat.shouldShowRequestPermissionRationale(Activity activity, String permission) ï¼ˆçœŸå¿ƒå¤ªé•¿äº†ï¼‰ Activity activity Activityå®žä¾‹String permission æƒé™åç§°åº”ç”¨ç¬¬ä¸€æ¬¡éœ€è¦æŽˆæƒæ—¶,ç”¨æˆ·æŽˆæƒï¼Œè¯¥æ–¹æ³•è¿”å›žfalseã€‚å½“ç”¨æˆ·æ‹’ç»æŽˆæƒ,ä¸‹æ¬¡éœ€è¦è¯¥æƒé™æ—¶,è¯¥æ–¹æ³•ä¼šè¿”å›žtrue ä¾‹ç¨‹1234567 if (ActivityCompat.shouldShowRequestPermissionRationale(PermissionActivity.this,Manifest.permission.READ_CONTACTS))&#123;//ç¬¬äºŒæ¬¡è¯¢é—®ç”¨æˆ·æ˜¯å¦æŽˆæƒ&#125;else&#123;//ç”¨æˆ·ä¾æ—§æ‹’ç»åŽæ“ä½œ&#125; ä¾‹ç¨‹æºç  123456789101112131415161718192021222324252627282930313233343536373839404142public class MainActivity extends AppCompatActivity &#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); &#125; public void Button(View view)&#123; if(ContextCompat.checkSelfPermission(MainActivity.this,Manifest.permission.CALL_PHONE) != PackageManager.PERMISSION_GRANTED)&#123; ActivityCompat.requestPermissions(MainActivity.this, new String[]&#123;Manifest.permission.CALL_PHONE&#125;,1 ); &#125;else &#123; call(); &#125; &#125; private void call() &#123; try &#123; Intent intent = new Intent(Intent.ACTION_CALL); intent.setData(Uri.parse("tel:10010")); startActivity(intent); &#125; catch (SecurityException e) &#123; e.printStackTrace(); &#125; &#125; @Override public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) &#123; switch (requestCode) &#123; case 1: if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) &#123; call(); &#125; else &#123; Toast.makeText(this, "You denied the permission", Toast.LENGTH_SHORT).show(); &#125; break; default: &#125; &#125; &#125; 12345&lt;Button android:onClick="Button" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Hello World!" /&gt;]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”æ•°æ®ä¿å­˜]]></title>
    <url>%2F2017%2F01%2F14%2FAndroid%E7%AC%94%E8%AE%B0-%E6%95%B0%E6%8D%AE%E4%BF%9D%E5%AD%98%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 Android ä¸­çš„ä¸»è¦æ•°æ®å­˜å‚¨ æœ‰ä¸‰ç§ ä¿å­˜é”®å€¼é›† è¦ä¿å­˜çš„ç›¸å¯¹è¾ƒå°é”®å€¼é›†åˆï¼Œä½¿ç”¨ SharedPreferences ä¿å­˜æ–‡ä»¶ä½¿ç”¨ Android æ–‡ä»¶ç³»ç»Ÿé€šè¿‡ File API è¯»å–å’Œå†™å…¥æ–‡ä»¶ï¼Œé€‚åˆæŒ‰å¼€å§‹åˆ°ç»“æŸçš„é¡ºåºä¸è·³è¿‡åœ°è¯»å–æˆ–å†™å…¥å¤§é‡æ•°æ®ã€‚ ä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–é€šè¿‡ç½‘ç»œäº¤æ¢çš„ä»»ä½•å†…å®¹ åœ¨ SQL æ•°æ®åº“ä¸­ä¿å­˜æ•°æ®Androidå†…å»ºçš„SQLite æ•°æ®åº“å­˜å‚¨é‡å¤æˆ–ç»“æž„åŒ–æ•°æ® PSï¼šè¿™é‡Œå¦‚æžœæ²¡æœ‰å­¦è¿‡ SQL æ•°æ®åº“ä½¿ç”¨ï¼ŒæŽ¨èLitePal Androidå¼€æºæ•°æ®åº“LitePal ï¼šéƒ­éœ–(ç¬¬ä¸€è¡Œä»£ç ä½œè€…) è¯¦ç»†ä»‹ç»åœ¨è¿™é‡Œï¼ˆæ‡’äººå¿…å¤‡ï¼‰Androidå¼€æºæ•°æ®åº“LitePal ä¿å­˜é”®å€¼é›† æƒ³è¦ä¿å­˜çš„ç›¸å¯¹è¾ƒå°é”®å€¼é›†åˆ è°ƒç”¨SharedPreferences é¦–å…ˆï¼šèŽ·å–SharedPreferencesçš„å¥æŸ„ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ªå…±äº«å‚æ•°æ–‡ä»¶æˆ–è®¿é—®ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å…±äº«å‚æ•°æ–‡ä»¶ã€‚å…·ä½“é€”å¾„æœ‰ä¸‰æ¡ getSharedPreferences (String name, int mode) ç¬¬ä¸€ä¸ªå‚æ•°ï¼šSharedPreferencesçš„åç§°ï¼Œç¬¬äºŒä¸ªï¼šå‚æ•°æŒ‡å®šæ“ä½œæ¨¡å¼ éœ€è¦åˆ›å»º/è¯»å– å¤šä¸ªå…±äº«å‚æ•°æ–‡ä»¶æ—¶ä½¿ç”¨ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æ‹¥æœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡è¯†ç¬¦é€šè¿‡è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°èŽ·å¾—å…±äº«å‚æ•°å¯¹è±¡ã€‚å¯ä»¥é€šè¿‡APPä¸­çš„ä»»æ„Contextå¯¹è±¡è°ƒç”¨å®ƒã€‚ ç¤ºä¾‹12//æŒ‡å®šSharedPreferencesåç§°ä¸ºdata æ¨¡å¼ä¸ºMODE_PRIVATEï¼šåªæœ‰å½“å‰ç¨‹åºæ‰æœ‰æƒé™è¯»å–/ä¿®æ”¹SharedPreferences sharedPref = getSharedPreferences("data", MODE_PRIVATE); getPreferences (int mode) å‚æ•°ï¼šæŒ‡å®šæ“ä½œæ¨¡å¼ åªåˆ›å»º Activity çš„ä¸€ä¸ªSharedPreferencesã€‚åœ¨Activity ä¸­ä½¿ç”¨ã€‚ æ–¹æ³•ä¼šæ£€ç´¢å±žäºŽè¯¥ Activity çš„é»˜è®¤å…±äº«é¦–é€‰é¡¹æ–‡ä»¶ï¼Œæ— éœ€æä¾›åç§° ç¤ºä¾‹12//æ¨¡å¼ï¼šMODE_PRIVATEï¼šåªæœ‰å½“å‰ç¨‹åºæ‰æœ‰æƒé™è¯»å–/ä¿®æ”¹SharedPreferences sharedPref = getActivity().getPreferences(Context.MODE_PRIVATE); getDefaultSharedPreferences(context) å‚æ•°ï¼šcontext è‡ªåŠ¨ä»¥æ¡£æœŸåº”ç”¨ç¨‹åºåŒ…åä½œä¸ºå‰ç¼€å‘½åSharedPreferencesæ–‡ä»¶ å†™å…¥æ•°æ®åˆ°å…±äº«å‚æ•°ä¸­ SharedPreferences è°ƒç”¨ edit() åˆ›å»ºä¸€ä¸ª SharedPreferences.Editorä½¿ç”¨è¯¸å¦‚ putInt() å’Œ putString() æ–¹æ³•å†™å…¥çš„é”®å’Œå€¼æœ€åŽè°ƒç”¨commit() ä»¥ä¿å­˜æ›´æ”¹ä¹Ÿå¯è°ƒç”¨apply() ä¿å­˜æ›´æ”¹ commit() ä¸Ž apply() ç›¸åŒ/åŒºåˆ« ç›¸åŒ éƒ½æ˜¯æäº¤preferenceä¿®æ”¹æ•°æ® åŒºåˆ« applyæ²¡æœ‰è¿”å›žå€¼ commitè¿”å›žbooleanè¡¨æ˜Žä¿®æ”¹æ˜¯å¦æäº¤æˆåŠŸ applyæ˜¯å°†æ“ä½œæäº¤åˆ°å†…å­˜ï¼Œè€ŒåŽå¼‚æ­¥çœŸæ­£æäº¤åˆ°æ–‡ä»¶ commitæ˜¯åŒæ­¥çš„æäº¤åˆ°æ–‡ä»¶ å¤šä¸ªcommitåŒæ—¶æäº¤ï¼Œäº’ç›¸ç­‰å¾…ï¼Œæ•ˆçŽ‡è¾ƒä½Ž applyç›´æŽ¥è¦†ç›–ï¼Œæ•ˆçŽ‡è¾ƒé«˜ applyæ²¡æœ‰ä»»ä½•é”™è¯¯æç¤ºï¼Œåªæ˜¯æäº¤çš„åŠ¨ä½œ ç¤ºä¾‹123456//åˆ›å»º .edit()SharedPreferences.Editor editor = sharedPref.edit();//å†™å…¥å­—ç¬¦ä¸²ã€‚key-å€¼ TextVieweditor.putString("TextView","hello");//ä¿å­˜æ›´æ”¹editor.commit(); ä»Žå…±äº«å‚æ•°ä¸­è¯»å–æ•°æ® èŽ·å–SharedPreferencesçš„å¥æŸ„æ–¹å¼åŒä¸Š è°ƒç”¨æ¯”å¦‚getInt()æˆ–getString()æ–¹æ³•ï¼Œç„¶åŽä¼ å…¥é”®å€¼ï¼Œå¦‚æžœé”®ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›žä¸€ä¸ªé»˜è®¤å€¼ ç¤ºä¾‹123456//èŽ·å–SharedPreferencesçš„å¥æŸ„SharedPreferences sharedPreferences = getSharedPreferences("data",MODE_PRIVATE);//è¯»å–é”®å€¼å¯¹åº”æ•°æ®String text = sharedPreferences.getString("TextView","");//æ‰“å°åˆ°logä¸­ éªŒè¯Log.d("data",text); ä¿å­˜åˆ°æ–‡ä»¶ Android è®¾å¤‡æœ‰ä¸¤ä¸ªæ–‡ä»¶å­˜å‚¨åŒºåŸŸï¼š å†…éƒ¨å­˜å‚¨ å’Œ å¤–éƒ¨å­˜å‚¨Android è®¾å¤‡æ—©æœŸå†…ç½®çš„éžæ˜“å¤±æ€§å†…å­˜ï¼ˆå†…éƒ¨å­˜å‚¨ï¼‰ï¼Œä»¥åŠç§»åŠ¨å­˜å‚¨ä»‹è´¨ å¾®åž‹ SD å¡ç­‰ï¼ˆå¤–éƒ¨å­˜å‚¨ï¼‰ä»»ä½•Androidè®¾å¤‡å§‹ç»ˆæœ‰ä¸¤ä¸ªå­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”æ— è®ºå¤–éƒ¨å­˜å‚¨è®¾å¤‡æ˜¯å¦å¯ç§»åŠ¨ï¼ŒAPI çš„è¡Œä¸ºå‡ä¸€è‡´ Androidçš„æ–‡ä»¶å­˜å‚¨æ˜¯ä»¥javaæµä¸ºåŸºç¡€ï¼Œå¹¶ä¼˜åŒ–äº†ä¸€äº›æ“ä½œã€‚javaæµä¸å±žäºŽæœ¬æ–‡èŒƒå›´ã€‚ æ¶‰åŠjavaæµéƒ¨åˆ†å‚è€ƒAndroidæ–‡ä»¶IOè¯¦è§£ å†…éƒ¨å­˜å‚¨ä¿å­˜åˆ°å†…éƒ¨å­˜å‚¨ æŸä¸€åº”ç”¨å¯¹å…¶å†…éƒ¨å­˜å‚¨ å§‹ç»ˆå…·æœ‰ è¿›è¡Œè¯»å†™çš„æƒé™ï¼Œè€Œæ— éœ€å£°æ˜Žä»»ä½•æƒé™ï¼Œåœ¨ Android Nä¹‹å‰ï¼Œå†…éƒ¨æ–‡ä»¶å¯ä»¥é€šè¿‡æ”¾å®½æƒé™è®©å…¶ä»–åº”ç”¨è®¿é—®ã€‚ä½†æ˜¯æžä¸æŽ¨èä»¥è¿™ç§æ–¹å¼å…±äº«æ–‡ä»¶ ç®€å•å®žä¾‹ 123456789101112131415161718192021222324252627public void save(String inputText)&#123; //æ–°å»ºä¸€ä¸ªFileOutputStreamå¯¹è±¡(å­—èŠ‚æµ) FileOutputStream out = null; //æ–°å»ºä¸€ä¸ªBufferedWriter (å­—ç¬¦æµ) BufferedWriter writer = null; try&#123; //out å®žä¾‹åŒ– out = openFileOutput("data",Context.MODE_PRIVATE); //OutputStreamWrit å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµ //å­—ç¬¦æµç»‘å®šBufferedWriter(ç¼“å†²åŒº) writer = new BufferedWriter(new OutputStreamWriter(out)); //å†™å…¥åˆ°æ–‡ä»¶ writer.write(inputText); &#125;catch (IOException e )&#123; e.printStackTrace(); &#125; finally &#123; try&#123; //å¦‚æžœå†™å…¥æˆåŠŸ if (writer != null) &#123; //å…³é—­æµ writer.close(); &#125; &#125;catch (IOException e)&#123; e.printStackTrace(); &#125; &#125; &#125; FileOutputStreamï¼š ç»§æ‰¿è‡ª OutputStream ç”¨äºŽæ–‡ä»¶å¤„ç†çš„èŠ‚ç‚¹æµ ç”¨äºŽå†™å…¥åŽŸå§‹å­—èŠ‚æµåˆ°æ–‡ä»¶ FileOutputStream openFileOutput (String name, int mode) è¿”å›žFileOutputStreamå¯¹è±¡ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶å ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ“ä½œæ¨¡å¼ï¼Œæœ‰4ç§å–å€¼ MODEPRIVATE(é»˜è®¤)å½“åŒä¸€æ–‡ä»¶åå­˜åœ¨æ—¶è¦†ç›–åŽŸæ–‡ä»¶ MODEAPPEND å½“åŒåæ–‡ä»¶å­˜åœ¨æ—¶ï¼Œåœ¨åŽŸæ–‡ä»¶æœ«å°¾è¿½åŠ  å…¶ä½™ä¸¤ç§å‡åœ¨android4.2åŠä»¥ä¸Šç‰ˆæœ¬ä¸­åºŸå¼ƒ OutputStreamWrit ç»§æ‰¿è‡ª Writer å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµ BufferedWriter ç»§æ‰¿è‡ªWriter ç»‘å®šå­—ç¬¦è¾“å‡ºæµï¼Œæé«˜å…·ä½“çš„æµå¯¹è±¡çš„æ•ˆçŽ‡ .flush()æ–¹æ³• å¯¹ç¼“å†²åŒºè¿›è¡Œåˆ·æ–°ï¼Œè®©æ•°æ®åˆ°ç›®çš„åœ° .close();æ–¹æ³• å…³é—­ç¼“å†²åŒºï¼Œå³å…³é—­ç»‘å®šçš„æµ ä»Žå†…éƒ¨å­˜å‚¨è¯»å–æ–‡ä»¶ ç®€å•å®žä¾‹ 123456789101112131415161718192021222324252627282930313233343536public String load()&#123; //æ–°å»ºFileInputStreamå¯¹è±¡ FileInputStream in = null; //æ–°å»º BufferedReaderå¯¹è±¡ BufferedReader reader = null; //æ–°å»ºä¸€ä¸ªStringBuilder ç©º content = new StringBuilder(); try&#123; //FileInputStreamå¯¹è±¡å®žä¾‹åŒ– in = openFileInput("data"); //å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµ //ç¼“å†²æµç»‘å®šå­—ç¬¦æµ reader = new BufferedReader(new InputStreamReader(in)); //ç©º String String line = ""; //è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦è¯»å–å®Œæˆ while((line = reader.readLine())!=null)&#123; //è¯»å–å†…å®¹æ·»åŠ åˆ° StringBuilder å¯¹è±¡ä¸­ content.append(line); &#125; &#125;catch (IOException e)&#123; e.printStackTrace(); &#125; finally &#123; if(reader != null)&#123; try&#123; //å…³é—­æµ reader.close(); &#125;catch (IOException e)&#123; e.printStackTrace(); &#125; &#125; &#125; //å°†è¯»å–ç»“æžœ ç”±StringBuilderè½¬æ¢ä¸ºString å¹¶è¿”å›ž return content.toString(); &#125; FileInputStream ç»§æ‰¿è‡ª InputStreamï¼Œç”¨äºŽæ–‡ä»¶å¤„ç†çš„èŠ‚ç‚¹æµ ä»Žæ–‡ä»¶ä¸­è¯»å– FileInputStream openFileInput(String filename) è¿”å›žFileInputStreamå¯¹è±¡ å‚æ•°ä¸º è¯»å–çš„æ–‡ä»¶å InputStreamRead å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµ BufferedReader ç¼“å†²æµ å¤–éƒ¨å­˜å‚¨ å å‘]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2016æ€»ç»“]]></title>
    <url>%2F2016%2F12%2F31%2F2016%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[2016 æ‰¾åˆ°äº†å…´è¶£-Androidå¼€å§‹æ­£å¼å­¦ä¹ ã€‚ æ­å»ºäº†è‡ªå·±çš„blogï¼Œè™½ç„¶å‘¨å›´äººæ²¡äººå…³æ³¨ï¼Œæœ‰ä¸€ç¯‡æ—¥å­çš„é˜…è¯»é‡è¿‡äº†1ä¸‡ï¼Œè¿˜æ˜¯å¾ˆæƒŠå–œçš„ åµŒå…¥å¼å·¥ä½œæ²¡ç”¨æ‰¾åˆ°æ»¡æ„çš„ï¼Œåªèƒ½è¯´ç­‰æ˜¥æ‹› Andoidçš„å®žä¹ ï¼Œè¿™æ®µæ—¶é—´åŠªåŠ›æé«˜è‡ªå·±ï¼Œ æ”¾å¼ƒäº†è€ƒç ” å¿ƒæƒ…èµ°è¿‡äº†ç±»ä¼¼æŠ‘éƒçš„ç»åŽ†ï¼Œå¯¹ä½“åˆ¶ç§ç§å„æœ‰çœ‹æ³•ï¼Œæ˜¯å¯¹æ˜¯é”™ï¼Œè®©æ—¶é—´è§è¯ 2017 å¸Œæœ›æœ‰è‡ªå·±çš„æ”¶å…¥ï¼Œç»æµŽç›¸å¯¹è‡ªç”±ä¸€ç‚¹ è°ˆä¸€æ®µæ‹çˆ±ï¼Œé‡åˆ°åˆé€‚çš„å¥³å­©å§ Androidçš„è·¯ä¸Šï¼Œé¡ºåˆ©ä¸€ç‚¹å§ ä¸ç»™è‡ªå·±è®¾å®šé™åˆ¶ï¼Œèµ°ä¸€æ­¥å†èµ°ä¸€æ­¥]]></content>
      <categories>
        <category>éš</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Android Studioä¼˜åŒ–ç¼–è¯‘é€Ÿåº¦]]></title>
    <url>%2F2016%2F12%2F25%2FAndroid%20Studio%E4%BC%98%E5%8C%96%E7%BC%96%E8%AF%91%E9%80%9F%E5%BA%A6%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ http://www.jianshu.com/p/1c878c10a6bb http://www.jianshu.com/p/9b8ef61b7cdb http://www.jianshu.com/p/64d9a52aebbf ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 å¯¼è¯­ ssdç›˜å®¹é‡ä¸å¤Ÿäº†ï¼Œé‡è£…ç³»ç»Ÿï¼Œéšä¾¿é‡æ–°å®‰è£…äº†Android Studio è®°å½•ä¸€è¾¹ä¼˜åŒ–è¿‡ç¨‹ æœ€é‡è¦çš„ æœ‰ä¸€ä¸ªè‰¯å¥½çš„æ¢¯å­+å…¨å±€ç¿»å¢™ å¤§éƒ¨åˆ†Android Studioå®‰è£…çš„é—®é¢˜,å°±åŸºæœ¬ä¸ä¼šå‡ºçŽ° å¼€å¯gradleå•ç‹¬çš„å®ˆæŠ¤è¿›ç¨‹ åœ¨C:\Users.gradleç›®å½•(userç›®å½•å³å½“å‰ç”¨æˆ·ä¸åŒç”µè„‘ä¸€èˆ¬ä¸åŒ)ä¸‹æ–°å»º gradle.propertiesæ–‡ä»¶å¤åˆ¶ä¸‹é¢çš„ä»£ç  12345org.gradle.daemon=true org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=800m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8org.gradle.parallel=true org.gradle.configureondemand=true åº”è¯¥æ˜¯å¢žå¤§äº†gradle è¿è¡Œçš„ java è™šæ‹Ÿæœºçš„å¤§å°ï¼Œæˆ‘çš„ç”µè„‘æ˜¯8gå†…å­˜ï¼Œè¿™ä¸ªé…ç½®æ•ˆæžœæœ€å¥½ æ‰©å¤§Android Studio è¿è¡Œå†…å­˜ æ‰¾åˆ°Android Studioå®‰è£…ç›®å½•ä¸‹çš„binæ–‡ä»¶å¤¹æ‰¾åˆ°studio64.exe.vmoptionså’Œstudio.exe.vmoptionsæ–‡ä»¶(64ä½)studio.exe.vmoptionså’Œstudio.exe.vmoptionsæ–‡ä»¶(32ä½) åˆ†åˆ«ç¼–è¾‘æ–‡ä»¶,æ”¹åŠ¨3ä¸ªåœ°æ–¹å¦‚ä¸‹ 123-Xms1024m-Xmx2048m-XX:MaxPermSize=800m Android Studio è®¾ç½® Command-line Optionä¸å¡« gradle ç¦»çº¿æ¨¡å¼å‹¾é€‰Office Workï¼Œæˆ‘è¿™é‡Œæµ‹è¯•æ˜¯é€Ÿåº¦åŸºæœ¬ä¸å˜ï¼Œä½†æ˜¯ç½‘ä¸Šæœ‰äººæµ‹è¯•æ˜¯æ•ˆæžœç›¸å·®å¾ˆå¤šï¼ŒåŽŸå› ä¸æ˜Žï¼Œå¯èƒ½æ˜¯ç½‘ç»œä¸€ç›´å…¨å±€ç¿»å¢™çš„å…³ç³»]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”Broadcastå¹¿æ’­]]></title>
    <url>%2F2016%2F12%2F23%2FAndroid%E7%AC%94%E8%AE%B0-Broadcast%E5%B9%BF%E6%92%AD%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 BroadcastReceiveråŸºç¡€ é¦–å…ˆç¥­å‡ºå®˜æ–¹æ–‡æ¡£åŠä¸­æ–‡ç¿»è¯‘ https://developer.android.com/reference/android/content/BroadcastReceiver.htmlhttp://www.jianshu.com/p/1b56172b0c77 BroadcastReceiveræ¦‚è¿° @åˆ«è·¯å¯»å¿†Androidä¸­çš„å››å¤§ç»„ä»¶æ˜¯ Activityã€Serviceã€Broadcastå’ŒContent Providerã€‚è€ŒIntentæ˜¯ä¸€ä¸ªå¯¹åŠ¨ä½œå’Œè¡Œä¸ºçš„æŠ½è±¡æè¿°ï¼Œè´Ÿè´£ç»„ä»¶ä¹‹é—´ç¨‹åºä¹‹é—´è¿›è¡Œæ¶ˆæ¯ä¼ é€’ã€‚é‚£ä¹ˆBroadcast Receiverç»„ä»¶å°±æä¾›äº†ä¸€ç§æŠŠIntentä½œä¸ºä¸€ä¸ªæ¶ˆæ¯å¹¿æ’­å‡ºåŽ»ï¼Œç”±æ‰€æœ‰å¯¹å…¶æ„Ÿå…´è¶£çš„ç¨‹åºå¯¹å…¶ä½œå‡ºååº”çš„æœºåˆ¶ã€‚ @zuolongsnailä¸“æ  å¹¿æ’­æŽ¥æ”¶å™¨æ˜¯ä¸€ä¸ªä¸“æ³¨äºŽæŽ¥æ”¶å¹¿æ’­é€šçŸ¥ä¿¡æ¯ï¼Œå¹¶åšå‡ºå¯¹åº”å¤„ç†çš„ç»„ä»¶ã€‚å¾ˆå¤šå¹¿æ’­æ˜¯æºè‡ªäºŽç³»ç»Ÿä»£ç çš„â”€â”€æ¯”å¦‚ï¼Œé€šçŸ¥æ—¶åŒºæ”¹å˜ã€ç”µæ± ç”µé‡ä½Žã€æ‹æ‘„äº†ä¸€å¼ ç…§ç‰‡æˆ–è€…ç”¨æˆ·æ”¹å˜äº†è¯­è¨€é€‰é¡¹ã€‚åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥è¿›è¡Œå¹¿æ’­â”€â”€æ¯”å¦‚è¯´ï¼Œé€šçŸ¥å…¶å®ƒåº”ç”¨ç¨‹åºä¸€äº›æ•°æ®ä¸‹è½½å®Œæˆå¹¶å¤„äºŽå¯ç”¨çŠ¶æ€ã€‚ åº”ç”¨ç¨‹åºå¯ä»¥æ‹¥æœ‰ä»»æ„æ•°é‡çš„å¹¿æ’­æŽ¥æ”¶å™¨ä»¥å¯¹æ‰€æœ‰å®ƒæ„Ÿå…´è¶£çš„é€šçŸ¥ä¿¡æ¯äºˆä»¥å“åº”ã€‚æ‰€æœ‰çš„æŽ¥æ”¶å™¨å‡ç»§æ‰¿è‡ªBroadcastReceiveråŸºç±»ã€‚ å¹¿æ’­æŽ¥æ”¶å™¨æ²¡æœ‰ç”¨æˆ·ç•Œé¢ã€‚ç„¶è€Œï¼Œå®ƒä»¬å¯ä»¥å¯åŠ¨ä¸€ä¸ªactivityæ¥å“åº”å®ƒä»¬æ”¶åˆ°çš„ä¿¡æ¯ï¼Œæˆ–è€…ç”¨NotificationManageræ¥é€šçŸ¥ç”¨æˆ·ã€‚é€šçŸ¥å¯ä»¥ç”¨å¾ˆå¤šç§æ–¹å¼æ¥å¸å¼•ç”¨æˆ·çš„æ³¨æ„åŠ›â”€â”€é—ªåŠ¨èƒŒç¯ã€éœ‡åŠ¨ã€æ’­æ”¾å£°éŸ³ç­‰ç­‰ã€‚ä¸€èˆ¬æ¥è¯´æ˜¯åœ¨çŠ¶æ€æ ä¸Šæ”¾ä¸€ä¸ªæŒä¹…çš„å›¾æ ‡ï¼Œç”¨æˆ·å¯ä»¥æ‰“å¼€å®ƒå¹¶èŽ·å–æ¶ˆæ¯ã€‚ å¹¿æ’­åˆ†ç±» è§¦å‘å¹¿æ’­å‘ç”Ÿçš„äº‹ä»¶åˆ†ç±»æœ‰ä¸¤ç§ Androidç³»ç»Ÿå¹¿æ’­äº‹ä»¶ ç”±androidè®¾å¤‡çŠ¶æ€å˜åŒ–è€Œè§¦å‘çš„ç³»ç»Ÿå¹¿æ’­å¦‚ï¼š Intent.ACTION_POWER_CONNECTED; //æ’ä¸Šå¤–éƒ¨ç”µæºæ—¶å‘å‡ºçš„å¹¿æ’­ Intent.ACTION_SCREEN_ON; //å±å¹•è¢«æ‰“å¼€ä¹‹åŽçš„å¹¿æ’­ ACTION_TIME_CHANGED//ç³»ç»Ÿæ—¶é—´æ”¹å˜è€Œè§¦å‘çš„å¹¿æ’­ è‡ªå®šä¹‰çš„å¹¿æ’­äº‹ä»¶ è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£äº†ï¼Œæ¯”å¦‚qqå½“æˆ‘ä»¬å†å¦å¤–ä¸€å°æ‰‹æœºä¸Šç™»é™†æ—¶ï¼Œæ‰‹å¤´çš„è¿™ä¸ªæ‰‹æœºqqå°±ä¼šè‡ªåŠ¨ä¸‹çº¿ã€‚è…¾è®¯çš„æœåŠ¡å™¨é€šè¿‡åŽå°æœåŠ¡å¯ç”¨äº†è‡ªå®šä¹‰å¹¿æ’­æ¥ç»ˆç»“æ­£åœ¨è¿è¡Œçš„Activityï¼Œè¯¦æƒ…ä¹‹åŽä¼šæœ‰ä¾‹ç¨‹ï¼Œä¸å†ç´¯èµ˜ã€‚ èƒ½å¤Ÿè¢«æŽ¥æ”¶çš„å¹¿æ’­ç±»åž‹ æ™®é€šå¹¿æ’­ï¼ˆNormal broadcastsï¼‰ï¼š ï¼ˆç”± Context.sendBroadcastå‘å‡ºï¼‰å¼‚æ­¥å‘å‡ºã€‚æ‰€æœ‰å¹¿æ’­æŽ¥æ”¶å™¨éƒ½å¯ä»¥åœ¨åŒä¸€æ—¶é—´æŽ¥æ”¶å¹¿æ’­ã€‚å¹¿æ’­æŽ¥æ”¶è€…æ— æ³•æŽ¥æ”¶å¹¿æ’­çš„å¤„ç†ç»“æžœæˆ–è€…é˜»æ–­å¹¿æ’­çš„ä¼ é€’ã€‚ æœ‰åºå¹¿æ’­ï¼ˆOrdered broadcastsï¼‰ï¼š ï¼ˆç”± Context.sendOrderedBroadcastå‘å‡ºï¼‰æ¯æ¬¡åªå‘é€ç»™ä¸€ä¸ªå¹¿æ’­æŽ¥æ”¶å™¨ã€‚å½“æ¯ä¸ªå¹¿æ’­æŽ¥æ”¶å™¨ä¾æ¬¡æ‰§è¡Œæ—¶ï¼Œå®ƒå¯ä»¥å‘ä¸‹ä¸€ä¸ªå¹¿æ’­æŽ¥æ”¶å™¨ä¼ æ’­ç»“æžœï¼Œæˆ–è€…é˜»æ–­è¯¥å¹¿æ’­ï¼Œä½¿å¾—è¯¥å¹¿æ’­ä¸èƒ½è¢«ä¸‹ä¸€ä¸ªå¹¿æ’­æŽ¥æ”¶å™¨æŽ¥æ”¶åˆ°ã€‚ é€šä¿—è§£é‡Šï¼š æ™®é€šå¹¿æ’­å°±ç›¸å½“äºŽå°åŒº/æ‘å§”ä¼šçš„å¤§å–‡å­ï¼Œæœ‰äº‹å‘ç”Ÿï¼ˆè§¦å‘å¹¿æ’­ï¼‰é€šçŸ¥æ‰€æœ‰çš„äººï¼ˆå¹¿æ’­æŽ¥æ”¶å™¨ï¼‰ï¼Œå…¨åŠŸçŽ‡çš„å¤§å–Šå¤§å«ç¡®ä¿æ‰€æœ‰äººï¼ˆå¹¿æ’­æŽ¥æ”¶å™¨ï¼‰éƒ½èƒ½å¬åˆ°ã€‚è€Œæœ‰äººï¼ˆå¹¿æ’­æŽ¥æ”¶å™¨ï¼‰åœ¨ç¡è§‰è¢«åµé†’ä½†æ˜¯åˆæ²¡åŠžæ³•ç ¸äº†é‚£ä¸ªå¤§å–‡å­ï¼Œåªèƒ½ç»§ç»­å¬ç€ï¼ˆæ— æ³•æŽ¥æ”¶å¹¿æ’­çš„å¤„ç†ç»“æžœæˆ–è€…é˜»æ–­å¹¿æ’­çš„ä¼ é€’ï¼‰ã€‚ æœ‰åºå¹¿æ’­ å°±ç›¸å½“äºŽé—´è°æœºå…³çš„ç»å¯†æ¶ˆæ¯ä¼ é€’ã€‚ç»å¯†åˆ°æ‰‹ï¼ˆè§¦å‘å¹¿æ’­ï¼‰é—´è°ç§˜å¯†æ±‡æ€»ç»™ä¸Šçº¿Aï¼ˆå¹¿æ’­æŽ¥æ”¶å™¨Aï¼‰ã€‚æœ¬æ¥ ä¸Šçº¿ï¼ˆå¹¿æ’­æŽ¥æ”¶å™¨Aï¼‰åº”è¯¥ å¬å–å®Œæ¯•é‡æ–°æ•´ç†æƒ…å‘é¦–é•¿Bï¼ˆå¹¿æ’­æŽ¥æ”¶å™¨Bï¼‰æŠ¥å‘Šï¼ˆå‘å¹¿æ’­æŽ¥æ”¶å™¨Bä¼ æ’­ å¹¿æ’­æŽ¥æ”¶å™¨Aä¿®æ”¹çš„ç»“æžœï¼‰,ä½†æ˜¯Aè¢«æ”¶ä¹°ï¼Œå°†æƒ…æŠ¥éšåŒ¿äº†ï¼Œæ²¡æœ‰å‘é¦–é•¿Bæ±‡æŠ¥ï¼ˆå¹¿æ’­æŽ¥æ”¶å™¨Aé˜»æ–­è¯¥å¹¿æ’­ï¼Œä½¿å¾—è¯¥å¹¿æ’­ä¸èƒ½è¢«ä¸‹ä¸€ä¸ªå¹¿æ’­æŽ¥æ”¶å™¨BæŽ¥æ”¶åˆ°ï¼‰ã€‚ï¼ˆPSç»“å±€é¦–é•¿Bé”™è¯¯å¸¦äººç‚¸äº†æ‘å§”ä¼šï¼Œè¯¥ç¡è§‰çš„äººç»ˆäºŽå¯ä»¥å®‰ç”Ÿç¡è§‰äº†ï¼ï¼‰ å¹¿æ’­äº‹ä»¶æ³¨å†Œæœ‰ä¸¤ç§ é™æ€æ³¨å†Œï¼Œå°±æ˜¯åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­å®šä¹‰ï¼Œæ³¨å†Œçš„å¹¿æ’­æŽ¥æ”¶å™¨å¿…é¡»è¦ç»§æ‰¿BroadcastReceiver. åŠ¨æ€æ³¨å†Œï¼Œæ˜¯åœ¨ç¨‹åºä¸­ä½¿ç”¨Context.registerReceiveræ³¨å†Œï¼Œæ³¨å†Œçš„å¹¿æ’­æŽ¥æ”¶å™¨ç›¸å½“äºŽä¸€ä¸ªåŒ¿åç±»ã€‚ä¸¤ç§æ–¹å¼éƒ½éœ€è¦IntentFIlterã€‚ ä¾‹ç¨‹è§ä¸‹èŠ‚ã€‚ åŠ¨æ€æ³¨å†Œï¼ˆåœ¨ä»£ç ä¸­æ³¨å†Œï¼‰ åœ¨ä»£ç ä¸­é€šè¿‡registerReceiver()æ³¨å†Œã€‚appå…³é—­åŽ,è¯¥æŽ¥æ”¶å™¨ä¹Ÿä¼šéšä¹‹é”€æ¯ã€‚ é¦–å…ˆå®šä¹‰ä¸€ä¸ªå†…éƒ¨å­ç±»NetworkChangeReceiverç»§æ‰¿è‡ª BroadcastReceiver 12345678class NetworkChangeReceiver extends BroadcastReceiver &#123;@Override//é‡å†™onReceiveï¼ŒæŽ¥æ”¶åˆ°å¹¿æ’­åŽæç¤ºæ¶ˆæ¯ public void onReceive(Context context, Intent intent) &#123; Toast.makeText(context, "network is availableç½‘ç»œå·²å˜åŒ–", Toast.LENGTH_SHORT).show(); &#125; &#125; åœ¨onCreate()æ–¹æ³•ä¸­åˆ›å»ºIntentFilterå®žä¾‹å’ŒNetworkChangeReceiverå®žä¾‹ã€‚å¹¶åœ¨IntentFilterå®žä¾‹ä¸­æ·»åŠ ç½‘ç»œå˜åŒ–æ—¶ç³»ç»Ÿå¹¿æ’­å¯¹åº”å€¼ã€‚éšåŽä¼ å…¥registerReceiver()ä¸­æ³¨å†Œã€‚ 123456789101112 protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); //åˆ›å»ºIntentFilterå®žä¾‹ intentFilter = new IntentFilter(); //æ·»åŠ å¯¹åº”ç³»ç»Ÿå¹¿æ’­ intentFilter.addAction("android.net.conn.CONNECTIVITY_CHANGE"); //æ·»åŠ NetworkChangeReceiverå®žä¾‹ networkChangeReceiver = new NetworkChangeReceiver(); //åŠ¨æ€æ³¨å†Œ registerReceiver(networkChangeReceiver, intentFilter);&#125; åŠ¨æ€æ³¨å†Œçš„å¹¿æ’­æŽ¥æ”¶å™¨æœ€åŽè¦å–æ¶ˆæ³¨å†Œã€‚åœ¨onDestroy()æ–¹æ³•ä¸­è°ƒç”¨unregisterReceiver()é”€æ¯åŠ¨æ€æ³¨å†Œçš„å¹¿æ’­æŽ¥æ”¶å™¨ã€‚ 1234 protected void onDestroy()&#123; super.onDestroy(); unregisterReceiver(networkChangeReceiver);&#125; æœ€åŽè¦åœ¨AndroidMainfest.xmlä¸­å£°æ˜ŽæŸ¥è¯¢ç³»ç»Ÿç½‘ç»œçŠ¶æ€çš„æƒé™ã€‚ 1&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/&gt; è¿è¡Œæ•ˆæžœå¦‚å¦‚æ‰€ç¤ºï¼ˆæ¨¡æ‹Ÿå™¨ï¼‰ é™æ€æ³¨å†Œï¼ˆxmlä¸­æ³¨å†Œï¼‰ ç›´æŽ¥åœ¨Manifest.xmlæ–‡ä»¶ä¸­é…ç½®å¹¿æ’­æŽ¥æ”¶è€… ä¾‹ç¨‹ä¸ºäº†æ–¹ä¾¿åŒæ ·ä»¥android.net.conn.CONNECTIVITY_CHANGEä¸ºä¾‹ï¼Œä¸ŽåŠ¨æ€æ³¨å†Œç›¸åŒã€‚ä¸ä½¿ç”¨å†…éƒ¨å­ç±»ï¼ˆç¬¬ä¸€è¡Œä»£ç ï¼‰ æ–°å»ºåç§°ä¸ºBootCompleteReceiverçš„java class ä»£ç å¦‚ä¸‹ 123456 public class BootCompleteReceiver extends BroadcastReceiver &#123; @Override public void onReceive(Context context, Intent intent)&#123; Toast.makeText(context, "ç½‘ç»œæ”¹å˜", Toast.LENGTH_SHORT).show(); &#125;&#125; åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­æ³¨å†Œå¹¿æ’­æŽ¥æ”¶å™¨ ä»£ç å¦‚ä¸‹ 12345&lt;receiver android:name=".BootCompleteReceiver"&gt; &lt;intent-filter&gt; &lt;action android:name="android.net.conn.CONNECTIVITY_CHANGE"/&gt; &lt;/intent-filter&gt;&lt;/receiver&gt; åœ¨AndroidManifest.xmlä¸­å£°æ˜Žæƒé™ 12&lt;uses-permission android:name="android.permission.INTERNET"&gt;&lt;/uses-permission&gt;&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"&gt;&lt;/uses-permission&gt; ä½¿ç”¨å†…éƒ¨å­ç±»ï¼ˆåœ¨Activityä¸­å®šä¹‰ï¼‰ åœ¨è¿™æ™•åœˆäº†ä¸€ä¸‹åˆï¼Œæ‰¾ä¸å‡ºæ¯›ç—…ã€‚çœ‹ä¹¦å¤šä»”ç»†å§ï¼Œä¹¦ä¸Šè¯´äº†ä¸ç”¨å†…éƒ¨å­ç±»ã€‚è¯¦ç»†èµ„æ–™åœ¨è¿™é‡Œ http://blog.csdn.net/chdjj/article/details/19496567 æ¸…å•æ–‡ä»¶æ³¨å†Œå¹¿æ’­æŽ¥æ”¶è€…æ—¶ï¼Œå¹¿æ’­æŽ¥æ”¶è€…çš„åå­—æ ¼å¼éœ€è¦æ³¨æ„å› ä¸ºæ˜¯å†…éƒ¨ç±»ï¼Œæ‰€ä»¥éœ€è¦åœ¨å†…éƒ¨ç±»æ‰€åœ¨çš„ç±»ä¸Žå†…éƒ¨ç±»ä¹‹é—´åŠ ä¸Š$ç¬¦å·(è¿™ä¸€ç‚¹åœ¨AndroidStudioä¸­è¾“å…¥æ—¶æœ‰æç¤º) å†…éƒ¨ç±»åœ¨å£°æ˜Žæ—¶ä¸€å®šè¦å†™æˆé™æ€å†…éƒ¨ç±»ï¼ˆclasså…³é”®å­—å‰åŠ ä¸Šstaticï¼‰ã€‚å¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆå¹¿æ’­å‘ç”Ÿæ—¶ï¼Œåº”ç”¨åœæ­¢è¿è¡Œï¼‰ åœ¨MainActivityä¸­æ–°å»ºå­ç±» 123456 public static class BootCompleteReceiver extends BroadcastReceiver &#123; @Override public void onReceive(Context context, Intent intent)&#123; Toast.makeText(context, "Boot complete", Toast.LENGTH_SHORT).show(); &#125;&#125; åœ¨AndroidManifest.xmlä¸­æ³¨å†Œå¹¿æ’­æŽ¥æ”¶å™¨ 12345&lt;receiver android:name=".MainActivity$BootCompleteReceiver"&gt; &lt;intent-filter&gt; &lt;action android:name="android.net.conn.CONNECTIVITY_CHANGE"/&gt; &lt;/intent-filter&gt;&lt;/receiver&gt; åœ¨AndroidManifest.xmlä¸­å£°æ˜Žæƒé™ 12&lt;uses-permission android:name="android.permission.INTERNET"&gt;&lt;/uses-permission&gt;&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"&gt;&lt;/uses-permission&gt; è¿è¡Œæ•ˆæžœåŒåŠ¨æ€æ³¨å†Œ ä½¿ç”¨å¹¿æ’­æŽ¥æ”¶å™¨æ³¨æ„äº‹é¡¹ åœ¨onReceive()æ–¹æ³•ä¸­ä¸å®œæ·»åŠ è¿‡å¤šé€»è¾‘/è€—æ—¶æ“ä½œï¼Œå¹¿æ’­æŽ¥æ”¶å™¨æ²¡æœ‰å¤šçº¿ç¨‹ï¼Œä¸€æ—¦æ—¶é—´è¿‡é•¿ï¼Œç¨‹åºå°±ä¼šæŠ¥é”™ã€‚ å¹¿æ’­æŽ¥æ”¶å™¨ä¸€èˆ¬ä¸ºå¯åŠ¨å…¶ä»–ç»„ä»¶ä½œç”¨ã€‚ å‘é€æ ‡å‡†å¹¿æ’­ å‘é€æ ‡å‡†å¹¿æ’­ä¹‹å‰ï¼Œé¦–å…ˆè¦æ³¨å†Œä¸€ä¸ªä½œä¸ºç›®æ ‡çš„å¹¿æ’­æŽ¥æ”¶å™¨ã€‚ï¼ˆè¿‡ç¨‹ç•¥ï¼Œåªä¸Šä»£ç ï¼‰ æ–°å»ºMyBroadcastReceiver.class 1234567 public class MyBroadcastReceiver extends BroadcastReceiver&#123; @Override public void onReceive(Context context, Intent intent) &#123; Toast.makeText(context,"MyBroadcastReceiver",Toast.LENGTH_SHORT).show(); &#125;&#125; åœ¨Xmlä¸­æ³¨å†Œï¼ˆé™æ€ï¼‰ 12345&lt;receiver android:name=".MyBroadcastReceiver"&gt; &lt;intent-filter&gt; &lt;action android:name="com.example.broadcasttest.MyBroad"/&gt; &lt;/intent-filter&gt;&lt;/receiver&gt; xmlä¸­æ³¨å†Œä¸€ä¸ªButton 12345&lt;Button android:layout_width="wrap_content" android:layout_height="wrap_content" android:onClick="SendBroad" android:text="SendBroad" /&gt; MainActivityä¸­æ–°å»º SendBroad()å‡½æ•° é¦–å…ˆæž„å»ºä¸€ä¸ª Intentå¯¹è±¡ï¼Œå°†è‡ªå®šä¹‰çš„å¹¿æ’­å€¼å¡«å…¥ã€‚å†è°ƒç”¨sendBroadcastæ–¹æ³•å°†å¹¿æ’­å‘é€å‡ºåŽ»ã€‚ 12345 public void SendBroad(View view)&#123; Intent intent = new Intent("com.example.broadcasttest.MyBroad"); sendBroadcast(intent);&#125; å‘é€çš„æ˜¯æ ‡å‡†å¹¿æ’­ã€‚è¿è¡Œæ•ˆæžœå¦‚ä¸‹å›¾ã€‚ å‘é€æœ‰åºå¹¿æ’­ é¦–å…ˆæ–°å»ºä¸€ä¸ªBroad2 çš„å·¥ç¨‹ã€‚åŒæ ·æŽ¥æ”¶Broadå‘é€çš„å¹¿æ’­ã€‚ ä»£ç å¦‚ä¸‹ 1234567 public class AnotherBroadcast extends BroadcastReceiver &#123; @Override public void onReceive(Context context, Intent intent) &#123; Toast.makeText(context," AnotherBroadcast",Toast.LENGTH_SHORT).show(); &#125;&#125; 12345&lt;receiver android:name=".AnotherBroadcast"&gt; &lt;intent-filter android:priority="10"&gt; &lt;action android:name="com.example.broadcasttest.MyBroad"/&gt; &lt;/intent-filter&gt; &lt;/receiver&gt; æµ‹è¯•æ•ˆæžœï¼šå½“æ‘ä¸‹å‘é€å¹¿æ’­æŒ‰é’®åŽï¼Œå¼¹å‡ºä¸¤ä¸ªæç¤ºã€‚ ä¿®æ”¹Broadé¡¹ç›®ä¸­onClickå¯¹åº”äº‹ä»¶ã€‚å°†sendBroadcast(ï¼‰æ”¹ä¸ºsendOrderedBroadcast();å‘é€æœ‰åºå¹¿æ’­ã€‚ 12345 public void SendBroad(View view)&#123; Intent intent = new Intent("com.example.broadcasttest.MyBroad"); sendOrderedBroadcast(intent,null);&#125; æ•ˆæžœä¸Žå‘é€æ ‡å‡†å¹¿æ’­ç›¸åŒï¼ˆè¿˜æœªå®šä¹‰ä¼˜å…ˆçº§/æˆªæ–­ç­‰ï¼‰ å®šä¹‰ä¼˜å…ˆçº§ï¼Œå†Broadçš„AndroidMainfest.xmlä¸­ä¿®æ”¹æ³¨å†Œçš„å¹¿æ’­æ·»åŠ android:priority=â€100â€ä¼˜å…ˆçº§100 12345&lt;receiver android:name=".MyBroadcastReceiver"&gt; &lt;intent-filter android:priority="100"&gt; &lt;action android:name="com.example.broadcasttest.MyBroad"/&gt; &lt;/intent-filter&gt;&lt;/receiver&gt; åœ¨Broad2çš„AndroidMainfest.xmlä¸­æ·»åŠ android:priority=â€10â€ä¼˜å…ˆçº§10 12345&lt;receiver android:name=".AnotherBroadcast"&gt; &lt;intent-filter android:priority="10"&gt; &lt;action android:name="com.example.broadcasttest.MyBroad"/&gt; &lt;/intent-filter&gt;&lt;/receiver&gt; å‘é€å¹¿æ’­åŽMyBroadcastReceiveræœ€å…ˆæ”¶åˆ°å¹¿æ’­ã€‚ æˆªæ–­å¹¿æ’­ã€‚æœ‰åºå¹¿æ’­ä¸­å‰ä¸€ä¸ªå¹¿æ’­æŽ¥æ”¶å™¨å¯ä»¥æˆªæ–­å¹¿æ’­ä¼ æ’­ã€‚æ·»åŠ  abortBroadcast();å³å¯ã€‚ 12345678 public class MyBroadcastReceiver extends BroadcastReceiver&#123; @Override public void onReceive(Context context, Intent intent) &#123; Toast.makeText(context,"MyBroadcastReceiver",Toast.LENGTH_SHORT).show(); abortBroadcast(); &#125;&#125; å†æ¬¡ç‚¹å‡»æŒ‰é’®å‘é€å¹¿æ’­ï¼Œåªæœ‰MyBroadcastReceiverå¯ä»¥æŽ¥æ”¶åˆ°å‘é€çš„å¹¿æ’­ã€‚ æœ¬åœ°å¹¿æ’­ åªåœ¨appåº”ç”¨å†…éƒ¨ä¼ é€’çš„å¹¿æ’­ã€‚æ³¨å†Œè¿‡ç¨‹ç±»ä¼¼äºŽåŠ¨æ€æ³¨å†Œã€‚ å®šä¹‰ä¸€ä¸ªå†…éƒ¨ç±»LocalReceiverç»§æ‰¿è‡ªBroadcastReceiver 123456 public static class LocalReceiver extends BroadcastReceiver&#123; @Override public void onReceive(Context context, Intent intent)&#123; Toast.makeText(context, "received local broadcast", Toast.LENGTH_SHORT).show(); &#125;&#125; é¦–å…ˆåœ¨onCreate()æ–¹æ³•ä¸­é€šè¿‡localBroadcastManager.getInstanå¾—åˆ°ä¸€ä¸ªLocalBroadcastManagerçš„å®žä¾‹ï¼Œå†åˆ›å»ºIntentFilterå®žä¾‹å’ŒLocalReceiverå®žä¾‹ã€‚å¹¶åœ¨IntentFilterå®žä¾‹ä¸­æ·»åŠ å¹¿æ’­ã€‚éšåŽä¼ å…¥localBroadcastManager.registerReceiver()ä¸­æ³¨å†Œæœ¬åœ°å¹¿æ’­ã€‚ 123456789101112131415161718private IntentFilter intentFilter;private LocalReceiver localReceiver;private LocalBroadcastManager localBroadcastManager;@Overrideprotected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar); localBroadcastManager = localBroadcastManager.getInstance(this); intentFilter = new IntentFilter(); intentFilter.addAction("com.example.broadcasttest.LOCAL_BROADCAST"); localReceiver = new LocalReceiver(); localBroadcastManager.registerReceiver(localReceiver, intentFilter); &#125; åœ¨Activityçš„onDestroy()ä¸­é”€æ¯æ³¨å†Œã€‚ 12345@Overrideprotected void onDestroy()&#123; super.onDestroy(); localBroadcastManager.unregisterReceiver(localReceiver);&#125; åœ¨Buttonå¯¹åº”çš„å‡½æ•°ä¸­è°ƒç”¨localBroadcastManager.sendBroadcastå‘é€æœ¬åœ°å¹¿æ’­ã€‚ 12345 public void SendBroad(View view)&#123; Intent intent = new Intent("com.example.broadcasttest.LOCAL_BROADCAST"); localBroadcastManager.sendBroadcast(intent);&#125; æ•ˆæžœåŸºæœ¬åŒä¸Šï¼Œä¸åŠ ç´¯èµ˜ã€‚ä¸è¿‡åœ¨Broad2ä¸­æ˜¯æ€Žæ ·éƒ½æœä¸åˆ°å¹¿æ’­äº†ã€‚ æœ¬åœ°å¹¿æ’­ç‰¹ç‚¹ æ˜Žç¡®å¹¿æ’­åªåœ¨åº”ç”¨å†…éƒ¨ï¼Œä¼ é€’æ•°æ®æ— éœ€æ‹…å¿ƒæ³„å¯†ã€‚ å…¶ä»–ç¨‹åºå¹¿æ’­æ— æ³•å‘é€è‡³ç¨‹åºå†…éƒ¨ã€‚ æœ¬åœ°å¹¿æ’­æ¯”å…¨å±€å¹¿æ’­æ›´ä¸ºé«˜æ•ˆã€‚]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”Fragments]]></title>
    <url>%2F2016%2F12%2F18%2FAndroid%E7%AC%94%E8%AE%B0-Fragments%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) Androidå®˜æ–¹æ–‡æ¡£ä¹‹App Componentsï¼ˆFragmentsï¼‰ ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 å¯¼è¯­ Fragmentsçš„è‰ºæœ¯ä¹‹æ—… Fragmentsç®€ä»‹ Fragmentâ€”ç‰‡æ®µ æ˜¯Android åœ¨ Android 3.0ï¼ˆAPI 11 çº§ï¼‰ä¸­å¼•å…¥äº†ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç»™å¤§å±å¹•ï¼ˆå¦‚å¹³æ¿ç”µè„‘ï¼‰ä¸Šæ›´åŠ åŠ¨æ€å’Œçµæ´»çš„ UI è®¾è®¡æä¾›æ”¯æŒã€‚ å¯ä»¥å°†å¤šä¸ªç‰‡æ®µç»„åˆåœ¨ä¸€ä¸ª Activity ä¸­æ¥æž„å»ºå¤šçª—æ ¼ UIï¼Œä»¥åŠåœ¨å¤šä¸ª Activity ä¸­é‡å¤ä½¿ç”¨æŸä¸ªç‰‡æ®µã€‚å¯ä»¥å°†ç‰‡æ®µè§†ä¸º Activity çš„æ¨¡å—åŒ–ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå…·æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œèƒ½æŽ¥æ”¶è‡ªå·±çš„è¾“å…¥äº‹ä»¶ï¼Œå¯ä»¥åœ¨ Activity è¿è¡Œæ—¶æ·»åŠ æˆ–åˆ é™¤ç‰‡æ®µï¼ˆç±»ä¼¼äºŽä¸åŒ Activity ä¸­é‡å¤ä½¿ç”¨çš„â€œå­ Activityâ€ï¼‰ Googleå®˜æ–¹æ–‡æ¡£(ä¸­æ–‡) åˆ›å»ºFragments fragmentåˆ›å»ºè¿‡ç¨‹ä¸ŽActivityç±»ä¼¼ã€‚ åˆ›å»ºFragmentï¼Œéœ€è¦ç»§æ‰¿ä¸€ä¸ªFragmentç±»ï¼Œå¹¶å®žçŽ°Fragmentçš„ç”Ÿå‘½å‘¨æœŸå›žè°ƒæ–¹æ³•ï¼Œå¦‚onCreate(), onStart(), onPause(), onStop()ç­‰ ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨Fragmentä¸­åº”è‡³å°‘é‡å†™ä»¥ä¸‹è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¿…é¡»é‡å†™çš„æ—¶onCreateView()æ–¹æ³•. onCreate()ï¼šåˆ›å»ºFragmentå®žä¾‹æ—¶ï¼Œç³»ç»Ÿå›žè°ƒçš„æ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå¯¹ä¸€äº›å¿…è¦çš„ç»„ä»¶è¿›è¡Œåˆå§‹åŒ– onCreateView()ï¼šFragmentä¸Šç»˜åˆ¶UIæ—¶ï¼Œå›žæŽ‰è¯¥æ–¹æ³•ã€‚è¿”å›žä¸€ä¸ªViewå¯¹è±¡ï¼Œè¡¨ç¤ºFragmentçš„æ ¹è§†å›¾ï¼›è‹¥Fragmentä¸éœ€è¦ç»‘å®šç¤ºå›¾ï¼Œå¯ä»¥è¿”å›žnull onPause()ï¼šå½“ç”¨æˆ·ç¦»å¼€Fragmentæ—¶å›žè°ƒã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå¯¹Fragmentçš„æ•°æ®ä¿¡æ¯åšæŒä¹…åŒ–çš„ä¿å­˜å·¥ä½œ åˆ›å»ºä¸€ä¸ªFragmentç±» æ–°å»ºfirst_fragme ç»§æ‰¿è‡ªFragment Android Studioä¸­ å¯¹åº”Fragment åŒ…æœ‰ä¸¤ä¸ªï¼Œé€‰æ‹©support-v4 _(è¿™ä¸ªç‰ˆæœ¬å¯ä»¥å†Androidç‰ˆæœ¬ä¸­ä¿æŒFragmentç‰¹æ€§ä¸€è‡´) Fragmentå¹¶éžä¸€å®šè¦ç»‘å®šä¸€ä¸ªå¸ƒå±€æ–‡ä»¶ï¼Œä¸‹é¢ä¼šæåˆ°ã€‚ 1234567public class FirstFragment extends Fragment &#123; @Override public View onCreateView (LayoutInflater inflater, ViewGroup container, Bundle saveInstanceState)&#123; View view = inflater.inflate(R.layout.fragment_firest,container,false); return view; &#125;&#125; ä¸Žæ­¤å¯¹åº”çš„fragmentfirestå¸ƒå±€æ–‡ä»¶ LinearLayoutåŠ ä¸€ä¸ªButtonï¼ŒèƒŒæ™¯é¢œè‰²è®¾ç½®ä¸ºäº†é›è“è‰²ã€‚ onCreateView()æ–¹æ³• ViewGroupæ¥è‡ªå®¿ä¸»Activityå®¹å™¨å¸ƒå±€ï¼ŒFragmentçš„å¸ƒå±€å°†å…¶ä½œä¸ºæ ¹è§†å›¾æ’å…¥è‡³è¯¥è§†å›¾ä¸­ã€‚ Bundleç”¨äºŽå›žä¼ ä¹‹å‰å æ®è¯¥ä½ç½®çš„Fragmentå®žä¾‹æ‰€ä¿å­˜çš„Bundleä¿¡æ¯ï¼Œå½“è¯¥Fragmentçš„æ–°å®žä¾‹å¤„äºŽresumeçŠ¶æ€æ—¶ï¼Œè¯¥å‚æ•°è¢«å›žä¼  inflate() æ–¹æ³• å‚æ•°1ï¼ˆintï¼‰ï¼šéœ€è¦ç»‘å®šçš„Layoutçš„èµ„æºIDï¼› å‚æ•°2ï¼ˆViewGroupï¼‰ï¼šç»‘å®šçš„Layoutå¸ƒå±€çš„çˆ¶è§†å›¾ï¼› å‚æ•°3ï¼ˆbooleanï¼‰ï¼šæ˜¯å¦éœ€è¦å°†å‚æ•°1çš„Layoutèµ„æºä¾é™„äºŽï¼Œå‚æ•°2çš„ViewGroupä¸Šï¼Œfalseï¼Œè¡¨ç¤ºä¸ä¾é™„ã€‚ï¼ˆç³»ç»Ÿå·²ç»é»˜è®¤å°†Layoutæ’å…¥è‡³ViewGroupä¸­ï¼Œè‹¥ä¸ºtrueï¼Œå°†æ·»åŠ ä¸€å±‚å†—ä½™çš„è§†å›¾ åœ¨XMLå°†fragmentæ·»åŠ åˆ°activity åœ¨activity_main.xmlä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ã€‚è·Ÿæ·»åŠ ä¸€ä¸ªlayoutæ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚ 123456&lt;fragment android:id="@+id/left_fragment" android:name="ljy.com.fragmenttest.fragment_firest" android:layout_width="0dp" android:layout_height="match_parent" android:layout_weight="1"/&gt; è‡³æ­¤ä¸€ä¸ªfragmentæ·»åŠ å®Œæ¯•ã€‚ä¸ºäº†å¯¹æ¯”ï¼Œå†æ–°å»ºä¸€ä¸ªsecond_fragmentï¼ŒèƒŒæ™¯é¢œè‰²ä¸åŒï¼Œä¸¤è€…åŒæ—¶æ·»åŠ è¿›activity_mainä¸­ã€‚ ä¸€èˆ¬æ¥è¯´å¿…é¡»ä¸ºfragmentè®¾å®šå”¯ä¸€çš„èº«ä»½æ ‡è¯†ï¼Œä»¥ä¾¿å½“å®¿ä¸»Activityä¸ºrestartçŠ¶æ€æ—¶å¯ä»¥æ¢å¤fragment android:idå±žæ€§ä¸ºfragmentæŒ‡å®šå”¯ä¸€ID android:tagå±žæ€§ä¸ºfragmentæŒ‡å®šå”¯ä¸€å­—ç¬¦ä¸²æ ‡è¯† æœªæŒ‡å®šï¼Œåˆ™è¯¥fragmentçš„æ ‡è¯†ä¸ºå…¶çˆ¶å®¹å™¨æŽ§ä»¶çš„ID åŠ¨æ€æ·»åŠ ç¢Žç‰‡ å¤„ç†ç‰‡æ®µæ—¶ï¼Œè¯·è°¨è®°ï¼šActivity å¸ƒå±€å¿…é¡»åŒ…å«ä¸€ä¸ªå¯ä»¥æ’å…¥ç‰‡æ®µçš„å®¹å™¨ View æ·»åŠ æˆ–ç§»é™¤ç‰‡æ®µå¿…é¡»ä½¿ç”¨ FragmentManager åˆ›å»º FragmentTransactionï¼Œ FragmentTransactionå°†æä¾›æ·»åŠ ã€ç§»é™¤ã€æ›¿æ¢ç‰‡æ®µä»¥åŠæ‰§è¡Œå…¶ä»–ç‰‡æ®µäº‹åŠ¡æ‰€éœ€çš„ APIã€‚Activity å†…è°ƒç”¨ getSupportFragmentManager() ä»¥èŽ·å– FragmentManager 12rightfragment right = new rightfragment();FragmentManager fragmentManager = getSupportFragmentManager(); è°ƒç”¨ beginTransaction() åˆ›å»ºä¸€ä¸ª FragmentTransactionäº‹åŠ¡ï¼Œå¹¶è°ƒç”¨ add() æ·»åŠ ä¸€ä¸ªç‰‡æ®µï¼Œåšå¥½æ›´æ”¹å‡†å¤‡æ—¶ï¼Œè°ƒç”¨ commit() 123FragmentTransaction transaction = fragmentManager.beginTransaction();transaction.replace(R.id.right_layout,right);transaction.commit(); ç¤ºä¾‹ï¼š é¦–å…ˆæ”¹é€ ä¸€ä¸‹activitymain.xmlFrameLayoutåŒ…å«ä¸€ä¸ªleft_fragment 12345678910111213 &lt;FrameLayout android:id="@+id/right_layout" android:layout_width="0dp" android:layout_height="match_parent" android:layout_weight="1"&gt; &lt;fragment android:id="@+id/left_fragment" android:name="com.example.fragment_text.leftfragment" android:layout_width="wrap_content" android:layout_height="wrap_content" /&gt;&lt;/FrameLayout&gt; åœ¨MainActivityçš„onCreateæ–¹æ³•ä¸­æ·»åŠ fragment 12345678910111213//æ–°å»ºå‡†å¤‡æ›¿æ¢çš„Fragmentå®žä¾‹rightfragment right = new rightfragment();//æ–°å»ºFragmentManagerFragmentManager fragmentManager = getSupportFragmentManager();// è°ƒç”¨beginTransaction() åˆ›å»ºFragmentTransactionFragmentTransaction transaction = fragmentManager.beginTransaction();//FragmentTransactionå†…å¤„ç†æ·»åŠ /æ›¿æ¢ç­‰ã€‚transaction.replace(R.id.right_layout,right);//æœ€åŽæ‰§è¡Œcommit()æ–¹æ³•transaction.commit(); ç®¡ç†Fragments/æ‰§è¡ŒFragmentäº‹åŠ¡ Activityä¸­ç®¡ç†Fragmentï¼Œä½¿ç”¨FragmentManager( 1FragmentManager fragmentManager = getFragmentManager(); å¯ä»¥å®žçŽ°çš„æ“ä½œ findFragmentById()æ–¹æ³•èŽ·å–ç”±Activityç®¡è¾–çš„ç»‘å®šäº†UIçš„Fragmentå®žä¾‹ popBackStack()æ–¹æ³•å°†Fragmentä»ŽåŽé€€æ ˆä¸­å¼¹å‡º addOnBackStackChangedListener()æ–¹æ³•æ³¨å†Œç›‘å¬å™¨ï¼Œç”¨äºŽç›‘å¬åŽé€€æ ˆçš„å˜åŒ– Fragmentå¯å®žçŽ°åŠ¨æ€æ·»åŠ ã€åˆ é™¤ã€æ›¿æ¢ ç­‰ æ“ä½œï¼Œæ¯ä¸€ç»„å‘Activityæäº¤çš„å˜åŒ–ç§°ä¸ºäº‹åŠ¡ï¼Œä½¿ç”¨FragmentTransactionè¿™æ“ä½œäº‹åŠ¡,è°ƒç”¨beginTransaction(ï¼‰å¼€å¯ä¸€ä¸ªäº‹åŠ¡ 12FragmentManager fragmentManager = getFragmentManager();FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction(); å¯å®žçŽ°å¯¹Feagmentçš„æ“ä½œ add() //æ·»åŠ  remove() //ç§»é™¤ replace() //æ›¿æ¢ äº‹åŠ¡è¦åœ¨Activityä¸­ç”Ÿæ•ˆï¼Œè°ƒç”¨commit()æ–¹æ³•æäº¤ commit()æ–¹æ³•ä¹‹å‰ï¼Œè°ƒç”¨addToBackStack()æ–¹æ³•ï¼Œå¯ä»¥å°†è¯¥äº‹ç‰©æ·»åŠ åˆ°ç”±Activityç®¡è¾–çš„Fragmentè¿”å›žæ ˆä¸­ã€‚ç‚¹å‡»Backé”®å³æ’¤é”€è¯¥äº‹ç‰©æäº¤çš„æ›´æ”¹ ä½¿ç”¨FragmentTransactionæ“ä½œäº‹åŠ¡æ—¶æ³¨æ„ commit()å¿…é¡»åœ¨æœ€åŽè°ƒç”¨ ä¸€ä¸ªå¸ƒå±€å®¹å™¨ä¸­æ·»åŠ å¤šä¸ªFragmentï¼ŒåŠ å…¥çš„é¡ºåºå†³å®šäº†è¿™äº›Fragmentç»‘å®šçš„UIè§†å›¾åœ¨Viewæ ‘ä¸­çš„å±‚çº§é¡ºåº commit()æ–¹æ³•æäº¤åŽï¼Œå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œäº‹åŠ¡ï¼ŒUIæ›´æ–°åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œï¼Œä¸»çº¿ç¨‹ç©ºé—²æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œAndroidä¹Ÿæä¾›äº† åœ¨UIçº¿ç¨‹ä¸­è°ƒç”¨executePendingTransactions()æ–¹æ³•ï¼Œä½¿commit()æ–¹æ³•è°ƒç”¨åŽç«‹å³æ‰§è¡Œæäº¤çš„äº‹åŠ¡ï¼ˆä¸€èˆ¬ç”¨ä¸åˆ°ï¼‰ ä¸Ž Activity é€šä¿¡ Fragment ä¸­èŽ·å– Activity å®žä¾‹ getActivity()æ–¹æ³•å¯ä»¥èŽ·å–åˆ° Activity å®žä¾‹ 1MainActivity activity = (MainActivity) getActivity(); è°ƒç”¨Activityä¸­çš„è¯•å›¾ä¹Ÿå¾ˆç®€å•ï¼Œä½¿ç”¨findViewById()å³å¯ï¼ŒgetActivity()æ–¹æ³•è¿”å›žçš„æ—¢æ˜¯ä¸€ä¸ªContextå¯¹è±¡ 1View listView = getActivity().findViewById(R.id.list); åœ¨Fragmentä¸­ä½¿ç”¨Contextå¯¹è±¡ï¼ŒgetActivity()æ–¹æ³•ï¼Œåªèƒ½æ˜¯åœ¨fragmentå·²ç»ä¾é™„äºŽActivityåŽæ‰èƒ½è°ƒç”¨ã€‚å½“fragmentæœªä¾é™„äºŽæŸä¸ªActivityã€æˆ–fragmentå·²ç»å¤„äºŽå…¶ç”Ÿå‘½å‘¨æœŸçš„æœ«å°¾è€Œä¸å†ä¾é™„äºŽæŸä¸ªActivityæ—¶ï¼Œè°ƒç”¨getActivity()æ–¹æ³•ä¼šç›´æŽ¥è¿”å›žnull Activity ä¸­èŽ·å– Fragment å®žä¾‹()FragmentMangeræä¾›äº†findFragmentById()æ–¹æ³• 1RightFragment fragment = (RightFragment) getFragmentManager().findFragmentById(R.id.example_fragment); å¦‚æžœä½¿ç”¨çš„ä½¿support-V4åŒ…ï¼Œåˆ™ getFragmentManager()æ”¹ä¸ºgetSupportFragmentManager()ï¼Œä»£ç å¦‚ä¸‹ï¼š 1RightFragment fragment = (RightFragment)getSupportFragmentManager().findFragmentById(R.id.example_fragment); Fragmentä¸ŽFrangmentä¹‹é—´ä¹Ÿå¯ä»¥é€šè¿‡å®¿ä¸»Activityï¼ŒèŽ·å–åˆ°å¦ä¸€ä¸ªFragmentå®žä¾‹ï¼Œè°ƒç”¨å¦ä¸€ä¸ªFragmentä¸­çš„æ–¹æ³• ä¸ºActivityåˆ›å»ºäº‹ä»¶å›žè°ƒ å å‘ï¼Œ Frangmentçš„ç”Ÿå‘½å‘¨æœŸ ä¸ŽActivityæžä¸ºç›¸ä¼¼ï¼Œä¸” Frangmentçš„ç”Ÿå‘½å‘¨æœŸä¸Žå®¿ä¸»Activityæœ‰å¾ˆå¤§å…³è” æœ‰3ç§çŠ¶æ€ Resumedç»§ç»­ï¼šå®¿ä¸»Activityå¤„äºŽrunningï¼ŒFragmentå¤„äºŽå¯è§çŠ¶æ€ Pausedæš‚åœï¼šå¦ä¸€ä¸ªActivityå¤„äºŽå‰å°å¹¶èŽ·å¾—äº†ç„¦ç‚¹ï¼Œè¯¥Fragmentçš„å®¿ä¸»Activityå¹¶æœªè¢«å…¨éƒ¨é®æŒ¡ Stoppedåœæ­¢ï¼šFragmentä¸å¯è§æˆ–Fragmentå·²è¢«Activityç§»é™¤ï¼Œå®¿ä¸»Activityè¢«å›žæ”¶æ—¶ï¼ŒFragmentä¹Ÿå°†è¢«å›žæ”¶ å®¿ä¸»Activityçš„å½±å“ é‡è¦å›žè°ƒæ–¹æ³• onAttach()ï¼šfragmentå…³è”Activityæ—¶å›žè°ƒ onCreateView()ï¼šfragmentç»‘å®šUIè§†å›¾(åŠ è½½å¸ƒå±€)æ—¶å›žè°ƒ onActivityCreated()ï¼šå®¿ä¸»Activityåˆ›å»ºå®Œæ¯• (å®¿ä¸»Activityçš„onCreate()æ–¹æ³•è¿”å›ž) åŽè°ƒç”¨ onDestroyView()ï¼šä¸Žfragmentç»‘å®šçš„UIè§†å›¾è¢«ç§»é™¤æ—¶å›žè°ƒ onDetach()ï¼šfragmentä¸å†ä¾é™„äºŽActivityæ—¶å›žè°ƒ Activity ä¸ŽFragmentåœ¨ç”Ÿå‘½å‘¨æœŸä¹‹é—´çš„æœ€æ˜¾è‘—å·®å¼‚åœ¨äºŽå®ƒä»¬åœ¨å…¶å„è‡ªè¿”å›žæ ˆä¸­çš„å­˜å‚¨æ–¹å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒActivity åœæ­¢æ—¶ä¼šè¢«æ”¾å…¥ç”±ç³»ç»Ÿç®¡ç†çš„ Activity è¿”å›žæ ˆï¼ˆä»¥ä¾¿ç”¨æˆ·é€šè¿‡è¿”å›žæŒ‰é’®å›žé€€åˆ° Activityï¼‰ï¼ŒFramentä»…å½“æ‚¨åœ¨ç§»é™¤ç‰‡æ®µçš„äº‹åŠ¡æ‰§è¡ŒæœŸé—´é€šè¿‡è°ƒç”¨ addToBackStack() è¯·æ±‚ä¿å­˜å®žä¾‹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šå°†Fragmentæ”¾å…¥ç”±å®¿ä¸» Activity ç®¡ç†çš„è¿”å›žæ ˆã€‚ ä¸€æ—¦Activityå¤„äºŽresumeçŠ¶æ€æ—¶ï¼Œå¯ä»¥è‡ªç”±åœ°æ·»åŠ æˆ–ç§»é™¤fragmentï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“Activityçš„çŠ¶æ€ä¸ºresumeæ—¶ï¼Œfragmentæ‰èƒ½å¤Ÿè‡ªç”±åœ°æŽ§åˆ¶è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”UI-RecyclerView]]></title>
    <url>%2F2016%2F12%2F16%2FAndroid%E7%AC%94%E8%AE%B0-UI-RecyclerView%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) RecyclerViewä½¿ç”¨è¯¦è§£â€”å…­å’Œæ•¬ RecyclerViewä½¿ç”¨ä»‹ç»â€” Jin Yudong Android RecyclerView ä½¿ç”¨å®Œå…¨è§£æž ä½“éªŒè‰ºæœ¯èˆ¬çš„æŽ§ä»¶â€”é¸¿æ´‹_ åˆ›å»ºåˆ—è¡¨ä¸Žå¡ç‰‡â€”Android Developer ç¼–ç¨‹çŽ¯å¢ƒ Android Studio 2.2.3 å¯¼è¯­ RecyclerViewå†…å®¹è¾ƒListViewæ›´å¤šï¼ŒåˆæœŸåªèƒ½æ›´æ–°ä¸€äº›åŸºç¡€å†…å®¹ï¼Œé«˜çº§çš„ç”¨æ³•éšæ—¶æ›´æ–°ï¼Œé•¿æœŸè·Ÿè¿› ç®€ä»‹ RecyclerViewæ˜¯ç”¨äºŽå–ä»£ListViewçš„ç»„ä»¶,ç¬¬ä¸€æ¬¡å‡ºçŽ°æ˜¯åœ¨2014å¹´google I/Oå¤§ä¼šï¼Œå†…ç½®åœ¨æ˜¯Android LåŠä»¥ä¸Šç‰ˆæœ¬çš„SDKä¸­ã€‚ å¯¹æ¯”ä¸ŽListViewï¼ŒRecyclerViewå¼¥è¡¥äº†ListViewä¸­çš„æ•ˆçŽ‡é—®é¢˜ï¼ŒåŒæ—¶æ”¯æŒæ›´å¤šçš„æ˜¾ç¤ºæ•ˆæžœï¼Œä»£ç é€»è¾‘æ›´ä¸ºæ¸…æ™° åŸºæœ¬ä½¿ç”¨æ­¥éª¤ RecyclerViewå®šä¹‰åœ¨supportåº“ä¸­ï¼Œä½¿ç”¨RecyclerViewä¹‹å‰å¿…é¡»åœ¨æ·»åŠ ä¾èµ– build.gradleä¸­æ·»åŠ  compile &#39;com.android.support:recyclerview-v7:25.1.0&#39; RecyclerViewé¡¹ç›®ç»“æž„å¦‚ä¸‹ï¼š è¦ä½¿ç”¨RecyclerViewï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªAdapteré€‚é…å™¨å’Œä¸€ä¸ªLayoutManagerå¸ƒå±€ç®¡ç†å™¨ Adapteré€‚é…å™¨ï¼šä½œç”¨ä¸ŽListViewä¸­ä½¿ç”¨çš„Adapterç›¸åŒï¼Œéƒ½æ˜¯å°†æ•°æ®ä¸Žå¯¹åº”itemçš„ç•Œé¢è¿›è¡Œç»‘å®šæ‰€ä¸åŒçš„æ˜¯ï¼šRecyclerViewä¸­é€‚é…å™¨å¿…é¡»ç»§æ‰¿è‡ªRecyclerView.Adapterï¼Œä¸” å¼ºåˆ¶ä½¿ç”¨äº†ViewHolder LayoutManagerå¸ƒå±€ç®¡ç†å™¨ï¼šæ¯ä¸€ä¸ªitemå¦‚ä½•è¿›è¡ŒæŽ’åˆ—ï¼Œä½•æ—¶å±•ç¤ºå’Œéšè—ã€‚é‡ç”¨Viewæ—¶ï¼ŒLayoutManagerä¼šå‘Adapteré€‚é…å™¨è¯·æ±‚æ–°çš„æ•°æ®æ›¿æ¢æ—§çš„æ•°æ®ï¼Œé¿å…äº†Viewçš„å†—ä½™å’Œé¢‘ç¹è°ƒç”¨findViewById LayoutManagerçš„å¼•å…¥ ä½¿å¾—å„ç§å¸ƒå±€æŽ’åˆ—ç¼–å†™ï¼Œå˜çš„æ ¼å¤–å®¹æ˜“ï¼Œè¿™ä¹Ÿæ˜¯RecyclerViewä¼˜äºŽListViewçš„ä¸€ä¸ªåœ°æ–¹ ç›®å‰RecyclerView å†…ç½®3ç§LayoutManagerï¼š LinearLayoutManager æ¨ªå‘/ç«–å‘å¸ƒå±€ GridLayoutManager ç½‘æ ¼å¸ƒå±€ StaggeredGridLayoutManager ç€‘å¸ƒæµå¸ƒå±€ MainActivityä¸­ RecyclerView è®¾ç½® åˆ›å»ºRecyclerViewå¯¹è±¡RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recycle_view); è®¾ç½®LayoutManageræ˜¾ç¤ºè§„åˆ™ è®¾ç½®é€‚é…å™¨recyclerview.setAdapter(adapter); ç®€å•å®žä¾‹ç”±ä¸€ä¸ªç®€å•çš„å®žä¾‹+è¯¦ç»†åˆ†æž æ·»åŠ ä¾èµ–æ‰“å¼€app/build.gradleæ–‡ä»¶ï¼Œåœ¨dependenciesé—­åŒ…ä¸‹æ·»åŠ ä¾èµ–åº“ç‰ˆæœ¬ä¸Žä½ å·¥ç¨‹çš„com.android.support:appcompat-v7:25.1.0ç‰ˆæœ¬å¯¹åº” 1compile 'com.android.support:recyclerview-v7:25.1.0' ä¹‹åŽAndroidStudioä¼šå¼€å§‹åŒæ­¥ æ·»åŠ RecyclerViewåˆ°xmlæ–‡ä»¶,åŸºæœ¬ä¸ŽListViewä¸€è‡´ï¼Œä¸è¿‡RecyclerViewå¹¶éžå†…ç½®åœ¨SDKä¸­ï¼Œè¿™é‡Œéœ€è¦å†™å‡ºå®Œæ•´çš„åŒ…è·¯å¾„ 12345&lt;android.support.v7.widget.RecyclerView android:id="@+id/recycle_view" android:layout_width="match_parent" android:layout_height="match_parent" /&gt; è¦å±•ç¤ºçš„ä¾æ—§æ˜¯æ°´æžœ+å›¾ç‰‡å½¢å¼ï¼Œå›¾ç‰‡èµ„æºåœ¨ç¬¬ä¸€è¡Œä»£ç ç¬¬äºŒç‰ˆæºç  /chapter3/ListViewTest\app\src\main\res\drawable-hdpiä¸‹ï¼ŒåŒæ—¶å°†Fruitç±»å’Œfruititem.xmlä¸€å¹¶å¤åˆ¶ï¼Œè¿™é‡Œç»™å‡ºä¸¤è€…æºç ï¼Œä¸å†åŠ åˆ†æž Fruitç±» 1234567891011121314151617public class Fruit &#123;private String name;private int imageId;public Fruit(String name, int imageId) &#123; this.name = name; this.imageId = imageId; &#125;public String getName() &#123; return name; &#125;public int getImageId() &#123; return imageId; &#125;&#125; fruititem.xml 123456789101112131415161718&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"android:orientation="horizontal"android:layout_width="match_parent"android:layout_height="match_parent"&gt;&lt;ImageView android:id="@+id/fruit_image" android:layout_width="wrap_content" android:layout_height="wrap_content" /&gt;&lt;TextView android:id="@+id/fruit_name" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="center_vertical" android:layout_marginLeft="10dp" /&gt;&lt;/LinearLayout&gt; å‡†å¤‡RecyclerViewé€‚é…å™¨ï¼Œé€‚é…å™¨éœ€è¦ç»§æ‰¿è‡ª RecyclerView.Adapterï¼Œå°†æ³›åž‹æŒ‡å®šä¸º .ViewHolderï¼Œ(ViewHolderä¸ºåœ¨é€‚é…å™¨çš„ä¸€ä¸ªå†…éƒ¨ç±»)ï¼Œå¹¶é‡å†™3ä¸ªæ–¹æ³• 123public ViewHolder onCreateViewHolder(ViewGroup parent,int viewType)//åˆ›å»ºè¿”å›žViewHolderå®žä¾‹public void onBindViewHolder(ViewHolder holder,int pisition)//æ•°æ®ä¸Žç•Œé¢ç»‘å®špublic int getItemCount() // è¿”å›žæ•°æ®çš„æ•°é‡ æ–°å»º FruitAdapter ç»§æ‰¿è‡ª RecyclerView.Adapter 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849 //ç»§æ‰¿è‡ªRecyclerView.Adapterï¼Œæ³›åž‹ä¸º FruitAdapter .ViewHolder public class FruitAdapter extends RecyclerView.Adapter&lt;FruitAdapter.ViewHolder&gt; &#123; //ç§æœ‰Fruitåˆ—è¡¨ private List&lt;Fruit&gt; mFruitList;//æ–°å»ºå†…éƒ¨ç±»ViewHolderç»§æ‰¿è‡ªRecyclerView.ViewHoldeæœ‰æ¯ä¸ªItemçš„çš„æ‰€æœ‰ç•Œé¢å…ƒç´  static class ViewHolder extends RecyclerView.ViewHolder&#123; ImageView fruitImage; TextView fruitName; //ViewHolderæž„é€ å‡½æ•°ï¼Œä¼ å…¥Viewï¼Œé€šå¸¸ä¸ºRecyclerViewå­é¡¹çš„å¤–å±‚å¸ƒå±€(æœ¬ä¾‹ä¸ºfruit_item.xml) public ViewHolder(View view)&#123; super(view); //findViewByIdèŽ·å– Image/Nameå®žä¾‹ fruitImage = (ImageView)view.findViewById(R.id.fruit_image); fruitName = (TextView)view.findViewById(R.id.fruit_name); &#125; &#125;//FruitAdapteræž„é€ å‡½æ•°ï¼Œå°†æ•°æ®æºä¼ å…¥å…¨å±€å˜é‡mFruitList public FruitAdapter(List&lt;Fruit&gt;fruitList)&#123; mFruitList = fruitList; &#125; @Override //åˆ›å»ºViewHolderå®žä¾‹ public ViewHolder onCreateViewHolder(ViewGroup parent,int viewType)&#123; //åŠ è½½å¸ƒå±€æ–‡ä»¶ View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.fruit_item,parent,false); //è°ƒç”¨ViewHolderæž„é€ å‡½æ•° ViewHolder holder = new ViewHolder(view); //è¿”å›žViewHolderå®žä¾‹ return holder; &#125; @Override //å¯¹ RecyclerViewå­é¡¹è¿›è¡Œèµ‹å€¼ï¼Œæœ‰æ–°çš„å­é¡¹è¿›å…¥å±å¹•æ˜¾ç¤ºèŒƒå›´æ—¶è°ƒç”¨ public void onBindViewHolder(ViewHolder holder,int pisition)&#123; Fruit fruit = mFruitList.get(pisition); holder.fruitImage.setImageResource(fruit.getImageId()); holder.fruitName.setText(fruit.getName()); &#125; @Override //è¿”å›ž RecyclerViewå­é¡¹æ•°é‡ public int getItemCount()&#123; return mFruitList.size(); &#125; &#125; MainActivityä¸­ä½¿ç”¨RecyclerView åˆ›å»ºRecyclerViewå¯¹è±¡ è®¾ç½®LayoutManageræ˜¾ç¤ºè§„åˆ™ï¼ˆé»˜è®¤ç«–å‘æ»šåŠ¨ï¼‰ è®¾ç½®é€‚é…å™¨ ä»£ç å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950 public class MainActivity extends AppCompatActivity &#123;//ç§æœ‰åˆ—è¡¨ private List&lt;Fruit&gt; fruitList = new ArrayList&lt;Fruit&gt;(); @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); //åˆå§‹åŒ–Fruitsæ•°æ® initFruits(); //èŽ·å–RecyclerViewå®žä¾‹ RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recycle_view); //åˆ›å»ºLinearLayoutManagerï¼Œå¹¶è®¾ç½®å…¥recyclerView LinearLayoutManager layoutManager = new LinearLayoutManager(this); recyclerView.setLayoutManager(layoutManager); //æ–°å»ºé€‚é…å™¨ï¼Œå¹¶ä¼ å…¥ FruitAdapter adapter = new FruitAdapter(fruitList); recyclerView.setAdapter(adapter); &#125; //åˆå§‹åŒ–Fruitsç±» private void initFruits() &#123; //å¾ªçŽ¯ä¸¤é æ€•å ä¸æ»¡å±å¹• for (int i = 0; i &lt; 2; i++) &#123; Fruit apple = new Fruit("Apple", R.drawable.apple_pic); fruitList.add(apple); Fruit banana = new Fruit("Banana", R.drawable.banana_pic); fruitList.add(banana); Fruit orange = new Fruit("Orange", R.drawable.orange_pic); fruitList.add(orange); Fruit watermelon = new Fruit("Watermelon", R.drawable.watermelon_pic); fruitList.add(watermelon); Fruit pear = new Fruit("Pear", R.drawable.pear_pic); fruitList.add(pear); Fruit grape = new Fruit("Grape", R.drawable.grape_pic); fruitList.add(grape); Fruit pineapple = new Fruit("Pineapple", R.drawable.pineapple_pic); fruitList.add(pineapple); Fruit strawberry = new Fruit("Strawberry", R.drawable.strawberry_pic); fruitList.add(strawberry); Fruit cherry = new Fruit("Cherry", R.drawable.cherry_pic); fruitList.add(cherry); Fruit mango = new Fruit("Mango", R.drawable.mango_pic); fruitList.add(mango); &#125; &#125; &#125; è¿™æ ·æœ€ç®€å•çš„ RecyclerView å°±æ­å»ºå®Œäº†æ•ˆæžœå¦‚ä¸‹ ä»£ç æ¯”ListViewç¨å¤šï¼Œä½†æ˜¯é€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚ æ¨ªå‘/ç€‘å¸ƒæµ/ç½‘æ ¼å¸ƒå±€ åªéœ€è¦è®¾ç½®ç›¸åº”LayoutManagerå³å¯ /æ‰‹åŠ¨æ»‘ç¨½ æ¨ªå‘ åœ¨ LinearLayoutManager ä¸­ä¿®æ”¹å‡ è¡Œä»£ç å³å¯ ä¿®æ”¹ LinearLayoutManager ä»£ç ï¼Œæ·»åŠ ä¸€è¡Œï¼Œæžå®šï¼ 1layoutManager.setOrientation(LinearLayoutManager.HORIZONTAL); å½“ç„¶éœ€è¦ç®€å•ä¿®æ”¹ä¸€ä¸‹itemçš„å¸ƒå±€æ–‡ä»¶ï¼ŒLinearLayoutæ”¹ä¸ºåž‚ç›´æŽ’åˆ—ï¼Œå®½åº¦å›ºå®š100dpï¼Œå›¾ç‰‡/æ–‡å­—å±…ä¸­æ•ˆæžœå¦‚ä¸‹ ç€‘å¸ƒæµ è¿™éœ€è¦ StaggeredGridLayoutManager å¸ƒå±€ç®¡ç†å™¨ï¼Œå¯ä»¥ ç«–å‘/æ¨ªå‘ æ»šåŠ¨ ä»£ç å¦‚ä¸‹12//ç€‘å¸ƒæµå¸ƒå±€ï¼Œ3è¡Œï¼Œç«–å‘StaggeredGridLayoutManager layoutManager = new StaggeredGridLayoutManager(3, StaggeredGridLayoutManager.VERTICAL); è°ƒæ•´å¸ƒå±€æ–‡ä»¶ï¼Œæ•ˆæžœå¦‚ä¸‹ ç½‘æ ¼ è¿™éœ€è¦ GridLayoutManager å¸ƒå±€ç®¡ç†å™¨ ä»£ç å¦‚ä¸‹ 12//ç½‘æ ¼å¸ƒå±€ï¼Œä¸¤è¡ŒGridLayoutManager layoutManager = new GridLayoutManager(this,3); è°ƒæ•´å¸ƒå±€æ–‡ä»¶åŽï¼Œæ•ˆæžœå¦‚ä¸‹ æ³¨å†Œç‚¹å‡»äº‹ä»¶ RecyclerView ä¸­å¹¶æ²¡æœ‰æä¾›æ³¨å†Œç›‘å¬å™¨çš„æ–¹æ³•ï¼Œéœ€è¦å­é¡¹Viewè‡ªè¡Œæ³¨å†Œ éƒ¨åˆ†ä»£ç å¦‚ä¸‹1234567891011121314151617181920212223242526272829303132333435 static class ViewHolder extends RecyclerView.ViewHolder &#123; View fruitView; ImageView fruitImage; TextView fruitName; public ViewHolder(View view) &#123; super(view); fruitView = view; fruitImage = (ImageView) view.findViewById(R.id.fruit_image); fruitName = (TextView) view.findViewById(R.id.fruit_name); &#125;&#125; @Overridepublic ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123; View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.fruit_item, parent, false); final ViewHolder holder = new ViewHolder(view); holder.fruitView.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; int position = holder.getAdapterPosition(); Fruit fruit = mFruitList.get(position); Toast.makeText(v.getContext(), "you clicked view " + fruit.getName(), Toast.LENGTH_SHORT).show(); &#125; &#125;); holder.fruitImage.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View v) &#123; int position = holder.getAdapterPosition(); Fruit fruit = mFruitList.get(position); Toast.makeText(v.getContext(), "you clicked image " + fruit.getName(), Toast.LENGTH_SHORT).show(); &#125; &#125;); return holder;&#125;]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°-UI-ListView]]></title>
    <url>%2F2016%2F12%2F13%2FAndroid%E7%AC%94%E8%AE%B0-UI-ListView%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) ListView Android ListViewå·¥ä½œåŽŸç†å®Œå…¨è§£æžï¼Œå¸¦ä½ ä»Žæºç çš„è§’åº¦å½»åº•ç†è§£ ListViewæ˜¯æ‰€æœ‰åŽŸç”ŸæŽ§ä»¶ä¸­ä½¿ç”¨é¢‘çŽ‡æœ€é«˜å’Œæœ€å¤æ‚çš„ï¼Œæ¶‰åŠçŸ¥è¯†ç‚¹ä¹Ÿè¾ƒå¤šï¼Œä¸“é—¨æŠ½å‡ºä¸€ç¯‡æ¥è®°å½•ï¼Œæ¶‰åŠä¸€äº›è¿‡ç¨‹åˆ†æžï¼Œå¸Œæœ›è‡ªå·±èƒ½å†™å®Œ ListViewçš„ç®€å•ä½¿ç”¨ å…ˆæ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªç®€å•çš„å®žä¾‹ä»£ç å¦‚ä¸‹ åœ¨activity_main.xmlä¸­æ·»åŠ _ListView 12345&lt;ListView android:id="@+id/list_view" android:layout_width="match_parent" android:layout_height="match_parent"&gt;&lt;/ListView&gt; ä¿®æ”¹MainActivityçš„ä»£ç  123456789101112131415161718 //è¦æ˜¾ç¤ºçš„æ•°ç»„ï¼Œå±å¹•é•¿äº†ç‚¹ï¼Œä¸ºäº†æ˜¾ç¤ºæ»‘åŠ¨æ•ˆæžœå¤šå¢žåŠ äº†å‡ é¡¹ã€‚ private String[] data = &#123;"apple","banana","orange","watermelon","pear","grape","pineapple","strawberry","cherry","mango","A","B","C","D","E","F"&#125;; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar); setSupportActionBar(toolbar);//ä¸ºé€‚é…å™¨ç»‘å®šæ•°æ® ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(MainActivity.this,android.R.layout.simple_list_item_single_choice,data);//å¾—åˆ°ListViewå¯¹è±¡çš„å¼•ç”¨ListView listView = (ListView) findViewById(R.id.list_view);//é€‚é…å™¨å†…å®¹ä¼ é€’listView.setAdapter(adapter); &#125;); &#125; æ•ˆæžœå¦‚å›¾ æ­¥éª¤å…¶å®žæ¯”è¾ƒç®€å• å‡†å¤‡è¦æ˜¾ç¤ºçš„æ•°æ® â€”â€”String[] dataæ•°ç»„ æž„å»ºé€‚é…å™¨ â€”â€”ArrayAdapter adapter å°†é€‚é…å™¨æ·»åŠ åˆ°ListView â€”â€”listView.setAdapter(adapter); è¯¦è§£ ListViewé¦–å…ˆæ˜¯ç”¨æ¥å±•çŽ°å¤§é‡æ•°æ®çš„ï¼Œæ•°æ®æºçš„æ¥æºå¯ä»¥æ˜¯ç½‘ç»œä¸‹è½½ï¼Œç¨‹åºå†…ç½®ã€æ•°æ®åº“æå–ç­‰ï¼Œæœ¬ä¾‹ä¸­åˆ™æ˜¯ç®€å•çš„å®šä¹‰äº†ä¸€ä¸ªStringç±»åž‹ dataæ•°ç»„ã€‚æ•°æ®æºçš„ç±»åž‹/ç§ç±»ç¹å¤šï¼Œä½¿å¾—ListViewæ— æ³•ç›´æŽ¥é€‚é…æ•°æ®æºï¼Œç›´æŽ¥é€‚é…æ•°æ®æºå°†å¯¼è‡´ä»£ç çš„è‡ƒè‚¿å’Œæ•ˆçŽ‡çš„ä½Žä¸‹ã€‚ListViewä¸Žæ•°æ®æºä¹‹é—´éœ€è¦ä¸€ä¸ªè¿‡åº¦ é€‚é…å™¨ï¼šAdapterï¼ŒAdapteråœ¨ListViewå’Œæ•°æ®æºä¹‹é—´èµ·åˆ°äº†ä¸€ä¸ªæ¡¥æ¢çš„ä½œç”¨ã€‚æ­£æ˜¯Adapterçš„ä½¿ç”¨ListViewçš„ä½¿ç”¨å˜å¾—è¦æ¯”å…¶å®ƒæŽ§ä»¶å¤æ‚å¾—å¤šã€‚ Adapteré€‚é…å™¨ Adapteré€‚é…å™¨åœ¨ListViewå’Œæ•°æ®æºä¹‹é—´èµ·åˆ°äº†ä¸€ä¸ªæ¡¥æ¢çš„ä½œç”¨Adapterçš„æŽ¥å£éƒ½æ˜¯ç»Ÿä¸€çš„ï¼Œå› æ­¤ListViewä¸ç”¨æ‹…å¿ƒä»»ä½•é€‚é…æ–¹é¢çš„é—®é¢˜ã€‚ Adapteråˆæ˜¯ä¸€ä¸ªæŽ¥å£(interface)ï¼Œå®ƒå¯ä»¥åŽ»å®žçŽ°å„ç§å„æ ·çš„å­ç±»ï¼Œæ¯ä¸ªå­ç±»éƒ½èƒ½é€šè¿‡è‡ªå·±çš„é€»è¾‘æ¥åŽ»å®Œæˆç‰¹å®šçš„åŠŸèƒ½ï¼Œä»¥åŠä¸Žç‰¹å®šæ•°æ®æºçš„é€‚é…æ“ä½œï¼Œæ¯”å¦‚è¯´ArrayAdapterå¯ä»¥ç”¨äºŽæ•°ç»„å’ŒListç±»åž‹çš„æ•°æ®æºé€‚é…ï¼ŒSimpleCursorAdapterå¯ä»¥ç”¨äºŽæ¸¸æ ‡ç±»åž‹çš„æ•°æ®æºé€‚é… è¿™æ ·å°±è§£å†³äº†æ•°æ®æºé€‚é…çš„éš¾é¢˜ï¼Œå¹¶ä¸”è¿˜æ‹¥æœ‰ç›¸å½“ä¸é”™çš„æ‰©å±•æ€§ ç®€æ˜“çš„ç¤ºå›¾(æ¥è‡ª éƒ­éœ–çš„åšå®¢) å¸¸ç”¨Adapter ArrayAdapterâ€”â€”ç”¨æ¥ç»‘å®šä¸€ä¸ªæ•°ç»„ï¼Œæ”¯æŒæ³›åž‹æ“ä½œ SimpleAdapterâ€”â€”ç”¨æ¥ç»‘å®šåœ¨xmlä¸­å®šä¹‰çš„æŽ§ä»¶å¯¹åº”çš„æ•°æ® SimpleCursorAdapterâ€”â€”ç”¨æ¥ç»‘å®šæ¸¸æ ‡å¾—åˆ°çš„æ•°æ® BaseAdapterâ€”â€”é€šç”¨çš„åŸºç¡€é€‚é…å™¨ å®žä¾‹ä¸­ä½¿ç”¨çš„æ˜¯ArrayAdapterï¼ŒArrayAdapterå…·æœ‰å¤šä¸ªæž„é€ å‡½æ•°é‡è½½ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯å­—ç¬¦ä¸²ç±»åž‹ï¼Œ ArrayAdapterçš„æž„é€ å‡½æ•° å½“å‰ä¸Šä¸‹æ–‡ ListViewå­é¡¹çš„idï¼Œæœ¬ä¾‹ä¸­ä½¿ç”¨çš„æ˜¯android.R.layout.simple_list_item è¿™æ˜¯Androidå†…ç½®çš„ä¸€ä¸ªå¸ƒå±€æ–‡ä»¶ éœ€è¦é€‚é…çš„æ•°æ®ä¹‹åŽé€‚é…å™¨å°±æž„å»ºå®Œæˆï¼Œæœ€åŽä¼ é€’è¿›LIstViewä¸­å³å¯ è‡ªå®šä¹‰é€‚é…å™¨ ä»Žç¬¬ä¸€è¡Œä»£ç ç¬¬äºŒç‰ˆçš„æºç LiseViewTestç›®å½•ä¸‹æ‹·è´drawblehdpi åˆ°ä½ çš„å·¥ç¨‹ä¸‹ æ–°å»ºFruitç±» 123456789101112131415161718public class Fruit &#123; private String name; private int imageId; //æž„é€ å‡½æ•° æ°´æžœåç§°/æ°´æžœå¯¹åº”å›¾ç‰‡èµ„æºID public Fruit(String name, int imageId) &#123; this.name = name; this.imageId = imageId; &#125; public String getName() &#123; return name; &#125; public int getImageId() &#123; return imageId; &#125;&#125; åœ¨layoutç›®å½•ä¸‹æ–°å»ºfruititem.xml 123456789101112131415161718&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:orientation="horizontal" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;ImageView android:id="@+id/fruit_image" android:layout_width="wrap_content" android:layout_height="wrap_content" /&gt; &lt;TextView android:id="@+id/fruit_name" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="center_vertical" android:layout_marginLeft="10dp" /&gt;&lt;/LinearLayout&gt; ä¸€ä¸ªImageViewå’ŒTextView ï¼Œæ°´å¹³å±…ä¸­æ˜¾ç¤º è‡ªå®šä¹‰é€‚é…å™¨ç»§æ‰¿è‡ªArrayAdapter æ³›åž‹æŒ‡å®šä¸ºfruitç±» 12345678910111213141516171819202122 //ç»§æ‰¿è‡ªArrayAdapter public class FruitAdapter extends ArrayAdapter&lt;Fruit&gt; &#123; private int resourceId;//æž„é€ å‡½æ•° /ä¸Šä¸‹æ–‡ ListViewå­é¡¹å¸ƒå±€id æ•°æ® public FruitAdapter(Context context, int textViewResourceId, List&lt;Fruit&gt; objects) &#123; super(context, textViewResourceId, objects); resourceId = textViewResourceId; &#125; @Override //å½“å‰å­å…ƒç´ çš„çš„ä½ç½®ï¼Œ public View getView(int position, View convertView, ViewGroup parent)&#123; Fruit fruit = getItem(position); // èŽ·å–å½“å‰é¡¹çš„Fruitå®žä¾‹ View view = LayoutInflater.from(getContext()).inflate(resourceId,parent,false); ImageView fruitImage = (ImageView)view.findViewById(R.id.fruit_image); TextView fruitName = (TextView)view.findViewById(R.id.fruit_name); fruitImage.setImageResource(fruit.getImageId()); fruitName.setText(fruit.getName()); return view; &#125; &#125; getView()æ–¹æ³•æŽ¥å—çš„ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°positionä»£è¡¨å½“å‰å­å…ƒç´ çš„çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…·ä½“çš„ä½ç½®æ¥èŽ·å–ä¸Žå…¶ç›¸å…³çš„æ•°æ®ã€‚ç¬¬äºŒä¸ªå‚æ•°convertView LayoutInflater.inflate()æ–¹æ³•æ¥åŽ»åŠ è½½å¸ƒå±€ã€‚æŽ¥æ”¶3ä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºfalseè¡¨ç¤ºåªåœ¨çˆ¶å¸ƒå±€å£°æ˜Žçš„layoutå±žæ€§æœ‰æ•ˆï¼Œä½†ä¸ä¼šä¸ºè¿™ä¸ªviewæ·»åŠ çˆ¶å¸ƒå±€ï¼Œæœ€åŽè®¾å®šä¸ºæŽ¥ä¸‹æ¥ä¼šå¯¹è¿™ä¸ªviewè¿›è¡Œä¸€äº›å±žæ€§å’Œå€¼çš„è®¾å®šï¼Œæœ€åŽå°†viewè¿”å›žã€‚ ä¿®æ”¹MainActivityçš„ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class MainActivity extends AppCompatActivity &#123; //æ–°å»ºFruitç±»çš„æ•°ç»„ private List&lt;Fruit&gt; fruitList = new ArrayList&lt;Fruit&gt;(); @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main);// åˆå§‹åŒ–æ°´æžœæ•°æ® initFruits(); //è®¾ç½®FruitAdapteré€‚é…å™¨ FruitAdapter adapter = new FruitAdapter(MainActivity.this, R.layout.fruit_item, fruitList); //å¾—åˆ°ListViewçš„å¼•ç”¨ ListView listView = (ListView) findViewById(R.id.list_view); listView.setAdapter(adapter); &#125; // åˆå§‹åŒ–æ°´æžœæ•°æ® private void initFruits() &#123; //å¡«å……ä¸¤éï¼Œå æ»¡å±å¹• for (int i = 0; i &lt; 2; i++) &#123; Fruit apple = new Fruit("Apple", R.drawable.apple_pic); fruitList.add(apple); Fruit banana = new Fruit("Banana", R.drawable.banana_pic); fruitList.add(banana); Fruit orange = new Fruit("Orange", R.drawable.orange_pic); fruitList.add(orange); Fruit watermelon = new Fruit("Watermelon", R.drawable.watermelon_pic); fruitList.add(watermelon); Fruit pear = new Fruit("Pear", R.drawable.pear_pic); fruitList.add(pear); Fruit grape = new Fruit("Grape", R.drawable.grape_pic); fruitList.add(grape); Fruit pineapple = new Fruit("Pineapple", R.drawable.pineapple_pic); fruitList.add(pineapple); Fruit strawberry = new Fruit("Strawberry", R.drawable.strawberry_pic); fruitList.add(strawberry); Fruit cherry = new Fruit("Cherry", R.drawable.cherry_pic); fruitList.add(cherry); Fruit mango = new Fruit("Mango", R.drawable.mango_pic); fruitList.add(mango); &#125; &#125;&#125; åªéœ€è¦ä¿®æ”¹fruititem.xmlï¼Œå³å¯å®šåˆ¶ç•Œé¢ æå‡ListViewçš„æ•ˆçŽ‡convertViewå‚æ•° é’ˆå¯¹ Fruit fruit = getItem(position); // èŽ·å–å½“å‰é¡¹çš„Fruitå®žä¾‹æ¯æ¬¡æ»‘åŠ¨ListViewæ—¶ï¼ŒgetView()æ–¹æ³•éƒ½ä¼šå°†å¸ƒå±€éƒ½ä¼šé‡æ–°åŠ è½½ä¸€è¾¹ convertViewå‚æ•°ï¼šå°†ä¹‹å‰åŠ è½½å®Œæˆçš„å¸ƒå±€è¿›è¡Œç¼“å­˜ã€‚ å€ŸåŠ©convertViewå‚æ•°ï¼Œåœ¨æ¯æ¬¡åŠ è½½Viewä¹‹å‰æŸ¥è¯¢convertViewæ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™é‡æ–°åŠ è½½ï¼Œä¸ä¸ºç©ºåˆ™ä»ŽconvertViewä¸­å– ä»£ç éƒ¨åˆ†å¦‚ä¸‹ 12345678View view;Fruit fruit = getItem(position); // èŽ·å–å½“å‰é¡¹çš„Fruitå®žä¾‹ if (convertView == null) &#123; view = LayoutInflater.from(getContext()).inflate(resourceId,parent,false); &#125;else &#123; view = convertView; &#125; ListViewä¸ä¼šå†é‡å¤åŠ è½½å¸ƒå±€äº† ViewHolder ViewHolderä¸æ˜¯Androidçš„å¼€å‘APIï¼Œè€Œæ˜¯ä¸€ç§è®¾è®¡æ–¹æ³• é’ˆå¯¹ImageView fruitImage = (ImageView)view.findViewById(R.id.fruit_image); TextView fruitName = (TextView)view.findViewById(R.id.fruit_name);æ¯æ¬¡å¸ƒå±€å®žä¾‹åŒ–åŽï¼ŒfindViewByIdéƒ½ä¼šé‡æ–°æ‰§è¡ŒèŽ·å–æŽ§ä»¶å®žä¾‹ æ–°å¢žå†…éƒ¨ç±» ViewHolderï¼Œåˆ©ç”¨Tagé™„åŠ åˆ°å¯¹åº”Viewä¸­ï¼Œå³æ¯æ¬¡åŠ è½½å¸ƒå±€æ—¶ï¼Œå¯¹åº”çš„ èŽ·å–æŽ§ä»¶å®žä¾‹çš„æ“ä½œä¹Ÿä¸€å¹¶æ‰§è¡Œï¼Œå¹¶å‚¨å­˜åœ¨Viewä¸­ã€‚è¿™æ · èŽ·å–æŽ§ä»¶å®žä¾‹çš„æ“ä½œç›´æŽ¥ç¼“å­˜åœ¨Viewä¸­ï¼Œä¸ä¼šå†é‡å¤æ‰§è¡Œ ä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728 @Override public View getView(int position, View convertView, ViewGroup parent) &#123; Fruit fruit = getItem(position); // èŽ·å–å½“å‰é¡¹çš„Fruitå®žä¾‹ View view; ViewHolder viewHolder; if (convertView == null) &#123; //åŠ è½½å¸ƒå±€ view = LayoutInflater.from(getContext()).inflate(resourceId, parent, false); viewHolder = new ViewHolder(); viewHolder.fruitImage = (ImageView) view.findViewById (R.id.fruit_image); viewHolder.fruitName = (TextView) view.findViewById (R.id.fruit_name); view.setTag(viewHolder); // å°†ViewHolderå­˜å‚¨åœ¨Viewä¸­ &#125; else &#123; view = convertView; viewHolder = (ViewHolder) view.getTag(); // é‡æ–°èŽ·å–ViewHolder &#125; viewHolder.fruitImage.setImageResource(fruit.getImageId()); viewHolder.fruitName.setText(fruit.getName()); return view; &#125;//ViewHolder å†…éƒ¨ç±» class ViewHolder &#123; ImageView fruitImage; TextView fruitName; &#125; ListViewä¸­çš„ç‚¹å‡»äº‹ä»¶ æ¯”è¾ƒç®€å•,å†MainActivtyçš„onCreateæ–¹æ³•ä¸­æ·»åŠ  ä»£ç å¦‚ä¸‹ 123456listView.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123; @Override public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123; Fruit fruit = fruitList.get(position); Toast.makeText(MainActivity.this, fruit.getName(), Toast.LENGTH_SHORT).show(); setOnItemClickListenerä¸ºListViewæ³¨å†Œäº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œç‚¹å‡»å‘ç”Ÿæ—¶å›žæŽ‰ onItemClick()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡positionå‚æ•°åˆ¤æ–­å…·ä½“å­é¡¹ã€‚è¯¥å¤„æ˜¯æ‰§è¡ŒToast]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”UI(ä¸€)]]></title>
    <url>%2F2016%2F12%2F09%2FAndroid%E7%AC%94%E8%AE%B0-UI(%E4%B8%80)%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) å¸¸ç”¨æŽ§ä»¶TextView TextView æ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯ 12345678&lt;TextView android:id=&quot;@+id/text_view&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;wrap_content&quot; android:gravity=&quot;center&quot; android:textSize=&quot;24sp&quot; android:textColor=&quot;#00ff00&quot; android:text=&quot;This is TextView&quot; /&gt; æ•ˆæžœå¦‚ä¸‹ å¸¸ç”¨å±žæ€§è¯¦è§£ android:id æŒ‡å®šå½“å‰æŽ§ä»¶å”¯ä¸€æ ‡è¯†ç¬¦ android:layout_width android:layout_heightæŒ‡å®šæŽ§ä»¶çš„å®½åº¦å’Œé«˜åº¦ï¼Œå–å€¼æœ‰ match_parent åŒ¹é…çˆ¶å¸ƒå±€ wrap_contentè‡ªé€‚åº”å†…å®¹ fill_parentä¸Žmatch_parent ç›¸åŒ android:gravity æ–‡å­—å¯¹é½æ–¹å¼ï¼Œå¯å–å€¼ top bottom left right center å¯ä»¥ä½¿ç”¨ | åŒæ—¶ä½¿ç”¨å¤šä¸ªå±žæ€§ android:text æ–‡æœ¬å†…å®¹ android:textSize android:textColor æ–‡æœ¬çš„å¤§å°/é¢œè‰² Button Button æŒ‰é’® ä»£ç  123456&lt;Button android:id="@+id/button" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Button" android:textAllCaps="false"/&gt; æ•ˆæžœå¦‚ä¸‹ å¸¸ç”¨å±žæ€§ android:textAllCaps ç³»ç»Ÿè‡ªåŠ¨è½¬æ¢æ–‡æœ¬ä¸ºå¤§å†™ true/false æŒ‰é’®å“åº”(3ç§) åŒ¿åç±»æ³¨å†Œç›‘å¬å™¨ ä»£ç å¦‚ä¸‹12345678//æ–°å»ºButtonå¯¹è±¡ //å¼ºåˆ¶ç±»åž‹è½¬æ¢Button button = (Button)findViewById(R.id.button);button.setOnClickListener(new View.OnClickListener()&#123; @Override public void onClick(View v)&#123; //æ·»åŠ é€»è¾‘ &#125;&#125;); æŽ¥å£æ–¹å¼å®žçŽ° ä»£ç 123456789101112131415161718192021222324 //ç»§æ‰¿æŽ¥å£ public class MainActivity extends AppCompatActivity implements View.OnClickListener&#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); //æ³¨å†Œç›‘å¬å™¨ Button button = (Button)findViewById(R.id.button); button.setOnClickListener(this); &#125; @Override //æ ¹æ®button idå¤„ç†ä¸åŒé€»è¾‘ public void onClick(View view)&#123; switch (view.getId())&#123; case R.id.button: //å¤„ç†é€»è¾‘ break; default: break; &#125; &#125;&#125; android:onClick åŒ¹é…åœ¨xmlä¸­æŒ‡å®šandroid:onClick æŒ‡å®šçš„æ–¹æ³•åç§°åŒ¹é…ï¼Œç­¾åå¿…é¡»å®Œå…¨ç›¸åŒæ–¹æ³•è¦æ±‚ï¼š æ˜¯å…¬å…±æ–¹æ³• public å…·æœ‰ç©ºè¿”å›žå€¼ void ä»¥ View ä½œä¸ºå”¯ä¸€å‚æ•°ï¼ˆè¿™å°†æ˜¯ä¹‹å‰ç‚¹å‡»çš„ Viewï¼‰ ä»£ç å¦‚ä¸‹ 1android:onClick="Button_onClick" 123public void Button_onClick(View view)&#123; //å¤„ç†é€»è¾‘&#125; EditText EditText ä»£ç å¦‚ä¸‹ 123456&lt;EditText android:id="@+id/edit_text" android:layout_width="match_parent" android:layout_height="wrap_content" android:hint="è¾“å…¥æ–‡å­—" android:maxLines="2"/&gt; æ•ˆæžœ å¸¸ç”¨å±žæ€§ android:hint æŒ‡å®šä¸€äº›æç¤ºæ€§æ–‡å­—ï¼Œå†ç”¨æˆ·æœªè¾“å…¥æ—¶æç¤ºã€‚ android:maxLines è¾“å…¥å†…å®¹æœ€å¤§å ç”¨è¡Œæ•° æå–è¾“å…¥æ–‡æœ¬ é€šè¿‡findViewByIdæ‰¾åˆ°EditText å®žä¾‹ï¼Œåœ¨å¤„ç†é€»è¾‘ä¸­è°ƒç”¨EditText.getTextæ–¹æ³•å¾—åˆ°è¾“å…¥å†…å®¹ï¼Œå†ç”±toStringè½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ ä»£ç å¦‚ä¸‹12345678910//æ–°å»ºEditTExtå¯¹è±¡private EditText editText;//ç»‘å®šEditTextå®žä¾‹editText = (EditText)findViewById(R.id.edit_text);//æå–æ–‡æœ¬String inputText = editText.getText().toString();//Toastæ˜¾ç¤ºToast.makeText(MainActivity.this,inputText,Toast.LENGTH_SHORT).show(); ImageView å°†å›¾ç‰‡æ”¾å…¥drawable-xhdpiæ–‡ä»¶å¤¹ ImageView ä»£ç  12345&lt;ImageView android:id="@+id/image_view" android:layout_width="wrap_content" android:layout_height="wrap_content" android:src="@drawable/img_1"/&gt; æ•ˆæžœå¦‚ä¸‹ å¸¸ç”¨å±žæ€§ android:src å¼•ç”¨èµ„æºä½ç½® æ›´æ”¹ImageViewå›¾ç‰‡ è°ƒç”¨ imageView.setImageResource()æ–¹æ³• ä»£ç å¦‚ä¸‹12345private ImageView imageView;imageView = (ImageView)findViewById(R.id.image_view);imageView.setImageResource(R.drawable.img_2); ProgressBar ProgressBar ä»£ç å¦‚ä¸‹ 123456&lt;ProgressBar android:id="@+id/progress_bar" android:layout_width="match_parent" android:layout_height="wrap_content" style="?android:attr/progressBarStyleHorizontal" android:max="100"/&gt; å¸¸ç”¨å±žæ€§ androidï¼švisibility æ˜¯å¦å¯è§ å–å€¼ visible invisible gone style=â€?android:attr/progressBarStyleHorizontalâ€android:max=â€100â€è®¾å®šæ˜¾ç¤ºæ–¹å¼ä¸ºæ¨ªå‘è¿›åº¦æ¡ï¼Œè¿›åº¦æ¡æœ€å¤§å€¼100 è¿›åº¦æ¡æœ‰å…³è®¾ç½® æ˜¾ç¤º/éšè—è¿›åº¦æ¡progressBar.setVisibility()æ–¹æ³• 12345678910private ProgressBar progressBar;progressBar = (ProgressBar)findViewById(R.id.progress_bar);//è®¾ç½®ProgressBarif(progressBar.getVisibility() == View.GONE)&#123; progressBar.setVisibility(View.VISIBLE);&#125; else &#123; progressBar.setVisibility(View.GONE);&#125; è®¾ç½®è¿›åº¦æ¡è¿›åº¦ 123int progress = progressBar.getProgress();progress +=10;progressBar.setProgress(progress); AlertDialog AlertDialog ä»£ç å¦‚ä¸‹ 123456789101112131415161718AlertDialog.Builder dialog = new AlertDialog.Builder(MainActivity.this);dialog.setTitle("This is Dialog");dialog.setMessage("something important");dialog.setCancelable(false);//setPositiveButtonè®¾å®šOKç‚¹å‡»äº‹ä»¶dialog.setPositiveButton("OK",new DialogInterface.OnClickListener()&#123;@Override public void onClick(DialogInterface dialog,int which)&#123; &#125;&#125;);//setNegativeButtonè®¾å®šCanncelç‚¹å‡»äº‹ä»¶dialog.setNegativeButton("Canncel",new DialogInterface.OnClickListener()&#123;@Override public void onClick(DialogInterface dialog,int which)&#123; &#125;&#125;);//æ˜¾ç¤º AlertDialogdialog.show(); ProgressDialog ProgressDialogä¸ŽAlertDialogç±»ä¼¼ï¼Œä½†æ˜¯ä¼šé¢å¤–æ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ ä»£ç å¦‚ä¸‹ 12345678910//æ–°å»ºProgressDialogå¯¹è±¡ProgressDialog progressDialog = new ProgressDialog(MainActivity.this);//è®¾ç½®æ ‡é¢˜progressDialog.setTitle("This is ProgressDialog");//è®¾ç½®å†…å®¹progressDialog.setMessage("Loading...");//æ˜¯å¦å¯ä»¥è¿”å›žé”®å–æ¶ˆprogressDialog.setCancelable(false);//æ˜¾ç¤ºprogressDialog.show(); æ•ˆæžœå¦‚å›¾ PSï¼šprogressDialog.setCancelable();å±žæ€§è®¾ç½®ä¸ºfalseæ—¶è¡¨ç¤ºProgressDialogæ— æ³•é€šè¿‡Backé”®å–æ¶ˆã€‚åªèƒ½é€šè¿‡progressDialog.dismiss()æ–¹æ³•å–æ¶ˆ å››ç§åŸºæœ¬å¸ƒå±€LinearLayout çº¿æ€§å¸ƒå±€ çº¿æ€§æ–¹å‘ä¸Šä¾æ¬¡æŽ’åˆ— åŸºç¡€æ•ˆæžœå¦‚ä¸‹1234567891011121314151617181920212223242526&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools" android:id="@+id/activity_main" android:orientation="horizontal" android:layout_width="match_parent" android:layout_height="match_parent" tools:context="ljy.com.uilayouttest.MainActivity"&gt; &lt;Button android:id="@+id/button_1" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Button_1"/&gt; &lt;Button android:id="@+id/button_2" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Button_2"/&gt; &lt;Button android:id="@+id/button_3" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Button_3"/&gt;&lt;/LinearLayout&gt; åŸºç¡€å±žæ€§ androidï¼šorientation LinearLayout çš„æŽ’åˆ—æ–¹å‘ï¼Œå–å€¼æœ‰ä¸¤ç§ horizontalæ¨ªå‘å’Œverticalç«–å‘ï¼Œä¸æŒ‡å®š androidï¼šorientationæ—¶ï¼Œé»˜è®¤ horizontal android:layoutgravity æŒ‡å®šæŽ§ä»¶åœ¨å¸ƒå±€ä¸­çš„å¯¹é½æ–¹å¼ã€‚è¯¥å±žæ€§ä¸Ž LinearLayout çš„æŽ’åˆ—æ–¹å‘æœ‰å¾ˆå¤§å…³ç³»ã€‚ android:layoutweight å…è®¸ä½¿ç”¨æ¯”ä¾‹æ–¹å¼æŒ‡å®šæŽ§ä»¶å¤§å°,è®¡ç®—æŽ§ä»¶å¤§å°æ—¶ï¼Œç³»ç»Ÿéžå°†æ‰€æœ‰æŽ§ä»¶çš„android:layoutweight å€¼ç›¸åŠ ï¼Œå½“ä½œåŸºåº•ï¼Œè®¡ç®—æŒ‡å®šçš„å¤§å°æ¯”ä¾‹ EditTextå’ŒButtonå¸¸è§ç”¨æ³• 12345678910111213 &lt;EditText android:id="@+id/button_1" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:hint="Button_1"/&gt;&lt;Button android:id="@+id/button_2" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:text="Button_2"/&gt; æŒ‡å®šandroid:layoutwidth ä¸º0dpï¼Œandroid:layoutweight=â€1â€å‡ä¸º1 å¹³åˆ†å¤§å° å¦ä¸€ç§ç”¨æ³• 123456789101112 &lt;EditText android:id="@+id/button_1" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:hint="Button_1"/&gt;&lt;Button android:id="@+id/button_2" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Button_2"/&gt; å°†Buttonçš„android:layout_widthè®¾å®šä¸ºwrap_contentï¼ŒEditText çš„android:layoutweight=â€1â€ï¼ŒEditTextä¼šå æ»¡æ•´ä¸ªå±å¹•å‰©ä½™éƒ¨åˆ†ï¼Œåœ¨é€‚é…å±å¹•æ—¶è¾ƒå¸¸ç”¨ RelativeLayoutç›¸å¯¹å¸ƒå±€ å±žæ€§è¾ƒå¤šï¼Œä»¥ä»£ç å½¢å¼è¯´æ˜Žç›¸å¯¹çˆ¶å¸ƒå±€ä½ç½® ä»£ç å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools" android:id="@+id/activity_main" android:orientation="horizontal" android:layout_width="match_parent" android:layout_height="match_parent" tools:context="ljy.com.uilayouttest.MainActivity"&gt; &lt;Button android:id="@+id/button_1" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_alignParentLeft="true" android:layout_alignParentTop="true" android:text="Button 1"/&gt; &lt;Button android:id="@+id/button_2" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_alignParentRight="true" android:layout_alignParentTop="true" android:text="Button 2"/&gt; &lt;Button android:id="@+id/button_3" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_centerInParent="true" android:text="Button 3"/&gt; &lt;Button android:id="@+id/button_4" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_alignParentBottom="true" android:layout_alignParentLeft="true" android:text="Button 4"/&gt; &lt;Button android:id="@+id/button_5" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_alignParentBottom="true" android:layout_alignParentRight="true" android:text="Button 5"/&gt;&lt;/RelativeLayout&gt; android:layout_alignParentLeft=â€trueâ€android:layout_alignParentTop=â€trueâ€android:layout_centerInParent=â€trueâ€android:layout_alignParentBottom=â€trueâ€android:layoutalignParentRight=â€trueâ€ ç®€è€Œè¨€ä¹‹è¿™äº›å±žæ€§æŒ‡å®šäº†æŽ§ä»¶ç›¸å¯¹çˆ¶å¸ƒå±€çš„ä½ç½® ç›¸å¯¹æŽ§ä»¶ä½ç½® ä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools" android:id="@+id/activity_main" android:orientation="horizontal" android:layout_width="match_parent" android:layout_height="match_parent" tools:context="ljy.com.uilayouttest.MainActivity"&gt; &lt;Button android:id="@+id/button_3" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_centerInParent="true" android:text="Button 3"/&gt; &lt;Button android:id="@+id/button_1" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_above="@id/button_3" android:layout_toLeftOf="@id/button_3" android:text="Button 1"/&gt; &lt;Button android:id="@+id/button_2" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_above="@id/button_3" android:layout_toRightOf="@id/button_3" android:text="Button 2"/&gt; &lt;Button android:id="@+id/button_4" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_below="@id/button_3" android:layout_toLeftOf="@id/button_3" android:text="Button 4"/&gt; &lt;Button android:id="@+id/button_5" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_below="@id/button_3" android:layout_toRightOf="@id/button_3" android:text="Button 5"/&gt;&lt;/RelativeLayout&gt; è¯´æ˜Ž android:layout_above å¯ä»¥æŒ‡å®šä¸€ä¸ªæŽ§ä»¶ä½äºŽæŒ‡å®šæŽ§ä»¶çš„ä¸Šæ–¹ï¼Œéœ€è¦æŒ‡å®šIDå¼•ç”¨ android:layout_below æŒ‡å®šä¸€ä¸ªæŽ§ä»¶ä½äºŽæŒ‡å®šæŽ§ä»¶çš„ä¸‹æ–¹ï¼Œidå¼•ç”¨ android:layout_toLeftOf æŒ‡å®šä¸€ä¸ªæŽ§ä»¶ä½äºŽæŒ‡å®šæŽ§ä»¶çš„å·¦ä¾§ï¼Œidå¼•ç”¨ android:layout_toRightOf æŒ‡å®šä¸€ä¸ªæŽ§ä»¶ä½äºŽæŒ‡å®šæŽ§ä»¶çš„å³ä¾§ï¼Œidå¼•ç”¨ã€‚ NOTEï¼šå½“æŽ§ä»¶åŽ»å¼•ç”¨å¦ä¸€ä¸ªæŽ§ä»¶çš„IDæ—¶ï¼Œå¼•ç”¨æŽ§ä»¶ä¸€å®šè¦åœ¨å‰æœ¬ä¾‹ä¸­æ˜¯id/button3åœ¨æœ€å‰é¢ FrameLayoutå¸§å¸ƒå±€ æ‰€æœ‰æŽ§ä»¶é»˜è®¤å·¦ä¸Šè§’ ä»£ç å¦‚ä¸‹ä¸¤ä¸ªæŽ§ä»¶é‡åˆ 1234567891011121314&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;TextView android:id="@+id/text_view" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="TextView"/&gt; &lt;ImageView android:id="@+id/image_view" android:layout_width="wrap_content" android:layout_height="wrap_content" android:src="@mipmap/ic_launcher"/&gt;&lt;/FrameLayout&gt; android:layoutgravity åŒæ ·å¯ä»¥åº”ç”¨äºŽFrameLayoutä¸­ï¼ŒæŒ‡å®šå¯¹é½æ–¹å¼ PercentFrameLayoutç™¾åˆ†æ¯”å¸ƒå±€ PercentFrameLayoutå¹¶éžå†…ç½®äºŽç³»ç»ŸSDKä¸­ï¼Œä½¿ç”¨å‰è¦åœ¨build.gradleä¸­æ·»åŠ ç™¾åˆ†æ¯”å¸ƒå±€çš„ä¾èµ–ã€‚ ä¿®æ”¹app/build.gradleæ–‡ä»¶ï¼Œåœ¨dependenciesé—­åŒ…ä¸­å¢žåŠ ä¾èµ–ã€‚ 12345678910dependencies &#123; compile fileTree(dir: 'libs', include: ['*.jar']) androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', &#123; exclude group: 'com.android.support', module: 'support-annotations' &#125;) compile 'com.android.support:appcompat-v7:25.0.1' //ä¸‹é¢ä¸€è¡Œä¸ºå¢žåŠ å†…å®¹ï¼Œè¦ä¸Žä¸Šé¢çš„ç‰ˆæœ¬å·ä¿æŒä¸€è‡´ compile 'com.android.support:percent:25.0.1' testCompile 'junit:junit:4.12'&#125; ä¿®æ”¹å®ŒæˆåŽï¼Œasä¼šå¼€å§‹åŒæ­¥ï¼ŒåŒæ­¥å®Œæˆå³å¯ã€‚ PercentFrameLayoutç»§æ‰¿äº†FrameLayoutçš„ç‰¹æ€§ï¼Œæ‰€æœ‰æŽ§ä»¶é»˜è®¤å·¦ä¸Šè§’ï¼Œéœ€è¦é€šè¿‡android:layoutgravity æ¥è°ƒæ•´ä½ç½® æºç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334# PercentFrameLayout å¹¶éžç³»ç»Ÿå†…ç½®SDKï¼Œéœ€è¦å£°æ˜Žå®Œæ•´åŒ…è·¯å¾„&lt;android.support.percent.PercentFrameLayout# éšåŽå®šä¹‰appçš„å‘½åç©ºé—´ xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;Button android:id="@+id/button1" android:text="Button1" android:layout_gravity="left|top" app:layout_widthPercent="50%" app:layout_heightPercent="50%"/&gt; &lt;Button android:id="@+id/button2" android:text="Button2" android:layout_gravity="right|top" app:layout_widthPercent="50%" app:layout_heightPercent="50%"/&gt; &lt;Button android:id="@+id/button3" android:text="Button3" android:layout_gravity="left|bottom" app:layout_widthPercent="50%" app:layout_heightPercent="50%"/&gt; &lt;Button android:id="@+id/button4" android:text="Button4" android:layout_gravity="right|bottom" app:layout_widthPercent="50%" app:layout_heightPercent="50%"/&gt;&lt;/android.support.percent.PercentFrameLayout&gt; æ•ˆæžœå¦‚å›¾ ä¸Žä¹‹ç±»ä¼¼çš„è¿˜æœ‰ PercentRelativeLayoutï¼Œç”¨æ³•ä¸åŠ ç´¯èµ˜ è‡ªå®šä¹‰æŽ§ä»¶å¼•å…¥å¸ƒå±€ æ–°å»ºtitle.xml 12345678910111213141516171819202122232425262728293031323334353637&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="wrap_content" android:background="@drawable/title_bg"&gt; &lt;Button android:id="@+id/title_back" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="center" android:layout_margin="5dp" android:background="@drawable/back_bg" android:text="Back" android:textColor="#fff" /&gt; &lt;TextView android:id="@+id/title_text" android:layout_width="0dp" android:layout_height="wrap_content" android:layout_gravity="center" android:layout_weight="1" android:gravity="center" android:text="Title Text" android:textColor="#fff" android:textSize="24sp" /&gt; &lt;Button android:id="@+id/title_edit" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="center" android:layout_margin="5dp" android:background="@drawable/edit_bg" android:text="Edit" android:textColor="#fff" /&gt;&lt;/LinearLayout&gt; åœ¨activitymain.xml ä¸­ä½¿ç”¨title.xml &lt;include layout=&quot;@layout/title&quot;/&gt; éšè—ç³»ç»Ÿè‡ªå¸¦æ ‡é¢˜æ ,åœ¨mainActivityçš„onCreatä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ã€‚ 123 ActionBar actionBar = getSupportActionBar();if (actionBar != null) actionBar.hide(); æ•ˆæžœå¦‚ä¸‹ è‡ªå®šä¹‰æŽ§ä»¶ åˆ›å»ºTitleLayoutç»§æ‰¿è‡ªLinearLayout ï¼Œä»£ç å¦‚ä¸‹123456789public class TitleLayout extends LinearLayout &#123;//æž„é€ å‡½æ•° public TitleLayout(Context context, AttributeSet attributeSet)&#123; super(context,attributeSet); //è°ƒç”¨LayoutInflater.fromæ–¹æ³•æž„å»ºLayoutInflaterå¯¹è±¡ï¼Œ //å†è°ƒç”¨inflateåŠ è½½å¸ƒå±€æ–‡ä»¶ LayoutInflater.from(context).inflate(R.layout.title,this); &#125;&#125; å†activitymain.xml ä¸­ æ·»åŠ è‡ªå®šä¹‰æŽ§ä»¶,æ·»åŠ è‡ªå®šä¹‰æŽ§ä»¶æ—¶è¦æŒ‡æ˜ŽæŽ§ä»¶çš„å®Œæ•´ç±»å 123&lt;ljy.com.uicustomviews.TitleLayout android:layout_width="match_parent" android:layout_height="wrap_content"/&gt; æ•ˆæžœä¸Žå¼•å…¥å¸ƒå±€æ–‡ä»¶ç›¸åŒ æ³¨å†ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶ åœ¨TitleLayoutçš„æž„é€ å‡½æ•°æ·»åŠ æŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶1234567891011121314151617Button titleBack = (Button)findViewById(R.id.title_back);Button titleEdit = (Button)findViewById(R.id.title_edit);titleBack.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; //æ¨¡æ‹Ÿè¿”å›žé”® ((Activity)getContext()).finish(); &#125; &#125;); titleEdit.setOnClickListener(new OnClickListener() &#123; @Override public void onClick(View v) &#123; //Toasté€šçŸ¥ Toast.makeText(getContext(),"clik",Toast.LENGTH_SHORT).show(); &#125; &#125;);]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç¬”è®°â€”Activity]]></title>
    <url>%2F2016%2F12%2F07%2FAndroid%E7%AC%94%E8%AE%B0-Activity%2F</url>
    <content type="text"><![CDATA[èµ„æ–™æ¥æºå¦‚ä¸‹ ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ) ActivityåŸºç¡€Activityå®šä¹‰ Activity æ˜¯Androidå››å¤§ç»„ä»¶ä¹‹ä¸€ï¼Œç”¨æˆ·å¯ä¸Žå…¶æä¾›çš„å±å¹•è¿›è¡Œäº¤äº’ï¼Œä»¥æ‰§è¡Œæ“ä½œã€‚ æ¯ä¸ª Activity éƒ½ä¼šèŽ·å¾—ä¸€ä¸ªç”¨äºŽç»˜åˆ¶å…¶ç”¨æˆ·ç•Œé¢çš„çª—å£ã€‚çª—å£å¯ä»¥å……æ»¡å±å¹•ï¼Œä¹Ÿå¯æµ®åŠ¨ã€‚åº”ç”¨é€šå¸¸ç”±å¤šä¸ªå½¼æ­¤è”ç³»çš„ Activity ç»„æˆã€‚åº”ç”¨ä¸­çš„æŸä¸ª Activity ä¸ºâ€œä¸»â€Activityï¼Œå³é¦–æ¬¡å¯åŠ¨åº”ç”¨æ—¶çš„Activityã€‚ åˆ›å»ºActivity æ–°å»ºFirstAtivityç»§æ‰¿è‡ªAppCompatActivity 12345public class FirstActivity extends AppCompatActivity&#123;@Overrideprotected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState);&#125; &#125; åˆ›å»ºåŠ è½½å¸ƒå±€ åˆ‡æ¢åˆ°first-layout 1234567891011 &lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;Button android:id="@+id/button_1" android:text="button_1" android:layout_width="wrap_content" android:layout_height="wrap_content" /&gt;&lt;/LinearLayout&gt; åœ¨FirestActivityä¸­åŠ è½½layout åœ¨onCreateä¸­åŠ å…¥ 1setContentView(R.layout.first_layout); åœ¨AndroidMainfestæ–‡ä»¶ä¸­æ³¨å†Œã€‚ 12345678&lt;activity android:name=".FirstActivity" android:label="This is FirstActivity"&gt; &lt;intent-filter&gt; &lt;action android:name="android.intent.action.MAIN"/&gt; &lt;category android:name="android.intent.category.LAUNCHER"/&gt; &lt;/intent-filter&gt;&lt;/activity&gt; åœ¨æ¨¡æ‹Ÿå™¨ä¸­å¯åŠ¨apk ä½¿ç”¨Toast Toast googleå®˜æ–¹è¯´æ˜Ž æŽ¨é€ä¸€ä¸ªçŸ­å°ä¿¡æ¯æŽ¨é€ç»™ç”¨æˆ· å¦‚å›¾ï¼ˆæ‘˜è‡ªandroid developerï¼‰ ä½¿ç”¨æ–¹æ³• 1Toast.makeText(context, text, duration).show(); ä¸¾ä¾‹ 12Toast.makeText(FirstActivity.this, "you clicked button 1", Toast.LENGTH_SHORT).show();/* activity.this æ¶ˆæ¯å†…å®¹ æ˜¾ç¤ºæ—¶é—´è®¾ç½® */ ä½¿ç”¨Menu åˆ›å»ºèœå• åœ¨resä¸‹æ–°ç–†menuæ–‡ä»¶å¤¹ï¼Œå³å‡»menuæ–‡ä»¶å¤¹â€”newâ€”Menu resource fileï¼Œåˆ›å»ºmainçš„èœå•æ–‡ä»¶ã€‚ main.xmlä¸­æ·»åŠ å¦‚ä¸‹ä»£ç  123456789 &lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;menu xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;item android:id="@+id/add_item" android:title="Add"/&gt; &lt;item android:id="@+id/remove_item" android:title="Remove"/&gt;&lt;/menu&gt; è¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªèœå•é¡¹ Addå’ŒRemove åœ¨FirestActivityä¸­é‡å†™ onCreateOptionsMenu()æ–¹æ³•ï¼ˆå¿«æ·é”® Ctrl+Oï¼‰ 12345 @Overridepublic boolean onCreateOptionsMenu(Menu menu) &#123; getMenuInflater().inflate(R.menu.main, menu); return true;&#125; getMenuInflater()å¯ä»¥å¾—åˆ°MenuInflaterå¯¹è±¡ï¼Œå†è°ƒç”¨.inflateå°±å¯ä»¥åˆ›å»ºèœå•ã€‚.inflatæŽ¥å—ä¿©ä¸ªå‚æ•°ï¼Œä¸€æ˜¯èµ„æºæ–‡ä»¶åï¼ŒäºŒæ˜¯èœå•é¡¹æ·»åŠ è‡³é‚£ä¸ªå¯¹è±¡ä¸­ã€‚onCreateOptionsMenuæ–¹æ³•ä¸­è¿”å›žtrueè¡¨ç¤ºåˆ›å»ºèœå•å¹¶æ˜¾ç¤ºã€‚ æ•ˆæžœå¦‚ä¸‹ã€‚ åˆ›å»ºèœå•ç‚¹å‡»å“åº”äº‹ä»¶ é‡å†™onOptionsItemSelectedæ–¹æ³• 12345678910111213@Override public boolean onOptionsItemSelected(MenuItem item) &#123; switch (item.getItemId()) &#123; case R.id.add_item: Toast.makeText(this, "Add", Toast.LENGTH_SHORT).show(); break; case R.id.remove_item: Toast.makeText(this, "Remove", Toast.LENGTH_SHORT).show(); break; default: &#125; return true; &#125; é€šè¿‡item.getItemId()åˆ¤æ–­ç‚¹å‡»é€‰é¡¹ï¼Œå¼¹å‡ºä¸åŒçš„Toast å‘ä¸€ä¸ªactivity å¹¶ä¼ é€’å­—ç¬¦ä¸² æž„å»ºä¸€ä¸ªIntent Intent intent = new Intent(this, DisplayMessageActivity.class); æž„é€ æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼š Context æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™é‡Œä½¿ç”¨äº†thisæ˜¯å› ä¸ºActivityæ˜¯Contextçš„å­ç±»ã€‚ Class ç±»æ˜¯ç³»ç»Ÿå°†è¦åˆ†å‘çš„APPç»„ä»¶ï¼Œåœ¨è¿™é‡Œï¼Œè¿™ä¸ªActivityå°†ä¼šè¢«å¯åŠ¨ã€‚ 12345678910111213public void sendMessage(View view) &#123; // åˆ›å»ºä¸€ä¸ªæ–°çš„intentå¯¹è±¡ï¼Œç»‘å®šDisplayMessageActivity Intent intent = new Intent(this, DisplayMessageActivity.class); //åˆ›å»ºä¸€ä¸ªeditTextå¯¹è±¡ï¼Œç»‘å®šxmlä¸­editText EditText editText = (EditText) findViewById(R.id.edit_message); //èŽ·å–editTextä¸­è¾“å…¥æ–‡å­—ï¼Œè½¬æˆå­—ç¬¦ä¸² String message = editText.getText().toString(); //ä¸€ä¸ªIntentå¯¹è±¡å¯ä»¥æºå¸¦è¢«ç§°ä¸ºextrasçš„é”®å€¼å¯¹ã€‚ // putExtra()æ–¹æ³•å°†é”®æ”¾åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œå°†å€¼æ”¾åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­ã€‚ intent.putExtra(EXTRA_MESSAGE, message); //å¯åŠ¨intentå¯¹åº”Activity startActivity(intent); &#125; 1234567891011121314151617181920protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_display_message); //åˆ›å»ºæœ¬åœ°intent Intent intent = getIntent(); //å–å‡ºStringç±»åž‹æ•°æ®ï¼Œå¦‚æžœæ˜¯Intç±»åž‹å°±æ˜¯getIntExtraï¼ŒBooleanç±»åž‹å°±æ˜¯getBooleanExtra String message = intent.getStringExtra(MainActivity.EXTRA_MESSAGE); //æ˜¾ç¤ºString //åˆ›å»ºæ–°çš„TextView TextView textView = new TextView(this); //è®¾ç½®æ–‡æœ¬å¤§å° textView.setTextSize(40); //è®¾ç½®æ˜¾ç¤ºå†…å®¹ textView.setText(message); //ç»‘å®šxml ViewGroup layout = (ViewGroup) findViewById(R.id.activity_display_message); //ViewGroupä¸­æ·»åŠ TextView layout.addView(textView);&#125; è¿”å›žæ•°æ®ç»™ä¸Šä¸€ä¸ªActivity æž„å»ºIntentä½¿ç”¨startActivityForResult()æ–¹æ³•ä¼ å…¥è¯·æ±‚ç ï¼Œå¯åŠ¨ä¸‹ä¸€ä¸ªActivityåœ¨ä¸‹ä¸€ä¸ªActivityä¸­æž„å»ºIntentï¼Œintent.putExtraå­˜å…¥é”®å€¼-keyï¼Œè°ƒç”¨setResult()æ–¹æ³•ï¼Œä¼ å…¥finish()ç»“æŸæŽ‰Activityé‡å†™ç¬¬ä¸€ä¸ªActivityä¸­çš„onActivityResult()æ–¹æ³•ï¼Œè°ƒç”¨.getStringExtraå–å‡ºkeyå¯¹åº”é”®å€¼ã€‚ startActivityForResult(Intent, int Bundle) Intentä¸Žå•çº¯å¯åŠ¨Activityçš„Intentç›¸åŒï¼Œç¬¬äºŒä¸ªæ˜¯è¯·æ±‚ç ï¼Œä¸‹ä¸€çº§ å›žè°ƒæä¾›ç›¸åŒçš„è¯·æ±‚ç ï¼Œä»¥ä¾¿æ‚¨åº”ç”¨å¯ä»¥æ­£ç¡®è¯†åˆ«ç»“æžœã€‚ 12Intent intent = new Intent(FirestActivity.this,ScendActivity.class);startActivityForResult(intent,1); setResult()æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å‘ä¸Šçº§æ–¹æ³•å¤„ç†ç»“æžœï¼Œä¸€èˆ¬ä½¿ç”¨RESULT_OKæˆ–RESULT_CANCELEDï¼Œç¬¬äºŒä¸ªå‚æ•° å¯¹åº”Intent 1234567//æ–°å»ºæ˜¾ç¤ºIntentIntent intent = new Intent();//å­˜å…¥key-é”®å€¼intent.putExtra("data_return","Hello Firest");setResult(RESULT_OK,intent);//ç»“æŸActivityfinish(); onActivityResult()ä¸‰ä¸ªå‚æ•°.ç¬¬ä¸€ä¸ªstartActivityForResult() ä¼ é€’çš„è¯·æ±‚ä»£ç ã€‚ç¬¬äºŒä¸ª Activity æŒ‡å®šçš„ç»“æžœä»£ç ã€‚æˆåŠŸæ˜¯ RESULT_OKï¼›å¤±è´¥ï¼Œåˆ™æ˜¯ RESULT_CANCELEDã€‚ç¬¬ä¸‰ä¸ªæ˜¯ä¼ é€ç»“æžœæ•°æ®çš„ Intentã€‚ 12345678910111213 @Overrideprotected void onActivityResult(int requestCode,int resultCode,Intent data)&#123; //é€‰æ‹©ä¸åŒè¯·æ±‚ç å¯¹åº”å¤„ç†é€»è¾‘ switch(requestCode)&#123; case 1: //å¤„ç†ç»“æžœæ—¶å€™ok if(resultCode == RESULT_OK)&#123; //å–å‡ºæ•°æ® String returnedData = data.getStringExtra("data_return"); Log.d("FirstActivity", returnedData); &#125; &#125;&#125; Activityç”Ÿå‘½å‘¨æœŸ Activity 3ç§çŠ¶æ€ Resumed/ç»§ç»­Activity å¤„äºŽå‰å°ï¼Œä¸”ç”¨æˆ·å¯ä»¥ä¸Žå…¶äº¤äº’ Paused/æš‚åœ Activity è¢«åœ¨å‰å°ä¸­å¤„äºŽå¦ä¸€ä¸ª Activityâ€”éƒ¨åˆ†é˜»æŒ¡ã€‚ æš‚åœçš„ Activity ä¸ä¼šæŽ¥æ”¶ç”¨æˆ·è¾“å…¥å¹¶ä¸”æ— æ³•æ‰§è¡Œä»»ä½•ä»£ç ã€‚ Stopped/åœæ­¢Activityå®Œå…¨éšè—ï¼Œå¯¹ç”¨æˆ·å®Œå…¨ä¸å¯è§.å½“åœæ­¢æ—¶ï¼Œactivityçš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯æ¯”å¦‚æˆå‘˜å˜é‡éƒ½ä¼šè¢«ä¿ç•™ï¼Œä½†æ˜¯ä¸èƒ½å†æ‰§è¡Œä»»ä½•ä»£ç  å¯åŠ¨ä¸€ä¸ªActivity onCreateæ–¹æ³• ä¸»Activityï¼š ç”¨æˆ·ç‚¹å‡»appå›¾æ ‡ï¼Œå¯åŠ¨ä¸»Activity åœ¨AndroidManifest.xmlä¸­å£°æ˜Ž1234&lt;intent-filter&gt;&lt;action android:name="android.intent.action.MAIN" /&gt;&lt;category android:name="android.intent.category.LAUNCHER" /&gt;&lt;/intent-filter&gt; é€šè¿‡è°ƒç”¨onCreateæ–¹æ³•åˆ›å»ºä¸€ä¸ªActivityå®žä¾‹ï¼ŒonCreateæ–¹æ³•åœ¨Activityçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªæ‰§è¡Œä¸€æ¬¡ã€‚ ä¹‹åŽç³»ç»Ÿä¼šå¾ˆå¿«çš„è°ƒç”¨onStartå’ŒonResumeæ–¹æ³•ï¼ŒActivityè¿›å…¥Resumed/ç»§ç»­æ¨¡å¼ã€‚ç›´åˆ°è¢«å…¶ä»–activityè¦†ç›–/å±å¹•å…³é—­ã€‚é”€æ¯Activity onDestoryæ–¹æ³•å¤§å¤šæ•°çš„APPä¸éœ€è¦å®žçŽ°è¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºæœ¬åœ°ç±»å¼•ç”¨ä¼šéšç€Activityä¸€èµ·æ€»ç»“ï¼Œä¸è¿‡Activityçš„æ¸…ç†å·¥ä½œåº”è¯¥æ”¾åœ¨onPauseä¸‹æˆ–è€…onStopã€‚ Note:åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹ç³»ç»Ÿè°ƒç”¨onDestoryæ–¹æ³•ä¹‹åŽå·²ç»è°ƒç”¨è¿‡onPauseæ–¹æ³•ä¸ŽonStopæ–¹æ³•ï¼Œä¸è¿‡æœ‰ä¸€ä¸ªä¾‹å¤–æƒ…å†µï¼šä½ åœ¨onCreateæ–¹æ³•ä¸­è°ƒç”¨äº†finishæ–¹æ³•ã€‚åœ¨ä¸€äº›ä¾‹å­ä¸­ï¼Œå½“ä½ çš„Activityä¸´æ—¶å†³å®šè¦å¯åŠ¨å¦ä¸€ä¸ªActivityï¼Œä½ å¯èƒ½è¦åœ¨onCreateæ–¹æ³•å†…è°ƒç”¨finishæ–¹æ³•æ¥é”€æ¯è¿™ä¸ªActivityï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šç«‹å³è°ƒç”¨onDestoryæ–¹æ³•ï¼Œè€Œä¸ä¼šè°ƒç”¨å…¶å®ƒä»»ä½•ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚ æš‚åœActivity onPause()æ–¹æ³• Activityè¢«å…¶ä»–Activityè¦†ç›–/å¤±åŽ»ç”¨æˆ·ç„¦ç‚¹ï¼Œç³»ç»Ÿè°ƒç”¨onPause()æ–¹æ³•ï¼ŒActivity è¿›å…¥æš‚åœçŠ¶æ€ã€‚ noteï¼šandroid7.0åŠä»¥ä¸Šç‰ˆæœ¬åŠ å…¥äº†å¤šçª—å£æ¨¡å¼ï¼Œå½“Activityå¤±åŽ»ç”¨æˆ·ç„¦ç‚¹æ—¶ï¼Œå¯èƒ½å¤„äºŽå¤šçª—å£æ¨¡å¼ã€‚ onPause() å¸¸ç”¨å›žè°ƒï¼š æ£€æŸ¥ Activity æ˜¯å¦å¯è§ã€‚ä¸å¯è§åˆ™åœæ­¢å¯èƒ½æ¶ˆè€— CPU çš„æ“ä½œ æäº¤æœªä¿å­˜çš„æ›´æ”¹ï¼Œä»…ä¿å­˜ç”¨æˆ·ç¦»å¼€æ—¶å¸Œæœ›æ°¸ä¹…æ€§ä¿å­˜æ­¤ç±»æ›´æ”¹ï¼ˆæ¯”å¦‚ç”µå­é‚®ä»¶è‰ç¨¿ï¼‰ã€‚ é‡Šæ”¾ç³»ç»Ÿèµ„æºï¼ŒGPS/Camerç­‰ ç¤ºä¾‹ (é‡Šæ”¾Camer) 123456789public void onPause() &#123;super.onPause(); // Always call the superclass method first// Release the Camera because we don't need it when paused// and other activities might need to use it.if (mCamera != null) &#123; mCamera.release(); mCamera = null;&#125; æ³¨æ„äº‹é¡¹ï¼š åœ¨onPause()ä¸€èˆ¬ä¸æ‰§è¡Œæ°¸ä¹…æ€§å­˜å‚¨ç”¨æˆ·æ›´æ”¹ï¼Œä¸æ‰§è¡Œ CPU å¯†é›†åž‹å·¥ä½œï¼Œè¿™äº›å·¥ä½œä¸€èˆ¬æ”¾åœ¨onStop() ã€‚ ç»§ç»­ Activity onResume() æ–¹æ³• æš‚åœçŠ¶æ€å›žåˆ°ç»§ç»­çŠ¶æ€ï¼ŒActivityç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ä¹Ÿä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ onResume() ä»¥åˆå§‹åŒ–åœ¨ onPause() æœŸé—´é‡Šæ”¾çš„ç»„ä»¶ã€‚ ç¤ºä¾‹(é‡æ–°èŽ·å–Camera)1234567public void onResume() &#123; super.onResume(); // Always call the superclass method first // Get the Camera instance as the activity achieves full user focus if (mCamera == null) &#123; initializeCamera(); // Local method to handle camera init &#125; åœæ­¢ Activity noteï¼šå¤§å¤šæ•°ç›¸å¯¹ç®€å•çš„ Activity è€Œè¨€ï¼Œç³»ç»Ÿåœ¨ Activity åœæ­¢æ—¶ä¼šå°†Activity å®žä¾‹ä¿ç•™åœ¨ç³»ç»Ÿå†…å­˜ä¸­ï¼Œæ— éœ€å®žçŽ° onStop() å’Œ onRestart() æˆ–ç”šè‡³onStart() æ–¹æ³•ã€‚å¯èƒ½åªéœ€ä½¿ç”¨ onPause() æš‚åœæ­£åœ¨è¿›è¡Œçš„æ“ä½œï¼Œå¹¶ä»Žç³»ç»Ÿèµ„æºæ–­å¼€è¿žæŽ¥ã€‚ onStop() æ–¹æ³• åœºæ™¯ï¼š ç”¨æˆ·åœ¨æœ€è¿‘åº”ç”¨åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåº”ç”¨ åº”ç”¨ä¸­æ‰§è¡Œå¼€å§‹æ–° Activity çš„æ“ä½œ Activityä½¿ç”¨æ—¶ï¼ŒæŽ¥æ‰“ç”µè¯ è°ƒç”¨æ—¶ï¼ŒActivityä¸å†å¯è§ï¼Œé‡Šæ”¾å‡ ä¹Žæ‰€æœ‰ç”¨æˆ·ä¸ä½¿ç”¨æ—¶ä¸éœ€è¦çš„èµ„æºã€‚å¦‚æžœç³»ç»Ÿå†…å­˜ç´§å¼ ï¼Œåˆ™å¯èƒ½é”€æ¯å†…å­˜ä¸­çš„Acitivityå®žä¾‹ã€‚ onStop() æ–¹æ³•è°ƒç”¨åŽï¼ŒActivityä¸å†å¯è§ï¼Œæžç«¯æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¯èƒ½ä¼šä»…ç»ˆæ­¢åº”ç”¨è¿›ç¨‹ï¼Œè€Œä¸è°ƒç”¨ onDestroy() ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ onStop() é‡Šæ”¾å‡ ä¹Žæ‰€æœ‰ç”¨æˆ·ä¸ä½¿ç”¨æ—¶ä¸éœ€è¦çš„èµ„æºã€‚ å°½ç®¡ onPause() æ–¹æ³•åœ¨ onStop()ä¹‹å‰è°ƒç”¨ï¼Œåœ¨onStop() æ‰§è¡Œæ›´å¤§ã€å ç”¨æ›´å¤š CPU çš„å…³é—­æ“ä½œï¼Œæ¯”å¦‚å‘æ•°æ®åº“å†™å…¥ä¿¡æ¯ ç¤ºä¾‹ï¼ˆè‰ç¨¿ç¬”è®°å†…å®¹ä¿å­˜åœ¨æ°¸ä¹…å­˜å‚¨ï¼‰12345678910111213141516 protected void onStop() &#123; super.onStop(); // Always call the superclass method first // Save the note's current draft, because the activity is stopping // and we want to be sure the current note progress isn't lost. ContentValues values = new ContentValues(); values.put(NotePad.Notes.COLUMN_NAME_NOTE, getCurrentNoteText()); values.put(NotePad.Notes.COLUMN_NAME_TITLE, getCurrentNoteTitle()); getContentResolver().update( mUri, // The URI for the note to update. values, // The map of column names and new values to apply to them. null, // No SELECT criteria are used. null // No WHERE columns are used. );&#125; å¯åŠ¨/é‡å¯ Activity onStart() æ–¹æ³• Activity åœæ­¢è½¬æ¢ä¸ºç»§ç»­çŠ¶æ€æ—¶ï¼Œç³»ç»Ÿå›žè°ƒonRestart() æ–¹æ³•+ onStart() æ–¹æ³•.onStop() æ–¹æ³•æ¸…ç†äº†æ‰€æœ‰ Activity çš„èµ„æºï¼Œé‡å¯ Activity éœ€è¦é‡æ–°å®žä¾‹åŒ–å®ƒä»¬ã€‚åŒæ—¶ Activity åˆæ¬¡åˆ›å»ºæ—¶é‡æ–°å®žä¾‹åŒ–å®ƒä»¬ã€‚ å‡ºäºŽæ­¤ï¼Œç»å¸¸ä½¿ç”¨ onStart() æ–¹æ³•ä½œä¸º onStop() æ–¹æ³•çš„å¯¹åº” ç¤ºä¾‹1234567891011121314151617181920212223 @Overrideprotected void onStart() &#123; super.onStart(); // Always call the superclass method first // The activity is either being restarted or started for the first time // so this is where we should make sure that GPS is enabled LocationManager locationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE); boolean gpsEnabled = locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER); if (!gpsEnabled) &#123; // Create a dialog here that requests the user to enable GPS, and use an intent // with the android.provider.Settings.ACTION_LOCATION_SOURCE_SETTINGS action // to take the user to the Settings screen to enable GPS when they click "OK" &#125;&#125;@Overrideprotected void onRestart() &#123; super.onRestart(); // Always call the superclass method first // Activity being restarted from stopped state&#125; ä¿å­˜ Activity çŠ¶æ€ onSaveInstanceState()æ–¹æ³• é»˜è®¤æƒ…å†µä¸‹ï¼ŒActivity å®žä¾‹è¢«é”€æ¯æ—¶ç³»ç»Ÿä¼šä½¿ç”¨ Bundle å®žä¾‹çŠ¶æ€ä¿å­˜ Activity å¸ƒå±€ä¸­æœ‰å…³æ¯ä¸ª View å¯¹è±¡çš„ä¿¡æ¯ã€‚åœ¨Activity é‡å»ºæ—¶ï¼Œå¸ƒå±€çŠ¶æ€ä¾¿è‡ªåŠ¨æ¢å¤å…ˆå‰çš„çŠ¶æ€ã€‚ é»˜è®¤å®žçŽ°ä¿å­˜æœ‰å…³ Activity è§†å›¾å±‚æ¬¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¾‹å¦‚ EditText å°éƒ¨ä»¶ä¸­çš„æ–‡æœ¬æˆ–ListView çš„æ»šåŠ¨ä½ç½® è¦æ¢å¤çš„æ›´å¤šä¿¡æ¯ï¼Œéœ€è¦é‡å†™ onSaveInstanceState()æ–¹æ³•ï¼Œå°†é”®å€¼å¯¹æ·»åŠ è‡³ Bundle å¯¹è±¡ note:æ—‹è½¬å±å¹•æ—¶ï¼ŒActivity å°†è¢«é”€æ¯å¹¶é‡æ–°åˆ›å»ºã€‚åŽŸå› ï¼šæ–¹å‘æ›´æ”¹æ—¶å¯èƒ½éœ€è¦æ—¶åŠ è½½å¤‡ç”¨èµ„æºï¼ˆæ¯”å¦‚å¸ƒå±€ï¼‰ ç¤ºä¾‹12345678910111213static final String STATE_SCORE = "playerScore";static final String STATE_LEVEL = "playerLevel";...@Overridepublic void onSaveInstanceState(Bundle savedInstanceState) &#123; // Save the user's current game state savedInstanceState.putInt(STATE_SCORE, mCurrentScore); savedInstanceState.putInt(STATE_LEVEL, mCurrentLevel); // Always call the superclass so it can save the view hierarchy state super.onSaveInstanceState(savedInstanceState); &#125; æ¢å¤ Activity onCreate() å’Œ onRestoreInstanceState() å›žè°ƒæ–¹æ³•å‡æŽ¥æ”¶åŒ…å«å®žä¾‹çŠ¶æ€ä¿¡æ¯çš„ç›¸åŒ Bundle onCreate() æ–¹æ³• è°ƒç”¨onCreate() æ–¹æ³•éœ€è¦åŒºåˆ†æ˜¯åˆ›å»º Activity çš„æ–°å®žä¾‹è¿˜æ˜¯æ¢å¤å…ˆå‰çš„å®žä¾‹ï¼Œåˆ¤æ–­ Bundle æ˜¯å¦ä¸º null ç¤ºä¾‹ 1234567891011121314@Overrideprotected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); // Always call the superclass first // Check whether we're recreating a previously destroyed instance if (savedInstanceState != null) &#123; // Restore value of members from saved state mCurrentScore = savedInstanceState.getInt(STATE_SCORE); mCurrentLevel = savedInstanceState.getInt(STATE_LEVEL); &#125; else &#123; // Probably initialize members with default values for a new instance &#125; ...&#125; onRestoreInstanceState()æ–¹æ³• åªéœ€è¦æ¢å¤çš„å·²ä¿å­˜çš„çŠ¶æ€ ç¤ºä¾‹12345678 public void onRestoreInstanceState(Bundle savedInstanceState) &#123; // Always call the superclass so it can restore the view hierarchy super.onRestoreInstanceState(savedInstanceState); // Restore state members from saved instance mCurrentScore = savedInstanceState.getInt(STATE_SCORE); mCurrentLevel = savedInstanceState.getInt(STATE_LEVEL);&#125; é‡å¯Activityå…¶ä»–é€‰æ‹© å®˜æ–¹è¯´æ˜Ž é‡å¯åº”ç”¨å¹¶æ¢å¤å¤§é‡æ•°æ®ä¸ä»…æˆæœ¬é«˜æ˜‚ï¼Œè€Œä¸”ä¼šç•™ä¸‹ç³Ÿç³•çš„ä½¿ç”¨ä½“éªŒï¼Œæœ‰ä¸¤ä¸ªå…¶ä»–é€‰æ‹©åœ¨é…ç½®å˜æ›´æœŸé—´ä¿ç•™å¯¹è±¡ Activity å› é…ç½®å˜æ›´è€Œé‡å¯ï¼Œåˆ™å¯é€šè¿‡ä¿ç•™ Fragment æ¥å‡è½»é‡æ–°åˆå§‹åŒ– Activity çš„è´Ÿæ‹… å½“ Android ç³»ç»Ÿå› é…ç½®å˜æ›´è€Œå…³é—­ Activity æ—¶ï¼Œä¸ä¼šé”€æ¯å·²æ ‡è®°ä¸ºè¦ä¿ç•™çš„ Activity çš„ç‰‡æ®µã€‚ æ‚¨å¯ä»¥å°†æ­¤ç±»ç‰‡æ®µæ·»åŠ åˆ° Activity ä»¥ä¿ç•™æœ‰çŠ¶æ€çš„å¯¹è±¡ã€‚ Activityæœ€ä½³å®žè·µçŸ¥æ™“å½“å‰è¿è¡Œçš„æ´»åŠ¨ è‡ªå®šä¹‰BaseActivityç»§æ‰¿è‡ªAppCompatActivityé‡å†™onCreateæ–¹æ³•ï¼Œæ‰“å°å½“å‰è¿è¡Œçš„Activityåappç±»æ‰€æœ‰Activityæ”¹ä¸ºç»§æ‰¿BaseActivity ä»£ç å¦‚ä¸‹ 1234567public class BaseActivity extends AppCompatActivity &#123; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); //æ‰“å°å½“å‰ç±»å Log.d("BaseActivity", getClass().getSimpleName())ï¼› &#125; æ•ˆæžœå¦‚ä¸‹ éšæ—¶é€€å‡ºç¨‹åº æ–°å»ºActivityCollectorç±»ä½œä¸ºæ´»åŠ¨ç®¡ç†å™¨ï¼Œæ·»åŠ /åˆ é™¤Activityç™»è®°,åœ¨BaseActivityä¸­æ·»åŠ å¯¹åº”ä»£ç ã€‚ ä»£ç å¦‚ä¸‹ 1234567891011121314151617181920 public class ActivityCollector &#123;//æ–°å»ºActivityçš„åˆ—è¡¨å¯¹è±¡ public static List&lt;Activity&gt; activities = new ArrayList&lt;&gt;();//æ·»åŠ Activityè¿›å…¥åˆ—è¡¨ public static void addActivity(Activity activity) &#123; activities.add(activity); &#125;//åœ¨åˆ—è¡¨ä¸­ç§»é™¤Activity public static void removeActivity(Activity activity) &#123; activities.remove(activity); &#125;//forå¾ªçŽ¯åˆ—è¡¨ ç»“æŸæ‰€æœ‰Activity public static void finishAll() &#123; for (Activity activity : activities) &#123; if (!activity.isFinishing()) &#123; activity.finish(); &#125; &#125; &#125; &#125; BaseActivityåœ¨onCreate()æ–¹æ³•ä¸­æ·»åŠ  12//Activityç®¡ç†å™¨ä¸­æ·»åŠ æ–°çš„æ´»åŠ¨ActivityCollector.addActivity(this); é‡å†™onDestroy()æ–¹æ³• 123456@Overrideprotected void onDestroy()&#123; super.onDestroy(); //Activityç®¡ç†å™¨ä¸­ç§»é™¤æ´»åŠ¨ ActivityCollector.removeActivity(this);&#125; åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨finishAll()æ–¹æ³•å³å¯ã€‚ å¯åŠ¨æ´»åŠ¨çš„æœ€è¿‘å†™æ³• å¯åŠ¨ä¸‹ä¸€ä¸ªActivityå¹¶ä¼ é€’æ•°æ®æ¨¡å—åŒ– åœ¨SecondActivityå†…å¢žåŠ actionStart()æ–¹æ³• 12345678910 //è°ƒç”¨çš„Activityï¼Œæ•°æ®1ï¼Œæ•°æ®2 public static void actionStart(Context context, String data1, String data2)&#123; //æ–°å»ºIntentï¼Œç»‘å®šSecondActivity Intent intent = new Intent(context,ScendActivity.class); //å­˜å…¥data1ï¼Œdata2 intent.putExtra("param1",data1); intent.putExtra("param2",data2); //å¯åŠ¨Activity context.startActivity(intent);&#125; å¯åŠ¨SecondActivityæ–¹å¼ScendActivity.actionStart(FirestActivity.this,&quot;data1&quot;,&quot;data2&quot;);]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆå…¥æ ‘èŽ“æ´¾2---åˆå§‹åŒ–+è¿œç¨‹æ¡Œé¢]]></title>
    <url>%2F2016%2F11%2F27%2F%E5%88%9D%E5%85%A5%E6%A0%91%E8%8E%93%E6%B4%BE2----%E5%B8%B8%E8%A7%84%E5%88%9D%E5%A7%8B%E5%8C%96%2B%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%2F</url>
    <content type="text"><![CDATA[åˆå§‹åŒ–å¯ç”¨æ ‘èŽ“æ´¾rootç”¨æˆ· ä¸åšç‰©è”ç½‘ç»ˆç«¯æ—¶å¯ç”¨rootç”¨æˆ·æ¯”è¾ƒæ–¹ä¾¿ SSHè¿žæŽ¥æ ‘èŽ“æ´¾ åœ¨å‘½ä»¤è¡Œä¸‹æ‰§è¡Œ å¯ç”¨rootç”¨æˆ· 1sudo passwd root æ‰§è¡ŒåŽè¾“å…¥ä¸¤éä½ è¦è®¾å®šçš„rootå¯†ç  åœ¨è¾“å…¥1sudo passwd â€“unlock root rootç”¨æˆ·è§£é”å®Œæˆ æ‰§è¡Œå®Œæ¯•åŽä¾æ—§æ— æ³•ç™»é™† æ‰§è¡Œ 1sudo nano /etc/ssh/sshd_config æ‰¾åˆ°PermitRootLogin without-password æ”¹ä¸ºPermitRootLogin yes Ctrl + X ã€ Y ã€ å›žè½¦ ä¿å­˜ sudo reboot æ›´æ¢å›½å†…é•œåƒåœ°å€ &gt; http://blog.lxx1.com/2040 ç”±äºŽä¼—æ‰€å‘¨çŸ¥çš„åŽŸå› ï¼Œæ ‘èŽ“æ´¾é“¾æŽ¥å®˜æ–¹æ›´æ–°æºå®žåœ¨å¤ªè¿‡ç¼“æ…¢ï¼Œå›½å†…æœ‰ä¸€æ‰¹ä¸é”™çš„é•œåƒåœ°å€ï¼Œå¯ä»¥è§£å†³ç³»ç»Ÿ/è½¯ä»¶æ›´æ–°é—®é¢˜ã€‚ æ”¶é›†çš„æ ‘èŽ“æ´¾é•œåƒä¸€èˆ¬ä½¿ç”¨æ¯”è¾ƒé¢‘ç¹çš„æœ‰ä¸‹é¢å‡ ä¸ª1.é˜¿é‡Œäº‘ é¦–æŽ¨é•œåƒåœ°å€ï¼Œç§»åŠ¨/è”é€š/ç”µä¿¡ç½‘ç»œéƒ½æœ‰ä¸é”™çš„è®¿é—®é€Ÿåº¦ã€‚2.å¤§è¿žä¸œè½¯ä¿¡æ¯å­¦é™¢ åŒ—æ–¹ç”¨æˆ·æ¯”è¾ƒå‹å¥½3.ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦ æ•™è‚²ç½‘æœ‰åŠ æˆï¼Œéžæ•™è‚²ç½‘å°±æ…¢å¤šäº† è¿™é‡Œé€‰æ‹© é˜¿é‡Œäº‘çš„é•œåƒ æ›´æ–° sources.list æ‰§è¡Œ 1sudo nano /etc/apt/sources.list åˆ é™¤å®˜æ–¹å†…å®¹æˆ–è€…ç”¨#æ³¨é‡ŠæŽ‰ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ 12deb http://mirrors.aliyun.com/raspbian/raspbian/ jessie main non-free contribdeb-src http://mirrors.aliyun.com/raspbian/raspbian/ jessie main non-free contrib åˆ é™¤raspi.listå¤‡ç”¨æ›´æ–°æº(å¯é€‰) é€šå¸¸æ›´æ–°sources.liståŽä¾æ—§ç¼“æ…¢ï¼Œå¤§å¤šæ˜¯raspi.listçš„é”… rm /etc/apt/sources.list.d/raspi.list è®¾ç½®ä¸­æ–‡å­—ä½“ ç³»ç»Ÿä¸­ç¼ºå°‘ä¸­æ–‡å­—åº“ é¦–å…ˆæ›´æ–°å­—åº“å’Œè¾“å…¥æ³• æ‰§è¡Œ 12sudo apt-get install ttf-wqy-zenheisudo apt-get install scim-pinyin æŽ¥ä¸‹æ¥ éƒ½ç‚¹ y æ‰§è¡Œ 1sudo raspi-config é€‰æ‹©change_locale ç©ºæ ¼é”®åœ¨å‰é¢æ‰“å‹¾æˆ–åŽ»æŽ‰å‹¾ï¼ˆæ˜Ÿå·=å‹¾ï¼‰ Tabé€‰æ‹©OK åŽ»æŽ‰en_GB.UTF-8 UTF-8å‹¾é€‰ï¼šâ€en_US.UTF-8 UTF-8â€ã€â€zh_CN.UTF-8 UTF-8â€ã€â€zh_CN.GBK GBKâ€ OKï¼Œä¸‹ä¸€å±å¹•, é»˜è®¤è¯­è¨€é€‰zh_CN.UTF-8 è¿œç¨‹æ¡Œé¢ ç»ˆç«¯æ‰§è¡Œ 1apt-get install xrdp windowsç«¯ CMD æ‰§è¡Œ mstsc è¾“å…¥æ ‘èŽ“æ´¾ipåœ°å€ ç”¨æˆ·å å¯†ç ]]></content>
      <categories>
        <category>æ ‘èŽ“æ´¾</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GitHub-Pagesæ›´æ–°å¯¼è‡´Nextä¸»é¢˜-åšå®¢ä¸»é¡µç©ºç™½ï¼Œè§£å†³æ–¹æ¡ˆ]]></title>
    <url>%2F2016%2F11%2F08%2FGitHub-Pages%E6%9B%B4%E6%96%B0%E5%AF%BC%E8%87%B4Next%E4%B8%BB%E9%A2%98-%E5%8D%9A%E5%AE%A2%E4%B8%BB%E9%A1%B5%E7%A9%BA%E7%99%BD%EF%BC%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%2F</url>
    <content type="text"><![CDATA[å€’è…¾äº†ä¿©å°æ—¶ï¼Œä»¥ä¸ºæ¢¯å­åäº†ï¼Œç»“æžœã€‚ã€‚ã€‚GitHub-Pagesæ›´æ–°äº†ï¼ï¼ï¼ åŽŸå›  GitHub-Pagesæ›´æ–°ï¼Œ è¿‡æ»¤æŽ‰äº† source/vendors ç›®å½•çš„è®¿é—®ã€‚ issueså…¥å£ è§£å†³1æ›´æ–°ä¸»é¢˜ ä½œè€…æ›´æ–°äº†åˆ°æœ€æ–°çš„masteråˆ†æ”¯ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œ Soï¼š 1git pull https://github.com/iissnan/hexo-theme-next themes/next è§£å†³2æ›´æ–°æœ¬åœ°è®¾ç½®ï¼ˆNextæœ€æ–°ç‰ˆï¼‰ å°† source/vendors ç›®å½•ä¿®æ”¹æˆ source/lib ï¼ˆæˆ–è€…å…¶ä»–çš„åç§°ï¼Œåªæ˜¯ lib æˆ‘æµ‹è¯•äº†å¯ä»¥ä½¿ç”¨ï¼‰ï¼›åŒæ—¶ï¼Œä¿®æ”¹ä¸‹ä¸»é¢˜é…ç½®æ–‡ä»¶_config.ymlï¼Œ å°† _internal: vendors æ”¹æˆä½ æ‰€ä¿®æ”¹çš„åå­—ï¼Œä¾‹å¦‚ _internal: libã€‚ è§£å†³3æ›´æ–°æœ¬åœ°è®¾ç½®ï¼ˆNext5.0åŠä»¥ä¸‹ç‰ˆæœ¬ï¼‰ å°† source/vendors ç›®å½•ä¿®æ”¹æˆ source/lib ï¼ˆæˆ–è€…å…¶ä»–çš„åç§°ï¼Œåªæ˜¯ lib æˆ‘æµ‹è¯•äº†å¯ä»¥ä½¿ç”¨ï¼‰ï¼›åŒæ—¶ï¼Œä¿®æ”¹ä¸‹ä¸»é¢˜é…ç½®æ–‡ä»¶_config.ymlï¼Œ vendors: vendors æ”¹æˆä½ æ‰€ä¿®æ”¹çš„åå­—ï¼Œä¾‹å¦‚ _internal: libã€‚]]></content>
      <categories>
        <category>ç‚¹æ»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[è‡ªå»ºDNSæœåŠ¡å™¨(dnsmasq)ï¼Œå¯¹æŠ—DNSæ±¡æŸ“]]></title>
    <url>%2F2016%2F10%2F09%2F%E8%87%AA%E5%BB%BADNS%E8%A7%A3%E5%86%B3%E8%BF%90%E8%90%A5%E5%95%86DNS%E6%B1%A1%E6%9F%93%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯ å­¦æ ¡ç½‘ç»œå‡ºå£åŠ«æŒä¸¥é‡ï¼Œä¸Šæ·˜å®åŠ è¿”åˆ©â€”â€”â€”-ç­‰ç­‰ç­‰ç­‰ç­‰ç­‰ ä¸€ç›´æ›´æ–°hostsä¸æ–¹ä¾¿ï¼Œè¦ä¸Šgoogleï¼Œå…¨å¹³å°ä¸å¥½å¼„ é¡¹ç›®ç»„éœ€è¦ ç›®çš„ æ­å»ºä¸€ä¸ªå¯è®¿é—®ä¸ªäººå…¬ç½‘DNSæœåŠ¡å™¨ æé«˜DNSåŠ è½½é€Ÿåº¦ è§„é¿è¿è¥å•†çš„DNSåŠ«æŒ ä¸å½±å“å­¦æ ¡å†…ç½‘è®¿é—® ç®€å•çš„èƒ½ä¸Šgoogle å‡†å¤‡ ä¸€å°æœ‰å…¬ç½‘IPçš„vpsï¼Œå¼€æ”¾äº†53ç«¯å£ï¼ˆç«¯å£æ‰«ææ˜¾ç¤ºå¼€æ”¾äº†53ç«¯å£ï¼‰ è£…çš„æ˜¯linuxç³»ç»Ÿï¼ˆä»¥ CentOS 6.4 ä¸ºä¾‹ï¼‰ WinSCPï¼ˆæˆ–å…¶ä»–æ–‡ä»¶ç®¡ç†ï¼‰ putty.exeï¼ˆæˆ–è€…å…¶ä»–SSHç™»é™†å·¥å…·ï¼‰ æ²¡äº†ã€‚ã€‚ã€‚ã€‚ DNSmasqåŽŸç†å’Œè¯´æ˜Ž DNSmasqæ˜¯ä¸€ä¸ªå°å·§ä¸”æ–¹ä¾¿åœ°ç”¨äºŽé…ç½®DNSå’ŒDHCPçš„å·¥å…·ï¼Œé€‚ç”¨äºŽå°åž‹ç½‘ç»œã€‚ä½œä¸ºåŸŸåè§£æžæœåŠ¡å™¨(DNS)ï¼Œdnsmasqå¯ä»¥é€šè¿‡ç¼“å­˜ DNS è¯·æ±‚æ¥æé«˜å¯¹è®¿é—®è¿‡çš„ç½‘å€çš„è¿žæŽ¥é€Ÿåº¦ã€‚ é€šè¿‡è®¾ç½®DNSmasqçš„ä¸Šæ¸¸DNSåœ°å€ä¸ºæ— æ±¡æŸ“DNSæ¥è§£å†³è¿è¥å•†çš„DNSæ±¡æŸ“ã€‚ DNSmasqå¯ä»¥å¯¹å•ç‹¬çš„ç½‘å€è®¾ç½®DNSæœåŠ¡å™¨ã€‚å¯¹äºŽå­¦æ ¡å†…ç½‘åœ°å€è®¾ç½®ä¸ºå­¦æ ¡æ•™è‚²ç½‘çš„DNSè§£æžã€‚å¯¹äºŽç±»ä¼¼äºŽyoutubeè¿™ç§ç”±äºŽDNSæ±¡æŸ“æ²¡æ³•è®¿é—®çš„åœ°å€ï¼Œå¯ä»¥å…ˆæ”¶é›†æ— æ±¡æŸ“çš„DNSåœ°å€ï¼Œç„¶åŽäº¤ä¸Žæ— æ±¡æŸ“DNSè§£æžå¾—åˆ°æ­£ç¡®åœ°å€ã€‚ DNSmasqå†å¯¹ç½‘å€æäº¤ä¸Šæ¸¸DNSè§£æžå‰ï¼Œå¯ä»¥å…ˆé€šè¿‡æœ¬åœ°hostsåŒ¹é…ã€‚è®¾ç½®åˆé€‚hostså¯ä»¥å®žçŽ°ç§‘å­¦ä¸Šç½‘ã€‚ å¼€å§‹ï¼ æ­¥éª¤å®‰è£…dnsmasq 1yum install dnsmasq -y é…ç½®Dnsmasq Dnsmasqçš„é…ç½®æ–‡ä»¶æ˜¯ /etc/dnsmasq.conf .é€šè¿‡WinSCPåŠ è½½ä¿®æ”¹ã€‚ dnsmasq.confè®¾ç½®é¡¹è¯´æ˜Ž æ­¤æ¬¡ä½¿ç”¨çš„é…ç½®å¦‚ä¸‹ 1234567891011 #æŒ‡å®šç»™dnsmasqä½¿ç”¨çš„hosts addn-hosts=/etc/dnsmasq.host #ä¸ä½¿ç”¨/etc/resolv.conf(VPSé»˜è®¤DNS)æ¥è¿›è¡Œä¸Šæ¸¸dnsæœåŠ¡å™¨è§£æžéœ€è¦é…ç½®çš„æ¯”è¾ƒå°‘ç›´æŽ¥å†™åœ¨dnsmasq.confæ–‡ä»¶é‡Œäº† no-resolv #ä¸Šæ¸¸DNSåœ°å€è¿™é‡Œä¸ºè…¾è®¯DNSå’Œä¸­ç§‘å¤§DNSserver=119.29.29.29server=202.141.162.123server=/google.com/202.141.162.123 #è¿™ä¸€è¡Œæ˜¯é’ˆå¯¹å­¦æ ¡å†…ç½‘è®¿é—®ï¼Œå­¦æ ¡å†…åœ°å€ä½¿ç”¨å­¦æ ¡å†…ç½‘DNSã€‚å…·ä½“åœ°åŒºè°ƒæ•´ã€‚server=/.edu.cn/202.141.162.123 ä¸Šæ¸¸DNSæŽ¨è è¿™é‡Œéœ€è¦åœ¨VPSä¸Šæµ‹è¯•å„ä¸ªDNSåŽå†³å®šã€‚ å¸¸ç”¨é è°±DNS é˜¿é‡ŒDNS 223.5.5.5 223.6.6.6 114DNS 114.114.114.114 è…¾è®¯DNS 119.29.29.29 V2EX DNS 199.91.73.222 178.79.131.110ï¼ˆè®¿é—®è‹¹æžœå•†åº—æœ‰buffåŠ é€Ÿï¼‰ æ— æ±¡æŸ“DNS ç›®å‰æ¯”è¾ƒç¨³å®šçš„åªæœ‰ä¸­ç§‘å¤§DNSå’Œä¸€äº›è‡ªå»ºçš„å°åž‹DNSã€‚å°åž‹DNSé€šè¿‡åå¸¦æ¥è®¿é—®googleç­‰ï¼Œä¼šå¸¦æ¥ä¸€äº›éšç§å’Œå®‰å…¨é£Žé™©ï¼Œè¿˜æ˜¯æŽ¨èè‡ªå»ºDNS/hostsè®¿é—®ã€‚ ä¸­ç§‘å¤§DNS 202.38.93.153 ï¼ˆæ•™è‚²ç½‘ï¼‰ 202.141.176.93 ï¼ˆä¸­å›½ç§»åŠ¨ï¼‰ 202.141.162.123 ï¼ˆä¸­å›½ç”µä¿¡ï¼‰ å…¶ä»–DNSè¯·è‡ªè¡ŒGOOGLE åƒä¸‡æ³¨æ„ï¼ï¼ï¼ é…ç½®æ–‡ä»¶ä¸­æœ‰listen-addressé…ç½®ï¼Œç½‘ç»œå¤§å¤šæ•°æ•™ç¨‹ä¸­æœ‰listen-address=127.0.0.1è¿™æ˜¯æŒ‡DnsmasqåªæœåŠ¡äºŽæœ¬æœºçš„DNSè¯·æ±‚ã€‚å¦‚æžœéœ€è¦æ­å»ºå…¬ç½‘DNSæœåŠ¡ï¼Œè¿™ä¸ªç»å¯¹ä¸èƒ½æœ‰ï¼ï¼ åˆ›å»º/ä¿®æ”¹/etc/dnsmasq.hostæ–‡ä»¶ ä¸€äº›å¸¸ç”¨åŽ»å¹¿å‘Šhosts/ç§‘å­¦ä¸Šç½‘hostsçš„å†…å®¹ï¼Œ å…·ä½“ä¸å¤šè¯´hostsç§‘å­¦ä¸Šç½‘æ˜¯ä¸€å¤©æ¯”ä¸€å¤©æ­»çš„å¿«ã€‚æ²¡æœ‰æ‰¾åˆ°é è°±çš„åœ°å€æŽ¨èã€‚è‡ªè¡Œæœç´¢æŠŠï¼ é‡å¯DnsmasqæœåŠ¡ 1sudo service dnsmasq restart æµ‹è¯•53ç«¯å£ 1netstat -tunlp|grep 53 å¦‚æžœæ­£å¸¸åº”è¯¥å¦‚ä¸‹ 123[root@VM_27_70_centos ~]# netstat -tunlp|grep 53tcp 0 0 0.0.0.0:53 0.0.0.0:* LIST EN 4226/dnsmasqudp 0 0 0.0.0.0:53 0.0.0.0:* 4226/dnsmasq ä¿®æ”¹æœ¬åœ°DNSåœ°å€ è¿™ä¸ªä¸å¤šè¯´äº†ï¼Œä¸ä¼šçš„è‡ªè¡Œgoogleäº†ã€‚ã€‚ ç»“æŸè¯­åˆ›å»ºå®Œäº†ï¼Œæœ¬åœ°DNSå¿«å¤šäº†ï¼Œè®¿é—®æ·˜å®å†ä¹Ÿæ²¡æœ‰äº†ç‰›çš®ç™£ã€‚ å‚è€ƒæ–‡çŒ® http://blog.antior.cn/posts/2015_29.htmlhttp://www.jianshu.com/p/71ccc79aaa9ehttp://www.linuxdown.net/install/soft/2016/0520/5566.htmlhttp://blog.cnwyhx.com/centos-linux-dnsmasq-install-dns/]]></content>
      <categories>
        <category>æ ‘èŽ“æ´¾</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>VPS</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android]]></title>
    <url>%2F2016%2F07%2F17%2FAndroid%E6%B1%87%E6%80%BB%2F</url>
    <content type="text"><![CDATA[Andoridç¬”è®°ç³»åˆ—1234567891011121314151617181920æ›´æ–°2016.07.20 ç¬¬ä¸€è¡Œä»£ç Activityåˆ›å»ºéƒ¨åˆ†å®Œæˆ2016.07.21 å®Œæˆæ·»åŠ äº†buttonå’Œmenuéƒ¨åˆ†ï¼Œå¯¹åº”P39é¡µ2016.07.22 å®Œæˆäº†P55é¡µä¹‹å‰çš„activityéƒ¨åˆ†ã€‚å¯¹äºŽactivityï¼ˆäºŒï¼‰2016.08.10 åŸºæœ¬æžå®šï¼ŒUIé™¤ListViewä»¥å¤–çš„éƒ¨åˆ†ã€‚4ç§å¸ƒå±€æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä¸å†æŠ˜è…¾ã€‚2016.08.11 å¼€å§‹ListViewéƒ¨åˆ†2016.08.14 åœæ›´åŠæœˆ2016.09.02 æ¢å¤æ›´æ–°2016.09.03 Broadcastéƒ¨åˆ†å¼€å‘ã€‚2016.09.07 ListViewéƒ¨åˆ†é™¤BaseAdapterå¤–å®Œæˆã€‚BaseAdapterå†…å®¹ï¼Œä»€ä¹ˆæ—¶å€™ç†è§£æ·±ä¸€ç‚¹å†è¡¥ä¸Šã€‚2016.09.13 å®Œæˆäº†Broadcastå¯¹åº”éƒ¨åˆ†2016.10.03 é‡æ–°æŒ‰ç…§googleçš„æ–‡æ¡£æŸ¥æ¼è¡¥ç¼º.2016.10.03 æ›´åAndroidç¬”è®°ï¼Œé‡æ–°å¼€å§‹æ›´æ–°ã€‚2016.12.05 ç¬¬äºŒè¡Œä»£ç å¼€å§‹ï¼2016.12.07 é‡æ–°æ•´ç†Androidç³»åˆ—ç¬”è®°ï¼Œä»Ž0æ•´åˆ2016.12.08 Activityéƒ¨åˆ†æ•´åˆå®Œæˆ2016.12.13 UIéƒ¨åˆ†åŸºç¡€å®Œæˆï¼ŒLIstViewéƒ¨åˆ†å®Œæˆ2016.12.16 RecycleViewéƒ¨åˆ†ï¼ŒåŸºç¡€å®Œæˆï¼Œæœ‰å¾…è¿›ä¸€æ­¥å¡«å‘ 2016.12.22 Fragmentå®Œæˆï¼Œæœ‰ä¸€ä¸ªå å‘2016.12.23 Broadcastå®Œæˆ]]></content>
      <categories>
        <category>Androidç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android Studio</tag>
        <tag>Android</tag>
        <tag>å­¦ä¹ è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å•ç‰‡æœºè¯¾ç¨‹è®¾è®¡æ€»ç»“]]></title>
    <url>%2F2016%2F07%2F09%2F%E5%8D%95%E7%89%87%E6%9C%BA%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[ç´¯æ­»äººçš„å•ç‰‡æœºè¯¾ç¨‹è®¾è®¡ç»ˆäºŽç»“æŸäº†ï¼Œå¿™äº†ä¸¤å¤©å¤šã€‚å°±æ˜¯ä¸ªæ•°ç ç®¡+ADCã€‚çœ‹çœ‹è‡ªå·±ä¸¤å¹´å¤šå‰å†™çš„ç¨‹åºã€‚ã€‚è¿™æ„Ÿè§‰ã€‚ç”¨äº†ä¸€å¤©å¤šé‡æž„ã€‚ã€‚ã€‚ã€‚ä¹‹å‰å†™ç¨‹åºçš„é‚£ä¸ªä¹±å•Šã€‚ã€‚ã€‚é‡æ–°æ•´ç†ä¸‹ï¼Œè‡ªå·±çš„åº“å‡½æ•°ã€‚è®°å½•äºŽæ­¤ã€‚ 1602åº“å‡½æ•°1602.h1234567891011121314151617181920212223242526272829303132333435363738/*æ¨¡ å— åï¼š LCD1602 *//*åˆ› å»º äººï¼šzyy æ—¥æœŸï¼š2014-11-04 *//*ä¿® æ”¹ è€…ï¼šjs æ—¥æœŸï¼š2016-07-08 *//*ç‰ˆ æœ¬2.1 *//*ä½¿ç”¨æ–¹æ³•ï¼šé¦–å…ˆè°ƒç”¨LCDåˆå§‹åŒ–å‡½æ•°void LcdInit()ï¼› è¾“å…¥ä¸€ä¸ªdoubleç±»åž‹æ•°æ®è°ƒç”¨void LcdDisplay(double temp); æ˜¾ç¤ºåœ¨ç¬¬äºŒè¡Œï¼›å¦‚éœ€ä¿®æ”¹ç¬¬ä¸€è¡Œæ•°æ®å¯åœ¨LcdDisplayå‡½æ•°ä¸­ä¿®æ”¹ *//* BUG : ç¬¬äºŒè¡Œdoubleæ•°æ®æ˜¾ç¤ºæœ€åŽä¸€ä½åŽï¼Œä¼šè·Ÿéšä¸€ä½ä¹±ç  */#include &lt;stc12c5a60s2.h&gt; #include &lt;intrins.h&gt;#include &lt;stdio.h&gt;#include &lt;math.h&gt;#define uint unsigned int#define uchar unsigned charsbit lcdrs = P1^7;sbit lcden = P2^4;sbit rw = P1^6;#define lcd_data_port P0void sdelay(uint s); //é€šç”¨å»¶è¿Ÿå‡½æ•°void write_com(uchar com); //å¹¶å£å†™æ•°æ®void write_data(uchar date); //å¹¶å£å†™æ•°æ®void LcdInit(); //1602åˆå§‹åŒ–void LcdDisplay(double temp,uint t); //æ˜¾ç¤ºå‡½æ•° 1602.c123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104//1602.cinclude &lt;1602.h&gt;/*æ¨¡ å— åï¼š LCD1602 *//*åˆ› å»º äººï¼šzyy æ—¥æœŸï¼š2014-11-04 *//*ä¿® æ”¹ è€…ï¼šjs æ—¥æœŸï¼š2016-07-08 *//*ç‰ˆ æœ¬2.1 *//**********************************************/void sdelay(uint s) //é€šç”¨å»¶è¿Ÿå‡½æ•°&#123; uint x,y; for(x=s;x&gt;0;x--) for(y=250;y&gt;0;y--);&#125;/**********************************************/void write_com(uchar com) //å¹¶å£å†™æ•°æ®&#123; lcdrs=0; lcden=0; lcd_data_port=com; sdelay(1); lcden=1; sdelay(1); lcden=0;&#125;void write_data(uchar date) //å¹¶å£å†™æ•°æ®&#123; lcdrs=1; lcden=0; lcd_data_port=date; sdelay(1); lcden=1; sdelay(1); lcden=0;&#125;/*********************************************************************** å‡½ æ•° å: LcdInit* åŠŸèƒ½æè¿°: LCDåˆå§‹åŒ–* å‡½æ•°è¯´æ˜Ž: åˆå§‹åŒ–æ•°æ®ï¼š0x38 0x0c 0x06 0x01* è°ƒç”¨å‡½æ•°: sdelayï¼ˆï¼‰ï¼Œwrite_comï¼ˆï¼‰ï¼Œ write_dataï¼ˆï¼‰* è¾“ å…¥: æ— * è¿” å›ž: æ— * è®¾ è®¡ è€…ï¼šzyy æ—¥æœŸï¼š2014-12-23* ç‰ˆ æœ¬ï¼š 1.0***********************************************************************/void LcdInit() //1602åˆå§‹åŒ–&#123; lcden=0; rw=0; write_com(0x38); write_com(0x0c); write_com(0x06); write_com(0x01);&#125;/*********************************************************************** å‡½ æ•° å: LcdDisplay* åŠŸèƒ½æè¿°: LCDæ˜¾ç¤º* å‡½æ•°è¯´æ˜Ž: doubleç±»åž‹æ•°æ®è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œåœ¨lcdç¬¬äºŒè¡Œæ˜¾ç¤ºã€‚* è°ƒç”¨å‡½æ•°: sprintf(),write_com(),sdelay()* å…¨å±€å˜é‡: æ— * è¾“ å…¥: ä¸€ä¸ªdoubleç±»åž‹å˜é‡å€¼* è¿” å›ž: æ— * è®¾ è®¡ è€…ï¼šzyy æ—¥æœŸï¼š2014-12-23* ä¿® æ”¹ è€…ï¼šjs æ—¥æœŸï¼š2016-07-08* ç‰ˆ æœ¬ï¼š 2.0***********************************************************************/void LcdDisplay(double temp,uint t) //æ˜¾ç¤ºå‡½æ•°&#123;static uchar table0[]=&#123;"pm "&#125;; //1602é»˜è®¤ç¬¬ä¸€è¡Œstatic uchar table1[]=&#123;"00.0 "&#125;;uchar num=0;sprintf(table1,"%f",(double)temp);sprintf(table1+8,"%2d",(uint)t); write_com(0x80); for(num=0;num&lt;15;num++) //ç¬¬ä¸€è¡Œåˆ·æ–° &#123; write_data(table0[num]); sdelay(5); &#125; write_com(0x80+0x40); for(num=0;num&lt;16;num++) //ç¬¬äºŒè¡Œæ˜¾ç¤º &#123;write_data(table1[num]); //0.0195 sdelay(5); &#125;&#125; æ•°ç ç®¡ å¯¹åº”ç”µè·¯å›¾å¦‚ä¸‹shu.h12345678910111213141516171819202122232425262728293031323334353637/*æ¨¡ å— åï¼š æ•°ç ç®¡ *//*åˆ› å»º äººï¼šzy æ—¥æœŸï¼š2014-07-01 *//*ç‰ˆ æœ¬1.2 *//*ä½¿ç”¨æ–¹æ³•ï¼šè°ƒç”¨ Shu_Display(double js)å‡½æ•°ï¼Œè¾“å…¥ä¸€ä¸ªdoubleç±»åž‹æ•°æ®ï¼Œ å›ºå®šæ˜¾ç¤ºæ ¼å¼ä¸ºå°æ•°ç‚¹å‰4ä½åŠå°æ•°ç‚¹åŽä¸¤ä½ã€‚ *//*BUGï¼šæ˜¾ç¤ºå°æ•°ç‚¹åŽç¬¬äºŒä½æ—¶ï¼Œæœ‰æ—¶ä¼šä¸Žè¾“å…¥å€¼å°1.åŽŸå› ç–‘ä¼¼ä¸Žfmod()å‡½æ•°æœ‰å…³ */#include &lt;stc12c5a60s2.h&gt; #include &lt;intrins.h&gt;#include &lt;stdio.h&gt;#include &lt;math.h&gt;#define uint unsigned int#define uchar unsigned char //ç«¯å£å®šä¹‰#define io_dm P0 //å®šä¹‰LEDæ˜¾ç¤ºçš„æ®µç æ•°æ®è„šsbit io_shu = P2^3; //æ•°ç ç®¡å¼€å…³ä½Žç”µå¹³æœ‰æ•ˆsbit io_A = P2^0; //3-8è¯‘ç å™¨è¾“å…¥sbit io_B = P2^1;sbit io_C = P2^2;sbit io_DP = P0^7; //dpç‚¹å®šä¹‰extern uchar du_num[15];void delay_1ms(uchar x); //1mså»¶è¿Ÿå‡½æ•°void wei(uchar i); //ä½é€‰è¾“å‡ºå‡½æ•°void Shu_Display(double js);//æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•° shu.c123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293#include &lt;shu.h&gt; /*æ¨¡ å— åï¼š æ•°ç ç®¡ *//*åˆ› å»º äººï¼šzy æ—¥æœŸï¼š2014-07-01 *//*ç‰ˆ æœ¬1.2 *///æ˜¾ç¤ºæ•°å­—uchar du_num[]=&#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71&#125;;// 0 1 2 3 4 5 6 7 8 9 a b c d e f void delay_1ms(uchar x)//1mså»¶è¿Ÿå‡½æ•°&#123; uchar j; while(x--)&#123; for(j=0;j&lt;125;j++) &#123;;&#125; &#125; &#125;void wei(uchar i) //ä½é€‰ä¿¡å·è¾“å…¥&#123; //i=i+1; switch (i) &#123; case 0:&#123;io_A=0;io_B=0;io_C=0;&#125; break; case 1:&#123;io_A=1;io_B=0;io_C=0;&#125; break; case 2:&#123;io_A=0;io_B=2;io_C=0;&#125; break; case 3:&#123;io_A=1;io_B=1;io_C=0;&#125; break; case 4:&#123;io_A=0;io_B=0;io_C=1;&#125; break; case 5:&#123;io_A=1;io_B=0;io_C=1;&#125; break; case 6:&#123;io_A=0;io_B=1;io_C=1;&#125; break; default: ; break; &#125;&#125; /*********************************************************************** å‡½ æ•° å: Shu_Display() * åŠŸèƒ½æè¿°: å°†æ•°å­—æ˜¾ç¤ºåˆ°æ•°ç ç®¡ä¸Šï¼Œæ˜¾ç¤ºæ ¼å¼4+2* å‡½æ•°è¯´æ˜Ž: æ®µé€‰ä½é€‰ï¼ŒåŠ¨æ€åˆ·æ–°æ•°ç ç®¡* è°ƒç”¨å‡½æ•°: delay_1ms fmod()* å…¨å±€å˜é‡: æ— * è¾“ å…¥: 1ä¸ªdoubleç±»åž‹æ•°æ®* è¿” å›ž: æ— * è®¾ è®¡ è€…ï¼šzy æ—¥æœŸï¼š2014-07-01 * ä¿® æ”¹ è€…ï¼šzy æ—¥æœŸï¼š2016-07-08* ç‰ˆ æœ¬ï¼š 1.2***********************************************************************/void Shu_Display(double js)&#123;uchar i; //å¾ªçŽ¯å˜é‡ static uchar suff[6]; //æ•°æ®å¤„ç†æš‚å­˜æ•°ç»„ static uint cuff[4]; //æå–å„ä½æœ‰å…³ static double n=1,y; //ä¸Žå°æ•°æˆªå–æœ‰å…³ static uint count; //æš‚å­˜ y=fmod(js,n); //åˆ†ç¦»jså°æ•°éƒ¨åˆ† å­˜åœ¨yä¸­ count=js; //å¼ºåˆ¶ç±»åž‹è½¬æ¢ï¼Œå–jsæ•´æ•°éƒ¨åˆ† suff[0] = count/1000; //å–åƒä½ cuff[0] = count%1000; suff[1] = cuff[0]/100; //å–ç™¾ä½ cuff[1] = cuff[0]%100; suff[2] = cuff[1]/10; //å–åä½ suff[3] = cuff[1]%10; //å–ä¸ªä½ count = y*1000; //å°æ•°éƒ¨åˆ†ã€‚æ‰©å¤§1000å€æå–ã€‚ cuff[2] = count%1000; suff[4] = cuff[2]/100; //å°æ•°ç‚¹åŽä¸€ä½ cuff[3] = cuff[2]%100; suff[5] = cuff[3]/10; //å°æ•°ç‚¹åŽ2ä½ io_shu=0; //æ‰“å¼€3-8è¯‘ç å™¨ for(i=0;i&lt;6;i++) &#123; wei(i); //ä½é€‰ io_dm=du_num[suff[i]];//æ®µé€‰ if(i==3) io_DP=1; delay_1ms(1); //å»¶è¿Ÿ &#125; &#125;]]></content>
      <categories>
        <category>ç”µå­ç±»</category>
      </categories>
      <tags>
        <tag>å•ç‰‡æœº</tag>
        <tag>å¼€æº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ï¼ˆäºŒï¼‰â€”â€”VPSä¼˜åŒ–åŠ é€Ÿ]]></title>
    <url>%2F2016%2F06%2F27%2FVPS%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E6%95%99%E7%A8%8B%E7%B3%BB%E5%88%972%2F</url>
    <content type="text"><![CDATA[12345678910æ›´æ–°2016.06.26 ä¸ŽSSRæœ‰å…³éƒ¨åˆ†åŸºæœ¬å®Œæˆã€‚2016.06.28 TCPä¼˜åŒ–éƒ¨åˆ†å®Œæˆ2016.06.29 gfw.pressã€FinalSpeedå’Œé”é€Ÿéƒ¨åˆ†åŸºæœ¬å®Œæˆã€‚2016.12.11 é‡æ–°æ•´ç†ç›¸å…³å†…å®¹ï¼Œå¢žåŠ SSRæ··æ·†2016.12.15 å¢žåŠ TCP-BBR2017.01.11 æ•´ç†ç›¸å…³å†…å®¹ï¼Œå¢žåŠ é”é€Ÿé…ç½®ä¼˜åŒ– 2017.03.28 æ›´æ–°ä¸€éƒ¨åˆ†é…ç½®å†…å®¹ï¼Œåˆ é™¤æ— æ•ˆå†…å®¹2017.04.02 å› 91yunè¢«çˆ†éšç§é—®é¢˜ï¼Œåˆ é™¤å…¶å¯¹åº”å†…å®¹2017.07.03 æ›´æ–°å¤§é‡é”é€Ÿ/bbrå†…å®¹ï¼Œç§»é™¤GFW.Presså’Œå…¶ä»–å†…å®¹ TCPä¼˜åŒ–ï¼ˆéžBBRé€‚ç”¨ï¼‰ä½¿ç”¨å»ºè®® å»ºè®®ç§‘å­¦ä¸Šç½‘æœåŠ¡å™¨éƒ½è¿›è¡Œä¸€éTCPä¼˜åŒ– ä¸Žå…¶ä»–åŠ é€Ÿæ‰‹æ®µå…¼å®¹ ä½¿ç”¨ BBR åŠ é€Ÿå¯ä»¥ç•¥è¿‡æ­¤éƒ¨åˆ†(å·²åŒ…å«) å…·ä½“æ­¥éª¤ é€‚ç”¨åœºæ™¯ï¼šé«˜å»¶è¿Ÿæžä¸¢åŒ…çº¿è·¯ å¢žåŠ TCPè¿žæŽ¥æ•°é‡ 1nano /etc/security/limits.conf æ·»åŠ ä¸¤è¡Œï¼š 12* soft nofile 51200* hard nofile 51200 ä¿å­˜(Ctrl + X â€”â€” y â€”â€”å›žè½¦) è®¾ç½®ulimitï¼š 1ulimit -n 51200 ä¿®æ”¹å†…æ ¸å‚æ•°é€‚åˆçš„è¿˜æ˜¯hyblaï¼ˆé«˜å»¶è¿Ÿé«˜ä¸¢åŒ…çŽ‡çŽ¯å¢ƒï¼‰é¦–å…ˆçœ‹ä¸€ä¸‹VPSçŽ°æœ‰ç®—æ³•ï¼š 1sysctl net.ipv4.tcp_available_congestion_control æ²¡æœ‰hyblaæ—¶ï¼ŒåŠ è½½hyblaç®—æ³•. 1/sbin/modprobe tcp_hybla å¼€å§‹ä¿®æ”¹ 1nano /etc/sysctl.conf å¤åˆ¶ä»£ç ï¼š 1234567891011121314151617181920212223#TCPé…ç½®ä¼˜åŒ–(ä¸ç„¶ä½ è‡ªå·±æ ¹æœ¬ä¸çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆ)fs.file-max = 51200#æé«˜æ•´ä¸ªç³»ç»Ÿçš„æ–‡ä»¶é™åˆ¶net.core.rmem_max = 67108864net.core.wmem_max = 67108864net.core.netdev_max_backlog = 250000net.core.somaxconn = 4096net.ipv4.tcp_syncookies = 1net.ipv4.tcp_tw_reuse = 1net.ipv4.tcp_tw_recycle = 0net.ipv4.tcp_fin_timeout = 30net.ipv4.tcp_keepalive_time = 1200net.ipv4.ip_local_port_range = 10000 65000net.ipv4.tcp_max_syn_backlog = 8192net.ipv4.tcp_max_tw_buckets = 5000net.ipv4.tcp_fastopen = 3net.ipv4.tcp_mem = 25600 51200 102400net.ipv4.tcp_rmem = 4096 87380 67108864net.ipv4.tcp_wmem = 4096 65536 67108864net.ipv4.tcp_mtu_probing = 1net.ipv4.tcp_congestion_control = hybla#END OF LINE ä¿å­˜(Ctrl + X â€”â€” y â€”â€”å›žè½¦) åº”ç”¨ 1sysctl -p é‡å¯SSR 1/etc/init.d/shadowsocks restart é”é€Ÿ ä»‹ç»é”é€Ÿï¼ˆServerSpeederï¼‰åŠ é€Ÿè½¯ä»¶æ˜¯ä¸€ç§åŸºäºŽZETATCPåŠ é€Ÿå¼•æ“Žçš„è½¯ä»¶ï¼Œåªéœ€å•è¾¹éƒ¨ç½²å°±å¯ä»¥èµ·åˆ° æ˜¾è‘—åŠ é€Ÿæ•ˆæžœçš„ TCP åŠ é€ŸæŠ€æœ¯ã€‚ ä½¿ç”¨å»ºè®®(7.03) é™¤éžå¯¹éšç§è¦æ±‚ç‰¹åˆ«é«˜ï¼ŒåŠ é€Ÿæ‰‹æ®µé¦–å…ˆå‚æ•°é”é€Ÿ ä¸Ž BBR ç›®å‰ä¸å…¼å®¹ï¼ŒäºŒè€…å–å…¶ä¸€å¯æ»¡è¶³å¤§éƒ¨åˆ†éœ€è¦åŠ é€Ÿåœºæ™¯ é»˜è®¤å‚æ•°å³å¯æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯ï¼Œé™¤éžå¾ˆæ…¢ï¼Œå¦åˆ™ä¸æŽ¨èæ›´æ”¹é…ç½®æ–‡ä»¶ é”é€Ÿç›®å‰å·²ç»åŸºæœ¬åœæ­¢è¿è¥ï¼Œè€Œä¸”æ¯å…¬å¸LotServeré¢å‘ä¼ä¸šç”¨æˆ·è¿˜åœ¨è¿è¥ ä»¥ä¸‹æä¾›çš„ç ´è§£ç‰ˆå®‰è£…æ–¹å¼ï¼Œæ”¶é›†è‡ªç½‘ç»œã€‚ä»…ä¾›ä¸ªäººå®žéªŒä½¿ç”¨ï¼Œè¯·æ”¯æŒæ­£ç‰ˆã€‚ é”é€Ÿå®‰è£… å®‰è£…åŒ…æ¥è‡ª @Vicer æ„Ÿè°¢åŽŸä½œè€…ï¼ é”é€Ÿä¸€é”®å®‰è£…åŒ… å‚è€ƒ https://github.com/0oVicero0/serverSpeeser_Install å®‰è£… 1wget --no-check-certificate -qO /tmp/appex.sh "https://raw.githubusercontent.com/0oVicero0/serverSpeeder_Install/master/appex.sh" &amp;&amp; bash /tmp/appex.sh 'install' ä¸­é—´æç¤ºå…¨éƒ¨è¾“å…¥ y å³å¯ï¼Œç­‰å¾…å®‰è£…å®Œæˆ å¸è½½ 1wget --no-check-certificate -qO /tmp/appex.sh "https://raw.githubusercontent.com/0oVicero0/serverSpeeder_Install/master/appex.sh" &amp;&amp; bash /tmp/appex.sh 'uninstall' å¸¸ç”¨å‘½ä»¤ å¯åŠ¨å‘½ä»¤ /appex/bin/lotServer.sh start çŠ¶æ€æŸ¥è¯¢ /appex/bin/lotServer.sh status åœæ­¢åŠ é€Ÿ /appex/bin/lotServer.sh stop æ›´æ–°è®¸å¯ /appex/bin/serverSpeeder.sh renewLic é‡æ–°å¯åŠ¨ /appex/bin/serverSpeeder.sh restart (7.03)é”é€Ÿé…ç½®æ–‡ä»¶ä¼˜åŒ– è¯¦ç»†é…ç½®æ–‡æ¡£ https://github.com/0oVicero0/serverSpeeder_Install/blob/master/lotServer.pdf é…ç½®æ–‡ä»¶åœ¨/serverspeeder/etc/config é¦–å…ˆç¡®ä¿ä¸‹é¢3ä¸ªå‚æ•°å¼€å¯ 123rsc="1"advinacc="1"maxmode="1" rsc=â€1â€³ #RSC ç½‘å¡é©±åŠ¨æ¨¡å¼advinacc=â€1â€³ #æµé‡æ–¹å‘åŠ é€Ÿmaxmode=â€1â€³ #æœ€å¤§ä¼ è¾“æ¨¡å¼ DO vpsè¿˜è¦å¼€å¯gso ä¸‹é¢æ˜¯ä¸€äº›ä¸ªäººæµ‹è¯•å¯¹åŠ é€Ÿæœ‰æ•ˆæžœçš„é€‰é¡¹ï¼Œè¯·ç»“åˆç½‘ç»œçŽ¯å¢ƒè‡ªè¡Œæµ‹è¯• æ‚é¡¹ initialCwndWan=â€œ64â€³åˆå§‹ TCP å‘é€çª—å£èƒ½å¤Ÿå‘é€çš„æ•°æ®åŒ…çš„æ•°é‡ï¼Œè¯¥å€¼è®¾ç½®çš„é«˜ä¼šèŽ·å¾—æ›´å¥½çš„åŠ é€Ÿæ•ˆæžœï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆç½‘ç»œçš„æ‹¥å¡žã€‚ä½¿ç”¨å€¼åœ¨60ä»¥ä¸‹æœ‰æ•ˆæžœ l2wQLimit=â€1024 4096â€³ä»Ž LAN åˆ° WAN åŠ é€Ÿå¼•æ“Žåœ¨ç¼“å†²æ± å……æ»¡å’Œç©ºé—²æ—¶åˆ†åˆ«èƒ½å¤Ÿç¼“å­˜çš„æ•°æ®åŒ…é˜Ÿåˆ—çš„é•¿åº¦çš„ä¸Šé™ï¼Œè¯¥å€¼è®¾ç½®çš„é«˜ä¼šèŽ·å¾—æ›´å¥½çš„åŠ é€Ÿæ•ˆæžœï¼Œä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚w2lQLimit=â€1024 4096â€³ä»Ž WAN åˆ° LAN åŠ é€Ÿå¼•æ“Žåœ¨ç¼“å†²æ± å……æ»¡å’Œç©ºé—²æ—¶åˆ†åˆ«èƒ½å¤Ÿç¼“å­˜çš„æ•°æ®åŒ…é˜Ÿåˆ—çš„é•¿åº¦çš„ä¸Šé™ï¼Œè¯¥å€¼è®¾ç½®çš„é«˜ä¼šèŽ·å¾—æ›´å¥½çš„åŠ é€Ÿæ•ˆæžœï¼Œä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚ halfCwndMinSRtt=â€500â€³halfCwndLossRateShift=â€3â€³ä»¥ä¸Šä¸¤ä¸ªå€¼ç”¨äºŽåˆ¤æ–­ç½‘ç»œæ‹¥å¡žï¼Œåˆ†åˆ«ä¸ºå»¶æ—¶å’Œä¸¢åŒ…çŽ‡ï¼Œä¸¢åŒ…çŽ‡é»˜è®¤å€¼ä¸º 3ï¼Œå³1/2^3ï¼Œå½“æ‹¥å¡žäº§ç”Ÿæ—¶ï¼Œé€€å‡ºç¬¬ä¸‰ä»£ Learning-based TCP ç®—æ³•ï¼Œé‡‡ç”¨ç±»ä¼¼ä¼ ç»Ÿ TCP çš„ç®—æ³•ã€‚æ­¤å¤„å¯¹äºŽé«˜ä¸¢åŒ…çš„çº¿è·¯æ¥è¯´ï¼Œç›´æŽ¥è®¾ç½®ä¸º1ï¼Œå³ä¸¢åŒ…ç™¾åˆ†ä¹‹50ä»¥ä¸Šæ—¶ï¼Œæ‰é€€å‡ºLearning-based TCP ç®—æ³•(è¿™ä¼šå¯¼è‡´é«˜ä¸¢åŒ…çº¿è·¯ä¸Šå¢žåŠ æµé‡æ¶ˆè€—) ä¿®æ”¹å®ŒæˆåŽï¼Œé‡å¯é”é€Ÿ 1/serverspeeder/bin/serverSpeeder.sh restart FinalSpeed ä»‹ç»FinalSpeedæ˜¯é«˜é€ŸåŒè¾¹åŠ é€Ÿè½¯ä»¶,å¯åŠ é€Ÿæ‰€æœ‰åŸºäºŽtcpåè®®çš„ç½‘ç»œæœåŠ¡,åœ¨é«˜ä¸¢åŒ…å’Œé«˜å»¶è¿ŸçŽ¯å¢ƒä¸‹,ä»å¯è¾¾åˆ°90%çš„ç‰©ç†å¸¦å®½åˆ©ç”¨çŽ‡,å³ä½¿é«˜å³°æ—¶æ®µä¹Ÿèƒ½è½»æ¾è·‘æ»¡å¸¦å®½ã€‚å¯ä»¥ä¸Žé”é€Ÿå…±å­˜ã€‚ ä½¿ç”¨å»ºè®®(7.03) FinalSpeedçŽ°åœ¨å·²åœæ­¢æ›´æ–°,å»ºè®®ä½œä¸ºå¤‡é€‰åŠ é€Ÿæ‰‹æ®µ OVZè™šæ‹ŸåŒ–çš„vpsä¸Šåªå¯ç”¨udpæ¨¡å¼ï¼Œudpåœ¨å›½å†…è¢«å°æ€è¾ƒä¸¥é‡ï¼Œå¯¼è‡´é“¾æŽ¥ä¸­æ–­ç­‰ã€‚ å®‰è£…æ–¹æ³• FinalSpeedçŽ°åœ¨å·²åœæ­¢æ›´æ–°ï¼Œå®˜æ–¹ç§»é™¤äº†å®‰è£…æ–¹æ³•ï¼Œä»¥ä¸‹å®‰è£…æ–¹å¼æ¥è‡ªgithubå¤‡ä»½ã€‚ å®‰è£…å‘½ä»¤: 1234rm -f install_fs.shwget https://github.com/dupontjoy/customization/raw/master/Rules/Shadowsocks/Finalspeed/install_fs.shchmod +x install_fs.sh./install_fs.sh 2&gt;&amp;1 | tee install.log ä¸€é”®å®‰è£…å®ŒæˆåŽï¼Œvpsä¼šè‡ªåŠ¨å®‰è£…javaçŽ¯å¢ƒã€‚ å¸è½½ï¼š 1sh /fs/stop.sh ; rm -rf /fs è®¾ç½®å¼€æœºå¯åŠ¨ï¼š 12chmod +x /etc/rc.localvi /etc/rc.local ç„¶åŽåŠ å…¥ 1sh /fs/start.sh æ¯å¤©æ™šä¸Š1ç‚¹è‡ªåŠ¨é‡å¯ï¼š 12crontab -e0 1 * * * sh /fs/restart.sh FinalSpeed windowså®¢æˆ·ç«¯å®˜æ–¹æœ€æ–°ç‰ˆæœ¬ä¸º1.2 æ›´æ–°æ—¥å¿—ä¸Šè¡¨æ˜Žcpuå ç”¨é™ä½Ž30%ï¼Œä½†æ˜¯ç¨³å®šæ€§è¾ƒå·®ï¼Œæ—¶å¸¸æŒ‚æŽ‰ã€‚æŽ¨èFinalSpeed1.12æµ‹è¯•ç‰ˆ ä¸ªäººå¸¸ç”¨ç‰ˆæœ¬ï¼Œå¾ˆç¨³å®šã€‚ è¿™ä¸€éƒ¨åˆ†è¯·å‚è€ƒä¸€ä¸‹ç½‘ç«™ã€‚ https://blog.kuoruan.com/82.html å¸¸ç”¨å‘½ä»¤ å¯åŠ¨ï¼š 1sh /fs/start.sh åœæ­¢ï¼š 1sh /fs/stop.sh é‡æ–°å¯åŠ¨ï¼š 1sh /fs/restart.sh è¿è¡Œæ—¥å¿—ï¼š 1tail -f /fs/server.log Kcptun å°å†…å­˜VPSå¯ç”¨(64Må†…å­˜æœåŠ¡å™¨ç¨³å®šè¿è¡Œ)ï¼ŒOVZæž¶æž„å¯ç”¨ï¼Œ Go è¯­è¨€ç¼–å†™ ä½¿ç”¨å»ºè®®(7.03) é¦–æ¬¡ä½¿ç”¨ï¼Œå»ºè®®ä½œä¸ºå¤‡é€‰åŠ é€Ÿæ‰‹æ®µ ä¸å½“é…ç½®å°†å¸¦æ¥å¤§é‡æµé‡æ¶ˆè€— å®‰è£… Kcptun åŸºäºŽ KCP åè®®çš„ UDP éš§é“ï¼Œå®ƒå¯ä»¥å°† TCP æµè½¬æ¢ä¸º KCP+UDP æµã€‚è€Œ KCP æ˜¯ä¸€ä¸ªå¿«é€Ÿå¯é åè®®ï¼Œèƒ½ä»¥æ¯” TCP æµªè´¹10%-20%çš„å¸¦å®½çš„ä»£ä»·ï¼Œæ¢å–å¹³å‡å»¶è¿Ÿé™ä½Ž 30%-40%ï¼Œä¸”æœ€å¤§å»¶è¿Ÿé™ä½Žä¸‰å€çš„ä¼ è¾“æ•ˆæžœã€‚ Kcptun æœåŠ¡ç«¯å®‰è£…ç¹çï¼Œç›®å‰æ²¡æœ‰æ”¹ä¸ºKcptunåŠ é€Ÿçš„éœ€æ±‚ï¼Œæ”¶é›†ç½‘ç»œä¸€éƒ¨åˆ†Kcptunæ­å»ºæ•™ç¨‹ä¾›å‚è€ƒã€‚ å°å†…å­˜ç¦éŸ³ï¼ŒKcptun ShadowsocksåŠ é€Ÿæ–¹æ¡ˆ https://blog.kuoruan.com/102.html Kcptun æœåŠ¡ç«¯ä¸€é”®å®‰è£…è„šæœ¬,å–œé—»ä¹è§çš„å¤šç”¨æˆ·æ”¯æŒ https://blog.kuoruan.com/110.html SSRæ··æ·†å‚æ•° ä½œè€…Jessica Lynnè½¬è½½è‡ª https://plus.google.com/113582246973758055268/posts/H51ZpzwUFDK?iem=4&amp;gpawv=1&amp;hl=zh-Hans-TW ä¸€äº›æ··æ·†å‚æ•°ï¼ˆåŸŸåï¼‰ å›½å†…ï¼š sz.btfs.mail.ftn.qq.com btrace.video.qq.com ossweb-img.qq.com 1234-wyfqdku4kcgcabalp6rdudo7â€“1042249034.cmos.greencompute.org aecpm.alicdn.com aldh5.tmall.com at.alicdn.com atanx.alicdn.com g.alicdn.com gtms03.alicdn.com gw.alicdn.com img.alicdn.com å›½å¤–ï¼š az813057.vo.msecnd.net az817829.vo.msecnd.net azureedge.net media.gettyimages.com origin.cdn77.com TCP-BBR(7.03) BBR (Bottleneck Bandwidth and RTT)æ˜¯ç”±googleå·¥ç¨‹å¸ˆç¼–å†™çš„æ–°çš„ TCP æ‹¥å¡žæŽ§åˆ¶ç®—æ³•ï¼Œç›®çš„æ˜¯è¦å°½é‡è·‘æ»¡å¸¦å®½, å¹¶ä¸”å°½é‡ä¸è¦æœ‰æŽ’é˜Ÿçš„æƒ…å†µ, åŠ é€Ÿæ•ˆæžœä¸æ¯”é”é€Ÿå·® ä½¿ç”¨å»ºè®®(7.03) å¼€æºï¼Œé«˜æ•ˆï¼Œå¼ºçƒˆæŽ¨èé¦–é€‰ï¼ åŒä¸€çº¿è·¯ï¼ŒBBRä¸Žé”é€Ÿå¯åˆ†åˆ«è¯•ç”¨å–èˆï¼Œä¸€èˆ¬æ»¡è¶³éœ€æ±‚ï¼ ä¿®æ”¹ç‰ˆ BBR æ›´ä¸ºé«˜æ•ˆ ä¸ä¼šé€ æˆæµé‡å¤§é‡æµªè´¹ å®‰è£… å¼€æºåœ°å€ æµ‹è¯•çŽ¯å¢ƒ Debian 7 x64 Vultr å¯ç”¨TCP-BBRæ¶‰åŠVPSæ›´æ¢å†…æ ¸ï¼Œæ‰€ä»¥å¦‚æžœæ­¥éª¤é”™è¯¯ï¼Œæˆ–è€…VPSä¸å…¼å®¹æœ€æ–°çš„å†…æ ¸ï¼Œä¼šå¯¼è‡´æ— æ³•å¼€æœºç­‰é”™è¯¯ï¼Œ é”é€Ÿä¸æ”¯æŒï¼Œæ›´æ¢åŽçš„ &gt;4.9 å†…æ ¸ å®‰è£…åŽŸç‰ˆBBR è„šæœ¬æ¥è‡ªç§‹æ°´é€¸å†° ç³»ç»Ÿæ”¯æŒï¼šCentOS 6+ï¼ŒDebian 7+ï¼ŒUbuntu 12+ è™šæ‹ŸæŠ€æœ¯ï¼šOpenVZ ä»¥å¤–çš„ï¼Œæ¯”å¦‚ KVMã€Xenã€VMware ç­‰ å†…å­˜è¦æ±‚ï¼šâ‰¥128M è¿žæŽ¥SSHï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤ï¼Œæ›´æ–°å†…æ ¸ 123wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.shchmod +x bbr.sh./bbr.sh å®‰è£…å®ŒæˆåŽï¼Œè„šæœ¬ä¼šæç¤ºéœ€è¦é‡å¯ VPSï¼Œè¾“å…¥ y å¹¶å›žè½¦åŽé‡å¯ é‡è¿žSSH éªŒè¯ å†…æ ¸ç‰ˆæœ¬ 1uname -r æœ€æ–°å†…æ ¸ç‰ˆæœ¬å¤§äºŽ4.9å³å¯ï¼Œæœ€æ–°4.12(7.03) ä¿®æ”¹sysctl.conf 1nano /etc/sysctl.conf å¤åˆ¶ä»£ç ï¼š 1234567891011121314151617181920212223#TCPé…ç½®ä¼˜åŒ–(ä¸ç„¶ä½ è‡ªå·±æ ¹æœ¬ä¸çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆ)fs.file-max = 51200#æé«˜æ•´ä¸ªç³»ç»Ÿçš„æ–‡ä»¶é™åˆ¶net.core.rmem_max = 67108864net.core.wmem_max = 67108864net.core.netdev_max_backlog = 250000net.core.somaxconn = 4096net.ipv4.tcp_syncookies = 1net.ipv4.tcp_tw_reuse = 1net.ipv4.tcp_tw_recycle = 0net.ipv4.tcp_fin_timeout = 30net.ipv4.tcp_keepalive_time = 1200net.ipv4.ip_local_port_range = 10000 65000net.ipv4.tcp_max_syn_backlog = 8192net.ipv4.tcp_max_tw_buckets = 5000net.ipv4.tcp_fastopen = 3net.ipv4.tcp_mem = 25600 51200 102400net.ipv4.tcp_rmem = 4096 87380 67108864net.ipv4.tcp_wmem = 4096 65536 67108864net.ipv4.tcp_mtu_probing = 1net.ipv4.tcp_congestion_control = bbr#END OF LINE ä¿å­˜(Ctrl + X â€”â€” y â€”â€”å›žè½¦) åº”ç”¨ 1sysctl -p é‡å¯SSR 1/etc/init.d/shadowsocks restart ä¿®æ”¹ç‰ˆBBR ç›¸å¯¹åŽŸç‰ˆæ›´ä¸ºæš´åŠ›ï¼ŒåŠ é€Ÿæ•ˆæžœæ›´å¥½ æä¾› Vicerç‰ˆ å’Œ é­”æ”¹ç‰ˆ ä¸¤ä¸ªè¯•ç”¨åŽåŠ é€Ÿæ•ˆæžœè¿˜ä¸é”™çš„ç‰ˆæœ¬ã€‚ æˆ‘çš„æµ‹è¯•æ¥çœ‹ é­”æ”¹ç‰ˆ çš„æœ€é«˜é€Ÿåº¦é«˜äºŽ Vicerç‰ˆ ï¼Œä½† YOUTUBE æ¥çœ‹ Vicerç‰ˆ é«˜äºŽ é­”æ”¹ç‰ˆ æ³¨æ„ï¼šä¿®æ”¹ç‰ˆBBRçš„ä¸€é”®è„šæœ¬ï¼Œæ”¯æŒç³»ç»Ÿè¾ƒå°‘ï¼Œå®‰è£…å‰éœ€è¦ç¡®è®¤è‡ªå·±çš„ç³»ç»Ÿæ”¯æŒï¼Œå¦‚ä¸åœ¨æ”¯æŒåˆ—è¡¨ï¼Œè‡ªè¡ŒGoogleå³å¯ï¼Œæœ‰å¤§é‡ç¬¬ä¸‰æ–¹è„šæœ¬ã€‚ æ”¯æŒç³»ç»Ÿï¼š Debian 8 / Ubuntu16 + /Debian 7(éœ€è¦æ‰‹åŠ¨å®‰è£…gcc4.9) Debian 7æ‰‹åŠ¨å®‰è£…gcc4.9(ä»¥rootç”¨æˆ·ç™»é™†ï¼Œå¦åˆ™ å‘½ä»¤å‰æ·»åŠ sudo) ä¿®æ”¹ç³»ç»Ÿæ›´æ–°æº 1nano /etc/apt/sources.list æ·»åŠ å¦‚ä¸‹ä¸¤ä¸ªæ›´æ–°æº 12deb http://ftp.cn.debian.org/debian/ jessie main non-free contribdeb http://ftp.uk.debian.org/debian/ jessie main non-free contrib ä¿å­˜(Ctrl + X â€”â€” y â€”â€”å›žè½¦) æ‰§è¡Œæ›´æ–°apt-get update æ£€æŸ¥å¯å®‰è£… gcc ç‰ˆæœ¬åˆ—è¡¨apt-cache search gccè¾“å‡ºæœ‰gcc4.9 å­—æ ·å³å¯ï¼Œæ•°é‡æ— æ‰€è°“ 1234567891011121314151617181920libx32gcc-4.8-dev - GCC support library (x32 development files) cpp-4.9 - GNU C preprocessor gcc-4.9 - GNU C compiler gcc-4.9-base - GCC, the GNU Compiler Collection (base package) gcc-4.9-locales - GCC, the GNU compiler collection (native language support files) gcc-4.9-multilib - GNU C compiler (multilib files) gcc-4.9-plugin-dev - Files for GNU GCC plugin development. gcc-4.9-source - Source of the GNU Compiler Collection gccgo-4.9 - GNU Go compiler gccgo-4.9-multilib - GNU Go compiler (multilib files) gcj-4.9 - GCJ byte code and native compiler for Java(TM) gcj-4.9-jdk - GCJ and Classpath development tools for Java(TM) gcj-4.9-jre-lib - Java runtime library for use with gcj (jar files) gdc-4.9 - GNU D compiler (version 2), based on the GCC backend gfortran-4.9 - GNU Fortran compiler gfortran-4.9-multilib - GNU Fortran compiler (multilib files) gobjc++-4.9 - GNU Objective-C++ compiler gobjc++-4.9-multilib - GNU Objective-C++ compiler (multilib files) gobjc-4.9 - GNU Objective-C compiler gobjc-4.9-multilib - GNU Objective-C compiler (multilib files) å‘½ä»¤apt-get install g++-4.9 å®‰è£…g++-4.9 Vicerç‰ˆBBR è„šæœ¬æ¥è‡ªDebian/Ubuntu TCP BBR æ”¹è¿›ç‰ˆ/å¢žå¼ºç‰ˆ ä¸€é”®å®‰è£… 1wget --no-check-certificate -qO &apos;BBR_POWERED.sh&apos; &apos;https://moeclub.org/attachment/LinuxShell/BBR_POWERED.sh&apos; &amp;&amp; chmod a+x BBR_POWERED.sh &amp;&amp; bash BBR_POWERED.sh é‡åˆ° Error! Header not be matched by Linux Kernel. å‚çœ‹Debian/Ubuntu å¼€å¯ TCP BBR æ‹¥å¡žç®—æ³•,ä¾ç…§ ä½œè€…å¼€å¯bbr çš„è„šæœ¬æ‰§è¡Œä¸€éå³å¯ã€‚ é‡åˆ°Error! Install gcc-4.9. debian 7 é‡æ–°å®‰è£…ä¸€é gcc-4.9 ï¼Œå…¶ä»–ç³»ç»Ÿ æ‰§è¡Œ apt-get update å®‰è£…å®ŒæˆåŽ æ‰§è¡Œlsmod |grep &#39;bbr_powered&#39; ç»“æžœä¸ä¸ºç©º,åˆ™åŠ è½½æ¨¡å—æˆåŠŸ é‡å¯SSR /etc/init.d/shadowsocks restart é­”æ”¹ç‰ˆBBR ä¸€é”®è„šæœ¬ 1wget -N --no-check-certificate https://raw.githubusercontent.com/FunctionClub/YankeeBBR/master/bbr.sh &amp;&amp; bash bbr.sh install ä¹‹åŽé€‰æ‹©é‡å¯ç³»ç»Ÿï¼Œé‡è¿žSSH è¾“å…¥å‘½ä»¤ bash bbr.sh start å³å¯å®Œæˆå®‰è£… éªŒè¯ sysctl net.ipv4.tcp_available_congestion_control è¿”å›žå‘½ä»¤æœ‰ tsunami å³å¯ã€‚ é‡å¯SSR /etc/init.d/shadowsocks restart ç»“æŸ]]></content>
      <categories>
        <category>ç§‘å­¦ä¸Šç½‘</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>VPS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ï¼ˆä¸€ï¼‰â€”â€”VPSä¸Šæ­å»ºSSR]]></title>
    <url>%2F2016%2F06%2F26%2FVPS%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E6%95%99%E7%A8%8B%E7%B3%BB%E5%88%97%2F</url>
    <content type="text"><![CDATA[123456789101112131415161718æ›´æ–°2016.06.26 ä¸ŽSSRæœ‰å…³éƒ¨åˆ†åŸºæœ¬å®Œæˆã€‚ 2016.09.29 æ›´æ–°SSRéƒ¨åˆ†å†…å®¹2016.10.09 æ›´æ–°SSRå†…å®¹ï¼Œæ›´æ–°Androidç«¯æŽ¥å…¥ã€‚2016.11.09 æ›´æ–°SSRæ··æ·†ç›¸å…³å†…å®¹ï¼Œæ›´æ–°SSR-Androidï¼Œæ›´æ–°éƒ¨åˆ†ä»‹ç»ã€‚2016.11.20 æ•´åˆä¸€éƒ¨åˆ†VPSä¼˜åŒ–å†…å®¹2016.12.11 åˆ å‡è°ƒæ•´ä¸€éƒ¨åˆ†å†…å®¹2016.12.15 æ›¿æ¢é”é€Ÿä¼˜åŒ–ä¸º BBRï¼Œæ•´åˆTCPä¼˜åŒ–2016.12.26 æ›´æ¢TCP BBR è„šæœ¬ï¼Œè„šæœ¬æ¥è‡ª@ç§‹æ°´é€¸å†° ç‰ˆæœ¬ï¼Œæµ‹è¯•é€šè¿‡ 2017.01.11 åŒæ­¥æ›´æ–°ä¸€éƒ¨åˆ†SSRå†…å®¹2017.02.17 åŒæ­¥æ›´æ–°ï¼Œè°ƒæ•´åˆ å‡å†…å®¹ï¼Œé™ä½Žä¸Šæ‰‹éš¾åº¦ï¼Œå¢žåŠ VPSæµ‹é€Ÿç›¸å…³å†…å®¹2017.03.28 è°ƒæ•´ä¸€éƒ¨åˆ†å†…å®¹ï¼Œæ›´æ–°VpsæŽ¨è2017.04.08 æ–°å¢ž VPS å®‰å…¨åŠ å›º2017.05.24 åŒæ­¥æ›´æ–°å†…å®¹ï¼Œæ›´æ¢åè®®ï¼Œå¢žåŠ æ–°å†…å®¹ã€‚2017.06.28 åˆ å‡è¿‡æ—¶å†…å®¹ï¼ŒåŒæ­¥æ›´æ–°2017.07.03 æ›´æ–°BBRå†…å®¹ï¼ŒVPSæµ‹é€Ÿ2017.07.12 æ›´æ¢è¿‡æ—¶æˆªå›¾ï¼Œä¿®æ­£é”™è¯¯ã€‚2017.07.28 æ›´æ¢å¤±æ•ˆé“¾æŽ¥ï¼Œå¯èƒ½æ˜¯æœ€åŽä¸€æ¬¡æ›´æ–°äº† SSRåŽŸä½œè€…å·²åˆ é™¤ä»£ç åº“ï¼Œåœ¨æœ‰å…¶ä»–ä½œè€…æ›´æ–°å‰ï¼Œä¸ä¼šå†æ›´æ–°æ­¤æ•™ç¨‹ï¼Œè¿™ä¸ªæ•™ç¨‹å¼€å§‹åˆ°çŽ°åœ¨1å¹´å¤šï¼ŒåŸºæœ¬æ²¡æœ‰åœæ›´ï¼Œæ”¶èŽ·äº†50000å¤šçš„æ²¡åŠ æ°´çš„é˜…è¯»é‡ï¼Œè°¢è°¢å¤§å®¶ï¼ æˆ‘å¼€å§‹æœ‰äº›æ˜Žç™½GFWçš„ä¸æ–­å¼ºåŒ–å¹¶ä¸æ˜¯æœ€å¯æ€•ã€‚æˆ–è€…è¯´GFWçš„å­˜åœ¨å¹¶ä¸é‡è¦ï¼Œå¯æ€–çš„æ˜¯äººå¿ƒçš„å¢™æ°¸è¿œæœ‰äººåœ¨æ— å¿åŠ å›ºã€‚ å®‰è£…è„šæœ¬è¯´æ˜Žï¼šé‡åˆ°å¤±æ•ˆç­‰ï¼Œè¯·ç•™è¨€æˆ–é‚®ä»¶æˆ‘ï¼ è„šæœ¬æ¥æº @ç§‹æ°´é€¸å†°ShadowsocksRä¸€é”®å®‰è£…è„šæœ¬ éšç§/åŽé—¨ï¼š(è¿™ä¸ªç»“è®ºä»…å¯¹æœ¬æ–‡ä½¿ç”¨è„šæœ¬è´Ÿè´£)æ–‡ç« ä¸­æ‰€ä½¿ç”¨çš„è„šæœ¬ï¼Œé™¤é»˜è®¤ç”¨æˆ·å/å¯†ç å¤–ï¼Œæ²¡æœ‰ä»»ä½•å¤¹å¸¦ç§è´§ã€‚è„šæœ¬äº¦å¼€æºï¼Œä¸æ”¾å¿ƒå¯ä»¥ä¸‹è½½åŽè‡ªè¡Œå®¡è®¡ï¼ https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocksR.sh SSR æœåŠ¡å™¨ç«¯æ›´æ–°ï¼šä½¿ç”¨æ­¤ä¸€é”®è„šæœ¬å®‰è£…çš„ï¼Œä¸èƒ½ä½¿ç”¨å…¶ä»–å‘½ä»¤æ›´æ–°ï¼Œåªèƒ½é€šè¿‡ å¤‡ä»½é…ç½®æ–‡ä»¶ï¼Œå¸è½½å†é‡æ–°å®‰è£…ï¼ä¹Ÿéƒ½ä¸æ˜¯äº‹ï¼Œå¤‡ä»½ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œé‡æ–°å®‰è£…ï¼Œè¦†ç›–é…ç½®æ–‡ä»¶ï¼Œé‡å¯å³å¯ã€‚ æœ€è¿‘æ›´æ–°åŒ…æ‹¬V2Ray -4 Shadowsocks-libev-5 ç«‹ä¸ªflag åŸºæœ¬ä»Ž0å¼€å§‹çš„æ•™ç¨‹ï¼Œå½“ä½œè‡ªå·±çš„å¤‡ä»½äº†ã€‚ åæ§½ä½œä¸ºä¸€ä¸ªä¼ªç¨‹åºå‘˜ï¼Œæ¯æ¬¡æœ€è‹¦æ¼çš„å°±æ˜¯Android SDKçš„æ›´æ–°ï¼Œå½“åˆå®‰è£…Android Studioæ—¶å€™å°±å› ä¸ºé˜²ç«å¢™æŠ˜è…¾äº†æ•´æ•´2å‘¨ï¼Œç®€ç›´å°±æ˜¯æŠŠè‡ªå­¦Androidçš„é‚£ç‚¹è€å¿ƒéƒ½ç£¨æ²¡äº†ã€‚å„ç§çš„æœç´¢æ–‡æ¡£ï¼Œç¦»äº†googleæ•ˆçŽ‡ä¸‹é™70%ï¼ç§‘å­¦ä¸Šç½‘ç®€ç›´æˆäº†ç¨‹åºå‘˜çš„å¿…å¤‡ç”Ÿå­˜æŠ€èƒ½äº†ã€‚ è°æ¯”è¾ƒéœ€è¦å•ç‹¬è´­ä¹°VPSç§‘å­¦ä¸Šç½‘ï¼Ÿ åªæ˜¯ç¿»å¢™ç®€å•æµè§ˆç½‘é¡µï¼Œå°±ä¸å¿…è¦å†å•ç‹¬èŠ±è´¹äººæ°‘å¸äº†ï¼Œè“ç¯ã€å’Œå„ä¸ªç½‘ç«™çš„å…è´¹ssè´¦æˆ·ï¼Œæ˜¯ä½ çš„ä¸»èœã€‚ å¶å°”çœ‹çœ‹è§†é¢‘ã€ä¸æƒ³ç”»å¤ªå¤šç²¾åŠ›åœ¨å¯»æ‰¾å…è´¹èµ„æºä¸Šã€‚å¯ä»¥ç›´æŽ¥è´­ä¹°çŽ°æˆçš„ss/vpnè´¦æˆ·ï¼Œåœ¨G+ç›¸åº”çš„ç¤¾åŒºå¯ä»¥æ‰¾åˆ°å¾ˆå¤šæ¯”è¾ƒé è°±çš„æä¾›å•†ã€‚ å¸¸å¹´æ³¡è§†é¢‘ç½‘ç«™åˆå—ä¸äº†å›½å†…è§†é¢‘ç½‘ç«™ä¹±ä¸ƒå…«ç³Ÿã€24hä½¿ç”¨googleæœåŠ¡ã€å¯¹ç¨³å®šæ€§å’Œæµé‡æœ‰ä¸€å®šè¦æ±‚ã€æ„¿æ„ä½¿ç”¨ä¸€ç‚¹æ—¶é—´æ¥æŠ˜è…¾VPSã€‚æ¯”è¾ƒé€‚åˆå•ç‹¬è´­ä¹°VPSæ¥ç§‘å­¦ä¸Šç½‘ã€‚VPSé€‰æ‹©å¦‚ä¸‹ä¼šæåŠã€‚ æœç´¢æ–‡æ¡£ï¼Œæ›´æ–°è½¯ä»¶æºã€æŠ˜è…¾ä¸ªäººç½‘ç«™åˆä¸æƒ³å¤‡æ¡ˆçš„ã€æŠ˜è…¾å¼€æºçš„ è¿™éƒ¨åˆ†å¤§ç¥žè°ä¼šæ¥çœ‹è¿™ä¸ªå•Šï¼Œæ—©è‡ªå·±åˆ†åˆ†é’Ÿå†™ä¸ªè½®å­äº† VPSé€‰æ‹©é€‰æ‹©VPSçœ‹é‚£å‡ ç‚¹ ä¸€å®šè¦æ ¹æ®è‡ªå·±çš„å…·ä½“ä½¿ç”¨åœºæ™¯å’Œç½‘ç»œçŽ¯å¢ƒæ¥é€‰æ‹©VPSæœåŠ¡ã€‚ é€‰æ‹©VPSçš„ä¸€èˆ¬è¦æ³¨æ„çš„å‡ ç‚¹ è‡ªå·±çš„å…·ä½“ç½‘ç»œçŽ¯å¢ƒ ç®€å•æ¥è¯´ï¼Œä¸€èˆ¬è”é€šçš„å›½é™…å‡ºå£ç¨³å®šæ€§å¤§äºŽç”µä¿¡ã€ç§»åŠ¨çš„å›½é™…å‡ºå£çœ‹å¿ƒæƒ…æœ‰çš„åœ°åŒºç”©ç”µä¿¡è”é€šå‡ æ¡è¡—ï¼Œåçš„æ—¶å€™æ ¹æœ¬æ²¡é€Ÿåº¦ã€‚ç”µä¿¡ç½‘è·¯æ¯”è¾ƒç‰¹æ®Šï¼Œå›½é™…å‡ºå£å……è¶³ï¼Œä½†æ˜¯é™é€Ÿåˆ°ä¸èƒ½å¿ï¼Œä¸æŒ¤çš„æ—¶å€™å—–å—–çš„ï¼Œé«˜å³°æœŸæ¸£åˆ°çˆ†ç‚¸ã€‚ ç§»åŠ¨ç½‘ç»œå…·ä½“æƒ…å†µä¸å¤ªæ¸…æ¥šã€‚ VPSåœ°ç‚¹ã€‚ æ—¥æœ¬VPSç”µä¿¡ç½‘ç»œè®¿é—®è¦ç»•é“ç¾Žå›½ç»•é“pingä¸€èˆ¬åœ¨200åˆ°300äº†ï¼Œï¼ˆ9.29ï¼‰è”é€šç›´è¿žæ—¥æœ¬ï¼Œpingåœ¨100ï¼è”é€šç›®å‰ä¹Ÿåˆ†åœ°åŒºæœ‰é™é€Ÿã€‚(2.17)è”é€šå› ä¸º16å¹´å¹´åº•æµ·åº•å…‰ç¼†æ•…éšœæŸå¤±äº†30ï¼…çš„å›½é™…å‡ºå£ï¼Œå¯¼è‡´æ–°å¹´åˆ°çŽ°åœ¨å‡ºå£è·¯ç”±å¹¶ä¸ç¨³å®šï¼Œè”é€š-æ—¥æœ¬nttå»¶è¿Ÿæœ‰æ—¶200æœ‰æ—¶100.ï¼ˆ6.28ï¼‰ç›®å‰è¯»è€…åæ˜ nttæ¯”è¾ƒç¨³å®šã€‚ ç”µä¿¡ç›®å‰åˆ†åœ°åŒºç›´è¿žæ—¥æœ¬ï¼Œç›´è¿žpingåœ¨100æˆ–è€…å¤šä¸€ç‚¹ã€‚ï¼ˆæœ‰è¿æ°”æˆåˆ†ï¼Œå¤šåˆ·å‡ ä¸ªipè¯•è¯•ï¼‰(2.17)æµ‹é€Ÿç»“æžœæ¥çœ‹ï¼Œç›®å‰ç”µä¿¡ç›´è¿žçš„çœä»½åè€Œæ›´å¤šã€‚ ç¾Žå›½çš„VPSè”é€š/ç”µä¿¡è®¿é—®å»¶è¿ŸåŸºæœ¬ç›¸å½“ã€‚ä¸€èˆ¬é€‰æ‹©é è¿‘ç¾Žå›½è¥¿æµ·å²¸èŠ‚ç‚¹æ—§é‡‘å±±ã€æ´›æ‰çŸ¶ã€çº½çº¦ç­‰åœ°ç‚¹ã€‚ç”µä¿¡é™é€Ÿå¾ˆåŽ‰å®³ï¼Œæ‰€ä»¥ä¸€èˆ¬ç”µä¿¡ç½‘éœ€è¦å¼€æ··æ·†é…åˆFinaSppeedç­‰åŠ é€Ÿã€‚ æ–°åŠ å¡èŠ‚ç‚¹ï¼Œåœ¨é è¿‘å—æ–¹åœ°åŒºï¼Œå¯ä»¥pingåœ¨100ä»¥å†…ç¨³å®šï¼youtube 4kä¸å¡ã€‚ä½†åœ¨ååŒ—ä¸€äº›åœ°åŒºpingä¸ç¨³å®šã€‚ï¼ˆ9.29ï¼‰Vultræ–°å¼€æ–°åŠ å¡èŠ‚ç‚¹ï¼ŒåŒ—æ–¹éƒ¨åˆ†åœ°åŒºç›´è¿žã€‚ é¦™æ¸¯VPSï¼Œè¿™ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œé¦™æ¸¯çš„VPS pingå€¼å¯ä»¥ä½Žåˆ°20å‡ ï¼Œä½†æ˜¯é¦™æ¸¯æœ¬èº«çš„å›½é™…å‡ºå£å°±å°ï¼ŒVPSä»·æ ¼ä¹Ÿåé«˜ï¼Œå¦å¤–é¦™æ¸¯æ¯•ç«Ÿä¹Ÿåœ¨æ”¿åºœçš„ç›´æŽ¥ç®¡è¾–å†…ï¼Œéšç§æ–¹é¢é£Žé™©æ¯”å…¶ä»–åœ°åŒºèŠ‚ç‚¹è¦å¤§ä¸€äº›ã€‚å»ºè®®åœŸè±ªçº§åˆ«çš„æ¸¸æˆçŽ©å®¶ä½¿ç”¨ã€‚ VPSè™šæ‹ŸåŒ–æž¶æž„ (å…·ä½“è§£é‡Šè¯·è‡ªè¡Œgoogleï¼Œåªè¯´æ˜Žå¯¹ç§‘å­¦ä¸Šç½‘çš„å½±å“) OpenVZï¼ˆç®€ç§°OVZï¼‰ ä¾¿å®œï¼ä½†æ˜¯æ²¡æ³•è¿›è¡Œä¿®æ”¹å†…æ ¸ã€åŠ é”é€Ÿä¹‹ç±»çš„ä¼˜åŒ–æ“ä½œã€‚è®¿é—®é€Ÿåº¦åŸºæœ¬å–å†³äºŽä½ çš„æœ¬åœ°ç½‘ç»œçŽ¯å¢ƒä¼˜åŒ–çš„å¯èƒ½æ€§ã€‚ï¼ˆä¸æ˜¯æ²¡æœ‰å¯ä»¥åŠ é€Ÿçš„æ‰‹æ®µï¼Œå°±æ˜¯åœ¨åŸºæœ¬ç›¸åŒæƒ…å†µä¸‹ï¼Œä¸å¦‚å…¶ä»–æž¶æž„çš„vpså¯ä»¥æ¦¨å¹²VPSçš„ä¼ è¾“æ€§èƒ½ï¼‰ã€‚åŠ é€Ÿæ‰‹æ®µï¼šFinaspeedï¼ˆå·²åœæ­¢æ›´æ–°ï¼‰ å’Œnet-speederã€‚ Xenæ€§èƒ½è¾ƒå¥½ï¼Œå®žé™…ç”¨çš„ä¸å¤šï¼Œä¸åšæ›´å¤šè¯„è®º Hyper-VHå®Œç¾Žæ”¯æŒWindowsç³»ç»Ÿï¼ŒHyper-VåŒæ ·å¯ä»¥è¶…å”®å†…å­˜å’Œç¡¬ç›˜ï¼Œå¦‚æžœæœåŠ¡å•†è¶…å–è¾ƒå¤šå¯èƒ½ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼ŒLinuxæ“ä½œç³»ç»Ÿæ€§èƒ½è¾ƒä½Žã€‚ KVMå…¨åŠŸèƒ½è™šæ‹ŸåŒ–æž¶æž„ï¼Œå¯ä¸Šä¼ ISOæ‰‹åŠ¨å®‰è£…ç³»ç»Ÿã€‚KVM VPSç›¸å¯¹å…¶å®ƒæž¶æž„çš„VPSè¾ƒä¸ºè‡ªç”±ã€‚è™šæ‹ŸåŒ–æ€§èƒ½æ¯”Xenç•¥ä½Žã€‚å¯ä»¥ä½¿ç”¨TCPä¼˜åŒ–å’Œé”é€Ÿï¼Œä»·æ ¼æ¯”ä¸€åŠOVZçš„è¦é«˜ä¸€äº›ã€‚ï¼ˆæœ¬æ•™ç¨‹ä»¥KVMä¸ºä¾‹ã€‚ã€‚é€Ÿåº¦éœ€æ±‚å¤§çš„æœ€å¥½ä½¿ç”¨KVMï¼‰ VPSæä¾›å•† è¿™ä¸ªå°±æ¯”è¾ƒå¤šäº†ï¼Œå°½é‡é€‰æ‹©è´­ä¹°äººè¾ƒå¤šçš„ï¼Œè€Œä¸”ä¸€èˆ¬æ”¯æŒæ”¯ä»˜å®çš„æœåŠ¡å•†è¢«å›½äººçŽ©åŠæ®‹å±…å¤šï¼ˆæ¯”å¦‚æ¬ç“¦å·¥ã€‚ã€‚è¶…å”®ä¸¥é‡ï¼‰ï¼Œæ‰€ä»¥è´­ä¹°ä¸æ”¯æŒæ”¯ä»˜å®çš„vpsæä¾›å•†è¦é è°±ä¸€ç‚¹ã€‚æ³¨å†Œpaypalå›½é™…ç‰ˆï¼ˆæ³¨ï¼šæ˜¯å›½é™…ç‰ˆpaypal ä¸æ˜¯å›½å†…çš„è´å®ï¼ï¼‰ä¸€èˆ¬çš„vpsæä¾›å•†éƒ½æ”¯æŒpaypalä»˜æ¬¾ã€‚ä¸Žä½¿ç”¨ä¿¡ç”¨å¡ç›¸æ¯”ï¼Œå…·ä½“çš„ä¼˜æƒ æ”¿ç­–ä¸åŒï¼Œè¯¦æƒ…è¯·è‡ªè¡Œgoogleã€‚ (6.28)æ”¯æŒæ”¯ä»˜å®/å¾®ä¿¡çš„æœåŠ¡å•†è‰¯èŽ ä¸é½ï¼Œç¬¬ä¸€æ¬¡è´­ä¹°éœ€è¦æ³¨æ„é€€æ¬¾æ”¿ç­–ï¼Œè™šæ‹ŸåŒ–æž¶æž„ç­‰ï¼Œæœ€å¥½æŒ‰æœˆæ”¯ä»˜ã€‚çŽ°åœ¨ä½¿ç”¨çš„æ˜¯æ´›æ‰çŸ¶çš„KVMæœºå™¨ï¼Œé…åˆBBRåŸºæœ¬3ç½‘é€šåƒï¼Œé™¤ä¸ªåˆ«æ—¶æ®µéžå¸¸ç¨³å®šã€‚ æŽ¨èå‡ ä¸ª VPS çš„è¯„æµ‹ç½‘ç«™ï¼Œç›¸å¯¹æ›´æ–°å¾ˆå¿«ã€‚ http://www.laozuo.org/myvpshttps://doub.io/https://www.91yun.org/ ï¼ˆ3.28ï¼‰Vultr-ä»…ç›¸å…³å‚è€ƒ(å·²è¿‡æ—¶ï¼) æ¥æºï¼šhttps://www.v2ex.com/t/302347 ç›®å‰ Vultr å·²ç»æŽ¨å‡º 2.5åˆ€/æœˆ çš„å¥—é¤ï¼Œé…åˆæ–°æ³¨å†Œèµ ä½™é¢ï¼Œæ€§ä»·æ¯”å¾ˆé«˜ï¼Œä½†åŒæ—¶ä¹Ÿè¢«æžçƒ‚äº†ï¼Œå¥½ç”¨çš„ipæ®µï¼Œçœ‹è¿æ°”äº†ã€‚NTTçš„çº¿è·¯ï¼Œåœ¨åŽåŒ—åœ°åŒºé«˜å³°æœŸä¸€ç›´çˆ†ç‚¸ã€‚ã€‚ åˆ·ipåœ°å€å¯ä»¥ä½¿ç”¨Vultrçš„reserved IPåŠŸèƒ½ï¼Œå®žæµ‹æ˜¯åœ¨ä¸€ä¸ªå°æ—¶åŽå¯ä»¥åˆ é™¤æ— ç”¨ip æ—¥æœ¬èŠ‚ç‚¹-IPï¼ˆ2017.2.17ï¼‰ç›®å‰Vulträ¸œäº¬èŠ‚ç‚¹å¯ä»¥å¼€å‡ºä¸å°‘45.6 /45.4/104ç­‰ä»¥ä¸‹ç»“è®ºä»…ä¾›å‚è€ƒï¼æ³¨æ„ä»¥ä¸‹ç»“è®ºä»…ä¾›å‚è€ƒï¼Œå®žé™…ä¸åŒç½‘ç»œä¸åŒipè¡¨çŽ°ä¸ä¸€å®šç›¸åŒ 108.å¼€å¤´æ™®éååº”è¾ƒå¥½ï¼Œç”µä¿¡/è”é€šç¨³å®šæ€§æ¯”45å¼€å¤´è¦å¥½ï¼Œæ¯”è¾ƒéš¾åˆ·åˆ°ã€‚ 45.7X-youtube-1080pï¼Œæ— åŽ‹åŠ› 45.3X-youtube-1080p ï¼Œç•¥å¡ ç¾Žå›½èŠ‚ç‚¹ IP ä»¥108å¼€å¤´æœ€ä¸ºç¨³å®š/ä¸¢åŒ…å»¶è¿Ÿéƒ½è¾ƒå…¶ä»–ipå¥½ä¸€äº› ä½ç½®é¦–é€‰æ´›æ‰çŸ¶ï¼Œä½†è”é€šéƒ¨åˆ†åœ°åŒºè¿žæŽ¥è¾ƒå¡é¡¿ï¼Œä»¥å®žæµ‹ä¸ºå‡†ã€‚ è¥¿é›…å›¾èŠ‚ç‚¹ï¼Œè®ºå›åæ˜ è¾ƒä¸ºç¨³å®š(ä»…ä¾›å‚è€ƒ) VPSæµ‹é€Ÿå¸¸ç”¨VPSæä¾›å•†æµ‹é€Ÿåœ°å€ vultr http://www.vultrvps.com/test-server æ¬ç“¦å·¥ http://www.64mb.biz/tips/4ip.html å…¶ä»–å¾…æ›´æ–°ï¼Œå…¶å®žåªè¦æœç´¢ æµ‹é€Ÿåœ°å€+vpsæä¾›å•†åç§°å°±å¥½ ä»¥vulträ¸œäº¬èŠ‚ç‚¹ä¸ºä¾‹ æœ‰çš„vpsæä¾›å•†åªæä¾›æµ‹é€Ÿç½‘å€ï¼Œè€Œæµ‹é€Ÿå¤§å¤šä»¥ipåœ°å€ä¸ºä¸»ï¼Œpingå‘½ä»¤å¯ä»¥èŽ·å– æµ‹é€Ÿç½‘å€ å¯¹åº”çš„ipåœ°å€ æœ€ç®€å•çš„å‘½ä»¤ PING (å»¶è¿Ÿæµ‹è¯•) win+rç»„åˆé”®æ‰“å¼€è¿è¡Œæ  è¾“å…¥cmdï¼Œå›žè½¦ å¦‚å›¾ è¾“å…¥ ping ä½ éœ€è¦æµ‹è¯•çš„ipåœ°å€ è¿™é‡Œæ˜¯ 1ping hnd-jp-ping.vultr.com åº”ç­”å¦‚ä¸‹ è¿™é‡Œå¯ä»¥çœ‹åˆ°å…·ä½“çš„æµ‹é€Ÿipåœ°å€ä¸º 108.61.201.151 é€‰ä¸­ Ctrl + Cå¤åˆ¶ä¸‹æ¥ å»¶è¿Ÿ141 å·¦å³ï¼Œè¿˜åœ¨æŽ¥å—èŒƒå›´å†…ã€‚ä¸¢åŒ…å¤§è‡´ä½œä¸ºå‚è€ƒå³å¯ï¼Œåªæœ‰4ä¸ªåŒ…å‘é€ï¼Œä¸è¶³ä»¥ä½œä¸ºç»“æžœæ³¨æ„è¿™é‡Œçš„å»¶è¿Ÿåªæ˜¯pingæ£€æµ‹çš„ç»“æžœï¼Œå¯ä»¥ä½œä¸ºå®žé™…è®¿é—®å»¶è¿Ÿçš„å‚è€ƒå€¼ï¼Œè€Œä¸æ˜¯ç»å¯¹å‡†ç¡®ï¼ æµ‹é€Ÿç›¸å…³ç½‘ç«™ æŸ¥è¯¢ipåœ°å€å½’å±žåœ°ä¸è¦ä½¿ç”¨ ç™¾åº¦æœç´¢æŸ¥è¯¢ipåœ°å€ é‚£äº›æ•°æ®å›½å†…å°šå¯ï¼Œvpsä¸€èˆ¬å¯¹åº”å›½å¤–ç½‘ç«™ï¼Œç™¾åº¦ç­‰åˆ™é”™è¯¯ä¸å°‘ï¼ŒæŽ¨èï¼šipip.net https://www.ipip.net/ip.html å…¨å›½pingæ£€æµ‹æœ‰æ—¶sså±žäºŽåˆç§ŸæœåŠ¡å™¨ï¼Œå¯èƒ½åœ¨ä¸åŒçœä»½ï¼Œéœ€è¦è¯„ä¼°ipåˆ°ä¸åŒçœä»½çš„å»¶è¿Ÿï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ å…¨å›½èŒƒå›´å†…çš„pingæ£€æµ‹é¦–æŽ¨ï¼šç«™é•¿ä¹‹å®¶pingæ£€æµ‹ http://ping.chinaz.com/ è·¯ç”±è¿½è¸ª Best Trace Best Traceæ˜¯ç”± IPIP.NET å¼€å‘çš„è·¯ç”±è¿½è¸ªæ£€æµ‹å·¥å…·å®˜æ–¹åœ°å€ä¸‹è½½ è·¯ç”±è¿½è¸ª å³ æ£€æµ‹æ•°æ® ä»Žä½ çš„æœ¬åœ°å®½å¸¦å¼€å§‹ åˆ° vps çš„æ•´ä¸ªè¿‡ç¨‹ä¸­èµ°çš„è·¯å¾„ï¼Œä¾‹å¦‚ åŒ—äº¬è”é€š åˆ° vulträ¸œäº¬ ä»ŽåŒ—äº¬ç›´æŽ¥è¿žåˆ°æ—¥æœ¬ï¼Œè€Œ æ²³å—ç”µä¿¡åˆ° vulträ¸œäº¬ åˆ™æ˜¯å…ˆåˆ°ç¾Žå›½ï¼Œå†åŽ»æ—¥æœ¬ã€‚ ä¸Šå›¾è¯´è¯(å›¾ç‰‡æ¥è‡ª91yun) è¿™æ¬¾è½¯ä»¶å‡ ä¹Žæ²¡æœ‰ä¸Šæ‰‹éš¾åº¦ å…·ä½“ä»‹ç»å¦‚ä¸‹ http://www.laozuo.org/8277.html ä¸¢åŒ…çŽ‡ WinMTR å…·ä½“ä»‹ç»å¦‚ä¸‹ï¼Œ91yunä»‹ç»å¾ˆè¯¦ç»†ï¼Œå¹¶é™„å¸¦ä¸‹è½½åœ°å€ï¼Œæ­¤å¤„å°±ä¸å¤šè¨€äº† https://www.91yun.org/zh/archives/1120 VPSè‡ªèº«æµ‹è¯•ï¼ˆ7.03ï¼‰ vpsç½‘ç»œæµ‹è¯• https://teddysun.com/444.html vpsæ€§èƒ½æµ‹è¯• https://teddysun.com/245.html vpséƒ¨ç½² æˆ‘é€‰æ‹©çš„æ˜¯Vultr VPSã€‚2.5åˆ€/æœˆï¼Œ500Gæµé‡ æ€Žä¹ˆæŠ˜è…¾éƒ½å¤Ÿäº†ã€‚ æœ¬èŠ‚å†…å®¹è½¬è½½/åˆ èŠ‚/ä¿®æ­£è‡ª https://mpc2008cn.github.io/2015/10/22/vps/å°±æ˜¯ä»Žè¿™å¼€å§‹æŠ˜è…¾çš„ï¼Œæœ‰åˆ å‡å’Œä¿®æ”¹ã€‚ Vultr é€šè¿‡ä¸‹é¢é“¾æŽ¥æ³¨å†Œï¼Œä½ å¯ä»¥å…è´¹èŽ·å¾— 10ç¾Žå…ƒåŒæ—¶ ä¹Ÿèƒ½å¸®åŠ©æˆ‘èŽ·å¾—ä¸€äº›å¥–åŠ±ï¼Œè°¢è°¢ï¼ Vultråœ°å€ æœåŠ¡å™¨é€‰æ‹© é€‰æ‹©ä¸œäº¬æˆ–è€…ç¾Žå›½è¥¿æµ·å²¸çš„æœåŠ¡å™¨,é€Ÿåº¦ç›¸å¯¹æ¯”è¾ƒå¿« æ“ä½œç³»ç»Ÿ æŽ¨èé€‰æ‹©Debian 7 x64æ­¤ç‰ˆæœ¬æ­å»ºSSR/é”é€Ÿ/bbråŸºæœ¬æ²¡æœ‰é‡åˆ°æ•…éšœå…¶ä»–ç‰ˆæœ¬ä¹Ÿå¯ï¼Œè¯·è‡ªè¡Œé€‰æ‹© é€‰æ‹©ç¡¬ä»¶ ä¸€ä¸ªæœˆå¯ä»¥å…è´¹ç”¨$5çš„é…ç½®,ç§‘å­¦ä¸Šç½‘å°±å¤Ÿäº†ï¼Œå»ºç«™ç­‰éœ€æ±‚éœ€è¦æ›´å¤§çš„ã€‚ åˆ›å»ºvps ç­‰å¾…å®Œæˆã€‚ VPSæµ‹è¯•(å¯å¿½ç•¥ï¼Œä½†æ˜¯æŽ¨èè¿›è¡Œ) ä½ å¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„ VPSæµ‹è¯•è½¯ä»¶ï¼Œæ¥æŸ¥çœ‹ è‡ªå·±çš„vpsåˆ°æœ¬åœ°çš„ è·¯ç”±è¿½è¸ª æ—¶å€™ä¸Ž å®˜æ–¹æµ‹è¯•åœ°å€ ç›¸åŒï¼Œä¸¢åŒ…çŽ‡/å»¶è¿Ÿå¦‚ä½•ç­‰ çŽ°åœ¨å‡ ä¹Žæ‰€æœ‰çš„vpsè¿è¥å•† éƒ½æœ‰å¤§é‡çš„å›½äººæ¶Œå…¥ï¼Œæœ‰ä¸€ç‚¹æ¦‚çŽ‡ä½ å¼€åˆ°çš„IP æ˜¯è¢« é•¿åŸŽé˜²ç«å¢™ é˜»æ–­è¿‡ï¼Œè¢«åºŸå¼ƒçš„ipã€‚åœ¨æ­£å¼æ­å»º ç§‘å­¦ä¸Šç½‘ æœåŠ¡ä¹‹å‰ï¼Œè¯·ç¡®ä¿è‡ªå·± VPS çš„å¯è®¿é—®æ€§ é…ç½®securecrt(ä¸å¿…åœ¨æ„ipåœ°å€) ä¸‹è½½securecrt å¤åˆ¶æœåŠ¡å™¨çš„IPåœ°å€,åˆå§‹ç”¨æˆ·å,åˆå§‹å¯†ç  securecrtè¿žæŽ¥vps è§£åŽ‹ä¸‹è½½çš„secure crt,åŒå‡»\SecureCRT_EN\SecureCRT\ä¸­çš„SecureCRT.exe è¾“å…¥IPåœ°å€,ç”¨æˆ·å,ç‚¹å‡»connect å¼¹å‡ºæ¡†ç‚¹å‡»Accept&amp;Save è¾“å…¥å¯†ç ,å‹¾é€‰save password,OK å‡ºçŽ°å¦‚å›¾æ‰€ç¤º,æ ‡ç­¾å˜ç»¿å°±è¯´æ˜Žè¿žæŽ¥æˆåŠŸå•¦. éƒ¨ç½²ShadowSocksR ä¸ºä»€ä¹ˆé€‰æ‹©SSRè€Œä¸æ˜¯åŽŸç‰ˆçš„SSä¸»è¦åŽŸå› å¦‚ä¸‹ å¯ä»¥ç›´æŽ¥å¯ç”¨chacha20åŠ å¯†ï¼Œåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ¯”è¾ƒå¥½ä½¿ TFO(TCP Fast Open)ç›´æŽ¥è‡ªå¸¦ï¼Œå‡å°‘æ¡æ‰‹æ¬¡æ•°ã€‚ äºŒæ¬¡æ··æ·†å’ŒæŠ—é‡æ”¾ç­‰é™„åŠ åŠŸèƒ½ shadowsocksRçš„ç›¸å…³äº‰è®ºåœ¨ä»¥ä¸‹ç½‘å€ä¸­ï¼Œè‡³äºŽç”¨æˆ·è€Œè¨€ï¼ŒçŽ°åœ¨ssrå¼€æºï¼Œä¸€å®šçš„ç½‘ç»œçŽ¯å¢ƒä¸‹æ¯”åŽŸç‰ˆçš„ssç¨³å®šå°±å¤Ÿäº†ã€‚ ä¸€äº›äº‰è®®å¦‚ä¸‹ https://www.librehat.com/about-shadowsocks-r-and-the-security-of-shadowsocks/ SSRæœ‰å…³ç½‘å€ (2.17)åœ¨2016.12æœˆä¹‹å‰å¾ˆé•¿ä¸€æ®µæ—¶é—´SSRåªåœ¨ ZeroNet ä¸­æ›´æ–°ï¼Œ17å¹´ä»¥åŽåˆ°çŽ°åœ¨æ¢å¤åœ¨githubä¸Šæ›´æ–°ï¼æœ›å‘¨çŸ¥ï¼**SSRå·²åˆ é™¤åº“ï¼Œä½†è¿˜å¯ä»¥å®‰è£…** ShadowsocksR githubä¸»é¡µ https://github.com/breakwa11/shadowsocks-rss ShadowsocksR C#(windowsç‰ˆ)ä¸‹è½½åœ°å€ https://github.com/shadowsocksr/shadowsocksr-csharp/releases shadowsocksr-androidç‰ˆä¸‹è½½åœ°å€ https://github.com/shadowsocksr/shadowsocksr-android/releases ç”¨åˆ°çš„ä¸€é”®å®‰è£…è„šæœ¬@ç§‹æ°´é€¸å†°(æ„Ÿè°¢ï¼) https://shadowsocks.be/9.html ZeroNet(ç›®å‰æ›´æ–°çŠ¶æ€æœªçŸ¥) SSR-ZeroNet http://127.0.0.1:43110/shadowsocksr.bitï¼ˆ10.9ï¼‰ä¸å®‰è£…ZeroNetï¼Œç›´æŽ¥è®¿é—®åœ°å€https://bit.no.com:43110/shadowsocksr.bit/ ZeroNetç®€ä»‹å’ŒæŽ¥å…¥ http://www.williamlong.info/archives/4574.html å®‰è£…SSR å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ°ç™»é™†æˆåŠŸçš„securecrt 123wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocksR.shchmod +x shadowsocksR.sh./shadowsocksR.sh 2&gt;&amp;1 | tee shadowsocksR.log å¦‚å›¾ï¼Œå›žè½¦ã€‚ è¾“å…¥è®¾å®šåˆå§‹å¯†ç ï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥å›žè½¦ã€‚ è¾“å…¥åˆå§‹ç«¯å£ï¼Œä¹Ÿç›´æŽ¥å›žè½¦ å—¯ï¼Œå›žè½¦ ç­‰å¾…ä¸€æ®µæ—¶é—´çš„æ»šå±ï¼Œæœ€åŽä¼šæç¤ºâ€”â€”æˆåŠŸ shadowsocks.jsoné…ç½®æ–‡ä»¶ shadowsocks.jsonæ–‡ä»¶ä¸­å®šä¹‰SSRçš„è®¿é—®ç«¯å£ï¼ŒåŠ å¯†æ–¹å¼ç­‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ WinSCPè½¯ä»¶è¿›è¡Œç¼–è¾‘ä¿®æ”¹(æ›´ä¸ºå‹å¥½)ï¼Œç›´æŽ¥ä½¿ç”¨ securecrt ç­‰å·¥å…· ä½¿ç”¨ vim å‘½ä»¤ä¿®æ”¹ä¹Ÿå¯ï¼Œæ­¤æ–‡ä¸­æš‚ä¸æ¶‰åŠ WinSCP æ˜¯ä¸€ä¸ª Windows çŽ¯å¢ƒä¸‹ä½¿ç”¨çš„ SSH çš„å¼€æºå›¾å½¢åŒ– SFTP å®¢æˆ·ç«¯ã€‚åŒæ—¶æ”¯æŒ SCP åè®®ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯åœ¨æœ¬åœ°ä¸Žè¿œç¨‹è®¡ç®—æœºé—´å®‰å…¨åœ°å¤åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥ç›´æŽ¥ç¼–è¾‘æ–‡ä»¶. ä¸‹è½½WinSCPç»¿è‰²ä¸­æ–‡ç‰ˆã€‚ è§£åŽ‹ç¼©æ‰“å¼€winscpï¼Œä¿æŒé»˜è®¤é…ç½®ä¸å˜ï¼Œè¾“å…¥VPSçš„ipåœ°å€ã€ç”¨æˆ·åã€å¯†ç ã€‚ç‚¹å‡»ç™»é™†ã€‚ é»˜è®¤åœ¨/rootæ–‡ä»¶å¤¹ä¸‹ï¼Œè¦è¿›å…¥/etcæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°shadowsocks.json ç¼–è¾‘shadowsocks.jsonæ–‡ä»¶ ä¸‹é¢æ˜¯ä¸€ä¸ª shadowsocks.jsonçš„æ³¨é‡Šæ¨¡æ¿ç›´æŽ¥å¤åˆ¶ç²˜è´´ æ— æ³¨é‡Šç‰ˆæœ¬ è¦†ç›–åŽŸå§‹æ–‡ä»¶å³å¯ï¼Œæˆ–è€…åœ¨åŽŸæ–‡ä»¶ä¸Šä¿®æ”¹ï¼ˆå»ºè®®å…ˆçœ‹ä¸€ä¸‹æ³¨é‡Šï¼Œäº†è§£ä¸€ä¸‹shadowsocks.jsonçš„å¤§è‡´å†…å®¹ï¼‰ å‚è€ƒèµ„æ–™ç½‘å€shadowsocks.jsonæ–‡ä»¶å„é¡¹é…ç½®è¯´æ˜Ž https://github.com/breakwa11/shadowsocks-rss/wiki/Server-Setup æ··æ·†æ’ä»¶è¯´æ˜Ž https://github.com/breakwa11/shadowsocks-rss/wiki/obfs æ³¨é‡Š 12345678910111213141516171819202122232425262728&#123; "server":"0.0.0.0", "server_ipv6":"::", "local_address":"127.0.0.1", "local_port":1080, "port_password":&#123; #çº¯ SS ä¸å¸¦æ··æ·† ç«¯å£25 å¯†ç ä¸º123456. "25":"123456", #ç«¯å£443ï¼Œå¯†ç 123456 ï¼Œprotocolé€‰æ‹©auth_chain_aã€‚obfsé€‰æ‹©tls1.2_ticket_authï¼Œå…·ä½“æ’ä»¶çš„ä»‹ç»å¦‚ä¸‹å‚è€ƒèµ„æ–™ä¸­ "443":&#123;"protocol":"auth_chain_a", "password":"123456", "obfs":"tls1.2_ticket_auth", "obfs_param":""&#125;, #æ³¨æ„æ— è®ºæ€Žä¹ˆå˜åŒ–ï¼Œæœ€åŽä¸€ä¸ªç«¯å£è®¾ç½®ï¼Œä¸å¸¦é€—å·ï¼ "3389":&#123;"protocol":"auth_aes128_md5", "password":"123456", "obfs":"tls1.2_ticket_auth", "obfs_param":""&#125;#æ­¤å¤„æ²¡æœ‰é€—å·ï¼ &#125;, "timeout":400, #é»˜è®¤å…¨å±€çš„åŠ å¯†æ–¹å¼ï¼Œå³ä¸Šè¾¹å„ä¸ªç«¯å£çš„é»˜è®¤åŠ å¯†æ–¹å¼ã€‚ä¸€èˆ¬ä¸ºaes-256-cfbï¼Œ æ­¤å¤„ï¼Œé€‰æ‹©ä¸ºchacha20ï¼Œç§»åŠ¨è®¾å¤‡æ€§èƒ½è¾ƒå¥½ã€‚ "method":"chacha20", #protocol.åè®®å®šä¹‰æ’ä»¶çš„é»˜è®¤å€¼ï¼Œoriginå³ä½¿ç”¨åŽŸç‰ˆSSåè®®ï¼Œä¸æ··æ·†ã€‚å³ä¸Šé¢ç«¯å£é…ç½®ä¸­ï¼Œä½ æ²¡æœ‰è®¾ç½® protocol å’Œ obfs æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„é»˜è®¤å€¼ã€‚ "protocol": "origin", "protocol_param": "", #protocol.åè®®å®šä¹‰æ’ä»¶çš„é»˜è®¤å€¼ï¼Œplainå³ä½¿ç”¨åŽŸåè®®ï¼Œä¸æ··æ·†ã€‚ "obfs": "plain", "obfs_param": "", "redirect": "", "dns_ipv6": true, #TCP FAST OPEN ï¼Œæ‰“å¼€ "fast_open": true, "workers": 1&#125; æ— æ³¨é‡Šç‰ˆæœ¬ï¼Œç›´æŽ¥å¤åˆ¶ç²˜è´´è¦†ç›–åŽŸå§‹æ–‡ä»¶ï¼Œæˆ–è€…åœ¨åŽŸæ–‡ä»¶ä¸Šä¿®æ”¹ 12345678910111213141516171819202122&#123; "server":"0.0.0.0", "server_ipv6":"::", "local_address":"127.0.0.1", "local_port":1080, "port_password":&#123; "25":"123456", "443":&#123;"protocol":"auth_chain_a", "password":"123456", "obfs":"tls1.2_ticket_auth", "obfs_param":""&#125;, "3389":&#123;"protocol":"auth_aes128_md5", "password":"123456", "obfs":"tls1.2_ticket_auth", "obfs_param":""&#125; &#125;, "timeout":400, "method":"chacha20", "protocol": "origin", "protocol_param": "", "obfs": "plain", "obfs_param": "", "redirect": "", "dns_ipv6": true, "fast_open": true, "workers": 1&#125; é‡å¯SSR é…ç½®å®ŒæˆåŽï¼Œé‡å¯SSR,ä»¥rootè´¦æˆ·ç™»é™†securecrtï¼Œå¤åˆ¶ä»¥ä¸‹ä»£ç ï¼Œé‡å¯ssrã€‚ 1/etc/init.d/shadowsocks restart ä¼šæç¤ºshadowsocksré‡å¯æˆåŠŸã€‚ï¼ˆå¦‚å›¾ï¼‰ æ›´æ–°SSR vpsç«¯ï¼Œéœ€è¦å…ˆä»¤å­˜ shadowsocks.jsonæ–‡ä»¶ã€‚å†æ‰§è¡Œå¸è½½ 1./shadowsocksR.sh uninstall ä¹‹åŽé‡æ–°æ‰§è¡Œå®‰è£…è„šæœ¬å³å¯ æ··æ·†é€‰æ‹©(æ–°æ‰‹å¯ç•¥è¿‡)æ··æ·†æ’ä»¶ç®€ä»‹ ShadowsocksRç›®å‰æ”¯æŒçš„æ··æ·†æ’ä»¶ï¼ˆæ­¤ç±»åž‹çš„æ’ä»¶ç”¨äºŽå®šä¹‰åŠ å¯†åŽçš„é€šä¿¡åè®®ï¼‰ï¼š plain ,http_simple ,http_post,random_head ,tls1.2_ticketauth åè®®å®šä¹‰æ’ä»¶(ç”¨äºŽå®šä¹‰åŠ å¯†å‰çš„åè®®): origin, auth_sha1, auth_sha1_v2, auth_sha1_v4, auth_aes128_md5/auth_aes128_sha1 auth_aes128_md5/auth_aes128_sha1 æ”¯æŒ å•ç«¯å£å¤šç”¨æˆ·ï¼Œå³ä¸€ä¸ªç«¯å£ å¯ä»¥é…ç½® å‡ ä¸ªä¸åŒçš„å¯†ç ï¼Œç¨åŽæ›´æ–°ã€‚ ShadowsocksR åè®®æ’ä»¶æ–‡æ¡£ æ··æ·†æ’ä»¶é€‰æ‹©(5.24) é€šç”¨ æŽ¨èauth_chain_a+tls1.2_ticket_authè¿™ç§ç»„åˆç›®å‰æ··æ·†æ•ˆæžœæœ€å¥½ï¼Œæœ‰åˆ©äºŽä¸ªäººVPSçš„é•¿æ—¶é—´ä½¿ç”¨ã€‚ ï¼ˆ5.24ï¼‰auth_chain_aå¯ä¸ä½¿ç”¨ç”¨åŠ å¯†ï¼Œå³åŠ å¯†æ–¹å¼Noneï¼ˆSSRä½œè€…è¯­ï¼‰ï¼Œä½†æ˜¯å§ï¼Œæ€§èƒ½å·®ä¸å¤šçš„æƒ…å†µä¸‹ï¼ŒåŠ ä¸ªå¯†æ²¡æ¯›ç—…ã€‚ auth_aes128_md5æˆ–auth_aes128_sha1+éšæ„ï¼Œå³ä½¿ä½¿ç”¨rc4åŠ å¯†äº¦å¯ï¼ˆSSRä½œè€…è¯­ï¼‰ çŽ©æ¸¸æˆï¼Œæˆ–å¯¹å»¶è¿Ÿæœ‰è¦æ±‚ï¼Œä¸è¦ä½¿ç”¨tls1.2_ticket_auth ç½‘ç»œå°é”/ç›‘æŽ§çŽ¯å¢ƒä¸‹ ä¾‹å¦‚å­¦æ ¡æ•™è‚²ç½‘/å…¬å¸å†…ç½‘/å¹¿ç”µå®½å¸¦ç­‰ç­‰ï¼Œå°æ€äº†BT/ç¦æ­¢è®¿é—®ç½‘ç›˜ç­‰ç­‰ç­‰ç­‰ã€‚ ä½¿ç”¨http_simpleã€http_postæˆ–tls1.2_ticket_auth æ··æ·†è®¿é—®çš„ç›®æ ‡ç½‘å€ã€‚å†é…åˆ443/80ç«¯å£é€šå¸¸å¯ä»¥è§£å†³é—®é¢˜ã€‚ Android (5.24)æœ€å¥½ä½¿ç”¨auth_chain_aã€‚ å¦‚æžœä¹‹å‰ä½¿ç”¨çš„æ˜¯auth_aes128_md5ï¼ŒæŽ¨èä»¥auth_chain_aæ›¿æ¢ æ‰‹æœºè¿ç®—èƒ½åŠ›è¾ƒå·®çš„æŽ¨èä½¿ç”¨auth_sha1_v4æ›¿æ¢auth_aes128_md5 å•ç«¯å£å¤šç”¨æˆ·ï¼ï¼ï¼æŽ¨èï¼ï¼ï¼ https://doub.io/ss-jc48/ é€—æ¯”æ ¹æ®åœ°çš„ä»‹ç»ï¼Œå¾ˆè¯¦ç»†ï¼Œæ­é…æœ€æ–°çš„auth_chain_a æ··æ·†ï¼Œå¾ˆå¥½ç”¨ã€‚https://breakwa11.blogspot.ru/2017/01/shadowsocksr-mu.html?m=1 å®˜æ–¹ ShadowsocksRå•ç«¯å£å¤šç”¨æˆ·é…ç½®æ–¹æ³• åŸŸåç”³è¯·ï¼Œå…è´¹ï¼ https://my.freenom.com/clientarea.php DNSè§£æžç”³è¯·ï¼Œæ³¨å†Œç”¨Googleæœç´¢ä¸´æ—¶é‚®ç®±å³å¯ https://www.cloudxns.net/ VPSä¼˜åŒ– è¯¦æƒ…åœ¨ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ï¼ˆäºŒï¼‰â€”â€”VPSä¼˜åŒ–åŠ é€Ÿ è¿™é‡ŒåªæåŠ åŽŸç‰ˆBBR BBRç›®å‰æœ‰å¾ˆå¤šä¿®æ”¹ç‰ˆæœ¬ï¼Œæ•ˆæžœå¾ˆå¥½ï¼ŒBBRå±žäºŽå†…æ ¸çº§åˆ«ï¼Œä¸æŽ¨èæ–°æ‰‹ å®‰è£…ä¿®æ”¹ç‰ˆBBRï¼Œå†…æ ¸æŒ‚æŽ‰ï¼Œæ–°æ‰‹ä¸€èˆ¬å¾ˆéš¾å¤„ç†ã€‚ ä¿®æ”¹ç‰ˆBBR è¯¦æƒ…è§ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ï¼ˆäºŒï¼‰â€”â€”VPSä¼˜åŒ–åŠ é€Ÿ TCPä¼˜åŒ– å¢žåŠ TCPè¿žæŽ¥æ•°é‡ 1nano /etc/security/limits.conf æ·»åŠ ä¸¤è¡Œï¼š 12* soft nofile 51200* hard nofile 51200 ä¿å­˜(Ctrl + X â€”â€” y â€”â€”å›žè½¦) è®¾ç½®ulimitï¼š 1ulimit -n 51200 TCP-BBR(æŽ¨è) è„šæœ¬æ¥è‡ªäºŽ@ç§‹æ°´é€¸å†° æ•¬å‘Šï¼š é”é€Ÿä¸æ”¯æŒï¼Œæ›´æ¢åŽçš„ 4.9åŠä»¥åŽ å†…æ ¸ åŠ é€Ÿæ•ˆæžœä¸Žå…·ä½“ç½‘ç»œçŠ¶æ€æœ‰å…³ ä¸æŽ¨èæ–°æ‰‹ç›´æŽ¥å®‰è£…ä¿®æ”¹ç‰ˆBBRï¼ŒæŒ‚æŽ‰åŽå¾ˆéš¾æ¢å¤ã€‚ BBR (Bottleneck Bandwidth and RTT)æ˜¯ç”±googleå·¥ç¨‹å¸ˆç¼–å†™çš„æ–°çš„ TCP æ‹¥å¡žæŽ§åˆ¶ç®—æ³•ï¼Œç›®çš„æ˜¯è¦å°½é‡è·‘æ»¡å¸¦å®½, å¹¶ä¸”å°½é‡ä¸è¦æœ‰æŽ’é˜Ÿçš„æƒ…å†µ, åŠ é€Ÿæ•ˆæžœä¸æ¯”é”é€Ÿå·®ï¼Œå®Œå…¨å¼€æºï¼Œå¯¹éšåŒ¿æ€§è¦æ±‚é«˜è€Œæ— æ³•ä½¿ç”¨é”é€Ÿçš„äººå£«ï¼Œä¹Ÿå¯ä»¥æ”¾å¿ƒä½¿ç”¨å¼€æºåœ°å€ å¯ç”¨TCP-BBRæ¶‰åŠVPSæ›´æ¢å†…æ ¸ï¼Œæ‰€ä»¥å¦‚æžœæ­¥éª¤é”™è¯¯ï¼Œæˆ–è€…VPSä¸å…¼å®¹æœ€æ–°çš„å†…æ ¸ï¼Œä¼šå¯¼è‡´æ— æ³•å¼€æœºç­‰é”™è¯¯ ç›®å‰åœ¨ Vultr / DO ä¸Šæµ‹è¯•é€šè¿‡ã€‚å…¶ä»–ä¸»æœºæä¾›å•†ï¼Œè¯·è‡ªè¡Œæµ‹è¯• è¿žæŽ¥SSHï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ 123wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.shchmod +x bbr.sh./bbr.sh æç¤ºéœ€è¦é‡å¯ VPSï¼Œè¾“å…¥ y å¹¶å›žè½¦åŽé‡å¯ï¼Œé‡è¿žSSH è„šæœ¬ä¼šè‡ªåŠ¨æ›´æ–°åŒ¹é…çš„4.xxç‰ˆæœ¬å†…æ ¸(6.28 ç›®å‰æ˜¯4.11ï¼‰ï¼Œå¹¶å¯ç”¨TCP BBR éªŒè¯ è¾“å…¥ 1uname -r æœ‰4.9.0 ä»¥ä¸Šå°± è¡¨ç¤º æ›´æ–°æˆåŠŸ è¾“å…¥ 1lsmod | grep bbr è¿”å›žå€¼æœ‰ tcpbbr å³bbrå·²å¯åŠ¨ã€‚ æ·»åŠ ä¸€äº›ä¼˜åŒ–å†…å®¹ä¿®æ”¹sysctl.conf 1nano /etc/sysctl.conf å¤åˆ¶ä»£ç ï¼š 1234567891011121314151617181920212223#TCPé…ç½®ä¼˜åŒ–(ä¸ç„¶ä½ è‡ªå·±æ ¹æœ¬ä¸çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆ)fs.file-max = 51200#æé«˜æ•´ä¸ªç³»ç»Ÿçš„æ–‡ä»¶é™åˆ¶net.core.rmem_max = 67108864net.core.wmem_max = 67108864net.core.netdev_max_backlog = 250000net.core.somaxconn = 4096net.ipv4.tcp_syncookies = 1net.ipv4.tcp_tw_reuse = 1net.ipv4.tcp_tw_recycle = 0net.ipv4.tcp_fin_timeout = 30net.ipv4.tcp_keepalive_time = 1200net.ipv4.ip_local_port_range = 10000 65000net.ipv4.tcp_max_syn_backlog = 8192net.ipv4.tcp_max_tw_buckets = 5000net.ipv4.tcp_fastopen = 3net.ipv4.tcp_mem = 25600 51200 102400net.ipv4.tcp_rmem = 4096 87380 67108864net.ipv4.tcp_wmem = 4096 65536 67108864net.ipv4.tcp_mtu_probing = 1net.ipv4.tcp_congestion_control = bbr#END OF LINE ä¿å­˜(Ctrl + X â€”â€” y â€”â€”å›žè½¦) åº”ç”¨ 1sysctl -p é‡å¯SSR 1/etc/init.d/shadowsocks restart VPSå®‰å…¨åŠ å›º( å®‰å…¨æ€§æ˜¯é‡ä¸­ä¹‹é‡ï¼) å¿…é¡»è¿›è¡Œçš„æ­¥éª¤ï¼Œå®‰å…¨æ€§æ˜¯é‡ä¸­ä¹‹é‡ï¼è¯¦æƒ…åœ¨ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ï¼ˆä¸‰ï¼‰â€”â€”VPSå®‰å…¨åŠ å›º shadowsocksR å®¢æˆ·ç«¯é…ç½®shadowsocksR C# windowsç‰ˆæœ¬ (6.28)æœ€æ–°çš„4.6.0å®¢æˆ·ç«¯(æ³¨æ„MD5æ ¡éªŒ) æ”¯æŒhostsæ–‡ä»¶å®žéªŒæ€§è´¨ï¼Œç¨³å®šåŽåŠ å…¥ shadowsocksR C# windowsç‰ˆæœ¬ æ¥æºäºŽgithubå¤‡ä»½ã€‚ è§£åŽ‹ShadowsocksR-win-4.6.1.7zï¼ˆä»¥å…·ä½“å®¢æˆ·ç«¯ç‰ˆæœ¬ä¸ºå‡†ï¼‰ï¼Œæ‰“å¼€ã€‚ å¯¹åº”ä¸Šæ–‡ä¸­SSRæœåŠ¡ç«¯é…ç½®è¾“å…¥å¯¹åº”ç«¯å£é…ç½®ï¼Œipåœ°å€ï¼Œå¯†ç ç­‰ã€‚ 25ç«¯å£ï¼ˆå•SSï¼‰ 443ç«¯å£ 3389ç«¯å£ å³é”®shadowsockså¿«æ·å›¾æ ‡,é€‰æ‹©å¯ç”¨ç³»ç»Ÿä»£ç†çŽ°åœ¨åº”è¯¥å¯ä»¥è®¿é—® è°·æ­Œäº†:) ä½¿ç”¨Chrome+SwitchyOmega æŽ¨èï¼ï¼ Chromeä¸‹æ’ä»¶SwitchyOmegaå¯ä»¥æ ¹æ®è¦è®¿é—®çš„ç½‘å€åˆ¤æ–­æ˜¯å¦éœ€è¦ç»è¿‡ä»£ç†ï¼Œåšåˆ°æ™ºèƒ½çš„ç§‘å­¦ä¸Šç½‘ã€‚å¹¶ä¸”çŽ°åœ¨è¿™ä¸ªæ’ä»¶çš„é…ç½®å¯ä»¥äº‘åŒæ­¥ï¼Œå†ä¹Ÿä¸ç”¨æœ¬åœ°ä¿å­˜äº†ï¼å…·ä½“æ•™ç¨‹å¦‚ä¸‹SwitchyOmegaä½¿ç”¨ssä»£ç† http://www.ihacksoft.com/chrome-switchyomega.html é…åˆgfwlist https://github.com/FelisCatus/SwitchyOmega/wiki/GFWList SSR-Android SSR-Android SSR-Androidç«¯(æ³¨æ„MD5æ ¡éªŒ) https://github.com/Jasper-1024/shadowsocksr-android-1/releases (12.11) ssr-androidæ›´æ–°åˆ°3.2.7.14.ç‰ˆï¼Œå¢žåŠ auth_aes128_md5å’Œauth_aes128_sha1,æŽ¨èæ›´æ–°ï¼ (1.11)ssr-androidæ›´æ–°åˆ°3.3.3.1æŽ¨èæ›´æ–°ï¼ (2.17)ssr-androidæ›´æ–°åˆ°3.3.4.5 æŽ¨èæ›´æ–°! (6.28)SSR-androidæ›´æ–°3.4.0.5 androidç«¯ä½¿ç”¨ å¯ä»¥ç›´æŽ¥è¾“å…¥SSRé…ç½®ï¼Œè¾ƒä¸ºç¹ç åœ¨SSR C#ç‰ˆæœ¬ï¼Œä¸­è¾“å…¥å®Œæ¯•ï¼Œä¿å­˜ã€‚ç›´æŽ¥æ‰«æäºŒç»´ç å³å¯ï¼äºŒç»´ç å¿…é¡»åœ¨å…‰æ ‡ç§»åˆ° SSRé“¾æŽ¥ å¤„æ‰ä¼šå‡ºçŽ° ç»“æŸ]]></content>
      <categories>
        <category>ç§‘å­¦ä¸Šç½‘</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>VPS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¼€ç«¯ï¼Œèµ·å§‹ã€‚]]></title>
    <url>%2F2016%2F06%2F21%2F%E5%BC%80%E7%AB%AF%2F</url>
    <content type="text"><![CDATA[æ€»ç®—æ˜¯åšå®¢æ­å»ºå®Œäº†ï¼Œä¾é™„åœ¨githubä¸Šï¼Œè‡ªå·±çš„åŸŸåä»€ä¹ˆçš„å…ˆä¸ä¹°äº†ã€‚ è¯„è®ºç³»ç»Ÿã€RSSã€ç•™è¨€ã€ç»Ÿè®¡ã€è®¿é—®é‡ åŸºæœ¬æœ‰ä¸ªç‹¬ç«‹åšå®¢çš„æ ·å­äº†ã€‚ä¹‹å‰ä¸€ç›´ä»¥ä¸ºç‹¬ç«‹åšå®¢è¦èŠ±å¾ˆé•¿æ—¶é—´æ‰å¯ä»¥å®Œæˆï¼Œå…¶å®žä¹Ÿå°±é‚£äº›ä¸œè¥¿ï¼ŒçœŸæ­£åŽ‰å®³çš„æ˜¯é€ è½®å­çš„äººã€‚ é©¬ä¸Šå¤§å››äº†ï¼Œåè€Œæ‰¾åˆ°äº†è‡ªå·±çš„å…´è¶£ï¼Œä¸çŸ¥é“æ˜¯é«˜å…´è¿˜æ˜¯æ‚²ä¼¤ï¼Œåšäº†ä¸‰å¹´çš„å•ç‰‡æœºæœ€åŽå‘çŽ°æœ€å–œæ¬¢çš„æ˜¯è½¯ä»¶ï¼Œé€ åŒ–å¼„äººå§ã€‚ å¼€å§‹æ›´æ–°è‡ªå·±çš„ç»åŽ†å’Œå¿ƒæƒ…ï¼ŒåŸºæœ¬ä¸ç”¨æ‹…å¿ƒå®¡æŸ¥å’Œå¤‡æ¡ˆï¼Œåæ­£æœåŠ¡å™¨åˆä¸åœ¨å›½å†…ã€‚åªèƒ½è¯´èµ°ä¸€æ­¥å†èµ°ä¸€æ­¥äº†ç”¨å¥½å‰©ä¸‹çš„æ—¶é—´ã€‚å‰è·¯å’ŒæœŸè®¸å¾ˆéš¾ï¼Œä½†æ˜¯å°±è¿™ä¹ˆç†¬ç€ï¼Œæ€»æœ‰æ„å¤–çš„ä¸€å¤©ã€‚]]></content>
      <categories>
        <category>éš</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åˆå…¥æ ‘èŽ“æ´¾1å®‰è£…ç³»ç»Ÿ+è¿›å…¥SSH]]></title>
    <url>%2F2016%2F06%2F21%2F%E5%88%9D%E5%85%A5%E6%A0%91%E8%8E%93%E6%B4%BE1----%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F%2B%E8%BF%9B%E5%85%A5SSH%2F</url>
    <content type="text"><![CDATA[ä¸ºäº†æ›´å¥½çš„ä»Žäº‹ç¨‹åºå‘˜äº‹ä¸šã€å¡«å‘linuxã€ä¸ºå­¦å¼Ÿæ‰“ä¸‹ç¬¬ä¸€æ‰‹èµ„æ–™ã€ç•™ä¸‹linuxåŸ¹è®­æ•™æâ€¦â€¦ å®žé™…å°±æ˜¯ä¸ºäº†æ­ä¸ªè·¯ç”±å™¨ï¼ŒçŽ©çŽ© å…¥äº†æ ‘èŽ“æ´¾3b +ç”µæº+å¤–å£³+sdå¡â€”300å¤§æ´‹â€”â€”â€“è‚‰ç–¼ æ ‘èŽ“æ´¾ç³»ç»Ÿå®‰è£… æ ‘èŽ“æ´¾3bçš„è€—ç”µé‡è¿˜æ˜¯æŒºå¤§çš„ æŽ¨èä¹°ä¸ª2.5Açš„ç”µæº ç³»ç»Ÿé€‰æ‹© æ ‘èŽ“æ´¾æ”¯æŒ æ•°åæ¬¾æ“ä½œç³»ç»Ÿï¼Œä¸€èˆ¬æ–°æ‰‹æŽ¨èçš„æ˜¯raspbian Raspbianæ˜¯ä¸ºæ ‘èŽ“æ´¾è®¾è®¡ï¼ŒåŸºäºŽDebiançš„æ“ä½œç³»ç»Ÿï¼Œä¸éš¶å±žäºŽæ ‘èŽ“æ´¾åŸºé‡‘ä¼š[1]ï¼Œä½†è¢«åˆ—ä¸ºå®˜æ–¹æ”¯æŒçš„æ“ä½œç³»ç»Ÿï¼Œ Raspbiané•œåƒåœ°å€(æœ€å¥½åœ¨FQä¸‹ï¼Œå¦åˆ™ä¼šå¾ˆæ…¢çš„ã€‚ä½ è¦ç”¨IDMå½“æˆ‘æ²¡è¯´) Raspbianæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç®€å•åŒºåˆ«å¦‚ä¸‹ RASPBIAN JESSIE WITH PIXELå¸¦æœ‰å®Œæ•´çš„æ¡Œé¢ä½“éªŒï¼Œå®‰è£…åŒ…1.4Gå·¦å³ RASPBIAN JESSIE LITEæ²¡æœ‰X-server å¥—ä»¶ï¼Œæ²¡æœ‰ Qt å’Œ GTK+ çš„å‡½å¼åº“ã€‚ç­‰äºŽåŽ»æŽ‰äº†æ¡Œé¢ã€‚å®‰è£…åŒ…400Mbä¸Šä¸‹ã€‚ æ‰€è¦ç”¨åˆ°çš„å·¥å…·æ˜¯ï¼š 1.å¤šåŠŸèƒ½è¯»å¡å™¨ä¸€ä¸ª 2.TFå¡ä¸€å¼ ï¼ˆ4Gä»¥ä¸Šï¼‰ çƒ§å†™å™¨å®˜æ–¹æŽ¨èæ˜¯win32diskimagerä½†æ˜¯æ–‡ä»¶è·¯å¾„ä¸æ”¯æŒä¸­æ–‡ã€‚ ä¸ªäººæŽ¨è USB Image Toolæ•…éšœçŽ‡æœ€ä½Žçš„æ˜¯1.7ç‰ˆæœ¬ã€‚ æ’ä¸Šè¯»å¡å™¨ï¼Œçƒ§å†™ç³»ç»Ÿå¼€å§‹ï¼ çƒ§å†™ç³»ç»Ÿ æ‰“å¼€USB Image Toolæ³¨æ„å·¦ä¸Šè§’æ˜¯Device Modeï¼Œä¸æ˜¯Volume Modeï¼ é€‰æ‹©ä¸‹è½½åŽè§£åŽ‹çš„imgæ–‡ä»¶ å†™å…¥ç­‰å¾…è¿›åº¦æ¡å®Œæˆå³å¯ã€‚ é”™è¯¯åŽŸå›  USB Image Tool åœ¨win7ä»¥ä¸Šç³»ç»Ÿä¸­å¿…é¡»è¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ USB Image Toolè¿è¡Œéœ€è¦.netçŽ¯å¢ƒ ç›´æŽ¥ä½¿ç”¨ç³»ç»Ÿé»˜è®¤åŠ è½½çš„å³å¯ã€‚ çƒ§å†™å®ŒæˆåŽæŽ¥å…¥ç”µæº è¿›å…¥SSHç®¡ç†ï¼ˆæ²¡æœ‰æ˜¾ç¤ºè®¾å¤‡æ—¶ï¼‰ ç¬¬ä¸€æ¬¡è¿›å…¥ç³»ç»Ÿæ—¶ç›´æŽ¥åˆ©ç”¨ç½‘çº¿æŽ¥å…¥è·¯ç”±å™¨ï¼Œå°†ç”µè„‘æŽ¥å…¥åŒä¸€ä¸ªwifiä¸‹ã€‚åœ¨è·¯ç”±å™¨ç®¡ç†ç•Œé¢æŸ¥æ‰¾æ ‘èŽ“æ´¾å¯¹åº”å¾—IPåœ°å€ã€‚ä¹Ÿå¯ä»¥æ‰«æä¸€ä¸‹å±€åŸŸç½‘è®¾å¤‡ä¸­å¼€å¯22ç«¯å£çš„è®¾å¤‡. ä½¿ç”¨SSHç®¡ç†å·¥å…·ï¼Œè¿™é‡Œä»¥puttyä¸ºä¾‹ã€‚æ‰“å¼€è½¯ä»¶ï¼Œå¡«å…¥æ ‘èŽ“æ´¾ipåœ°å€ã€‚ æ‰“å¼€è½¯ä»¶ï¼Œå¡«å…¥æ ‘èŽ“æ´¾ipåœ°å€ã€‚é»˜è®¤ç™»é™†ç•Œé¢ é»˜è®¤ç”¨æˆ·åpi å¯†ç raspberryã€‚ ç™»é™†æˆåŠŸï¼ å‚è€ƒ http://blog.csdn.net/longerzone/article/details/36034619]]></content>
      <categories>
        <category>æ ‘èŽ“æ´¾</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2016%2F06%2F18%2Fhellowworld%2F</url>
    <content type="text"><![CDATA[Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
      <categories>
        <category>éš</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Linux</tag>
        <tag>VPS</tag>
        <tag>python</tag>
        <tag>å•ç‰‡æœº</tag>
        <tag>å¼€æº</tag>
      </tags>
  </entry>
</search>
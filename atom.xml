<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é»˜</title>
  <subtitle>ä¸ºäº†ç”Ÿå­˜ï¼Œè€Œä¸€ç‚¹ç‚¹æ·¡å¿˜äº†æœ€åˆçš„æœ¬æ„ã€‚</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-01-14T06:53:03.785Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Jasper</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="http://yoursite.com/2018/01/14/wenti/"/>
    <id>http://yoursite.com/2018/01/14/wenti/</id>
    <published>2018-01-14T06:27:33.461Z</published>
    <updated>2018-01-14T06:53:03.785Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><ul>
<li>ä¸»ä½“æ˜¯Activity + ViewPager + Fragment, Fragmentçš„recyclerviewåŠ è½½åˆ—è¡¨.</li>
<li>MainViewModel ä¸­æŒæœ‰FragmentViewModel å’Œ MainRepositoryå®ä¾‹.(MainRepositoryå®ç°æ•°æ®è·å–).MainViewModelä¸­å®ç°äº†MainActicityçš„<code>LifecycleObserver</code>æ¥å£,å¯ä»¥åœ¨Acticity creat resumeç­‰ç­‰æ—¶å€™,åšä¸€äº›æ•°æ®æ“ä½œ.</li>
<li><p>æ•´ä½“æ˜¯MVVM,ç›´æ¥å¯¹ FragmentViewModel çš„å®ä¾‹æ‰§è¡Œ<code>xxx.set(items)</code>è®¾ç½®æ•°æ®,å¯¹åº”recyclerviewå°±èƒ½åˆ·æ–°æ•°æ®(ä¸ç”¨è€ƒè™‘çº¿ç¨‹é—®é¢˜)</p>
</li>
<li><p>æ•´ä½“éœ€è¦å®ç°çš„åŠŸèƒ½,å¦‚å›¾<img src="https://i.loli.net/2018/01/14/5a5afd1583ee6.png" alt="è‰å›¾.png"></p>
</li>
<li><p>æºç åœ°å€ &gt; <a href="https://github.com/Jasper-1024/MyPrivacy/tree/MVVM_test/app/src/main/java/com/jasperhale/myprivacy/Activity" target="_blank" rel="external">https://github.com/Jasper-1024/MyPrivacy/tree/MVVM_test/app/src/main/java/com/jasperhale/myprivacy/Activity</a><br>æš‚æ—¶æ¯”è¾ƒä¹±,è¿˜æ²¡æ•´ç†.</p>
</li>
<li><p>æˆ‘å°è¯•ä½¿ç”¨rxjavaçš„BehaviorSubjectæ¥å®ç°è¿™ä¸ªè¿‡ç¨‹.</p>
<ul>
<li><p>åœ¨FragmentViewModel  ä¸­æ–°å»ºä¸€ä¸ªpublicçš„ <code>BehaviorSubject</code></p>
</li>
<li><p>MainRepository è·å–æ•°æ®è¿‡ç¨‹åŒ…è£…æˆä¸€ä¸ª<code>Observable &lt;ObservableList&gt; applistObservable</code></p>
</li>
<li><p>åœ¨FragmentViewModelå°†è®¾ç½®è¿‡ç¨‹ï¼ˆ<code>xxx.set(items)</code>ï¼‰åŒ…è£…æˆä¸€ä¸ª <code>Observer&lt;ObservableList&gt; setObserver</code></p>
</li>
<li><p>åœ¨MainActicity creat/destoryæ—¶å€™ ç»‘å®š/è§£ç»‘ <code>applistObservable.subscribe(behaviorSubject);</code></p>
</li>
<li><p>åœ¨Fragment creat/destoryæ—¶å€™ ç»‘å®š/è§£ç»‘ <code>behaviorSubject.subscribe(setObserver);</code></p>
</li>
</ul>
</li>
</ul>
<p>##ã€€é—®é¢˜</p>
<ul>
<li>è¡¨ç°: recycleerview æ²¡æœ‰æ˜¾ç¤ºæ•°æ®.</li>
<li>åœ¨ MainRepository é‡Œé¢çš„ applistObservable æ‰“å°æ˜¾ç¤ºå·²ç»å®Œæˆäº†è·å–,ä½†FragmentViewModel é‡Œé¢çš„ setObserver æ²¡æœ‰æ”¶åˆ°æ•°æ®.</li>
<li>ç¨å¾®æ”¹ä¸€ç‚¹åœ°æ–¹(logæ‰“å°),android studioçš„ instant run åˆ·æ–°åå¯¹åº”åˆ—è¡¨æ˜¾ç¤ºæ­£å¸¸.</li>
</ul>
<p>##ã€€å…¶ä»–</p>
<ul>
<li>ä¸ªäººå¼€æºé¡¹ç›®,ä¸æ¶‰åŠå•†ä¸šé—®é¢˜.</li>
<li>å› ä¸ºè¿™ä¸ªå¡äº†å¾ˆä¹…äº†,æœ‰å¿æ±‚æ•™.</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æè¿°&quot;&gt;&lt;a href=&quot;#æè¿°&quot; class=&quot;headerlink&quot; title=&quot;æè¿°&quot;&gt;&lt;/a&gt;æè¿°&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ä¸»ä½“æ˜¯Activity + ViewPager + Fragment, Fragmentçš„recyclerviewåŠ è½½åˆ—è¡¨.&lt;/
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Androidéšæ‰‹è®°â€”Android Mé—ªé€€å°è®°</title>
    <link href="http://yoursite.com/2017/11/23/Android%E9%9A%8F%E6%89%8B%E8%AE%B0-Android%20M%E9%97%AA%E9%80%80%E5%B0%8F%E8%AE%B0/"/>
    <id>http://yoursite.com/2017/11/23/Androidéšæ‰‹è®°-Android Mé—ªé€€å°è®°/</id>
    <published>2017-11-23T04:00:00.000Z</published>
    <updated>2017-11-23T13:25:12.336Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 3.0.1</li>
</ul>
<hr>
<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul>
<li>MyPrivacy åœ¨android Mä¸Šé—ªé€€,åœ¨æ¨¡æ‹Ÿå™¨ä¸­å¤ç°.æç¤º<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android.util.AndroidRuntimeException: Calling startActivity() from outside of an Activity  context requires the FLAG_ACTIVITY_NEW_TASK flag. Is this really what you want?</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><ul>
<li>è¿›å…¥ç¬¬äºŒä¸ªActivityåº”ç”¨è®¾ç½®æ—¶,æ‰å‡ºç°,è€Œä¸” 7.1æ— é—®é¢˜.æ¨¡æ‹Ÿå™¨å¤ç°,æŠ“log.</li>
</ul>
<h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><ul>
<li>logçš„æ„æ€æ˜¯å¯åŠ¨activityçš„contextä¸æ˜¯ activity.</li>
<li><p>å¯¹åº”ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = new Intent(MyApplicantion.getContext(),   AppSettingActivity.class);</div><div class="line">intent.putExtra(&quot;PackageName&quot;, AppId);</div><div class="line">MyApplicantion.getContext().startActivity(intent);</div></pre></td></tr></table></figure>
</li>
<li><p>éœ€è¦å¯¹intentå£°æ˜ FLAG_ACTIVITY_NEW_TASK</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h3><ul>
<li>ç½‘ä¸Šçš„åŸå› åˆ†æ:</li>
<li>å› ä¸ºstandardæ¨¡å¼çš„Activityé»˜è®¤ä¼šè¿›å…¥å¯åŠ¨å®ƒçš„Activityæ‰€å±çš„ä»»åŠ¡æ ˆä¸­ï¼Œä½†æ˜¯ç”±äºéActivityç±»å‹çš„contextï¼ˆApplicationContextï¼‰å¹¶æ²¡æœ‰æ‰€è°“çš„ä»»åŠ¡æ ˆï¼Œæ‰€ä»¥å°±å‡ºç°é—®é¢˜äº†ã€‚éœ€è¦æŒ‡å®šActivityä¸ºFLAG_ACTIVITY_NEW_TASKæ ‡è®°ä½ï¼Œè¿™æ ·å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„ä»»åŠ¡æ ˆäº†ã€‚â€“androidå¼€å‘è‰ºæœ¯æ¢ç©¶</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;ç¼–ç¨‹ç¯å¢ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Android Studio 3.0.1&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;M
    
    </summary>
    
      <category term="Androidéšæ‰‹è®°" scheme="http://yoursite.com/categories/Android%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Androidéšæ‰‹è®°â€”ScrollView</title>
    <link href="http://yoursite.com/2017/11/12/Android%E9%9A%8F%E6%89%8B%E8%AE%B0-ScrollView/"/>
    <id>http://yoursite.com/2017/11/12/Androidéšæ‰‹è®°-ScrollView/</id>
    <published>2017-11-12T04:00:00.000Z</published>
    <updated>2017-11-12T09:48:39.562Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 3.0</li>
</ul>
<hr>
<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul>
<li>æ¨ªå±æ¨¡å¼ä¸‹,æ˜¾ç¤ºå†…å®¹è¢«é®æŒ¡</li>
</ul>
<h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><ul>
<li>GoogleğŸ˜‚</li>
</ul>
<h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><ul>
<li>ScrollView åªå…è®¸åµŒå¥—ä¸€ä¸ªå­å¸ƒå±€.è¶…å‡ºèŒƒå›´éƒ¨åˆ†ä¼šè‡ªåŠ¨å¢åŠ æ»šåŠ¨æ¡</li>
</ul>
<h3 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h3><ul>
<li>ScrollView åªèƒ½æ·»åŠ ç«–ç›´æ–¹å‘æ»šåŠ¨æ¡.</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;ç¼–ç¨‹ç¯å¢ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Android Studio 3.0&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ¨ªå±æ¨¡
    
    </summary>
    
      <category term="Androidéšæ‰‹è®°" scheme="http://yoursite.com/categories/Android%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Androidç¬”è®°â€”Rxjava2</title>
    <link href="http://yoursite.com/2017/11/06/Android%E7%AC%94%E8%AE%B0%E2%80%94Rxjava2/"/>
    <id>http://yoursite.com/2017/11/06/Androidç¬”è®°â€”Rxjava2/</id>
    <published>2017-11-06T04:00:00.000Z</published>
    <updated>2017-11-06T15:10:08.180Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>èµ„æ–™æ¥æºå¦‚ä¸‹<br><a href="http://www.jianshu.com/u/c50b715ccaeb" target="_blank" rel="external">ç»™åˆå­¦è€…çš„RxJava2.0æ•™ç¨‹</a>(demoä»£ç æ¥æº)</p>
<blockquote>
<p><a href="http://www.jianshu.com/u/c50b715ccaeb" target="_blank" rel="external">http://www.jianshu.com/u/c50b715ccaeb</a></p>
</blockquote>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 2.2.3 </li>
</ul>
<hr>
<ul>
<li>åœ¨Gradleé…ç½®:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">compile &apos;io.reactivex.rxjava2:rxjava:2.0.1&apos;</div><div class="line">compile &apos;io.reactivex.rxjava2:rxandroid:2.0.1&apos;</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h2><ul>
<li>åœ¨Eventbusä¸­äº¦æ¶‰åŠäº†ç›¸å…³æ¦‚å¿µ,æ¯”è¾ƒç®€å•.åŒ…æ‹¬Observable(è¢«è§‚å¯Ÿè€…)ã€Observer(è§‚å¯Ÿè€…)ã€subscribe().äº‹ä»¶ç”±Observable(è¢«è§‚å¯Ÿè€…)å¼€å§‹å‘å‡º,é€šè¿‡subscribe()æœ€ç»ˆè¢«ä¼ é€’åˆ°Observer(è§‚å¯Ÿè€…).è€Œæ•´ä¸ªè¿‡ç¨‹ä¸­ä½ æ˜¯ç«™åœ¨Observer(è§‚å¯Ÿè€…)çš„ä½ç½®,ä¹Ÿå°±æ˜¯äº‹ä»¶çš„æœ«å°¾,è§‚å¯ŸObservable(è¢«è§‚å¯Ÿè€…).</li>
<li><p>ä¸Šå›¾</p>
</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123;</div><div class="line">              emitter.onNext(1);</div><div class="line">              emitter.onComplete();</div><div class="line">          &#125;</div><div class="line">      &#125;).subscribe(new Observer&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void onSubscribe(Disposable d) &#123;</div><div class="line">              Log.d(TAG, &quot;subscribe&quot;);</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onNext(Integer value) &#123;</div><div class="line">              Log.d(TAG, &quot;&quot; + value);</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onError(Throwable e) &#123;</div><div class="line">              Log.d(TAG, &quot;error&quot;);</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onComplete() &#123;</div><div class="line">              Log.d(TAG, &quot;complete&quot;);</div><div class="line">          &#125;</div><div class="line">      &#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>äº‹ä»¶ç”±<code>emitter.onNext(1);</code>å¼€å§‹,æœ€ç»ˆè¢«<code>public void onNext(Integer value)</code>ç›¸åº”.è¢«è§‚å¯Ÿè€…äº‹ä»¶å‘é€ç»“æŸè°ƒç”¨<code>emitter.onComplete();</code>,åŒæ—¶è§‚å¯Ÿè€…æœ€ç»ˆä»¥<code>public void onComplete()</code>ç›¸åº”.</p>
</li>
</ul>
<hr>
<h2 id="note-ä¸Šä¸‹æ¸¸ä»¥-subscribeå»ºç«‹è¿æ¥å-äº‹ä»¶æ‰ä¼šå¼€å§‹å‘é€"><a href="#note-ä¸Šä¸‹æ¸¸ä»¥-subscribeå»ºç«‹è¿æ¥å-äº‹ä»¶æ‰ä¼šå¼€å§‹å‘é€" class="headerlink" title="* note: ä¸Šä¸‹æ¸¸ä»¥.subscribeå»ºç«‹è¿æ¥å,äº‹ä»¶æ‰ä¼šå¼€å§‹å‘é€."></a>* note: ä¸Šä¸‹æ¸¸ä»¥<code>.subscribe</code>å»ºç«‹è¿æ¥å,äº‹ä»¶æ‰ä¼šå¼€å§‹å‘é€.</h2><h3 id="Observable-è¢«è§‚å¯Ÿè€…-Observer-è§‚å¯Ÿè€…"><a href="#Observable-è¢«è§‚å¯Ÿè€…-Observer-è§‚å¯Ÿè€…" class="headerlink" title="Observable(è¢«è§‚å¯Ÿè€…) Observer(è§‚å¯Ÿè€…)"></a>Observable(è¢«è§‚å¯Ÿè€…) Observer(è§‚å¯Ÿè€…)</h3><ul>
<li>ObservableEmitter<br>ObservableEmitterï¼š Emitteræ„ä¸ºå‘å°„å™¨,äº‹ä»¶å‘é€.onNext(T value)ã€onComplete()å’ŒonError(Throwable error)åˆ†åˆ«å¯¹åº”nextäº‹ä»¶ã€completeäº‹ä»¶å’Œerroräº‹ä»¶ã€‚</li>
<li>Observer<integer>ä¸­onNext(Integer value)ã€onError(Throwable e)ã€onComplete()å¯¹åº”æ¥å—nextäº‹ä»¶ã€completeäº‹ä»¶å’Œerroräº‹ä»¶</integer></li>
<li>è¢«è§‚å¯Ÿè€…å‘é€completeäº‹ä»¶å’Œerroräº‹ä»¶å,è§‚å¯Ÿè€…æ¥å—åä¸å†ç»§ç»­å“åº”äº‹ä»¶,å³ä½¿è¢«è§‚å¯Ÿè€…è¿˜åœ¨å‘é€äº‹ä»¶.<strong>completeäº‹ä»¶å’Œerroräº‹ä»¶äº’æ–¥.</strong></li>
<li>åœ¨Observer<integer>ä¸­,è°ƒç”¨Disposable.dispose(),åˆ‡æ–­ç®¡é“.è¢«è§‚å¯Ÿè€…ç»§ç»­å‘é€,ä½†è§‚å¯Ÿè€…ä¸å†å“åº”.</integer></li>
</ul>
<h3 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h3><ul>
<li>å»ºç«‹Observable(è¢«è§‚å¯Ÿè€…) Observer(è§‚å¯Ÿè€…)ä¹‹é—´çš„ç®¡é“.æœ‰å¤šä¸ªé‡è½½.</li>
<li><p>é‡è½½</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public final Disposable subscribe() &#123;&#125;</div><div class="line"></div><div class="line">public final Disposable subscribe(Consumer&lt;? super T&gt; onNext) &#123;&#125;</div><div class="line"></div><div class="line">public final Disposable subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError) &#123;&#125; </div><div class="line"></div><div class="line">public final Disposable subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError, Action onComplete) &#123;&#125;</div><div class="line"></div><div class="line">public final Disposable subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError, Action onComplete, Consumer&lt;? super Disposable&gt; onSubscribe) &#123;&#125;</div><div class="line"></div><div class="line">public final void subscribe(Observer&lt;? super T&gt; observer) &#123;&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>é‡è½½è¯´æ˜</p>
<ul>
<li>ä¸å¸¦å‚æ•° : è§‚å¯Ÿè€…ä¸å…³å¿ƒä»»ä½•äº‹ä»¶(æœ‰åµç”¨ğŸ˜µ)</li>
<li>åªå¸¦onNext : è§‚å¯Ÿè€…åªå“åº”nextäº‹ä»¶.</li>
<li>å…¶ä»–ç±»ä¼¼â€¦.æ¼”ç»æ¨ç†â€¦.</li>
<li>æœ€åä¸€ä¸ªæ˜¯ä¼ å…¥å®Œæ•´çš„Observerå¯¹è±¡.(demoå°±æ˜¯ğŸ™ƒ)</li>
</ul>
</li>
</ul>
<h2 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h2><ul>
<li>åŸºäºRxjavaçš„è§‚å¯Ÿè€…æ¨¡å¼å¯ä»¥æ‹†åˆ†å¤§å¤šæ•°çš„ä¸šåŠ¡é€»è¾‘,å³ä½¿å†å¢åŠ å¾ˆå¤šåŠŸèƒ½æ•´ä½“ä¹Ÿä¸ä¼šè¿‡äºæ··ä¹±.</li>
<li>ä½†Rxjavaçš„å¼ºå¤§å¹¶ä¸å±€é™åœ¨æ‹†åˆ†é€»è¾‘.ç”±è¢«è§‚å¯Ÿè€…åˆ°è§‚å¯Ÿè€…çš„æ•´ä¸ªäº‹ä»¶ä¼ é€’è¿‡ç¨‹,åŸºäºRxjavaæˆ‘ä»¬å¯ä»¥<strong>ä»»æ„æ‹†åˆ† åˆå¹¶ è½¬æ¢ äº‹ä»¶ã€åˆ‡æ¢çº¿ç¨‹ç­‰.</strong></li>
</ul>
<hr>
<h2 id="note-æ“ä½œç¬¦æ­é…-Lambda-è¡¨è¾¾å¼é£Ÿç”¨æ›´ä½³-ğŸ¤£"><a href="#note-æ“ä½œç¬¦æ­é…-Lambda-è¡¨è¾¾å¼é£Ÿç”¨æ›´ä½³-ğŸ¤£" class="headerlink" title="* note: æ“ä½œç¬¦æ­é… Lambda è¡¨è¾¾å¼é£Ÿç”¨æ›´ä½³ ğŸ¤£"></a>* note: æ“ä½œç¬¦æ­é… Lambda è¡¨è¾¾å¼é£Ÿç”¨æ›´ä½³ ğŸ¤£</h2><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><ul>
<li>äº§ç”Ÿå¹¶å‘é€ Obserable äº‹ä»¶.</li>
<li>ä»…å¸¸ç”¨,è¯¦ç»†åœ¨<a href="https://maxwell-nc.github.io/android/rxjava2-2.html#timer" target="_blank" rel="external"> RxJava 2.x ä½¿ç”¨è¯¦è§£(äºŒ) åˆ›å»ºæ“ä½œç¬¦</a> <h4 id="creat"><a href="#creat" class="headerlink" title=".creat"></a>.creat</h4></li>
<li>å‰é¢demoä¸­å·²ç»å®é™…ä½¿ç”¨è¿‡äº†</li>
<li>ç”¨äºäº§ç”Ÿä¸€ä¸ª Obserable è¢«è§‚å¯Ÿè€…å¯¹è±¡,demoå¦‚ä¸Šæ‰€ç¤º.</li>
</ul>
<h4 id="just"><a href="#just" class="headerlink" title=".just"></a>.just</h4><ul>
<li>å¯¹äºç®€å•çš„å‡ ä¸ªæ•°æ®,ç›´æ¥ä½¿ç”¨justå‘é€å³å¯,æ— éœ€åˆ›å»º Obserable å¯¹è±¡.justæœ€å¤šå¯ä»¥æ¥æ”¶ <strong>10</strong> ä¸ªå‚æ•°.</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Observable.just(&quot;test&quot;,&quot;test2&quot;)</div><div class="line">      .subscribe(str -&gt; Log.i(&quot;tag&quot;, str));</div></pre></td></tr></table></figure>
<p>ç›¸å½“äºé¡ºåºè°ƒç”¨onNext(â€œtestâ€)å’ŒonNext(â€œtest2â€)ï¼Œæœ€åè°ƒç”¨onCompleteæ–¹æ³•ã€‚</p>
</li>
</ul>
<h4 id="fromArray"><a href="#fromArray" class="headerlink" title=".fromArray"></a>.fromArray</h4><ul>
<li>åŠŸèƒ½ä¸justç±»ä¼¼ä½†fromArrayæ¥æ¥æ”¶ä»»æ„é•¿åº¦çš„æ•°æ®æ•°ç»„,ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥æ•°ç»„<code>fromArray(new int[]{1, 2, 3})</code></li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Observable.fromArray(1, 2, 3, 4, 5)</div><div class="line">      .subscribe(integer -&gt; Log.i(&quot;tag&quot;, String.valueOf(integer)));</div></pre></td></tr></table></figure>
<p>fromArrayä¸æ”¯æŒç›´æ¥ä¼ å…¥listè¿›ï¼Œlistä¼šè¢«å½“ä½œä¸€ä¸ªæ•´ä½“å‘é€.</p>
</li>
</ul>
<h4 id="fromIterable"><a href="#fromIterable" class="headerlink" title=".fromIterable"></a>.fromIterable</h4><ul>
<li>åŠŸèƒ½ä¸fromArrayç±»ä¼¼,ä½†æ˜¯å¯ä»¥æ¥æ”¶ list ç±»å‹,éå†å¯è¿­ä»£æ•°æ®é›†åˆ.</li>
<li>demo<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line">list.add(&quot;a&quot;);</div><div class="line">list.add(&quot;b&quot;);</div><div class="line">list.add(&quot;c&quot;);</div><div class="line"></div><div class="line">Flowable.fromIterable(list).subscribe(</div><div class="line">      s -&gt; Log.i(&quot;tag&quot;, s)</div><div class="line">);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="timer"><a href="#timer" class="headerlink" title=".timer"></a>.timer</h4><ul>
<li>æŒ‡å®šä¸€æ®µæ—¶é—´é—´éš”åå‘é€æ•°æ®(ä¸€æ¬¡æ€§),ä¸å¤ªå¸¸ç”¨.</li>
</ul>
<h3 id="çº¿ç¨‹åˆ‡æ¢"><a href="#çº¿ç¨‹åˆ‡æ¢" class="headerlink" title="çº¿ç¨‹åˆ‡æ¢"></a>çº¿ç¨‹åˆ‡æ¢</h3><ul>
<li>é»˜è®¤äº‹ä»¶ä¼ é€’çš„åŒæ–¹åœ¨åŒä¸€çº¿ç¨‹å·¥ä½œ.</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">observable.subscribeOn(Schedulers.newThread())     </div><div class="line">       .subscribeOn(Schedulers.io())              </div><div class="line">       .observeOn(AndroidSchedulers.mainThread()) </div><div class="line">       .observeOn(Schedulers.io())                </div><div class="line">       .subscribe(consumer);</div></pre></td></tr></table></figure>
</li>
<li><p>æ–¹æ³•:</p>
<ul>
<li>.subscribeOn() : æŒ‡å®šè¢«è§‚å¯Ÿè€…å‘é€äº‹ä»¶çº¿ç¨‹,<strong>ä»…ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æœ‰æ•ˆ!</strong>  </li>
<li>.observeOn() : æŒ‡å®šè§‚å¯Ÿè€…/æµå˜æ¢(å¯¹å‘é€çš„äº‹ä»¶å¤„ç†ğŸ––)çº¿ç¨‹,<strong>å¤šæ¬¡è°ƒç”¨,å¤šæ¬¡åˆ‡æ¢æœ‰æ•ˆ</strong></li>
</ul>
</li>
<li><p>å‚æ•°:</p>
<ul>
<li>Schedulers.io() : é€‚ç”¨äºioå¯†é›†å‹æ“ä½œ,ç½‘ç»œé€šä¿¡ã€ç£ç›˜æ“ä½œç­‰.</li>
<li>Schedulers.computation() : CPUå¯†é›†æ“ä½œ,éœ€è¦å¤§é‡CPUè®¡ç®—çš„æ“ä½œ.</li>
<li>Schedulers.newThread() : åˆ›å»ºæ–°çº¿ç¨‹.</li>
<li>AndroidSchedulers.mainThread() : Androidä¸»çº¿ç¨‹,é€šå¸¸ä¸ºæ›´æ–°UIç­‰.</li>
</ul>
</li>
</ul>
<h3 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤"></a>è¿‡æ»¤</h3><ul>
<li>å¯¹ Obserable äº‹ä»¶ç­›é€‰.</li>
<li>ä»…å¸¸ç”¨,è¯¦ç»†åœ¨<a href="https://maxwell-nc.github.io/android/rxjava2-3.html#filter" target="_blank" rel="external">RxJava 2.x ä½¿ç”¨è¯¦è§£(ä¸‰) è¿‡æ»¤æ“ä½œç¬¦</a></li>
</ul>
<h4 id="filter"><a href="#filter" class="headerlink" title=".filter"></a>.filter</h4><ul>
<li>åŸºæœ¬è¿‡æ»¤æ“ä½œç¬¦,æŒ‰ç…§ä»»æ„è‡ªå®šè§„åˆ™è¿‡æ»¤.</li>
</ul>
<h3 id="ç»„åˆ"><a href="#ç»„åˆ" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h3><h3 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h3><h4 id="map"><a href="#map" class="headerlink" title=".map"></a>.map</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯”<strong>1:1</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>ä¸å˜</strong></li>
<li>mapä½œç”¨æ˜¯å¯¹Observableå‘é€çš„æ¯ä¸€ä¸ªäº‹ä»¶,åº”ç”¨å¤„ç†å˜æ¢å‡½æ•°,å†ç»§ç»­åƒä¸‹æ¸¸å‘é€.ä¸­é—´è¿‡ç¨‹å¯ä»¥è½¬æ¢äº‹ä»¶ç±»å‹ã€æ”¹å˜äº‹ä»¶å†…å®¹ç­‰ç­‰.<strong>åªéœ€è¦å˜æ¢åçš„äº‹ä»¶ç±»å‹ä¸ä¸‹æ¸¸æ¥æ”¶çš„ç±»å‹åŒ¹é…å³å¯.</strong></li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123;</div><div class="line">              emitter.onNext(1);</div><div class="line">              emitter.onNext(2);</div><div class="line">              emitter.onNext(3);</div><div class="line">          &#125;</div><div class="line">      &#125;).map(new Function&lt;Integer, String&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public String apply(Integer integer) throws Exception &#123;</div><div class="line">              return &quot;This is result &quot; + integer;</div><div class="line">          &#125;</div><div class="line">      &#125;).subscribe(new Consumer&lt;String&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void accept(String s) throws Exception &#123;</div><div class="line">              Log.d(TAG, s);</div><div class="line">          &#125;</div><div class="line">      &#125;);</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯æŠŠintç±»å‹è½¬æ¢ä¸ºäº†stringç±»å‹,ä¸è§‚å¯Ÿè€…æ¥æ”¶çš„ç±»å‹åŒ¹é…å³å¯.</p>
</li>
</ul>
<h4 id="flatMap"><a href="#flatMap" class="headerlink" title=".flatMap"></a>.flatMap</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯” <strong>1:n</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>ä¸ä¿è¯</strong></li>
<li>flatMap,é€šä¿—ç‚¹å°±æ˜¯æŠŠObservableå‘é€çš„äº‹ä»¶æ‹†æ•£å˜æ¢å†,ç»§ç»­åƒä¸‹æ¸¸å‘é€.1ä¸ªObservableäº‹ä»¶å¯æ‹†æˆä»»æ„ä¸ª.<strong>åªéœ€è¦å˜æ¢åçš„äº‹ä»¶ç±»å‹ä¸ä¸‹æ¸¸æ¥æ”¶çš„ç±»å‹åŒ¹é…å³å¯.</strong></li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123;</div><div class="line">              emitter.onNext(1);</div><div class="line">              emitter.onNext(2);</div><div class="line">              emitter.onNext(3);</div><div class="line">          &#125;</div><div class="line">      &#125;).flatMap(new Function&lt;Integer, ObservableSource&lt;String&gt;&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public ObservableSource&lt;String&gt; apply(Integer integer) throws Exception &#123;</div><div class="line">              final List&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line">              for (int i = 0; i &lt; 3; i++) &#123;</div><div class="line">                  list.add(&quot;I am value &quot; + integer);</div><div class="line">              &#125;</div><div class="line">              return Observable.fromIterable(list).delay(10,TimeUnit.MILLISECONDS);</div><div class="line">          &#125;</div><div class="line">      &#125;).subscribe(new Consumer&lt;String&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void accept(String s) throws Exception &#123;</div><div class="line">              Log.d(TAG, s);</div><div class="line">          &#125;</div><div class="line">      &#125;);</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯flatMapæŠŠä¸€ä¸ªintç±»å‹äº‹ä»¶æ‹†æˆäº†3ä¸ªStringç±»å‹,è¿è¡Œç»“æœçœ‹,æœ€ç»ˆäº‹ä»¶åˆ°è¾¾é¡ºåºä¸onNext(1);onNext(2);çš„å‘é€é¡ºåºæ— å…³</p>
</li>
</ul>
<h4 id="concatMap"><a href="#concatMap" class="headerlink" title=".concatMap"></a>.concatMap</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯” <strong>1:n</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>æŒ‰é¡ºåº</strong></li>
<li>ä¸flatMapä½œç”¨ç›¸åŒ,åªæ˜¯ä¿è¯äº†äº‹ä»¶ä¸¥æ ¼æŒ‰é¡ºåºè¾¾åˆ°ä¸‹æ¸¸.</li>
<li>demo å°±ä¸ä¸Šäº†,ç›´æ¥æ›¿æ¢flatMapçš„ä½ç½®å°±å¥½.</li>
</ul>
<h4 id="zip"><a href="#zip" class="headerlink" title=".zip"></a>.zip</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯” <strong>n:1</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>ä¸¥æ ¼æŒ‰é¡ºåº</strong></li>
<li>zip.æœ€å¸¸è§çš„å‹ç¼©æ–‡ä»¶æ ¼å¼,åœ¨è¿™é‡Œä¹Ÿæ˜¯ç±»ä¼¼çš„æ„æ€,zipå¯ä»¥ä¸¥æ ¼æŒ‰ç…§é¡ºåºåˆå¹¶å¤šä¸ª <strong>ä¸åŒç±»å‹</strong> Observableå‘é€çš„äº‹ä»¶.æ€»çš„å‘é€äº‹ä»¶æ•°é‡ä¸ä¸Šæ¸¸Observableå‘é€æœ€å°‘çš„é‚£ä¸ªæ•°é‡ç›¸åŒ.</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">Observable&lt;Integer&gt; observable1 = Observable.create(new ObservableOnSubscribe&lt;Integer&gt;() &#123;         </div><div class="line">  @Override                                                                                      </div><div class="line">  public void subscribe(ObservableEmitter&lt;Integer&gt; emitter) throws Exception &#123;                   </div><div class="line">      Log.d(TAG, &quot;emit 1&quot;);                                                                      </div><div class="line">      emitter.onNext(1);                                                                         </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit 2&quot;);                                                                      </div><div class="line">      emitter.onNext(2);                                                                         </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit 3&quot;);                                                                      </div><div class="line">      emitter.onNext(3);                                                                         </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit 4&quot;);                                                                      </div><div class="line">      emitter.onNext(4);                                                                         </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit complete1&quot;);                                                              </div><div class="line">      emitter.onComplete();                                                                      </div><div class="line">  &#125;                                                                                              </div><div class="line">&#125;).subscribeOn(Schedulers.io());                                                                   </div><div class="line"></div><div class="line">Observable&lt;String&gt; observable2 = Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;           </div><div class="line">  @Override                                                 public void subscribe(ObservableEmitter&lt;String&gt; emitter) throws Exception &#123;                    </div><div class="line">      Log.d(TAG, &quot;emit A&quot;);                                                                  </div><div class="line">      emitter.onNext(&quot;A&quot;);                                                                       </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit B&quot;);                                                                      </div><div class="line">      emitter.onNext(&quot;B&quot;);                                                                       </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit C&quot;);                                                                      </div><div class="line">      emitter.onNext(&quot;C&quot;);                                                                       </div><div class="line">      Thread.sleep(1000);                                                                        </div><div class="line"></div><div class="line">      Log.d(TAG, &quot;emit complete2&quot;);                                                              </div><div class="line">      emitter.onComplete();                                                                      </div><div class="line">  &#125;                                                                                              </div><div class="line">&#125;).subscribeOn(Schedulers.io());                                                                   </div><div class="line"></div><div class="line">Observable.zip(observable1, observable2, new BiFunction&lt;Integer, String, String&gt;() &#123;               </div><div class="line">  @Override                                                                                      </div><div class="line">  public String apply(Integer integer, String s) throws Exception &#123;                              </div><div class="line">      return integer + s;                                                                        </div><div class="line">  &#125;                                                                                              </div><div class="line">&#125;).subscribe(new Observer&lt;String&gt;() &#123;                    </div><div class="line">  @Override                                                                                      </div><div class="line">  public void onSubscribe(Disposable d) &#123;                                                        </div><div class="line">      Log.d(TAG, &quot;onSubscribe&quot;);                                                                 </div><div class="line">  &#125;                                                                                              </div><div class="line"></div><div class="line">  @Override                                                                                      </div><div class="line">  public void onNext(String value) &#123;                                                             </div><div class="line">      Log.d(TAG, &quot;onNext: &quot; + value);                                                            </div><div class="line">  &#125;                                                                                              </div><div class="line"></div><div class="line">  @Override                                                                                      </div><div class="line">  public void onError(Throwable e) &#123;                                                             </div><div class="line">      Log.d(TAG, &quot;onError&quot;);                                                                     </div><div class="line">  &#125;                                                                                              </div><div class="line"></div><div class="line">  @Override                                                                                      </div><div class="line">  public void onComplete() &#123;                                                                     </div><div class="line">      Log.d(TAG, &quot;onComplete&quot;);                                                                  </div><div class="line">  &#125;                                                                                              </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸¤ä¸ªäº‹ä»¶å‘é€åœ¨åŒä¸€çº¿ç¨‹ä¸­.å½“ä¸¤ä¸ªäº‹ä»¶å‘é€ä¸å†åŒä¸€çº¿ç¨‹æ—¶,æƒ…å†µç±»ä¼¼,ä¸è¿‡å½“å¼‚æ­¥æ—¶,æ•°é‡è¾ƒå°‘çš„äº‹ä»¶å‘é€å®Œæˆ,å‘é€Completeäº‹ä»¶å,é€šé“éšå³è¢«åˆ‡æ–­.</p>
</li>
</ul>
<h4 id="Concat"><a href="#Concat" class="headerlink" title=".Concat"></a>.Concat</h4><ul>
<li>å¤„ç†å‰åäº‹ä»¶æ•°é‡ä¹‹æ¯” <strong>n:1</strong>,äº‹ä»¶å˜æ¢å‰åé¡ºåº<strong>ä¸¥æ ¼æŒ‰é¡ºåº</strong></li>
<li>Concat,å¯ä»¥ä¸¥æ ¼æŒ‰ç…§é¡ºåºåˆå¹¶ <strong>ç›¸åŒç±»å‹</strong> Observableå‘é€çš„äº‹ä»¶.</li>
</ul>
<h2 id="Backpressure"><a href="#Backpressure" class="headerlink" title="Backpressure"></a>Backpressure</h2><hr>
<h2 id="è¢«ç¿»è¯‘ä¸ºèƒŒå‹â€¦-å¦‚æ­¤æ–‡ä¸è¾¾æ„çš„ç›´è¯‘-èƒ½å¿-å¾€ä¸‹éƒ½æ˜¯å› ä¸ºåŸæ–‡-ğŸ˜ˆ"><a href="#è¢«ç¿»è¯‘ä¸ºèƒŒå‹â€¦-å¦‚æ­¤æ–‡ä¸è¾¾æ„çš„ç›´è¯‘-èƒ½å¿-å¾€ä¸‹éƒ½æ˜¯å› ä¸ºåŸæ–‡-ğŸ˜ˆ" class="headerlink" title="* è¢«ç¿»è¯‘ä¸ºèƒŒå‹â€¦(å¦‚æ­¤æ–‡ä¸è¾¾æ„çš„ç›´è¯‘,èƒ½å¿?å¾€ä¸‹éƒ½æ˜¯å› ä¸ºåŸæ–‡..ğŸ˜ˆ)"></a>* è¢«ç¿»è¯‘ä¸ºèƒŒå‹â€¦(å¦‚æ­¤æ–‡ä¸è¾¾æ„çš„ç›´è¯‘,èƒ½å¿?å¾€ä¸‹éƒ½æ˜¯å› ä¸ºåŸæ–‡..ğŸ˜ˆ)</h2><ul>
<li>å…¶å®æ¦‚å¿µæœ‰å¤Ÿç®€å•:å°†æ•´ä¸ªäº‹ä»¶äº§ç”Ÿ/ä¼ é€’/å¤„ç†çš„è¿‡ç¨‹æƒ³è±¡ä¸ºä¸€æ¡æ²³æµç”±ä¸Šè€Œä¸‹, Backpressure æŒ‡çš„æ˜¯ä¸Šæ¸¸äº§ç”Ÿçš„äº‹ä»¶å¤ªå¿«,è¿œè¿œè¶…è¿‡äº†ä¸‹æ¸¸çš„å¤„ç†é€Ÿåº¦,ä»¥è‡³äºç¼“å†²åŒºæº¢å‡º.ä¸Šæ¸¸æ¥äº†æ´ªæ°´,ä¸‹æ¸¸å¾„æµé‡ä¸å¤Ÿ,ä»¥è‡³äºä¸­é—´æ²³é“è·¨è¿‡äº†å ¤å²¸,æº¢å‡º.</li>
</ul>
<h3 id="FlowableåŸºç¡€"><a href="#FlowableåŸºç¡€" class="headerlink" title="FlowableåŸºç¡€"></a>FlowableåŸºç¡€</h3><ul>
<li><p>Rxjava 1.xä¸­éœ€è¦è‡ªè¡Œé€šè¿‡æ“ä½œç¬¦å¤„ç†,åˆ°äº†2.0ä¸­,åˆ™æœ‰äº†ä¸“é—¨å¯¹ä»˜å‘æ´ªæ°´ä¸Šæ¸¸çš„è¢«è§‚å¯Ÿè€…- Flowable .æˆ‘ä»¬å¸¸ç”¨çš„ observable åœ¨2.xä¸­ä¸€èˆ¬ç”¨äºä¸æ¶‰åŠ Backpressure çš„æƒ…å†µ.è€Œå¯¹åº”ä¸ observable çš„ Observer ,æ”¹ä¸ºäº†  Subscriber .</p>
</li>
<li><p>demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">Flowable&lt;Integer&gt; upstream = Flowable.create(new FlowableOnSubscribe&lt;Integer&gt;() &#123;</div><div class="line">          @Override</div><div class="line">          public void subscribe(FlowableEmitter&lt;Integer&gt; emitter) throws Exception &#123;</div><div class="line">              Log.d(TAG, &quot;emit 1&quot;);</div><div class="line">              emitter.onNext(1);</div><div class="line">              Log.d(TAG, &quot;emit 2&quot;);</div><div class="line">              emitter.onNext(2);</div><div class="line">              Log.d(TAG, &quot;emit 3&quot;);</div><div class="line">              emitter.onNext(3);</div><div class="line">              Log.d(TAG, &quot;emit complete&quot;);</div><div class="line">              emitter.onComplete();</div><div class="line">          &#125;</div><div class="line">      &#125;, BackpressureStrategy.ERROR); //å¢åŠ äº†ä¸€ä¸ªå‚æ•°</div><div class="line"></div><div class="line">      Subscriber&lt;Integer&gt; downstream = new Subscriber&lt;Integer&gt;() &#123;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onSubscribe(Subscription s) &#123;</div><div class="line">              Log.d(TAG, &quot;onSubscribe&quot;);</div><div class="line">              s.request(Long.MAX_VALUE);  //æ³¨æ„è¿™å¥ä»£ç </div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onNext(Integer integer) &#123;</div><div class="line">              Log.d(TAG, &quot;onNext: &quot; + integer);</div><div class="line"></div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onError(Throwable t) &#123;</div><div class="line">               Log.w(TAG, &quot;onError: &quot;, t);</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          @Override</div><div class="line">          public void onComplete() &#123;</div><div class="line">              Log.d(TAG, &quot;onComplete&quot;);</div><div class="line">          &#125;</div><div class="line">      &#125;;</div><div class="line"></div><div class="line">      upstream.subscribe(downstream);</div></pre></td></tr></table></figure>
</li>
<li><p>æ³¨æ„ä¸¤ä¸ªåœ°æ–¹</p>
<ul>
<li>Flowableåˆ›å»ºæ—¶æ¯” observable å¤šäº†ä¸€ä¸ªå‚æ•°.(å‚æ•°ä½œç”¨ä¸‹èŠ‚è¯´æ˜)</li>
<li>Subscriberä¸­è°ƒç”¨äº† s.request .</li>
</ul>
</li>
<li><p>Flowable ä¸ Observable æœ€å¤§çš„ä¸åŒå°±æ˜¯ Flowableå†æ¬¡å‘é€äº‹ä»¶éœ€è¦ç­‰å¾… Subscriber ä¸­è°ƒç”¨ .request </p>
</li>
<li><p>.request() å®è´¨ä¸Šæ˜¯ä¸‹æ¸¸å‘ŠçŸ¥ä¸Šæ¸¸è‡ªå·±çš„å¤„ç†èƒ½åŠ›,ä½¿å¾—ä¸Šæ¸¸æ ¹æ®ä¸‹æ¸¸å¤„ç†èƒ½åŠ›å‘é€äº‹ä»¶.<strong>å¤šæ¬¡è°ƒç”¨,ä¸Šæ¸¸è¡¨ç¤ºå¤„ç†èƒ½åŠ›çš„æ•°å­—ä¼šå åŠ </strong>,ä¸Šæ¸¸æ¯å‘é€ä¸€ä¸ªäº‹ä»¶,è¯¥æ•°å­—å‡ä¸€,åˆ°0æŠ›å‡ºå¼‚å¸¸</p>
<ul>
<li>ä¸Šä¸‹æ¸¸åœ¨åŒä¸€çº¿ç¨‹æ—¶,ä¸‹æ¸¸æ²¡æœ‰æˆ–æ²¡æœ‰åŠæ—¶è°ƒç”¨ .request ,ä¸Šæ¸¸ä¼šæŠ›å‡ºå¼‚å¸¸</li>
<li>å¼‚æ­¥çº¿ç¨‹æ—¶,ä¸‹æ¸¸å³ä½¿æ²¡æœ‰è°ƒç”¨ .request ä¼šæœ‰128ä¸ªäº‹ä»¶çš„ç¼“å­˜åŒº.ä¸Šæ¸¸å¯ç»§ç»­å‘å‡ºäº‹ä»¶,ç¼“å­˜åŒºè¶…å‡º128ä¸ªäº‹ä»¶å,æŠ›å‡ºå¼‚å¸¸.</li>
</ul>
</li>
</ul>
<h3 id="Flowableæ‹“å±•"><a href="#Flowableæ‹“å±•" class="headerlink" title="Flowableæ‹“å±•"></a>Flowableæ‹“å±•</h3><h2 id="è¿™é‡Œå¯¹-Flowable-å¤šçš„å‚æ•°è¿›è¡Œè¯´æ˜"><a href="#è¿™é‡Œå¯¹-Flowable-å¤šçš„å‚æ•°è¿›è¡Œè¯´æ˜" class="headerlink" title="* è¿™é‡Œå¯¹ Flowable å¤šçš„å‚æ•°è¿›è¡Œè¯´æ˜."></a>* è¿™é‡Œå¯¹ Flowable å¤šçš„å‚æ•°è¿›è¡Œè¯´æ˜.</h2><ul>
<li>å‚æ•°<ul>
<li>BackpressureStrategy.BUFFER : é»˜è®¤ç¼“å­˜åŒº128,è¿™ä¸ªå‚æ•°æå¤§æ‹“å±•äº†ç¼“å­˜åŒº,ä½¿å¾— Flowable è¡¨ç°ä¸ Observable å·®ä¸å¤š.</li>
<li>BackpressureStrategy.DROP : 128ç¼“å­˜åŒºæ»¡äº†,å°±ä¸¢å¼ƒä¸Šæ¸¸äº‹ä»¶,ç›´åˆ°ä¸‹æ¸¸å¤„ç†äº†ä¸€ä¸ªäº‹ä»¶,ç¼“å­˜åŒº -1 ,å†å…è®¸å­˜å…¥æ–°çš„ä¸Šæ¸¸äº‹ä»¶.</li>
<li>BackpressureStrategy.LATEST : æ°¸è¿œä¿å­˜æœ€åè¾¾åˆ°çš„128ä¸ªä¸Šæ¸¸äº‹ä»¶,ä¸Šæ¸¸æœ‰æ–°çš„äº‹ä»¶åˆ°è¾¾æ»¡è½½çš„ç¼“å­˜åŒºæ—¶,ä¸¢å¼ƒç¬¬ä¸€ä¸ªå­˜å…¥ç¼“å­˜åŒºçš„ä¸Šæ¸¸äº‹ä»¶.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p>å¯¹äºä¸æ˜¯ç”±æˆ‘ä»¬ç¼–å†™çš„ Flowable ä¹Ÿå¯ä»¥é€šè¿‡ interval æ“ä½œç¬¦æ¥åŠ å·¥.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Flowable.interval(1, TimeUnit.MICROSECONDS)</div><div class="line">              .onBackpressureDrop()  //åŠ ä¸Š Backpressure ç­–ç•¥</div></pre></td></tr></table></figure>
</li>
<li><p>å¯¹åº”ä¸Šæ–‡,æŒ‡å®šå‚æ•°æœ‰3,æ„æ€åŒä¸Š.</p>
<ul>
<li>onBackpressureBuffer()</li>
<li>onBackpressureDrop()</li>
<li>onBackpressureLatest()</li>
</ul>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;èµ„æ–™æ¥æºå¦‚ä¸‹&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/u/c50b715ccaeb&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ç»™åˆå­¦è€…çš„RxJava2.0æ•™ç¨‹&lt;/a&gt;(demoä»£ç æ¥æº)&lt;/p&gt;
&lt;blockqu
    
    </summary>
    
      <category term="Androidç¬”è®°" scheme="http://yoursite.com/categories/Android%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Androidéšæ‰‹è®°â€”GlideåŠ è½½Drawableå¯¹è±¡</title>
    <link href="http://yoursite.com/2017/11/04/Android%E9%9A%8F%E6%89%8B%E8%AE%B0-Glide%E5%8A%A0%E8%BD%BDDrawable%E5%AF%B9%E8%B1%A1/"/>
    <id>http://yoursite.com/2017/11/04/Androidéšæ‰‹è®°-GlideåŠ è½½Drawableå¯¹è±¡/</id>
    <published>2017-11-04T04:00:00.000Z</published>
    <updated>2017-11-04T13:59:36.565Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 3.0</li>
</ul>
<hr>
<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul>
<li><p>Glideæ˜¯ä¸€ä¸ªé€šç”¨çš„å›¾ç‰‡ç¼“å­˜æ¡†æ¶,ä½†æ˜¯åœ¨MyPrivacyæ˜¾ç¤ºappIconæ—¶,ä¼ å…¥ ä¸€ä¸ªDrawableå¯¹è±¡,æç¤ºç±»å‹ä¸åŒ¹é…. </p>
</li>
<li><p>(æ³¨æ„: è¿™é‡Œæ˜¯ç›´æ¥ä¼ å…¥Drawableå¯¹è±¡,ä¸æ˜¯ç»è¿‡ R.xx å¼•ç”¨ !)</p>
</li>
</ul>
<h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><ul>
<li>æŸ¥é˜…èµ„æ–™å,ç¡®è®¤Glideä¸æ”¯æŒç›´æ¥åŠ è½½ä¼ å…¥çš„Drawableå¯¹è±¡,è½¬æ¢ä¸ºbitDrawableç±»å‹ä¹Ÿä¸å¯.</li>
<li><p>è§£å†³æ€è·¯æ¥è‡ª</p>
<blockquote>
<p><a href="https://github.com/bumptech/glide/issues/588" target="_blank" rel="external">https://github.com/bumptech/glide/issues/588</a></p>
</blockquote>
</li>
<li><p>ä¸æ”¯æŒç›´æ¥åŠ è½½,ä½†Glideçš„.error(Icon)é”™è¯¯æ—¶æ˜¾ç¤º   .placeholder(Icon)å ä½ç¬¦,æ”¯æŒDrawableå¯¹è±¡</p>
</li>
</ul>
<h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><ul>
<li>ä¸å†ç›´æ¥åŠ è½½ .load ä¼ å…¥ç©ºå­—ç¬¦ä¸², é€šè¿‡ .placeholder ç®€æ´åŠ è½½.</li>
<li>demo <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Drawable Iconã€€ï¼ã€€ï½˜ï½˜ï½˜ï¼›</div><div class="line"></div><div class="line">RequestOptions options = new RequestOptions()</div><div class="line">             .error(Icon)</div><div class="line">             .placeholder(Icon);</div><div class="line"></div><div class="line"> Glide.with(context)</div><div class="line">             .load(&quot;&quot;)</div><div class="line">             .apply(options)</div><div class="line">             .into(imageView);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h3><ul>
<li>placeholder åœ¨Glide 4.xç‰ˆæœ¬ä¸­,ç§»å…¥äº† RequestOptions å¯¹è±¡ä¸­.</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;ç¼–ç¨‹ç¯å¢ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Android Studio 3.0&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;
    
    </summary>
    
      <category term="Androidéšæ‰‹è®°" scheme="http://yoursite.com/categories/Android%E9%9A%8F%E6%89%8B%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>linuxç¬”è®°â€”qemuè¿è¡Œlinux</title>
    <link href="http://yoursite.com/2017/09/10/linux%E7%AC%94%E8%AE%B0%E2%80%94qemu%E8%BF%90%E8%A1%8Clinux/"/>
    <id>http://yoursite.com/2017/09/10/linuxç¬”è®°â€”qemuè¿è¡Œlinux/</id>
    <published>2017-09-10T02:17:11.000Z</published>
    <updated>2017-09-10T01:50:57.632Z</updated>
    
    <content type="html"><![CDATA[<hr>
<ul>
<li>ubuntu16.04</li>
<li>ä½¿ç”¨busyboxç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨qemuè¿è¡Œèµ·æ¥ã€‚</li>
<li>å†…å®¹æ¥è‡ª å¥”è·‘å§linuxå†…æ ¸ç¬¬6ç« </li>
<li>è¿™é‡Œå°†è¾“å…¥ä»£ç è¿‡ç¨‹é›†åˆåˆ°äº†å‡ ä¸ª.shæ–‡ä»¶,ä¸åšé‡å¤çš„å·¥ä½œ !</li>
<li>å½“ç„¶ç½‘å¥½æ˜¯å‰æ,æœ€å¥½æŒ‚ä»£ç†.</li>
</ul>
<hr>
<h2 id="å®‰è£…å·¥å…·"><a href="#å®‰è£…å·¥å…·" class="headerlink" title="å®‰è£…å·¥å…·"></a>å®‰è£…å·¥å…·</h2><ul>
<li><p>é¦–å…ˆéœ€è¦å®‰è£…qemu gcc, ubuntu16.04ä¸­è‡ªå¸¦çš„gccç‰ˆæœ¬è¾ƒä½,è¿™é‡Œæˆ‘ä»¬å®‰è£…ä¹¦ä¸­æ¨èçš„gcc-arm-linux-gnueabi </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install qemu libncurses5-dev gcc-arm-linux-gnueabi build-essential</div></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½busyboxæºç </p>
<ul>
<li>ä¹¦ä¸­æ¨èç‰ˆæœ¬æ˜¯1.24,ä½†æœ€æ–°ç‰ˆæœ¬å·²ç»åˆ°äº†busybox-1.27.2.è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€æ–°ç‰ˆ<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://busybox.net/downloads/busybox-1.27.2.tar.bz2</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>è§£å‹åˆ° busybox æ–‡ä»¶å¤¹<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -jxvf busybox-1.27.2.tar.bz2</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>ä¸‹è½½linuxå†…æ ¸æºç <ul>
<li>è¿˜æ˜¯ä»¥é…å¥—çš„4.0æºç ä¸ºä¾‹,(æé†’:å†…æ ¸è§£å‹åå¤§çº¦å 800MB,è¯·é¢„ç•™å‡ºè¶³å¤Ÿç©ºé—´)<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://www.kernel.org/pub/linux/kernel/v4.x/linux-4.0.tar.gz</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>è§£å‹åˆ°linuxæ–‡ä»¶å¤¹<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -jxvf linux-4.0.tar.gz</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿ"><a href="#ç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿ"></a>ç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿ</h2><h2 id="åˆ«é—®æˆ‘æœ€å°æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆ-æˆ‘ä¹Ÿæœ‰ç‚¹ğŸ˜µ-ä½†æ˜¯å…ˆç”¨èµ·æ¥"><a href="#åˆ«é—®æˆ‘æœ€å°æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆ-æˆ‘ä¹Ÿæœ‰ç‚¹ğŸ˜µ-ä½†æ˜¯å…ˆç”¨èµ·æ¥" class="headerlink" title="* åˆ«é—®æˆ‘æœ€å°æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆ,æˆ‘ä¹Ÿæœ‰ç‚¹ğŸ˜µ,ä½†æ˜¯å…ˆç”¨èµ·æ¥."></a>* åˆ«é—®æˆ‘æœ€å°æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»€ä¹ˆ,æˆ‘ä¹Ÿæœ‰ç‚¹ğŸ˜µ,ä½†æ˜¯å…ˆç”¨èµ·æ¥.</h2><ul>
<li><p>é¦–å…ˆåˆ©ç”¨ busybox æ‰‹å·¥ç¼–è¯‘ä¸€ä¸ªæœ€å°æ–‡ä»¶ç³»ç»Ÿã€‚<br>åœ¨busyboxæ–‡ä»¶å¤¹ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export ARCH=ARM</div><div class="line">export CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make menuconfig</div><div class="line">make install</div></pre></td></tr></table></figure>
</li>
<li><p>è¿›å…¥menuconfigå,é…ç½®é™æ€ç¼–è¯‘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Busybox Settings ---&gt;</div><div class="line">Build Options ---&gt;</div><div class="line">[*] Build BusyBox as a static binary (no shared libs)</div></pre></td></tr></table></figure>
</li>
<li><p>ç„¶å make install ç¼–è¯‘å®Œæˆã€‚ç¼–è¯‘å®Œæˆå,æŠŠ busybox æ ¹ç›®å½•ä¸‹é¢çš„_install ç›®å½•æ‹·è´åˆ° linux-4.0 ä¸‹ã€‚</p>
</li>
<li><p>è¿›å…¥_install ç›®å½•ï¼Œåˆ›å»º etcã€dev ç­‰ç›®å½•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir etc</div><div class="line">mkdir dev</div><div class="line">mkdir mnt</div><div class="line">mkdir -p etc/init.d/</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨_install /etc/init.d/ç›®å½•ä¸‹åˆ›å»º æ–‡ä»¶årcS çš„æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mkdir â€“p /proc</div><div class="line">mkdir â€“p /tmp</div><div class="line">mkdir -p /sys</div><div class="line">mkdir â€“p /mnt</div><div class="line">/bin/mount -a</div><div class="line">mkdir -p /dev/pts</div><div class="line">mount -t devpts devpts /dev/pts</div><div class="line">echo /sbin/mdev &gt; /proc/sys/kernel/hotplug</div><div class="line">mdev â€“s</div></pre></td></tr></table></figure>
<p>åŒæ—¶ä½¿ç”¨ <code>chmod +x rcS</code>ä¿®æ”¹rcSçš„å¯æ‰§è¡Œæƒé™.</p>
</li>
<li><p>åœ¨_install /etc ç›®å½•åˆ›å»ºæ–‡ä»¶å fstab çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">proc /proc proc defaults 0 0</div><div class="line">tmpfs /tmp tmpfs defaults 0 0</div><div class="line">sysfs /sys sysfs defaults 0 0</div><div class="line">tmpfs /dev tmpfs defaults 0 0</div><div class="line">debugfs /sys/kernel/debug debugfs defaults 0 0</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨_install /etc ç›®å½•åˆ›å»ºæ–‡ä»¶å inittab çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥å¦‚ä¸‹å†…å®¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">::sysinit:/etc/init.d/rcS</div><div class="line">::respawn:-/bin/sh</div><div class="line">::askfirst:-/bin/sh</div><div class="line">::ctrlaltdel:/bin/umount -a â€“r</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨_install/dev ç›®å½•ä¸‹åˆ›å»ºå¦‚ä¸‹è®¾å¤‡èŠ‚ç‚¹ï¼Œä»¥rootæƒé™æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd _install/dev/</div><div class="line">sudo mknod console c 5 1</div><div class="line">sudo mknod null c 1 3</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="sh-é…åˆchmod-xä½¿ç”¨"><a href="#sh-é…åˆchmod-xä½¿ç”¨" class="headerlink" title=".sh(é…åˆchmod +xä½¿ç”¨)"></a>.sh(é…åˆchmod +xä½¿ç”¨)</h3><ul>
<li><p>build.sh: ç¼–è¯‘busybox</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export ARCH=ARM</div><div class="line">export CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make menuconfig</div><div class="line">make install</div></pre></td></tr></table></figure>
</li>
<li><p>creat.sh: _installæ–‡ä»¶å¤¹ä¸‹å¤„ç†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">rm -rf etc </div><div class="line">rm -rf dev </div><div class="line">rm -rf mnt </div><div class="line">mkdir etc</div><div class="line">mkdir dev</div><div class="line">mkdir mnt</div><div class="line">mkdir -p etc/init.d/</div><div class="line"></div><div class="line">echo &quot;mkdir -p /proc</div><div class="line">mkdir -p /tmp</div><div class="line">mkdir -p /sys</div><div class="line">mkdir -p /mnt</div><div class="line">/bin/mount -a</div><div class="line">mkdir -p /dev/pts</div><div class="line">mount -t devpts devpts /dev/pts</div><div class="line">echo /sbin/mdev &gt; /proc/sys/kernel/hotplug</div><div class="line">mdev -s</div><div class="line">&quot; &gt; etc/init.d/rcS</div><div class="line">chmod +x etc/init.d/rcS</div><div class="line"></div><div class="line">echo &quot;proc /proc proc defaults 0 0</div><div class="line">tmpfs /tmp tmpfs defaults 0 0</div><div class="line">sysfs /sys sysfs defaults 0 0</div><div class="line">tmpfs /dev tmpfs defaults 0 0</div><div class="line">debugfs /sys/kernel/debug debugfs defaults 0 0</div><div class="line">&quot; &gt; etc/fstab</div><div class="line"></div><div class="line">echo &quot;::sysinit:/etc/init.d/rcS</div><div class="line">::respawn:-/bin/sh</div><div class="line">::askfirst:-/bin/sh</div><div class="line">::ctrlaltdel:/bin/umount -a -r</div><div class="line">&quot; &gt; etc/inittab</div><div class="line"></div><div class="line">cd dev/</div><div class="line">sudo mknod console c 5 1</div><div class="line">sudo mknod null c 1 3</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ç¼–è¯‘å†…æ ¸"><a href="#ç¼–è¯‘å†…æ ¸" class="headerlink" title="ç¼–è¯‘å†…æ ¸"></a>ç¼–è¯‘å†…æ ¸</h2><ul>
<li><p>ç¼–è¯‘å†…æ ¸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd linux-4.0</div><div class="line">export ARCH=arm</div><div class="line">export CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make vexpress_defconfig</div><div class="line">make menuconfig</div></pre></td></tr></table></figure>
</li>
<li><p>é…ç½® initramfsï¼Œåœ¨ initramfs source file ä¸­å¡«å…¥_installã€‚å¦å¤–éœ€è¦æŠŠ Default kernel command string æ¸…ç©ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">General setup ---&gt;</div><div class="line">[*] Initial RAM filesystem and RAM disk (initramfs/initrd) support</div><div class="line">(_install) Initramfs source file(s)</div><div class="line">Boot options --&gt;</div><div class="line">()Default kernel command string</div></pre></td></tr></table></figure>
</li>
<li><p>é…ç½® memory split ä¸ºâ€œ3G/1G user/kernel splitâ€ä»¥åŠæ‰“å¼€é«˜ç«¯å†…å­˜ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Kernel Features ---&gt;</div><div class="line">Memory split (3G/1G user/kernel split) ---&gt;</div><div class="line">[ *] High Memory Support</div></pre></td></tr></table></figure>
</li>
<li><p>å¼€å§‹ç¼–è¯‘ kernel</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">make bzImage -j4 ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make dtbs</div></pre></td></tr></table></figure>
</li>
<li><p>è¿è¡Œ QEMU æ¥æ¨¡æ‹Ÿ 4 æ ¸ Cortex-A9 çš„ Versatile Express å¼€å‘å¹³å°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qemu-system-arm -M vexpress-a9 -smp 4 -m 1024M -kernel arch/arm/boot/zImage -append &quot;rdinit=/linuxrc console=ttyAMA0 loglevel=8&quot; -dtb arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="sh-é…åˆchmod-x"><a href="#sh-é…åˆchmod-x" class="headerlink" title=".sh(é…åˆchmod +x)"></a>.sh(é…åˆchmod +x)</h3><ul>
<li><p>build.sh : ç¼–è¯‘å†…æ ¸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">export ARCH=arm</div><div class="line">export CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make vexpress_defconfig</div><div class="line">make menuconfig</div><div class="line">make bzImage -j4 ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-</div><div class="line">make dtbs</div></pre></td></tr></table></figure>
</li>
<li><p>run.sh : è¿è¡Œarmå†…æ ¸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qemu-system-arm -M vexpress-a9 -smp 4 -m 1024M -kernel arch/arm/boot/zImage -append &quot;rdinit=/linuxrc console=ttyAMA0 loglevel=8&quot; -dtb arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographicyun</div></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;ubuntu16.04&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨busyboxç¼–è¯‘æœ€å°æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨qemuè¿è¡Œèµ·æ¥ã€‚&lt;/li&gt;
&lt;li&gt;å†…å®¹æ¥è‡ª å¥”è·‘å§linuxå†…æ ¸ç¬¬6ç« &lt;/li&gt;
&lt;li&gt;è¿™é‡Œå°†è¾“å…¥ä»£ç è¿‡ç¨‹é›†åˆåˆ°äº†å‡ ä¸ª.shæ–‡ä»¶,ä¸åšé‡å¤çš„å·¥ä½œ !&lt;/li&gt;
&lt;l
    
    </summary>
    
      <category term="Linuxç¬”è®°" scheme="http://yoursite.com/categories/Linux%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="qemu" scheme="http://yoursite.com/tags/qemu/"/>
    
  </entry>
  
  <entry>
    <title>linuxç¬”è®°â€”â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘</title>
    <link href="http://yoursite.com/2017/08/23/linux%E7%AC%94%E8%AE%B0%E2%80%94%E7%9C%8B%E9%97%A8%E7%8B%97%E5%86%85%E6%A0%B8API%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91/"/>
    <id>http://yoursite.com/2017/08/23/linuxç¬”è®°â€”çœ‹é—¨ç‹—å†…æ ¸APIæ–‡æ¡£ç¿»è¯‘/</id>
    <published>2017-08-23T09:52:16.000Z</published>
    <updated>2017-09-10T01:35:25.036Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li>wdtç¬¬äºŒå¼¹ï¼Œå†…æ ¸APIï¼Œå‹‰å¼ºç¿»è¯‘ä¸‹æ¥äº†ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥æ•´ç†</li>
</ul>
<hr>
<h2 id="çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API"><a href="#çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API" class="headerlink" title="çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API"></a>çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API</h2><ul>
<li>æœ€åæ›´æ–°æ—¶é—´ 2013.2.12</li>
<li>Wim Van Sebroeck <a href="&#x6d;&#x61;&#x69;&#108;&#116;&#x6f;&#x3a;&#119;&#105;&#109;&#64;&#x69;&#103;&#x75;&#x61;&#110;&#x61;&#46;&#x62;&#101;">&#119;&#105;&#109;&#64;&#x69;&#103;&#x75;&#x61;&#110;&#x61;&#46;&#x62;&#101;</a></li>
</ul>
<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><ul>
<li>æœ¬æ–‡æ¡£æ²¡æœ‰æè¿°çœ‹é—¨ç‹—è®¾å¤‡æˆ–é©±åŠ¨ã€‚ä¹Ÿä¸æ¶‰åŠé‚£äº›åœ¨ç”¨æˆ·ç©ºé—´è°ƒç”¨çš„APIï¼Œå¯¹åº”åœ¨ Documentation/watchdog/watchdog-api.txt ï¼ˆä¹Ÿå°±æ˜¯<a href="">ä¸Šä¸€ç¯‡</a>ï¼‰</li>
<li>æœ¬æ–‡æ¡£æè¿°çš„æ˜¯ï¼Œåˆ©ç”¨çœ‹é—¨ç‹—å­ç³»ç»Ÿæ¡†æ¶æ–¹å¼è¿›è¡Œçœ‹é—¨ç‹—é©±åŠ¨ç¼–å†™æ—¶æ‰€ä½¿ç”¨åˆ°çš„APIã€‚çœ‹é—¨ç‹—å­ç³»ç»Ÿæ¡†æ¶æä¾›äº†æ‰€æœ‰ä¸ç”¨æˆ·ç©ºé—´äº¤äº’çš„æ¥å£ï¼Œä¸éœ€è¦æ¯æ¬¡ç¼–å†™é‡å¤çš„ä»£ç ã€‚è¿™æ„å‘³è¿™é©±åŠ¨ç¨‹åºåªéœ€è¦æä¾›å‡ ä¸ªä¸åŒçš„æ“ä½œå‡½æ•°ï¼Œå°±å¯ä»¥æ§åˆ¶WDTäº†ã€‚</li>
</ul>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><ul>
<li><p>æ¯ä¸€ä¸ªæƒ³è¦ä½¿ç”¨çœ‹é—¨ç‹—æ ¸å¿ƒå­ç³»ç»Ÿçš„é©±åŠ¨ç¨‹åºéƒ½å¿…é¡»åŒ…å«<code>#include&lt;linux/watchdog.h&gt;</code>(ç¼–å†™é©±åŠ¨ç¨‹åºæ˜¯ä¸å¾—ä¸åšçš„å·¥ä½œ)ã€‚<code>linux/watchdog.h</code>åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ³¨å†Œ/å¸è½½å‡½æ•°ï¼š</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">extern int watchdog_register_device(struct watchdog_device *);</div><div class="line">extern void watchdog_unregister_device(struct watchdog_device *);</div></pre></td></tr></table></figure>
</li>
<li><p>æ³¨å†Œå‡½æ•°å°†wdtè®¾å¤‡æ³¨å†Œè¿›wdtå­ç³»ç»Ÿï¼Œå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘struct watchdog<em>deviceçš„ç»“æ„ä½“</em>ã€‚å½“æ³¨å†ŒæˆåŠŸæ—¶è¿”å›0.æ³¨å†Œå¤±è´¥è¿”å›ä¸€ä¸ªè´Ÿå€¼ã€‚</p>
</li>
<li>å¸è½½å‡½æ•°æ˜¯å°†wdtè®¾å¤‡ä»wdtå­ç³»ç»Ÿå¸è½½ï¼Œå‡½æ•°å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘struct watchdog<em>deviceçš„ç»“æ„ä½“</em></li>
<li>çœ‹é—¨å­ç³»ç»ŸåŒ…å«äº†æ³¨å†Œæ—¶é—´è°ƒæ•´æœºåˆ¶ï¼ˆåŸæ–‡æ˜¯ an registration deferral mechanism ä¸€ç§å»¶æœŸæœºåˆ¶ï¼Ÿä¸Šä¸‹æ–‡ä¸å¤ªå¯¹å•Šï¼‰ï¼Œå…è®¸åœ¨å¼€æœºé˜¶æ®µï¼Œä½ å¯ä»¥æŒ‰ç…§ä½ è®¾å®šçš„å°½å¯æ—©çš„æ³¨å†Œä¸€ä¸ªçœ‹é—¨ç‹—è®¾å¤‡ã€‚</li>
</ul>
<h3 id="struct-watchdogdevice"><a href="#struct-watchdogdevice" class="headerlink" title="struct watchdogdevice"></a>struct watchdog<em>device</em></h3><ul>
<li>è¿™é‡Œç²˜è´´çš„æ˜¯linux4.1é‡Œå®šä¹‰çš„watchdog_deviceï¼ŒåŸæ–‡çš„watchdog_deviceæ›´é•¿ä½†è·Ÿæºç å¯¹ä¸èµ·æ¥ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»¥å†…æ ¸4.1é‡Œå®šä¹‰çš„ä¸ºå‡†äº†ğŸ˜‘ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"> struct watchdog_device &#123;</div><div class="line">int id;</div><div class="line">struct cdev cdev;</div><div class="line">struct device *dev;</div><div class="line">struct device *parent;</div><div class="line">const struct watchdog_info *info;</div><div class="line">const struct watchdog_ops *ops;</div><div class="line">unsigned int bootstatus;</div><div class="line">unsigned int timeout;</div><div class="line">unsigned int min_timeout;</div><div class="line">unsigned int max_timeout;</div><div class="line">void *driver_data;</div><div class="line">struct mutex lock;</div><div class="line">unsigned long status;</div><div class="line">/* Bit numbers for status flags */</div><div class="line">#define WDOG_ACTIVE		0	/* Is the watchdog running/active */</div><div class="line">#define WDOG_DEV_OPEN		1	/* Opened via /dev/watchdog ? */</div><div class="line">#define WDOG_ALLOW_RELEASE	2	/* Did we receive the magic char ? */</div><div class="line">#define WDOG_NO_WAY_OUT		3	/* Is &apos;nowayout&apos; feature set ? */</div><div class="line">#define WDOG_UNREGISTERED	4	/* Has the device been unregistered */</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>åŒ…å«ä»¥ä¸‹å­—æ®µï¼š<ul>
<li>idï¼šç”±watchdog_register_deviceå‡½æ•°æ³¨å†Œã€‚id 0æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ï¼Œid 0 æœ‰/dev/watchdog0 cdevï¼ˆåŠ¨æ€ä¸»è®¾å¤‡å·ï¼Œæ¬¡è®¾å¤‡å·0ï¼‰ å’Œ /dev/watchdog miscdevã€‚id åœ¨è°ƒç”¨åˆ°watchdog_register_deviceæ—¶è‡ªåŠ¨æ³¨å†Œã€‚<ul>
<li><strong>NOTE</strong>çœ‹æºç ï¼Œwdtå­ç³»ç»Ÿæ˜¯åŸºäºmiscå­ç³»ç»Ÿçš„ï¼Œæ³¨å†Œwdtè®¾å¤‡è°ƒç”¨çš„æ˜¯<code>misc_register(&amp;watchdog_miscdev);</code>è€Œmiscè®¾å¤‡ä¸»è®¾å¤‡å·åªèƒ½ä¸º10,è¿™é‡Œç»“è®ºæœ‰å†²çªï¼Œç­‰å¾…è§£å†³ä¸­ã€‚ã€‚ã€‚<ul>
<li>parentï¼šåœ¨è°ƒç”¨watchdog_register_deviceå‡½æ•°å‰ï¼Œè®¾ç½®çˆ¶è®¾å¤‡ï¼ˆæˆ–è€…è®¾ç½®ä¸ºnullï¼‰</li>
<li>infoï¼šæŒ‡å‘watchdog_infoç»“æ„ä½“çš„æŒ‡é’ˆï¼Œwatchdog_infoæä¾›äº†çœ‹é—¨ç‹—æœ¬èº«çš„ä¸€äº›é™„åŠ ä¿¡æ¯ï¼ˆåƒæ˜¯çœ‹é—¨ç‹—ç‹¬æœ‰çš„åç§°ä¹‹ç±»çš„ï¼‰</li>
<li>opsï¼šæŒ‡å‘watchdog_opsç»“æ„ä½“çš„æŒ‡é’ˆï¼Œwatchdog_opsæ˜¯çœ‹é—¨ç‹—æ”¯æŒæ“ä½œ(å‡½æ•°)çš„é›†åˆã€‚</li>
<li>bootstatus:å¯åŠ¨åè®¾å¤‡çŠ¶æ€(ä¸çœ‹é—¨ç‹—WDIOF<em>* æ ‡å¿—ä½ä¸€åŒå¼€å¯)</em></li>
<li>timeout:çœ‹é—¨ç‹—è¶…æ—¶çš„æ—¶é—´(ç§’ä¸ºå•ä½).å¦‚æœè®¾ç½®äº†WDOG<em>ACTIVE </em>å¯ç”¨äº†çœ‹é—¨ç‹—,åœ¨è¿™ä¸ªæ—¶é—´é•¿åº¦å,ç”¨æˆ·ç©ºé—´è¿˜æ²¡æœ‰å‘é€å¿ƒè·³åŒ…,çœ‹é—¨ç‹—ä¼šå°†ç³»ç»Ÿå¤ä½é‡å¯.</li>
<li>min<em>timeout:</em>å¯è®¾ç½®çš„çœ‹é—¨ç‹—æœ€å°è¶…æ—¶æ—¶é—´</li>
<li>max<em>timeout:</em>å¯è®¾ç½®çš„çœ‹é—¨ç‹—æœ€å¤§è¶…æ—¶æ—¶é—´</li>
<li>driver<em>data:</em>æŒ‡å‘çœ‹é—¨ç‹—è®¾å¤‡ç§æœ‰æ•°æ®çš„æŒ‡é’ˆ,è¿™ä¸ªdataåªèƒ½ç”±watchdog_set_drvdata å’Œ watchdog_get_drvdata routineså‡½æ•°è®¿é—®.</li>
<li>struct mutex lock; <strong>åŸæ–‡æ¡£æ²¡æœ‰ğŸ™„</strong></li>
<li>status:è¿™ä¸ªå­—æ®µåŒ…å«äº†è®¸å¤šçŠ¶æ€ä½,æä¾›æœ‰å…³è®¾å¤‡çš„é¢å¤–ä¿¡æ¯(ä¾‹å¦‚:çœ‹é—¨ç‹—çš„æ´»åŠ¨çŠ¶æ€\é™åˆ¶,ç°åœ¨nowayout ä½è®¾ç½®ä¸å¦)(æ‹¬å·é‡Œç¿»è¯‘æ˜¯å¦å‡†ç¡®å­˜ç–‘)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="struct-watchdog-ops"><a href="#struct-watchdog-ops" class="headerlink" title="struct watchdog_ops"></a>struct watchdog_ops</h3><ul>
<li><p>watchdog<em>ops</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> struct watchdog_ops &#123;</div><div class="line">struct module *owner;</div><div class="line">/* mandatory operations */</div><div class="line">int (*start)(struct watchdog_device *);</div><div class="line">int (*stop)(struct watchdog_device *);</div><div class="line">/* optional operations */</div><div class="line">int (*ping)(struct watchdog_device *);</div><div class="line">unsigned int (*status)(struct watchdog_device *);</div><div class="line">int (*set_timeout)(struct watchdog_device *, unsigned int);</div><div class="line">unsigned int (*get_timeleft)(struct watchdog_device *);</div><div class="line">void (*ref)(struct watchdog_device *);</div><div class="line">void (*unref)(struct watchdog_device *);</div><div class="line">long (*ioctl)(struct watchdog_device *, unsigned int, unsigned long);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>ä½ ä¸€å¼€å§‹å®šä¹‰çš„çœ‹é—¨ç‹—çš„module owneræ˜¯éå¸¸é‡è¦çš„,module owner åœ¨ä½¿ç”¨çœ‹é—¨ç‹—æ—¶ä¼šåŒæ—¶é”å®šçœ‹é—¨ç‹—è®¾å¤‡.(è¿™æ ·é¿å…äº†åœ¨å¸è½½æ¨¡å—æ—¶/dev/watchdogä¾ç„¶æ˜¯æ‰“å¼€çŠ¶æ€å¼•èµ·çš„ç³»ç»Ÿå´©æºƒ)</p>
</li>
<li><p>æŸäº›å‡½æ•°æ˜¯å¿…é¡»å®ç°çš„,å…¶ä»–æ˜¯å¯é€‰çš„,å¿…é¡»å®ç°çš„å‡½æ•°å¦‚ä¸‹:</p>
<ul>
<li><em>start  :</em>æŒ‡å‘çœ‹é—¨ç‹—è®¾å¤‡å¯åŠ¨å‡½æ•°çš„æŒ‡é’ˆ.è¿™ä¸ªå‡½æ•°å‚æ•°ä¸ºä¸€ä¸ª struct watchdog<em>device,</em>æˆåŠŸè¿”å›0,å¤±è´¥è¿”å›è´Ÿæ•°.</li>
<li><em>stop :</em>é€šè¿‡è¿™ä¸ªå‡½æ•°å…³é—­çœ‹é—¨ç‹—è®¾å¤‡.è¿™ä¸ªå‡½æ•°å‚æ•°ä¸ºä¸€ä¸ª struct watchdog<em>device,</em>æˆåŠŸè¿”å›0,å¤±è´¥è¿”å›è´Ÿæ•°.<ul>
<li>ä¸€äº›ç¡¬ä»¶çœ‹é—¨ç‹—è®¾å¤‡åªèƒ½å¯åŠ¨,æ²¡æœ‰å…³é—­é€‰é¡¹.å¯¹åº”è¿™äº›è®¾å¤‡çš„é©±åŠ¨,ä¸ç”¨å®ç° <em>stop  ,</em>å¦‚æœé©±åŠ¨ç¨‹åºæ²¡æœ‰å…³é—­è®¾å¤‡åŠŸèƒ½,çœ‹é—¨ç‹—æ ¸å¿ƒå±‚ä¼šåœ¨è®¾å¤‡å…³é—­åè®¾ç½® WDOG_HW_RUNNING å¹¶è°ƒç”¨é©±åŠ¨ç¨‹åºçš„ keepalive pingsåŠŸèƒ½.</li>
<li>å¦‚æœçœ‹é—¨ç‹—é©±åŠ¨æ²¡æœ‰å®ç°<em>stop  </em>å¿…é¡»è®¾ç½®max_hw_heartbeat<em>ms</em></li>
</ul>
</li>
</ul>
</li>
<li><p>ä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶çœ‹é—¨ç‹—éƒ½æœ‰ç›¸åŒçš„åŠŸèƒ½,è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰å¯é€‰å‡½æ•°äº†,åªæœ‰ä½†è¿™é¡¹åŠŸèƒ½è¢«ç¡¬ä»¶çœ‹é—¨ğŸ¶æ”¯æŒæ—¶,æ‰ç¼–å†™å¯¹åº”å‡½æ•°.</p>
<ul>
<li>ping:è¿™æ˜¯çœ‹é—¨ç‹—é©±åŠ¨å®ç°çš„å–‚ç‹—å‡½æ•°,è¿™ä¸ªå‡½æ•°çš„å‚æ•°æ—¶ä¸€ä¸ªæŒ‡å‘struct watchdog<em>deviceçš„æŒ‡é’ˆ</em>.å‡½æ•°æ‰§è¡ŒæˆåŠŸè¿”å›0,å¤±è´¥è¿”å›è´Ÿæ•°.<ul>
<li>å¤§å¤šæ•°çš„ç¡¬ä»¶ä¸æ”¯æŒç›´æ¥å–‚ç‹—çš„ç‰¹æ®ŠåŠŸèƒ½,ä¸€èˆ¬æ˜¯ç›´æ¥é‡å¯ç¡¬ä»¶çœ‹é—¨ç‹—.</li>
<li>çœ‹é—¨ç‹—å­ç³»ç»Ÿçš„æ ¸å¿ƒå±‚ä¹Ÿæ˜¯è¿™æ ·åšçš„:ä½†å®šæœŸå–‚ç‹—çš„æ“ä½œè½¬å‘åˆ°ç¡¬ä»¶çœ‹é—¨ç‹—æ—¶,æ ¸å¿ƒå±‚åœ¨ <em>ping å®ç°</em>æ—¶è°ƒç”¨å–‚ç‹—å‡½æ•°,ä½†å–‚ç‹—å‡½æ•°æ²¡æœ‰å®ç°æ—¶,ä½¿ç”¨ start  å¯¹åº”å‡½æ•°</li>
<li>( WDIOC_KEEPALIVEå¯¹åº”çš„ ioctlå‘½ä»¤åªæœ‰åœ¨içœ‹é—¨ç‹—infoé‡Œçš„WDIOF_KEEPALIVEPINGè¢«è®¾ç½®ä¸º1åæ‰ä¼šç”Ÿæ•ˆ )</li>
</ul>
</li>
<li>status: è¿™ä¸ªå‡½æ•°ç”¨æ¥æ£€æŸ¥çœ‹é—¨ç‹—è®¾å¤‡çš„çŠ¶æ€,é€šè¿‡çœ‹é—¨ç‹—çš„WDIOF<em>*</em>çŠ¶æ€æ ‡å¿—ä½æŠ¥å‘Š.WDIOF_MAGICCLOSE and WDIOF_KEEPALIVEPINGç”±çœ‹é—¨ç‹—æ ¸å¿ƒå±‚æŠ¥å‘Š.æ²¡æœ‰å¿…è¦åœ¨é©±åŠ¨ç¨‹åºä¸­æŠ¥å‘Š.æ­¤å¤–å¦‚æœé©±åŠ¨ç¨‹åºæ²¡æœ‰å®ç°è¯¥å‡½æ•°,çœ‹é—¨ç‹—æ ¸å¿ƒå±‚ä¼šè¿”å› struct watchdog<em>device</em>ä¸­çš„bootstatusçŠ¶æ€ä½.</li>
<li>set_timeout:è¿™ä¸ªå‡½æ•°è®¾ç½®å’Œæ£€æŸ¥ è¶…æ—¶æ—¶é—´çš„å˜åŒ–,è¿”å›0è¡¨ç¤ºæˆåŠŸ,è¿”å›-EINVALè¡¨ç¤ºè¶…å‡ºèŒƒå›´,è¿”å›-EIOè¡¨ç¤ºæ— æ³•å†™å…¥çœ‹é—¨ç‹—.è®¾ç½®æˆåŠŸå,å‡½æ•°åº”è¯¥å°†è®¾å®šçš„è¶…æ—¶æ—¶é—´å†™å…¥çœ‹é—¨ç‹—.(æˆ–è®¸ä¸é€šè¿‡æ¥å£è·å–çš„è¶…æ—¶æ—¶é—´ä¸åŒ,å› ä¸ºçœ‹é—¨ç‹—çš„åˆ†è¾¨ç‡ä¸ä¸€å®šèƒ½åˆ°1s). <ul>
<li>å®ç°äº†max_hw_heartbeat_msçš„é©±åŠ¨å°†ç¡¬ä»¶çœ‹é—¨ç‹—å¿ƒè·³å€¼è®¾ç½®ä¸ºè¶…æ—¶æ—¶é—´å’Œmax_hw_heartbeat_msä¹‹é—´çš„æœ€å°å€¼.Those drivers set the timeout value of the watchdog_device either to the requested timeout value (if it is larger than max_hw_heartbeat_ms), or to the achieved timeout value.</li>
<li>å¦‚æœçœ‹é—¨ç‹—é©±åŠ¨ç¨‹åºæ²¡æœ‰æ‰§è¡Œä»»ä½•æ“ä½œ,ä½†è®¾ç½®äº†watchdog<em>device.timeout</em>,æ­¤å›æ‰å‡½æ•°å¿½ç•¥.</li>
<li>å¦‚æœæ²¡æœ‰è®¾ç½® set_timeout,ä½†è®¾ç½®äº†WDIOF_SETTIMEOUT,çœ‹é—¨ç‹—æ¶æ„ä¼šå°† watchdog_deviceä¸­timeoutå€¼æ›´æ–°ä¸ºè¯·æ±‚çš„å€¼.</li>
<li>å¦‚æœä½¿ç”¨äº†pretimeout feature (WDIOF_PRETIMEOUT),é‚£ä¹ˆset_timeout å¿…é¡»åŒæ—¶æ£€æŸ¥ pretimeout æ˜¯å¦æœ‰æ•ˆ ,è®¾ç½®ç›¸åº”å®šæ—¶å™¨. è¿™äº›æ“ä½œåœ¨æ ¸å¿ƒå±‚æ²¡æœ‰racesæ— æ³•å®Œæˆ,æ‰€ä»¥å¿…é¡»åœ¨é©±åŠ¨ä¸­å®Œæˆ.</li>
</ul>
</li>
<li>set<em>pretimeout</em>:è¿™ä¸ªå‡½æ•°æ”¯æŒæ£€æŸ¥/æ”¹å˜çœ‹é—¨ç‹—ä¸­pretimeoutå€¼(pretimeoutè¯¦æƒ…è§wdtç”¨æˆ·å±‚apiç¿»è¯‘).è¿™ä¸ªå‡½æ•°æ˜¯å¯é€‰æ”¯æŒçš„,å› ä¸ºä¸æ˜¯æ‰€æœ‰çš„çœ‹é—¨ç‹—éƒ½æ”¯æŒè¿™ä¸ªåŠŸèƒ½.pretimeout ä¸æ˜¯ç»å¯¹æ—¶é—´,å…¶æ•°å€¼æ˜¯åœ¨è¶…æ—¶æ—¶é—´ä¹‹å‰å‡ ç§’å‘ç”Ÿ.<ul>
<li>è¿”å›0è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸ,è¿”å›-EINVAL,è¡¨ç¤ºè¶…å‡ºèŒƒå›´,è¿”å›-EIOè¡¨ç¤ºæœªèƒ½æˆåŠŸå‘çœ‹é—¨ç‹—å†™å…¥.</li>
<li>è®¾ç½®pretimeouä¸º0å€¼,ä»£è¡¨ç¦ç”¨pretimeoutåŠŸèƒ½.(WDIOF<em>PRETIMEOUT</em>éœ€è¦åœ¨çœ‹é—¨ç‹—çš„info ç»“æ„ä½“ä¸­è®¾ç½®)</li>
<li>å¦‚æœé©±åŠ¨æ²¡æœ‰å®ç°ä»»ä½•åŠŸèƒ½,ä½†è®¾å®šäº† watchdog<em>device.pretimeout</em>,æ­¤å›æ‰å‡½æ•°å¿½ç•¥.è¿™æ„å‘³è¿™,å¦‚æœæ²¡æœ‰æä¾›set<em>pretimeout</em>å‡½æ•°,ä½†è®¾å®šäº†WDIOF<em>PRETIMEOUT</em>,çœ‹é—¨ç‹—æ¶æ„ä¼šå°†pretimeoutçš„å€¼æ›´æ–°ä¸ºè¯·æ±‚å€¼.</li>
</ul>
</li>
<li>get<em>timeleft:</em>è¿™ä¸ªå‡½æ•°è¿”å›å¤ä½å‰å‰©ä½™æ—¶é—´.</li>
<li>restart:æ­¤å‡½æ•°é‡å¯çœ‹é—¨ç‹—ç¡¬ä»¶,è¿”å›0è¡¨ç¤ºæˆåŠŸ,å¤±è´¥è¿”å›å¯¹åº”é”™è¯¯ç .</li>
<li>ioctl:å¦‚æœè¿™ä¸ªå‡½æ•°å­˜åœ¨,åœ¨ç³»ç»Ÿè¿›è¡Œå†…éƒ¨ioctlå‘½ä»¤å¤„ç†å‰,ä¼šé¦–å…ˆè°ƒç”¨æ­¤å‡½æ•°.å¦‚æœä¸æ”¯æŒioctrlå‘½ä»¤,åº”è¯¥è¿”å› -ENOIOCTLCMD .è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸º(watchdog<em>device, cmd and arg)</em></li>
<li>refå’Œunref å·²ç»ä¸å†è¢«æ”¯æŒ.</li>
</ul>
</li>
<li><p>The status bits should (preferably) be set with the set_bit and clear_bit alike bit-operations. The status bits that are defined are:</p>
<ul>
<li>WDOG<em>ACTIVE:</em>è¿™ä¸ªçŠ¶æ€ä½æ ‡è¯†ç€ä»ç”¨æˆ·ç©ºé—´çœ‹ä¸€ä¸ªçœ‹é—¨ç‹—è®¾å¤‡æ˜¯å¦è¢«æ¿€æ´»,å¦‚æœè¢«æ¿€æ´»,ç”¨æˆ·ç©ºé—´éœ€è¦æ‰§è¡Œå–‚ç‹—åŠ¨ä½œ</li>
<li>WDOG_NO_WAY<em>OUT:</em>è¿™ä¸ªçŠ¶æ€ä½æ ‡è¯†è¿™nowayoutçš„è®¾ç½®,å¦‚æœè¢«æ¿€æ´»,é‚£çœ‹é—¨ç‹—å¯åŠ¨å,æ— æ³•è¢«åœæ­¢.</li>
<li>WDOG_HW_RUNNING:å¦‚æœç¡¬ä»¶çœ‹é—¨ç‹—è¿è¡Œ,æ­¤çŠ¶æ€ä½è¢«ç½®1.<ul>
<li>å½“ç¡¬ä»¶çœ‹é—¨ç‹—ä¸èƒ½è¢«åœæ­¢æ—¶,è¿™ä¸ªçŠ¶æ€ä½å¿…é¡»è¢«ç½®1.</li>
<li>å¦‚æœç³»ç»Ÿå¯åŠ¨åè‡ªåŠ¨å¯åŠ¨çœ‹é—¨ç‹—,åœ¨çœ‹é—¨ç‹—æ‰“å¼€å‰,å¿…é¡»è®¾ç½®æ­¤çŠ¶æ€ä½.</li>
<li>å½“æ­¤çŠ¶æ€ä½è¢«ç½®1,å³ä½¿WDOG<em>ACTIVEä¸º0</em>.çœ‹é—¨ç‹—æ¶æ„ä¹Ÿä¼šæ‰§è¡Œå–‚ç‹—åŠ¨ä½œ.</li>
<li>(å½“ä½ ç›´æ¥æ³¨å†Œè®¾ç½®äº† WDOG_HW_RUNNINGä½çš„çœ‹é—¨ç‹—è®¾å¤‡æ—¶,æ‰§è¡Œopen /dev/watchdogåŠ¨ä½œ,ç³»ç»Ÿä¼šç›´æ¥è·³è¿‡å¯åŠ¨æ“ä½œ,ç›´æ¥æ‰§è¡Œå–‚ç‹—æ“ä½œ )</li>
</ul>
</li>
</ul>
<ul>
<li><p>è¦è®¾ç½®WDOG_NO_WAY<em>OUT</em>çŠ¶æ€ä½(åœ¨æ³¨å†Œçœ‹é—¨ç‹—è®¾å¤‡å‰)ä½ å¯ä»¥:</p>
<ul>
<li><p>åœ¨watchdog<em>device</em>çš„ç»“æ„ä½“ä¸­è®¾ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.status = WATCHDOG_NOWAYOUT_INIT_STATUS,</div></pre></td></tr></table></figure>
<p>è¿™æ ·ç­‰åŒäºå°†WDOG_NO_WAY<em>OUT</em>å€¼è®¾ç½®ä¸ºCONFIG_WATCHDOG_NOWAYOUT</p>
</li>
<li>ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">static inline void watchdog_set_nowayout(struct watchdog_device *wdd, int nowayout)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>(note:)   wdté©±åŠ¨ç¨‹åºæ ¸å¿ƒæ”¯æŒmagic closeå’Œ nowayoutåŠŸèƒ½.è¦ä½¿ç”¨magic close,éœ€è¦åœ¨çœ‹é—¨ç‹—çš„ infoä¸­è®¾ç½®WDIOF<em>MAGICCLOSE </em>ä½.å¼€å¯ nowayout ä¼šè¦†ç›–magic close.</p>
</li>
<li><p>è·å–æˆ–è®¾å®šé©±åŠ¨ç¨‹åºç‰¹æ®Šæ•°æ®,åº”è¯¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">static inline void watchdog_set_drvdata(struct watchdog_device *wdd, void *data)</div><div class="line">static inline void *watchdog_get_drvdata(struct watchdog_device *wdd)</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>watchdog_set_drvdataå‡½æ•°å…è®¸ä½ æ·»åŠ å‘é©±åŠ¨ç¨‹åºæ·»åŠ ç‰¹æ®Šæ•°æ®,æ­¤å‡½æ•°çš„å‚æ•°ä¸ºæŒ‡å‘çœ‹é—¨ç‹—è®¾å¤‡çš„æŒ‡é’ˆ,å’ŒæŒ‡å‘éœ€è¦æ·»åŠ æ•°æ®çš„æŒ‡é’ˆ.</li>
<li>watchdog_get_drvdataå‡½æ•°è¿è¡Œä½ è¯»å–é©±åŠ¨ç¨‹åºä¸­çš„ç‰¹æ®Šæ•°æ®,æ­¤å‡½æ•°çš„å‚æ•°ä¸ºæŒ‡å‘ä½ æƒ³è¯»å–çš„çœ‹é—¨ç‹—è®¾å¤‡çš„æŒ‡é’ˆ.</li>
</ul>
<ul>
<li><p>åˆå§‹åŒ– timeout ,ä¼šç”¨åˆ°ä¸‹é¢çš„å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  extern int watchdog_init_timeout(struct watchdog_device *wdd,unsigned int timeout_parm, struct device *dev);</div><div class="line">  ``` </div><div class="line">  </div><div class="line">  * watchdog_init_timeoutå…è®¸ä½¿ç”¨æ¨¡å—çš„ timeout å­—æ®µåˆå§‹åŒ– timeout ,å½“æ¨¡å—çš„ timeout å­—æ®µæ— æ•ˆæ—¶,è®¾å¤‡æ ‘ä¸­çš„timeout-secä¹Ÿå¯.æœ€å¥½çš„åšæ³•æ˜¯å°†watchdog_device_ä¸­timeoutçš„å€¼,è®¾ç½®ä¸ºåˆå§‹é»˜è®¤å€¼,ç„¶åä½¿ç”¨åˆ°å‡½æ•°çš„ç”¨æˆ·å¯ä»¥åˆ†åˆ«è®¾ç½®è‡ªå®šä¹‰å€¼.</div><div class="line"></div><div class="line">* é‡å¯åç¦ç”¨çœ‹é—¨ç‹—,éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‡½æ•°:</div></pre></td></tr></table></figure>
<p>static inline void watchdog_stop_on_reboot(struct watchdog_device *wdd);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">* å¸è½½çœ‹é—¨ç‹—è®¾å¤‡æ—¶ç¦ç”¨çœ‹é—¨ç‹—,å¿…é¡»è°ƒç”¨æ­¤å‡½æ•°,å¦‚æœ nowayout æ²¡æœ‰è®¾ç½®,è¿™ä¸ªå‡½æ•°åªä¼šåœæ­¢çœ‹é—¨ç‹—.</div></pre></td></tr></table></figure>
<p>static inline void watchdog_stop_on_unregister(struct watchdog_device *wdd);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">* æ›´æ”¹é‡å¯å¤„ç†ç¨‹åºçš„ä¼˜å…ˆçº§,(çŒœæµ‹æ˜¯ä¸åŒçœ‹é—¨ç‹—çš„ä¼˜å…ˆçº§)è°ƒç”¨ä¸‹é¢çš„å‡½æ•°:</div></pre></td></tr></table></figure>
<p>oid watchdog_set_restart_priority(struct watchdog_device *wdd, int priority);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  * è®¾å®šä¼˜å…ˆçº§æ—¶,ç”¨æˆ·éœ€è¦éµå¾ªä»¥ä¸‹è§„åˆ™</div><div class="line">    * 0:ä¼˜å…ˆçº§æœ€ä½,éå¸¸æœ‰é™çš„é‡å¯èƒ½åŠ›</div><div class="line">    * 128:é‡å¯å¤„ç†çš„é»˜è®¤é€‰æ‹©,å¦‚æœæ²¡æœ‰å…¶ä»–çš„é‡å¯å¤„ç†ç¨‹åºå¯ç”¨,æˆ–è€…æ²¡æœ‰é‡å¯æ•´ä¸ªç³»ç»Ÿçš„é‡å¯å¤„ç†ç¨‹åºå¯ç”¨.</div><div class="line">    * 255:æœ€é«˜ä¼˜å…ˆçº§,ä¼šè¦†ç›–å…¶ä»–æ‰€æœ‰é‡å¯å¤„ç†ç¨‹åº</div><div class="line"></div><div class="line">* ä½¿ç”¨pretimeout é€šçŸ¥åŠŸèƒ½,éœ€è¦åˆ©ç”¨ä»¥ä¸‹å‡½æ•°:</div></pre></td></tr></table></figure>
<p>void watchdog_notify_pretimeout(struct watchdog_device *wdd)<br>```</p>
<ul>
<li>è¿™ä¸ªå‡½æ•°å¯ä»¥åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨,å¦‚æœå¯ç”¨äº†watchdog pretimeout governor æ¡†æ¶(kbuild CONFIG_WATCHDOG_PRETIMEOUT_GOV),å°±ä¼šé‡‡ç”¨è¿›å…¥é©±åŠ¨ç¨‹åºåˆ†é…å¥½çš„å¤„ç†ç¨‹åº,å¦‚æœæ²¡æœ‰å¯ç”¨watchdog pretimeout governor æ¡†æ¶,watchdog_notify_pretimeout()ä¼šå°†ä¿¡æ¯è¾“å‡ºåˆ°å†…æ ¸æ—¥å¿—ç¼“å­˜.</li>
</ul>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;wdtç¬¬äºŒå¼¹ï¼Œå†…æ ¸APIï¼Œå‹‰å¼ºç¿»è¯‘ä¸‹æ¥äº†ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥æ•´ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&quot;çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API&quot;&gt;&lt;a href=&quot;#çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸API&quot; class=&quot;headerlink&quot; title=&quot;çœ‹é—¨ç‹—å®šæ—¶å™¨é©±åŠ¨å†…æ ¸A
    
    </summary>
    
      <category term="Linuxç¬”è®°" scheme="http://yoursite.com/categories/Linux%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="wdt" scheme="http://yoursite.com/tags/wdt/"/>
    
  </entry>
  
  <entry>
    <title>linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘</title>
    <link href="http://yoursite.com/2017/08/22/linux%E7%AC%94%E8%AE%B0%E2%80%94%E7%9C%8B%E9%97%A8%E7%8B%97API%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91/"/>
    <id>http://yoursite.com/2017/08/22/linuxç¬”è®°â€”çœ‹é—¨ç‹—APIæ–‡æ¡£ç¿»è¯‘/</id>
    <published>2017-08-22T09:52:16.000Z</published>
    <updated>2017-09-10T01:35:42.263Z</updated>
    
    <content type="html"><![CDATA[<hr>
<ul>
<li>éšæ‰‹ç¿»è¯‘çš„æ–‡æ¡£ï¼Œè¦çœ‹æ‡‚linuxå†…æ ¸ï¼Œå†…æ ¸é™„å¸¦çš„æ–‡æ¡£è‡ªç„¶æ˜¯é€ƒä¸è¿‡ğŸ˜‚ï¼Œå…¨è‹±æ–‡é…åˆGoogleç¿»è¯‘ä¹Ÿå¾—ä¸Šã€‚ã€‚ã€‚ã€‚</li>
</ul>
<hr>
<ul>
<li><p>æœ€åæ›´æ–°æ—¶é—´ 10/05/2007</p>
</li>
<li><p>linuxçœ‹é—¨ç‹—è®¾å¤‡API</p>
</li>
<li>Copyright 2002 Christer Weingel <a href="&#x6d;&#97;&#x69;&#x6c;&#116;&#111;&#x3a;&#x77;&#105;&#x6e;&#x67;&#101;&#108;&#x40;&#x6e;&#97;&#x6e;&#x6f;&#45;&#x73;&#x79;&#115;&#x74;&#101;&#x6d;&#x2e;&#99;&#x6f;&#x6d;">&#x77;&#105;&#x6e;&#x67;&#101;&#108;&#x40;&#x6e;&#97;&#x6e;&#x6f;&#45;&#x73;&#x79;&#115;&#x74;&#101;&#x6d;&#x2e;&#99;&#x6f;&#x6d;</a></li>
<li><p>æœ¬æ–‡æ¡£çš„ä¸€äº›å†…å®¹æ¥è‡ª sbc60xxwdt ï¼Œç‰ˆæƒå±äº Copyright 2000 Jakob Oestergaard <a href="&#x6d;&#97;&#x69;&#x6c;&#x74;&#111;&#58;&#x6a;&#97;&#107;&#111;&#x62;&#x40;&#111;&#x73;&#x74;&#x65;&#110;&#102;&#101;&#x6c;&#x64;&#46;&#x64;&#x6b;">&#x6a;&#97;&#107;&#111;&#x62;&#x40;&#111;&#x73;&#x74;&#x65;&#110;&#102;&#101;&#x6c;&#x64;&#46;&#x64;&#x6b;</a></p>
</li>
<li><p>æœ¬æ–‡æ¡£åŸºäºlinuxå†…æ ¸ 2.4.18</p>
</li>
</ul>
<hr>
<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><ul>
<li>ä½ åº”è¯¥å·²ç»çŸ¥é“äº†ï¼Œçœ‹é—¨ç‹—å®šæ—¶å™¨ï¼ˆWDTï¼‰æ˜¯ä¸€ä¸ªç¡¬ä»¶å¤ä½ç”µè·¯ï¼Œåœ¨ç³»ç»Ÿè½¯ä»¶å‡ºç°æ•…éšœæ—¶å¤ä½ç³»ç»Ÿã€‚</li>
<li>é€šå¸¸ï¼Œç”¨æˆ·ç©ºé—´çš„å®šæœŸå–‚ç‹—ç¨‹åºé€šè¿‡/dev/watchdogçš„è®¾å¤‡æ–‡ä»¶é€šçŸ¥å†…æ ¸çœ‹é—¨ç‹—é©±åŠ¨ç¨‹åºã€‚é©±åŠ¨æ”¶åˆ°é€šçŸ¥ï¼Œä¼šå‘ŠçŸ¥ç¡¬ä»¶çœ‹é—¨ç‹—ä¸€åˆ‡æ­£å¸¸ï¼Œç¡¬ä»¶çœ‹é—¨ç‹—éœ€è¦ç­‰ä¸€ä¼šå†å¤ä½ç³»ç»Ÿã€‚å¦‚æœç”¨æˆ·ç©ºé—´é€šçŸ¥å¤±è´¥ï¼ˆRAMé”™è¯¯ã€å†…æ ¸æ¼æ´ç­‰ç­‰ï¼‰ï¼Œé€šçŸ¥å°†åœæ­¢ã€‚è¶…æ—¶åï¼Œç¡¬ä»¶çœ‹é—¨ç‹—å°†å¤ä½ç³»ç»Ÿï¼ˆé‡å¯ï¼‰ã€‚</li>
<li>linuxçœ‹é—¨ç‹—çš„APIæ˜¯ç›¸å½“ç‰¹æ®Šçš„ç»“æ„ï¼Œä¸åŒçš„é©±åŠ¨ç¨‹åºå¯¹APIçš„æ‰§è¡Œå„ä¸ç›¸åŒï¼Œæœ‰æ—¶ä¼šç¢°åˆ°ä¸å…¼å®¹çš„æƒ…å†µã€‚æœ¬æ–‡æ¡£å‚æ•°è®°å½•ç°æœ‰çš„æƒ…å†µï¼Œä»¥ä¾›æœªæ¥çš„é©±åŠ¨å¼€å‘å‚è€ƒã€‚<h3 id="æœ€ç®€å•çš„API"><a href="#æœ€ç®€å•çš„API" class="headerlink" title="æœ€ç®€å•çš„API"></a>æœ€ç®€å•çš„API</h3></li>
<li>æ‰€æœ‰é©±åŠ¨éƒ½æ”¯æŒçš„åŸºæœ¬æ“ä½œæ¨¡å¼ã€‚/dev/watchdogè¢«æ‰“å¼€åï¼Œçœ‹é—¨ç‹—è¢«æ¿€æ´»å¹¶å¤ä½ç³»ç»Ÿï¼Œé™¤éåœ¨ä¸€å°æ®µæ—¶é—´å†…è¢«pingé€šï¼Ÿï¼ˆå–‚ç‹—ï¼‰ï¼Œè¿™æ®µæ—¶é—´è¢«ç§°ä¸ºè¶…æ—¶æ—¶é—´æˆ–é—´æ–­æ—¶é—´ã€‚ç®€å•çš„å–‚ç‹—çš„æ–¹å¼æ˜¯å‘é©±åŠ¨ç¨‹åºå†™å…¥ä¸€äº›æ•°æ®ï¼Œä¸€ä¸ªéå¸¸ç®€å•çš„å®ä¾‹åœ¨<code>see samples/watchdog/watchdog-simple.c</code>ä¸‹.</li>
<li>æ›´é«˜çº§çš„é©±åŠ¨ç¨‹åºå¯ä»¥åšåˆ°ä¾‹å¦‚æ£€æŸ¥ä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œåœ¨æ‰§è¡Œå–‚ç‹—æ“ä½œä¹‹å‰ï¼Œåšå‡ºå›åº”ã€‚</li>
<li>/dev/ä¸‹è®¾å¤‡èŠ‚ç‚¹è¢«å…³é—­åï¼Œçœ‹é—¨ç‹—ä¹ŸåŒæ—¶è¢«ç¦ç”¨ï¼Œé™¤éæ”¯æŒâ€œMagic Closeâ€ï¼ˆè§ä¸‹æ–‡ï¼‰ï¼Œè¿™å¹¶ä¸æ˜¯ä¸ªå¥½åŠæ³•ã€‚å› ä¸ºå¦‚æœçœ‹çœ‹é—¨ç‹—demoæœ‰bugå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œä½†ç³»ç»Ÿä¸ä¼šé‡å¯ã€‚å› ä¸ºè¿™æ ·ä¸€äº›é©±åŠ¨æ”¯æŒâ€Disable watchdog shutdown on closeâ€, CONFIG_WATCHDOG_NOWAYOUTâ€è¿™æ ·çš„é…ç½®é€‰é¡¹ã€‚ä¸€æ—¦ç¼–è¯‘å†…æ ¸æ—¶å€™å¯ç”¨è¿™äº›é€‰é¡¹ï¼Œä¸€æ—¦çœ‹é—¨ç‹—ç¨‹åºæ¿€æ´»ï¼Œå°±ä¸å¯èƒ½ç¦ç”¨çœ‹é—¨ç‹—ã€‚å¦‚æœçœ‹é—¨ç‹—demoå´©æºƒï¼Œç³»ç»Ÿä¼šåœ¨è¶…æ—¶åè‡ªåŠ¨é‡å¯ã€‚çœ‹é—¨ç‹—é©±åŠ¨é€šå¸¸ä¹Ÿæ”¯æŒnowayout module parameterï¼Œä»¥ä¾¿åœ¨è¿è¡Œæ—¶æ§åˆ¶nowayout moduleã€‚</li>
</ul>
<h3 id="Magic-Close-feature"><a href="#Magic-Close-feature" class="headerlink" title="Magic Close feature"></a>Magic Close feature</h3><ul>
<li>å¦‚æœé©±åŠ¨ç¨‹åºæ”¯æŒ<code>Magic Close</code>,é‚£ä¹ˆè®¾å¤‡å°†ä¸æ”¯æŒç¦ç”¨çœ‹é—¨ç‹—ï¼Œé™¤éåœ¨å…³é—­è®¾å¤‡æ–‡ä»¶å‰ï¼Œå‘/dev/watchdogä¸‹è®¾å¤‡æ–‡ä»¶å†™å…¥ç‰¹å®šçš„magic å­—ç¬¦ â€˜Vâ€™ã€‚å¦‚æœç”¨æˆ·ç©ºé—´çš„ daemonå…³é—­äº†çœ‹é—¨çš„è®¾å¤‡æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰å‘é€é‚£ä¸ªç‰¹å®šçš„å­—ç¬¦ï¼Œé©±åŠ¨ä¼šè®¤ä¸ºdaemonè¿›ç¨‹å·²ç»è¢«æ€ï¼Œå¹¶ä¸”åœæ­¢äº†å®šæœŸå–‚ç‹—è¡Œä¸ºã€‚è¿™æ ·ä¼šå¯¼è‡´è¶…æ—¶åç³»ç»Ÿé‡å¯ã€‚<h3 id="ioctl-API"><a href="#ioctl-API" class="headerlink" title="ioctl API"></a>ioctl API</h3></li>
<li>æ‰€æœ‰çš„é©±åŠ¨ç¨‹åºéƒ½æ”¯æŒioctl API</li>
<li><strong>å–‚ç‹—æ“ä½œä½¿ç”¨ioctlå®Œæˆ</strong></li>
<li>æ‰€æœ‰çš„é©±åŠ¨éƒ½è¦æ”¯æŒä¸€ä¸ªKEEPALIVEçš„ioctlå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥èµ·åˆ°å‘é©±åŠ¨å†™å…¥æ•°æ®ä¸€æ ·çš„ä½œç”¨ã€‚æ‰€ä»¥watchdog daemonçš„ä¸»å‡½æ•°å¾ªç¯å¯ä»¥è¿™æ ·å®ç°<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> while (1) &#123;</div><div class="line">	ioctl(fd, WDIOC_KEEPALIVE, 0);</div><div class="line">	sleep(10);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Setting-and-getting-the-timeout"><a href="#Setting-and-getting-the-timeout" class="headerlink" title="Setting and getting the timeout"></a>Setting and getting the timeout</h3><ul>
<li>æŸäº›é©±åŠ¨æ”¯æŒè¿è¡Œæ—¶é€šè¿‡SETTIMEOUT ioctlå‘½ä»¤ä¿®æ”¹è¶…æ—¶æ—¶é—´ï¼Œè¿™äº›é©±åŠ¨éƒ½æœ‰WDIOF<em>SETTIMEOUTçš„æ ‡å¿—ä½</em>ã€‚è¶…æ—¶æ—¶é—´æ˜¯ä¸€ä¸ªå•ä½ä¸ºç§’çš„æ•´æ•°ï¼Œé©±åŠ¨ç¨‹åºä¼šè¿”å›è¿™ä¸ªå˜é‡å®é™…è®¾ç½®çš„æ•°å€¼ï¼Œä½†æ˜¯ç”±äºç¡¬ä»¶é™åˆ¶ï¼Œè¿”å›çš„æ•°å€¼å¯èƒ½ä¸è®¾ç½®æ•°å€¼ä¸åŒã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">int timeout = 45;</div><div class="line">ioctl(fd, WDIOC_SETTIMEOUT, &amp;timeout);</div><div class="line">printf(&quot;The timeout was set to %d seconds\n&quot;, timeout);</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>è¿™ä¸ªå®ä¾‹æˆ–è®¸ä¼šè¾“å‡ºâ€The timeout was set to 60 secondsâ€ï¼Œå¦‚æœè®¾å¤‡è¶…æ—¶æ—¶é—´ä¸ºåˆ†é’Ÿã€‚</p>
</li>
<li><p>è‡ªä»2.4.18å†…æ ¸å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨GETTIMEOUT ioctlå‘½ä»¤ï¼Œè·å–è¶…æ—¶æ—¶é—´ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ioctl(fd, WDIOC_GETTIMEOUT, &amp;timeout);</div><div class="line"><span class="built_in">printf</span>(<span class="string">"The timeout was is %d seconds\n"</span>, timeout);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Pretimeouts"><a href="#Pretimeouts" class="headerlink" title="Pretimeouts"></a>Pretimeouts</h3><ul>
<li><p>ä¸€äº›çœ‹é—¨ç‹—å®šæ—¶å™¨å¯ä»¥åœ¨ç³»ç»Ÿé‡å¯å‰ä¸€æ®µæ—¶é—´è®¾ç½®ä¸€ä¸ªè§¦å‘å™¨ã€‚è¿™æ ·è¿è¡Œlinuxåœ¨ç³»ç»Ÿä»å‰è®°å½•ä¸€äº›é‡è¦çš„ä¿¡æ¯ï¼ˆåƒpanicä¿¡æ¯å’Œkernel coredumpsï¼‰ï¼Œå…·ä½“å¯ä»¥é€šè¿‡NMTã€ä¸­æ–­ç­‰æœºåˆ¶å®ç°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pretimeout = 10;</div><div class="line">ioctl(fd, WDIOC_SETPRETIMEOUT, &amp;pretimeout);</div></pre></td></tr></table></figure>
</li>
<li><p>è¯·æ³¨æ„ï¼Œpretimeout æ—¶é—´æ˜¯åœ¨ è¶…æ—¶å…³é—­ç³»ç»Ÿ ä¹‹å‰çš„ç§’æ•°ã€‚ä¸æ˜¯ç›´åˆ°å‘ç”Ÿpretimeout äº‹ä»¶çš„ç§’æ•°ã€‚ä¾‹å¦‚è®¾å®šçš„è¶…æ—¶æ—¶é—´æ˜¯60sï¼Œ pretimeoutæ˜¯10sã€‚pretimeoutäº‹ä»¶ä¼šåœ¨50sæ—¶å‘ç”Ÿã€‚pretimeoutè®¾ç½®ä¸º0ä»£è¡¨ç¦ç”¨pretimeoutã€‚</p>
</li>
<li><p>åŒæ ·å­˜åœ¨ä¸€ä¸ªè·å–pretimeoutçš„ioctlå‘½ä»¤ã€‚</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ioctl(fd, WDIOC_GETPRETIMEOUT, &amp;timeout);</div><div class="line">printf(&quot;The pretimeout was is %d seconds\n&quot;, timeout);</div></pre></td></tr></table></figure>
</li>
<li><p>ä¸æ˜¯æ‰€æœ‰çœ‹é—¨ç‹—é©±åŠ¨éƒ½æ”¯æŒ pretimeout</p>
</li>
</ul>
<h3 id="è·å–é‡å¯å‰ç§’æ•°"><a href="#è·å–é‡å¯å‰ç§’æ•°" class="headerlink" title="è·å–é‡å¯å‰ç§’æ•°"></a>è·å–é‡å¯å‰ç§’æ•°</h3><ul>
<li>ä¸€äº›çœ‹é—¨ç‹—é©±åŠ¨æ”¯æŒè·å–ç³»ç»Ÿé‡å¯å‰ç§’æ•°ã€‚é€šè¿‡WDIOC<em>GETTIMELEFT  ioctl  </em>å‘½ä»¤å¯ä»¥è¿”å›ç³»ç»Ÿé‡å¯å‰ç§’æ•°ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ioctl(fd, WDIOC_GETTIMELEFT, &amp;timeleft);</div><div class="line">printf(&quot;The timeout was is %d seconds\n&quot;, timeleft);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="ç¯å¢ƒç›‘æµ‹"><a href="#ç¯å¢ƒç›‘æµ‹" class="headerlink" title="ç¯å¢ƒç›‘æµ‹"></a>ç¯å¢ƒç›‘æµ‹</h3><ul>
<li><p>æ‰€æœ‰çš„çœ‹é—¨ç‹—é©±åŠ¨éƒ½è¢«è¦æ±‚è¿”å›æ›´å¤šå…³äºç³»ç»Ÿæœ€åä¸€æ¬¡é‡å¯çš„ä¿¡æ¯ï¼Œåƒæ˜¯æ¸©åº¦ã€é£æ‰‡è½¬é€Ÿã€ç”µæºç­‰ã€‚GETSUPPORT ioctl çš„å‘½ä»¤å¯ä»¥è¿”å› è®¾å¤‡å¯ä»¥æ”¯æŒçš„ä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">struct watchdog_info ident;</div><div class="line">ioctl(fd, WDIOC_GETSUPPORT, &amp;ident);</div></pre></td></tr></table></figure>
</li>
<li><p>è¿”å›çš„ç»“æ„identä¸­çš„å­—æ®µå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">   identity		æè¿°watchdog driverçš„å­—ç¬¦ä¸²</div><div class="line">firmware_version	the firmware version of the card if available</div><div class="line">options			è®¾å¤‡æ”¯æŒæƒ…å†µçš„æ ‡å¿—ä½</div></pre></td></tr></table></figure>
</li>
<li><p>optionsæè¿°äº†GET_STATUS å’ŒGET_BOOT<em>STATUS ioctlå‘½ä»¤</em>å¯ä»¥è¿”å›é‚£äº›ä¿¡æ¯ã€‚å¹¶ä¸”å¯ä»¥è®¾ç½®ã€‚ï¼ˆï¼‰<strong>??æ— æ³•ç†è§£ä»€ä¹ˆæ„æ€??</strong></p>
</li>
</ul>
<ul>
<li>WDIOF<em>OVERHEAT     cpuè¿‡çƒ­å¤ä½</em><br>ç³»ç»Ÿé‡å¯å› ä¸ºï¼Œè¶…è¿‡äº†æ¸©åº¦é™åˆ¶ä¸Šé™ã€‚</li>
<li><p>WDIOF<em>FANFAULT        é£æ‰‡å¤±æ•ˆå¤ä½</em></p>
</li>
<li><p>WDIOF<em>EXTERN1        External relay 1 </em><br>å¤–éƒ¨ç›‘æ§ç”µæº1è¢«è§¦å‘ï¼Œï¼Ÿï¼Ÿï¼ŸControllers intended for real world applications include external monitoring pins that will trigger a reset.ï¼Ÿï¼Ÿï¼ˆä¸æ˜ç™½ä»€ä¹ˆæ„æ€ï¼‰</p>
</li>
<li><p>WDIOF_EXTERN2        External relay 2<br>å¤–éƒ¨ç›‘æ§ç”µæº2è¢«è§¦å‘</p>
</li>
<li><p>WDIOF_POWERUNDER    ç”µæºåäº†ï¼Œç”µæºå¸¦ä¸åŠ¨äº†<br>æœºå™¨æ˜¾ç¤ºæ¬ å‹ã€‚</p>
</li>
</ul>
<hr>
<ul>
<li>åé¢ä¸€ç‚¹ä¸ç¿»äº†ï¼Œæœ‰æ—¶é—´å†æ·»å‘</li>
</ul>
<hr>
<ul>
<li><p>WDIOF_CARDRESET        Card previously reset the CPU<br>The last reboot was caused by the watchdog card</p>
</li>
<li><p>WDIOF_POWEROVER        Power over voltage<br>The machine is showing an overvoltage status. Note that if one level is under and one over both bits will be set - this may seem odd but makes sense.</p>
</li>
<li><p>WDIOF_KEEPALIVEPING    Keep alive ping reply<br>The watchdog saw a keepalive ping since it was last queried.</p>
</li>
<li><p>WDIOF_SETTIMEOUT    Can set/get the timeout<br>The watchdog can do pretimeouts.</p>
</li>
<li><p>WDIOF_PRETIMEOUT    Pretimeout (in seconds), get/set<br>For those drivers that return any bits set in the option field, the GETSTATUS and GETBOOTSTATUS ioctls can be used to ask for the current status, and the status at the last reboot, respectively.  </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int flags;</div><div class="line">ioctl(fd, WDIOC_GETSTATUS, &amp;flags);</div></pre></td></tr></table></figure>
<p>  or</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ioctl(fd, WDIOC_GETBOOTSTATUS, &amp;flags);</div></pre></td></tr></table></figure>
</li>
<li><p>Note that not all devices support these two calls, and some only support the GETBOOTSTATUS call.</p>
</li>
<li><p>Some drivers can measure the temperature using the GETTEMP ioctl.  The returned value is the temperature in degrees fahrenheit.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int temperature;</div><div class="line">ioctl(fd, WDIOC_GETTEMP, &amp;temperature);</div></pre></td></tr></table></figure>
</li>
<li><p>Finally the SETOPTIONS ioctl can be used to control some aspects of the cards operation.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int options = 0;</div><div class="line">ioctl(fd, WDIOC_SETOPTIONS, &amp;options);</div></pre></td></tr></table></figure>
</li>
<li><p>The following options are available:</p>
<ul>
<li>WDIOS_DISABLECARD    Turn off the watchdog timer</li>
<li>WDIOS_ENABLECARD    Turn on the watchdog timer</li>
<li>WDIOS_TEMPPANIC        Kernel panic on temperature trip</li>
</ul>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;éšæ‰‹ç¿»è¯‘çš„æ–‡æ¡£ï¼Œè¦çœ‹æ‡‚linuxå†…æ ¸ï¼Œå†…æ ¸é™„å¸¦çš„æ–‡æ¡£è‡ªç„¶æ˜¯é€ƒä¸è¿‡ğŸ˜‚ï¼Œå…¨è‹±æ–‡é…åˆGoogleç¿»è¯‘ä¹Ÿå¾—ä¸Šã€‚ã€‚ã€‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æœ€åæ›´æ–°æ—¶é—´ 10/05/2007&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;linuxçœ‹é—¨
    
    </summary>
    
      <category term="Linuxç¬”è®°" scheme="http://yoursite.com/categories/Linux%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="ç¿»è¯‘" scheme="http://yoursite.com/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="wdt" scheme="http://yoursite.com/tags/wdt/"/>
    
  </entry>
  
  <entry>
    <title>linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ</title>
    <link href="http://yoursite.com/2017/08/19/linux%E7%AC%94%E8%AE%B0%E2%80%94rtc%E5%AD%90%E7%B3%BB%E7%BB%9F/"/>
    <id>http://yoursite.com/2017/08/19/linuxç¬”è®°â€”rtcå­ç³»ç»Ÿ/</id>
    <published>2017-08-19T02:17:11.000Z</published>
    <updated>2017-09-10T01:51:07.106Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li>æ­£å¼å¼€å§‹è®©äººå´©æºƒçš„linuxç³»åˆ—ï¼Œå¸Œæœ›è‡ªå·±èƒ½å†™å®Œã€‚<br>å…ˆæ‹¿rtcå¼€åˆ€ã€‚</li>
<li><p>è¿™é‡Œæˆ‘å°½å¯èƒ½è®°å½•ä¸‹æ€ç»´çš„ç»†èŠ‚ï¼Œè€Œä¸æ˜¯ä»…å±€é™äºä»£ç ï¼Œå¸Œæœ›è‡ªå·±èƒ½é¢†ä¼šLinuxå†…æ ¸å¼€å‘è€…çš„æƒ³æ³•ã€‚</p>
</li>
<li><p>å†…æ ¸ç‰ˆæœ¬ï¼šlinux4.1</p>
</li>
<li>éœ€è¦äº†è§£ï¼šç®€ç•¥äº†è§£å­—ç¬¦é©±åŠ¨ å’Œ Linuxè®¾å¤‡é©±åŠ¨æ¨¡å‹</li>
</ul>
<hr>
<h3 id="RTC"><a href="#RTC" class="headerlink" title="RTC"></a>RTC</h3><ul>
<li>rtcå³real time clockï¼Œå®æ—¶æ—¶é’Ÿã€‚</li>
<li>rtcä¸€èˆ¬è´Ÿè´£ç³»ç»Ÿå…³æœºåè®¡æ—¶ï¼Œé¢å¯¹ç¹å¤šçš„Linux RTCè®¾å¤‡ï¼Œå†…æ ¸å¹²è„†æä¾›äº†ä¸€ä¸ªrtcå­ç³»ç»Ÿï¼Œæ¥æ”¯æŒæ‰€æœ‰çš„rtcè®¾å¤‡ã€‚</li>
<li>å‚è€ƒèµ„æ–™ </li>
</ul>
<h3 id="rtcå­ç³»ç»Ÿ"><a href="#rtcå­ç³»ç»Ÿ" class="headerlink" title="rtcå­ç³»ç»Ÿ"></a>rtcå­ç³»ç»Ÿ</h3><ul>
<li>rtcè®¾å¤‡æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ï¼Œrtcå­ç³»ç»Ÿåœ¨å­—ç¬¦è®¾å¤‡çš„åŸºç¡€ä¸ŠæŠ½è±¡ä¸ç¡¬ä»¶æ— å…³çš„éƒ¨åˆ†ï¼Œå¹¶åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ‹“å±•sysfså’Œprocæ–‡ä»¶ç³»ç»Ÿä¸‹çš„è®¿é—®ã€‚</li>
<li>åˆ†ææ—¶å€™å§‹ç»ˆè®°ä½ä¸¤ç‚¹ï¼š<ul>
<li>rtcå­ç³»ç»Ÿæ˜¯ä¸ºäº†è®©rtcè®¾å¤‡é©±åŠ¨ç¼–å†™æ›´ä¸ºç®€å•ï¼Œä¸ç¡¬ä»¶æ— å…³éƒ¨åˆ†å·²è¢«æŠ½ç¦»ã€‚</li>
<li>rtcå­ç³»ç»Ÿæ˜¯åŸºäºå­—ç¬¦è®¾å¤‡è€Œæ¥çš„ã€‚<h3 id="æ–‡ä»¶æ¡†æ¶"><a href="#æ–‡ä»¶æ¡†æ¶" class="headerlink" title="æ–‡ä»¶æ¡†æ¶"></a>æ–‡ä»¶æ¡†æ¶</h3></li>
</ul>
</li>
<li><p>rtcå­ç³»ç»Ÿçš„æºç åœ¨ /drivers/rtc<br><img src="https://my.mixtape.moe/anynhb.jpg" alt="1.jpg"><br>åˆ å‡äº†å¾ˆå¤šrtc-xxx.cçš„é©±åŠ¨ï¼Œåªç•™ä¸‹äº†ds1307ä½œä¸ºç¤ºä¾‹ï¼Œè¿™é‡Œçœ‹åˆ°å®é™…ä¸Šä»£ç å¹¶ä¸å¤šã€‚</p>
</li>
<li><p>å…·ä½“æ–‡ä»¶åˆ†æ</p>
<ul>
<li><p>rtc.hï¼šå®šä¹‰ä¸RTCæœ‰å…³çš„æ•°æ®ç»“æ„ã€‚</p>
</li>
<li><p>class.cï¼šå‘å†…æ ¸æ³¨å†ŒRTCç±»ï¼Œä¸ºåº•å±‚é©±åŠ¨æä¾›rtc_device_registerä¸rtc_device_unregisteræ¥å£ç”¨äºRTCè®¾å¤‡çš„æ³¨å†Œ/æ³¨é”€ã€‚åˆå§‹åŒ–RTCè®¾å¤‡ç»“æ„ã€sysfsã€procã€‚</p>
</li>
<li>Interface.cï¼šæä¾›ç”¨æˆ·ç¨‹åºä¸RTCçš„æ¥å£å‡½æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬ioctlå‘½ä»¤ã€‚</li>
<li>rtc-dev.cï¼šå°†RTCè®¾å¤‡æŠ½è±¡ä¸ºé€šç”¨çš„å­—ç¬¦è®¾å¤‡ï¼Œæä¾›æ–‡ä»¶æ“ä½œå‡½æ•°é›†ã€‚</li>
<li>rtc-sysfs.cï¼šç®¡ç†RTCè®¾å¤‡çš„sysfså±æ€§ï¼Œè·å–RTCè®¾å¤‡åã€æ—¥æœŸã€æ—¶é—´ç­‰ã€‚</li>
<li>rtc-proc.cï¼šç®¡ç†RTCè®¾å¤‡çš„procfså±æ€§ï¼Œæä¾›ä¸­æ–­çŠ¶æ€å’Œæ ‡å¿—æŸ¥è¯¢ã€‚</li>
<li>rtc-lib.cï¼šæä¾›RTCã€Dataå’ŒTimeä¹‹é—´çš„è½¬æ¢å‡½æ•°ã€‚</li>
<li>rtc-xxx,cï¼šRTCè®¾å¤‡çš„å®é™…é©±åŠ¨ï¼Œæ­¤å¤„ä»¥rtc-ds1307ä¸ºä¾‹ã€‚</li>
<li>hctosys.cï¼šå¼€æœºæ—¶è·å–RTCæ—¶é—´ã€‚</li>
</ul>
</li>
<li><p>æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿæ¡†æ¶<br><img src="https://my.mixtape.moe/fdixml.jpg" alt=""></p>
</li>
<li><p>RTCå­ç³»ç»Ÿå…·ä½“å¯åˆ†ä¸º3å±‚ï¼š</p>
<ul>
<li>ç”¨æˆ·å±‚ï¼šRTCå­ç³»ç»Ÿå‘ä¸Šå±‚æä¾›äº†æ¥å£ï¼Œç”¨æˆ·é€šè¿‡è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œé—´æ¥è°ƒç”¨RTCè®¾å¤‡ï¼Œå…·ä½“æœ‰3ç§æ–¹å¼ã€‚<ul>
<li>/dev/rtc  RTCè®¾å¤‡æŠ½è±¡è€Œæ¥çš„å­—ç¬¦è®¾å¤‡ï¼Œå¸¸è§„æ–‡ä»¶æ“ä½œé›†åˆã€‚</li>
<li>/sys/class/rtc/rtcx é€šè¿‡sysfsæ–‡ä»¶ç³»ç»Ÿè¿›è¡ŒRTCæ“ä½œï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚</li>
<li>/proc/driver/rtc  é€šè¿‡procæ–‡ä»¶ç³»ç»Ÿè·å–RTCç›¸å…³ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li>RTCæ ¸å¿ƒå±‚ï¼šä¸ç¡¬ä»¶æ— å…³ï¼Œç”¨äºç®¡ç†RTCè®¾å¤‡æ³¨å†Œ/æ³¨é”€ã€æä¾›ä¸Šå±‚æ–‡ä»¶æ“ä½œçš„æ¥å£ç­‰ã€‚</li>
<li>RTCé©±åŠ¨ï¼šç‰¹å®šRTCè®¾å¤‡çš„é©±åŠ¨ç¨‹åºï¼Œå®ç°RTCæ ¸å¿ƒå±‚çš„å›æ‰å‡½æ•°ã€‚ç¼–å†™RTCé©±åŠ¨éœ€è¦æŒ‰ç…§RTCå­ç³»ç»Ÿçš„æ¥å£å¡«å†™å¯¹åº”å‡½æ•°å¹¶å»ºç«‹æ˜ å°„å³å¯ã€‚RTCæ ¸å¿ƒå±‚å‡½æ•°å®ç°çš„è¿‡ç¨‹å’Œæ•°é‡ä¸ç‰¹å®šç¡¬ä»¶ç´§å¯†ç›¸å…³ã€‚</li>
</ul>
</li>
</ul>
<ul>
<li>åˆçœ‹linuxç³»ç»Ÿçš„äººæ¥è¯´ï¼Œè¿™ä¸ªå›¾å¤Ÿå¤´æ™•çš„äº†ï¼Œä½†æ˜¯å‘¢ï¼Œå®é™…ä¸Šæ²¡é‚£ä¹ˆéº»çƒ¦ã€‚ç”±æµ…å…¥æ·±ï¼Œä¸€ç‚¹ä¸€ç‚¹æ¥åˆ†æã€‚</li>
</ul>
<h3 id="rtcå­ç³»ç»Ÿåˆ†æ"><a href="#rtcå­ç³»ç»Ÿåˆ†æ" class="headerlink" title="rtcå­ç³»ç»Ÿåˆ†æ"></a>rtcå­ç³»ç»Ÿåˆ†æ</h3><h4 id="rtc-dev"><a href="#rtc-dev" class="headerlink" title="rtc-dev"></a>rtc-dev</h4><ul>
<li>rtcå­ç³»ç»ŸåŸºäºå­—ç¬¦è®¾å¤‡ï¼Œå­—ç¬¦è®¾å¤‡å¯¹åº”çš„è‚¯å®šæ˜¯rtc-dev.cäº†ï¼Œæˆ‘ä»¬çš„åˆ†æç”±rtc-devèµ·æ­¥ã€‚</li>
<li><p>rtc-dev.c<br><img src="https://my.mixtape.moe/ukpdro.jpg" alt=""></p>
</li>
<li><p>å…¸å‹çš„å­—ç¬¦è®¾å¤‡ï¼Œæ¨¡å—çš„åˆå§‹åŒ–/å¸è½½è‡ªç„¶æ˜¯ rtc_dev_init(void) å’Œ  rtc_dev_exit(void)ã€‚<br>è®¾å¤‡æ¥å…¥ï¼Œæ·»åŠ /åˆ é™¤è®¾å¤‡ rtc_dev_add_device(struct rtc_device <em>rtc) å’Œ  e)    void rtc_dev_del_device(struct rtc_device </em>rtc)<br>è¿˜æœ‰ioctlå’Œopenç­‰å‡½æ•°ï¼Œç†Ÿæ‚‰å­—ç¬¦è®¾å¤‡é©±åŠ¨çš„ä¸ç”¨å¤šè¯´ã€‚</p>
</li>
<li><p>è¿½è¸ªä¸€ä¸‹è¿™ä¸¤ç»„å‡½æ•°åœ¨å“ªé‡Œè°ƒç”¨çš„ã€‚</p>
<ul>
<li>rtc_dev_init(void)å¯¹åº”åœ¨ class.cçš„rtc_init(void)å‡½æ•°</li>
<li>rtc_dev_add_deviceå¯¹åº”åœ¨class.cçš„ rtc_device_register()å‡½æ•°ã€‚</li>
</ul>
</li>
<li><p>rtc_dev_init(void)å¯¹åº”å®åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶ä½¿ç”¨ï¼Œå¯¹åº”rtc_init(void)ä¹Ÿæ˜¯åœ¨ç³»ç»Ÿåˆå§‹åŒ–ä¹‹åè°ƒç”¨ã€‚</p>
</li>
<li>rtc_dev_add_device()æ˜¯åœ¨é©±åŠ¨åŒ¹é…åè°ƒç”¨ï¼Œrtc_device_register()ä¹Ÿæ˜¯åœ¨é©±åŠ¨åŒ¹é…åè°ƒç”¨ã€‚æ‰“å¼€rtc-ds1307.c&gt;-probå‡½æ•°ï¼Œèƒ½æ‰¾åˆ°rtc_device_register()ä¹Ÿå°±è¯å®äº†è¿™ä¸ªæ€è·¯ã€‚</li>
<li>æ¥ä¸‹æ¥è½¬å…¥class.c</li>
</ul>
<h4 id="class-c"><a href="#class-c" class="headerlink" title="class.c"></a>class.c</h4><ul>
<li><p>linuxé©±åŠ¨æ¨¡å‹ä¸­class.cå¯¹åº”ç±»çš„æ„æ€ï¼Œæ˜¯rtcç±»ã€‚<br>æ¯ä¸ªclasså¯¹åº”éƒ½æœ‰è‡ªå·±æ ¸å¿ƒæ•°æ®ç»“æœï¼Œå¯¹åº”rtcç±»å°±æ˜¯rtc-device</p>
</li>
<li><p>rtc_device<br> rtc_deviceä»£è¡¨ RTCè®¾å¤‡åŸºç¡€çš„æ•°æ®ç»“æ„</p>
<ul>
<li>æ•°æ®ç»“æ„<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">rtc_device</span>  &#123;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">device</span> <span class="title">dev</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">module</span> *<span class="title">owner</span>;</span>  </div><div class="line">   <span class="keyword">int</span> id;                                   <span class="comment">//RTCè®¾å¤‡çš„æ¬¡è®¾å¤‡å·  </span></div><div class="line">   <span class="keyword">char</span> name[RTC_DEVICE_NAME_SIZE];  </div><div class="line">   <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rtc_class_ops</span> *<span class="title">ops</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">ops_lock</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">cdev</span> <span class="title">char_dev</span>;</span>  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">long</span> flags;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">long</span> irq_data;  </div><div class="line">   <span class="keyword">spinlock_t</span> irq_lock;  </div><div class="line">   <span class="keyword">wait_queue_head_t</span> irq_queue;  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">fasync_struct</span> *<span class="title">async_queue</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">rtc_task</span> *<span class="title">irq_task</span>;</span>  </div><div class="line">   <span class="keyword">spinlock_t</span> irq_task_lock;  </div><div class="line">   <span class="keyword">int</span> irq_freq;  </div><div class="line">   <span class="keyword">int</span> max_user_freq;  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RTC_INTF_DEV_UIE_EMUL  </span></div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">work_struct</span> <span class="title">uie_task</span>;</span>  </div><div class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">timer_list</span> <span class="title">uie_timer</span>;</span>  </div><div class="line">   <span class="comment">/* Those fields are protected by rtc-&gt;irq_lock */</span>  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> oldsecs;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> uie_irq_active:<span class="number">1</span>;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> stop_uie_polling:<span class="number">1</span>;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> uie_task_active:<span class="number">1</span>;  </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> uie_timer_active:<span class="number">1</span>;  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>å¾ˆé•¿ï¼Ÿå¾ˆğŸ˜µå¯¹ä¸å¯¹ï¼Ÿåªè¦å…³æ³¨ä¸€ç‚¹å°±è¡Œ_</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">int id;                                              //ä»£è¡¨æ˜¯é‚£ä¸ªrtcè®¾å¤‡  </div><div class="line">char name[RTC_DEVICE_NAME_SIZE];                     //ä»£è¡¨rtcè®¾å¤‡çš„åç§°  </div><div class="line">const struct rtc_class_ops *ops;                     //rtcæ“ä½œå‡½æ•°é›†ï¼Œéœ€è¦é©±åŠ¨å®ç°  </div><div class="line">struct mutex ops_lock;                               //æ“ä½œå‡½æ•°é›†çš„äº’æ–¥é”  </div><div class="line">  </div><div class="line">struct cdev char_dev;                                //ä»£è¡¨rtcå­—ç¬¦è®¾å¤‡ï¼Œå› ä¸ºrtcå°±æ˜¯ä¸ªå­—ç¬¦è®¾å¤‡  </div><div class="line">unsigned long flags;                                 //rtcçš„çŠ¶æ€æ ‡å¿—ï¼Œä¾‹å¦‚RTC_DEV_BUSY</div></pre></td></tr></table></figure>
</li>
<li><p>ä¸Šæ–‡ä¹¦è¯´åˆ°ï¼Œé©±åŠ¨ç¨‹åºçš„probå‡½æ•°é‡Œé¢è°ƒç”¨äº†rtc_device_register()è¿™è´§çš„ç±»å‹å°±æ˜¯rtc_deviceã€‚å‚åŠ é©±åŠ¨ç¨‹åºæ€æ ·è°ƒç”¨rtc_device<em>register(),</em>ä¸å…¶ä»–æ ¸å¿ƒçš„åŸºæœ¬ç»“æ„ä¸åŒçš„æ˜¯ï¼Œé©±åŠ¨ç¨‹åºä»¥ä¸æ˜¯ä»¥rtc-deviceä¸ºå‚æ•°æ³¨å†Œè®¾å¤‡åˆ°å­ç³»ç»Ÿï¼Œè€Œæ˜¯æ³¨å†Œå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªrtc<em>deivceçš„ç»“æ„ç»™é©±åŠ¨ã€‚</em></p>
</li>
</ul>
</li>
<li><p>rtc_class_ops<br>  è¿™ä¸ªæ˜¯rtc<em>deviceçš„ä¸€éƒ¨åˆ†ã€‚</em></p>
<ul>
<li><p>æ•°æ®ç»“æ„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">   struct rtc_class_ops &#123;  </div><div class="line">   int (*open)(struct device *);     //æ‰“å¼€è®¾å¤‡æ—¶çš„å›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥åˆå§‹åŒ–ç¡¬ä»¶å¹¶ç”³è¯·èµ„æº  </div><div class="line">   void (*release)(struct device *); //è¿™ä¸ªå‡½æ•°æ˜¯è®¾å¤‡å…³é—­æ—¶è¢«è°ƒç”¨çš„ï¼Œåº”è¯¥æ³¨é”€ç”³è¯·çš„èµ„æº  </div><div class="line">   int (*ioctl)(struct device *, unsigned int, unsigned long); //ioctlå‡½æ•°ï¼Œå¯¹æƒ³è®©RTCè‡ªå·±å®ç°çš„å‘½ä»¤åº”è¿”å›ENOIOCTLCMD  </div><div class="line">   int (*read_time)(struct device *, struct rtc_time *);       //è¯»å–æ—¶é—´  </div><div class="line">   int (*set_time)(struct device *, struct rtc_time *);        //è®¾ç½®æ—¶é—´  </div><div class="line">   int (*read_alarm)(struct device *, struct rtc_wkalrm *);    //è¯»å–ä¸‹ä¸€æ¬¡å®šæ—¶ä¸­æ–­çš„æ—¶é—´  </div><div class="line">   int (*set_alarm)(struct device *, struct rtc_wkalrm *);     //è®¾ç½®ä¸‹ä¸€æ¬¡å®šæ—¶ä¸­æ–­çš„æ—¶é—´  </div><div class="line">   int (*proc)(struct device *, struct seq_file *);            //procfsæ¥å£  </div><div class="line">   int (*set_mmss)(struct device *, unsigned long secs);       //å°†ä¼ å…¥çš„å‚æ•°secsè½¬æ¢ä¸ºstruct rtc_timeç„¶åè°ƒç”¨set_timeå‡½æ•°ã€‚ç¨‹åºå‘˜å¯ä»¥ä¸å®ç°è¿™ä¸ªå‡½æ•°ï¼Œä½†  å‰ææ˜¯å®šä¹‰å¥½äº†read_time/set_timeï¼Œå› ä¸ºRTCæ¡†æ¶éœ€è¦ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚  </div><div class="line">   int (*irq_set_state)(struct device *, int enabled);         //å‘¨æœŸé‡‡æ ·ä¸­æ–­çš„å¼€å…³ï¼Œæ ¹æ®enabledçš„å€¼æ¥è®¾ç½®  </div><div class="line">   int (*irq_set_freq)(struct device *, int freq);             //è®¾ç½®å‘¨æœŸä¸­æ–­çš„é¢‘ç‡  </div><div class="line">   int (*read_callback)(struct device *, int data);            ///ç”¨æˆ·ç©ºé—´è·å¾—æ•°æ®åä¼šä¼ å…¥è¯»å–çš„æ•°æ®ï¼Œå¹¶ç”¨è¿™ä¸ªå‡½æ•°è¿”å›çš„æ•°æ®æ›´æ–°æ•°æ®ã€‚  </div><div class="line">   int (*alarm_irq_enable)(struct device *, unsigned int enabled);  //alarmä¸­æ–­ä½¿èƒ½å¼€å…³ï¼Œæ ¹æ®enabledçš„å€¼æ¥è®¾ç½®  </div><div class="line">   int (*update_irq_enable)(struct device *, unsigned int enabled); //æ›´æ–°ä¸­æ–­ä½¿èƒ½å¼€å…³ï¼Œæ ¹æ®enabledçš„å€¼æ¥è®¾ç½®  </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>è¯¥ç»“æ„ä½“ä¸­å‡½æ•°å¤§å¤šæ•°éƒ½æ˜¯å’ŒrtcèŠ¯ç‰‡çš„æ“ä½œæœ‰å…³ï¼Œéœ€è¦é©±åŠ¨ç¨‹åºå®ç°ã€‚<br>æ‰€æœ‰RTCé©±åŠ¨éƒ½å¿…é¡»å®ç°read_timeã€set_timeå‡½æ•°ï¼Œå…¶ä»–å‡½æ•°å¯é€‰ã€‚</p>
</li>
</ul>
</li>
<li><p>å‚è€ƒå…¶ä»–çš„èµ„æ–™ï¼Œclassçš„åˆ†æå¦‚ä¸‹<br><img src="https://my.mixtape.moe/xrsnkw.jpg" alt=""></p>
</li>
<li><p>static int __init rtc_init(void)</p>
<ul>
<li>è°ƒç”¨class_createåˆ›å»ºRTCç±»ï¼Œåˆ›å»º/sys/class/rtcç›®å½•ï¼Œåˆå§‹åŒ–RTCç±»ç›¸å…³æˆå‘˜ï¼Œå‘ç”¨æˆ·ç©ºé—´æä¾›è®¾å¤‡ä¿¡æ¯ã€‚</li>
<li>è°ƒç”¨rtc-dev.cå®ç°çš„rtc_dev_init();åŠ¨æ€åˆ†é…RTCå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ã€‚</li>
<li>è°ƒç”¨rtc_sysfs_init(rtc<em>class)ï¼›åˆ›å»º/sys/class/rtcä¸‹å±æ€§æ–‡ä»¶</em></li>
</ul>
</li>
<li><p>static void __exit rtc<em>exit(void)</em></p>
<ul>
<li>è°ƒç”¨rtc-dev.cå®ç°çš„rtc_dev_exit()ï¼›æ³¨é”€è®¾å¤‡å·ã€‚</li>
<li>è°ƒç”¨class_destroy(rtc_class)ï¼›æ³¨é”€/sys/classä¸‹çš„rtcç›®å½•</li>
</ul>
</li>
</ul>
<ul>
<li>struct rtc_device <em>rtc_device_register(const char </em>name, struct device <em>dev,const struct rtc_class_ops </em>ops,struct module *ownerï¼‰_<ul>
<li>ç”³è¯·ä¸€ä¸ªidræ•´æ•°IDç®¡ç†æœºåˆ¶ç»“æ„ä½“ï¼Œå¹¶ä¸”åˆå§‹åŒ–ç›¸å…³æˆå‘˜</li>
<li>å°†è®¾å¤‡devå…³è”sysfsä¸‹çš„rtcç±»</li>
<li>åˆå§‹åŒ–rtcç»“æ„ä½“çš„ä¿¡å·é‡</li>
<li>åˆå§‹åŒ–rtcç»“æ„ä½“ä¸­çš„ä¸­æ–­</li>
<li>è®¾ç½®rtcçš„åå­—</li>
<li>åˆå§‹åŒ–rtcå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ï¼Œç„¶åæ³¨å†Œrtcè®¾å¤‡,è‡ªåŠ¨åˆ›å»º/dev/rtc(n)è®¾å¤‡èŠ‚ç‚¹æ–‡ä»¶</li>
<li>æ³¨å†Œå­—ç¬¦è®¾å¤‡</li>
<li>åœ¨/sys/rtc/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªé—¹é’Ÿå±æ€§æ–‡ä»¶</li>
<li>åˆ›å»º/proc/driver/rtcç›®å½•</li>
</ul>
</li>
<li>void rtc_device_unregister(struct rtc_device *rtc)<ul>
<li>åˆ é™¤sysfsä¸­çš„rtcè®¾å¤‡,å³åˆ é™¤/sys/class/rtcç›®å½•</li>
<li>åˆ é™¤devä¸‹çš„/dev/rtc(n)è®¾å¤‡èŠ‚ç‚¹æ–‡ä»¶</li>
<li>åˆ é™¤è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ¥å£,å³åˆ é™¤/proc/driver/rtcç›®å½•</li>
<li>å¸è½½å­—ç¬¦è®¾å¤‡</li>
<li>æ¸…ç©ºrtcçš„æ“ä½œå‡½æ•°æŒ‡é’ˆrtc-&gt;ops</li>
<li>é‡Šæ”¾rtcçš„deviceç»“æ„ä½“_</li>
</ul>
</li>
<li>static void rtc_device_release(struct device <em>dev)    </em><ul>
<li>å¸è½½idræ•°å­—ç®¡ç†æœºåˆ¶ç»“æ„ä½“</li>
<li>é‡Šæ”¾rtcç»“æ„ä½“çš„å†…å­˜</li>
</ul>
</li>
</ul>
<h4 id="Rtcå­ç³»ç»Ÿåˆå§‹åŒ–"><a href="#Rtcå­ç³»ç»Ÿåˆå§‹åŒ–" class="headerlink" title="Rtcå­ç³»ç»Ÿåˆå§‹åŒ–"></a>Rtcå­ç³»ç»Ÿåˆå§‹åŒ–</h4><ul>
<li>ä¸Šå›¾<br><img src="https://my.mixtape.moe/driyxr.jpg" alt=""></li>
</ul>
<ul>
<li>ä½¿ç”¨rtcå­ç³»ç»Ÿé¦–å…ˆéœ€è¦åœ¨å†…æ ¸ç¼–è¯‘é€‰é¡¹ä¸­å¯ç”¨RTCå­ç³»ç»Ÿæ”¯æŒã€‚<ul>
<li>å¿…é¡»å¯ç”¨Real Time Clock</li>
<li>ä½¿ç”¨/devä¸‹çš„è®¾å¤‡æ–‡ä»¶å¯¹åº”å¼€å¯CONFIG_RTC_INTF_DEV</li>
<li>ä½¿ç”¨/procä¸‹çš„æ¥å£å¯¹åº”å¼€å¯CONFIG_RTC_INTF_PROC</li>
<li>ä½¿ç”¨/sysfsä¸‹çš„æ¥å£å¯¹åº”å¼€å¯CONFIG_RTC_INTF_SYSFS</li>
</ul>
</li>
<li>_ç³»ç»Ÿå¯åŠ¨åï¼Œå¦‚é…ç½®å¯ç”¨rtcå­ç³»ç»Ÿï¼Œåˆ™ä¼šé¦–å…ˆæ‰§è¡Œrtc<em>init</em>å‡½æ•°ï¼Œåˆ›å»ºrtcç±»ã€åˆå§‹åŒ–ç›¸å…³æˆå‘˜ã€åˆ†é…è®¾å¤‡å·ç­‰</li>
<li>åˆ›å»ºrtcç±»åï¼Œä¹‹åè°ƒç”¨rtc_dev_init()åŠ¨æ€åˆ†é…rtcå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ã€‚ä¹‹åè°ƒç”¨rtc_sysfs_init()åˆå§‹åŒ–/sys/class/rtcç›®å½•ä¸­çš„å±æ€§æ–‡ä»¶</li>
</ul>
<h4 id="Rtcè®¾å¤‡æ³¨å†Œ"><a href="#Rtcè®¾å¤‡æ³¨å†Œ" class="headerlink" title="Rtcè®¾å¤‡æ³¨å†Œ"></a>Rtcè®¾å¤‡æ³¨å†Œ</h4><ul>
<li>Rtcè®¾å¤‡æœ¬è´¨ä¸Šå±äºå­—ç¬¦è®¾å¤‡ï¼Œä¾é™„äºç³»ç»Ÿå†…æ€»çº¿ã€‚ä¸€èˆ¬æ¥è¯´cpuå†…éƒ¨rtcä¾é™„äºplatformæ€»çº¿ï¼Œå¤–ç½®rtcèŠ¯ç‰‡åˆ™ä¾é™„äºé€šä¿¡æ–¹å¼å¯¹åº”æ€»çº¿ã€‚å…¶è¿‡ç¨‹ä¸é€šç”¨å­—ç¬¦è®¾å¤‡ç›¸ä¼¼ï¼Œrtcå­ç³»ç»Ÿåœ¨è®¾å¤‡æ³¨å†Œè¿‡ç¨‹ä¸­é™„åŠ äº†probå’Œsysfsç›¸å…³çš„æ³¨å†Œå’Œåˆå§‹åŒ–æ“ä½œã€‚</li>
<li><p>ä¸Šå›¾<br><img src="https://my.mixtape.moe/urumgu.jpg" alt=""></p>
<ul>
<li>Rtcè®¾å¤‡æŒ‚è½½åï¼Œç›¸åº”æ€»çº¿ä¼šæœç´¢åŒ¹é…çš„é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ç¨‹åºæˆåŠŸmatchåï¼Œè¿›å…¥é©±åŠ¨å®ç°çš„probeå‡½æ•°ï¼Œæ‰§è¡Œè®¾å¤‡æ³¨å†Œç­‰æ“ä½œã€‚</li>
</ul>
</li>
<li>å®Œæˆæ€»çº¿è®¾å¤‡æ³¨å†Œåï¼Œprobeä¼šè·³è½¬åˆ°rtc_device_register()å‡½æ•°ï¼Œå°†è®¾å¤‡æ³¨å†Œåˆ°rtcå­ç³»ç»Ÿã€‚</li>
<li>Rtcè®¾å¤‡æœ¬è´¨å±äºå­—ç¬¦è®¾å¤‡ï¼Œä¼šè°ƒç”¨rtc_dev_prepare()å‡½æ•°ï¼Œåˆå§‹åŒ–å­—ç¬¦è®¾å¤‡ï¼Œè®¾ç½®rtcç›¸å…³çš„file operationå‡½æ•°é›†åˆã€‚</li>
<li>ä¹‹åä¾æ¬¡è°ƒç”¨rtc_dev_add_device(rtc)ã€rtc_sysfs_add_device(rtc)ã€rtc_proc_add_device(rtc) ï¼Œè¿›è¡Œæ³¨å†Œå­—ç¬¦è®¾å¤‡ã€åœ¨/sys/rtc/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªé—¹é’Ÿå±æ€§æ–‡ä»¶ã€åˆ›å»º/proc/driver/rtcç›®å½•ç­‰æ“ä½œã€‚</li>
<li>rtc_device_register()ä¼šå°†é©±åŠ¨å®ç°çš„rtc_class_opsç»“æ„ä½“ä¸å…·ä½“è®¾å¤‡è”ç³»èµ·æ¥ã€‚</li>
</ul>
<h4 id="interface-c"><a href="#interface-c" class="headerlink" title="interface.c"></a>interface.c</h4><ul>
<li>åœ¨rtc-proc.cã€rtc_sysfså’Œioctlå‘½ä»¤ä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œè°ƒç”¨çš„éƒ½æ˜¯interface.cæä¾›çš„æ¥å£ï¼Œè¿™é‡Œä»¥ioctlçš„ä¸€ä¸ªä¾‹å­è¯´æ˜æ•´ä¸ªè°ƒç”¨çš„è¿‡ç¨‹</li>
<li><p>ä¸Šå›¾<br><img src="https://my.mixtape.moe/bvtlqf.jpg" alt=""></p>
</li>
<li><p>ä»¥icotlå‘½ä»¤RTC_RD_TIMEä¸ºä¾‹ï¼Œè¯´æ˜å‘½ä»¤è°ƒç”¨çš„æµç¨‹ã€‚</p>
<ul>
<li>RTC_RD_TIMEå¯¹åº”çš„æ˜¯/devä¸‹ioctlå‘½ä»¤ï¼Œè°ƒç”¨è¢«è½¬å‘è‡³/rtc-dev.c</li>
<li>rtc-dev.c-&gt;rtc_dev_ioctl(struct file *file,unsigned int cmd, unsigned long arg)å‡½æ•°ä¸­ã€‚RTC_RD_TIMEå¯¹åº”çš„ä»£ç ä¸ºerr = rtc_read_time(rtc, &amp;tm); rtc_read_timeæ˜¯interface.cæ–‡ä»¶æä¾›çš„æ¥å£ä¹‹ä¸€ã€‚</li>
<li>interface.c-&gt;rtc_read_time(struct rtc_device <em>rtc, struct rtc_time </em>tm)å‡½æ•°ä¸­å¯¹åº”rtc_class_opsè½¬å‘ä»£ç ä¸ºerr = rtc-&gt;ops-&gt;read_time(rtc-&gt;dev.parent, tm);å°†æ“ä½œè½¬å‘è‡³åŒ¹é…çš„rtcè®¾å¤‡ã€‚</li>
<li><p>è®¾å¤‡é©±åŠ¨è¿™é‡Œä»¥rtc-ds1307ä¸ºä¾‹ï¼Œä½†è®¾å¤‡æ³¨å†Œæ—¶é€šè¿‡mcp794xx_rtc_opsç»“æ„ä½“å°†rtc_class_opså¯¹åº”å‡½æ•°ä¸é©±åŠ¨ç¨‹åºå®ç°çš„å‡½æ•°ç»‘å®š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">static const struct rtc_class_ops mcp794xx_rtc_ops = &#123;</div><div class="line">.read_time  = ds1307_get_time,</div><div class="line">.set_time   = ds1307_set_time,</div><div class="line">.read_alarm = mcp794xx_read_alarm,</div><div class="line">.set_alarm  = mcp794xx_set_alarm,</div><div class="line">.alarm_irq_enable = mcp794xx_alarm_irq_enable,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>æœ€ç»ˆæ‰§è¡Œè½¬å…¥ds1307.c-&gt; ds1307_get_timeå‡½æ•°ï¼Œæ‰§è¡Œä¸ç¡¬ä»¶ç›¸å…³çš„æ“ä½œã€‚</p>
<h4 id="rtc-sysfs-c"><a href="#rtc-sysfs-c" class="headerlink" title="rtc-sysfs.c"></a>rtc-sysfs.c</h4></li>
</ul>
</li>
<li><p>ç”±å‰åŠéƒ¨åˆ†å¯çŸ¥ï¼Œ/sys/class/rtc/æ˜¯åœ¨rtc-initè°ƒç”¨rtc_sysfs_initåç”Ÿæˆã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">void __init rtc_sysfs_init(struct class *rtc_class) &#123;</div><div class="line">	rtc_class-&gt;dev_groups = rtc_groups;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>è¿™é‡Œçš„rtc_groupsæ˜¯rtc-sysfs.cä¸­å®šä¹‰äº†è¿™æ ·ä¸€ä¸ªattributeå‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">static struct attribute *rtc_attrs[] = &#123;</div><div class="line">&amp;dev_attr_name.attr,</div><div class="line">&amp;dev_attr_date.attr,</div><div class="line">&amp;dev_attr_time.attr,</div><div class="line">&amp;dev_attr_since_epoch.attr,</div><div class="line">&amp;dev_attr_max_user_freq.attr,</div><div class="line">&amp;dev_attr_hctosys.attr,</div><div class="line">NULL,</div><div class="line">&#125;;</div><div class="line">ATTRIBUTE_GROUPS(rtc);</div></pre></td></tr></table></figure>
</li>
<li><p>_åœ¨rtc_sysfs_initå‡½æ•°è°ƒç”¨åç»‘å®šäº†sysfsèŠ‚ç‚¹æ“ä½œå‡½æ•°çš„é›†åˆï¼Œä½¿å¾—è®¾å¤‡åŒ¹é…é©±åŠ¨ç¨‹åºåè€Œç”Ÿæˆå¯¹åº”çš„rtcnæ–‡ä»¶å¤¹ã€‚</p>
</li>
<li><code>dev_attr_nameå’Œdev_attr_data</code>ç”±å®<code>DEVICE_ATTR_RO</code>å’ŒDEVICE_ATTR_RWç”Ÿæˆï¼Œä»–ä»¬åˆ†åˆ«å®šä¹‰äº†åªè¯»çš„å’Œå¯è¯»å¯å†™çš„attributeèŠ‚ç‚¹ã€‚æ¯ä¸ªå±æ€§å‡½æ•°ä¸‹éƒ½æœ‰DEVICE_ATTR_XX()å®å£°æ˜ï¼Œç»‘å®šåˆ°å¯¹åº”attributeèŠ‚ç‚¹ã€‚</li>
</ul>
<h4 id="rtc-proc-c"><a href="#rtc-proc-c" class="headerlink" title="rtc-proc.c"></a>rtc-proc.c</h4><ul>
<li>procæ–‡ä»¶ç³»ç»Ÿæ˜¯è½¯ä»¶åˆ›å»ºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå†…æ ¸é€šè¿‡ä»–å‘å¤–ç•Œå¯¼å‡ºä¿¡æ¯ï¼Œä¸‹é¢çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ç»‘å®šä¸€ä¸ªå‡½æ•°ï¼Œå½“ç”¨æˆ·è¯»å–è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå‘æ–‡ä»¶å†™å…¥ä¿¡æ¯ã€‚</li>
<li><p>rtc-proc.cä¸­åˆå§‹åŒ–äº†file_operationsç»“æ„ä½“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">static const struct file_operations rtc_proc_fops = &#123;  </div><div class="line">  .open       = rtc_proc_open,  </div><div class="line">  .read       = seq_read,  </div><div class="line">  .llseek     = seq_lseek,  </div><div class="line">  .release    = rtc_proc_release,  </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>_RTCé©±åŠ¨åœ¨å‘RTCæ ¸å¿ƒæ³¨å†Œè‡ªå·±çš„æ—¶å€™ï¼Œç”±æ³¨å†Œå‡½æ•°rtc_device_resgisterè°ƒç”¨rtc_proc_add_deviceæ¥å®ç°procæ¥å£çš„åˆå§‹åŒ–ï¼Œè¿™ä¸ªå‡½æ•°å¦‚ä¸‹å®šä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">void rtc_proc_add_device(struct rtc_device *rtc)  </div><div class="line">&#123;	  </div><div class="line">   	if (rtc-&gt;id == 0)  </div><div class="line">       	proc_create_data(&quot;driver/rtc&quot;, 0, NULL, &amp;rtc_proc_fops, rtc);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸»è¦æ˜¯å®Œæˆåˆ›å»ºæ–‡ä»¶èŠ‚ç‚¹ï¼Œå¹¶å°†æ–‡ä»¶çš„æ“ä½œå‡½æ•°ä¸èŠ‚ç‚¹è”ç³»èµ·æ¥ã€‚è°ƒç”¨è¿™ä¸ªå‡½æ•°åï¼Œåœ¨/proc/driverç›®å½•ä¸‹å°±ä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶rtc</p>
</li>
</ul>
<h3 id="rtcè®¾å¤‡è®¿é—®"><a href="#rtcè®¾å¤‡è®¿é—®" class="headerlink" title="rtcè®¾å¤‡è®¿é—®"></a>rtcè®¾å¤‡è®¿é—®</h3><ul>
<li>rtcå­ç³»ç»Ÿæœ€å¤šå¯ä»¥æ”¯æŒ16ä¸ªrtcè®¾å¤‡ï¼Œå¤šä¸ªrtcè®¾å¤‡ä¼šåœ¨/dev/å’Œ /sys/class/rtc/ä¸‹ç”Ÿæˆrtc0ã€rtc1â€¦ç­‰ä¸åŒèŠ‚ç‚¹(ä¸‹æ–‡ä»¥rtcnä»£ç§°)ã€‚è€Œç³»ç»Ÿå¯åŠ¨æ—¶ä¼šé€‰æ‹©ä¸€ä¸ªrtcè®¾å¤‡è¯»å–è®¡æ—¶ï¼Œåœ¨/devä¸‹æœ‰rtcæ–‡ä»¶ï¼Œrtcæ–‡ä»¶æŒ‡å‘ç³»ç»Ÿé€‰æ‹©çš„rtcè®¾å¤‡å¯¹åº”çš„rtcnï¼ˆä¸€èˆ¬ä¸ºrtc0ï¼‰ã€‚</li>
<li>ç”¨æˆ·å±‚è®¿é—®rtcè®¾å¤‡æœ‰3ç§é€”å¾„ï¼š<ul>
<li>/dev/rtcn openç­‰å­—ç¬¦è®¾å¤‡æ“ä½œå’Œioctlå‘½ä»¤ã€‚</li>
<li>/sys/class/rtc/rtcn   sysfs å±æ€§ï¼Œä¸€äº›å±æ€§æ˜¯åªè¯»ã€‚</li>
<li>/proc/driver/rtc ç¬¬ä¸€ä¸ªrtcä¼šå ç”¨procfsæ¥å£ï¼Œåœ¨procfsä¸‹æš´éœ²æ›´å¤šä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<h4 id="dev"><a href="#dev" class="headerlink" title="/dev"></a>/dev</h4><ul>
<li>åœ¨/devä¸‹ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è®¿é—®rtcè®¾å¤‡ï¼Œç¬¬ä¸€ä¸ªæ˜¯é€šè¿‡å­—ç¬¦è®¾å¤‡å®šä¹‰çš„openã€readç­‰å‡½æ•°ï¼ˆéœ€è¦é©±åŠ¨ç¨‹åºå®ç°ï¼‰ã€å¦ä¸€ä¸ªæ˜¯é€šè¿‡å®šä¹‰çš„ioctlå‘½ä»¤ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥æ‰“å¼€rtc-dev.cå®šä¹‰çš„openç­‰å‡½æ•°ï¼Œåœ¨openç­‰ä¸­ç›´æ¥è°ƒç”¨é©±åŠ¨ç¨‹åºå®ç°çš„å‡½æ•°ã€‚é€šè¿‡ioctlå‘½ä»¤è®¿é—®åˆ™æ˜¯å°†æ“ä½œè½¬å‘åˆ°äº†interface.cå®šä¹‰çš„æ¥å£ï¼Œé—´æ¥è°ƒç”¨é©±åŠ¨ç¨‹åºå®ç°çš„å‡½æ•°ã€‚</li>
<li><p>ioctl()å‡½æ•°è®¿é—®/devä¸‹çš„è®¾å¤‡ã€‚ä»¥ä¸‹æ˜¯å…¸å‹å‡½æ•°ï¼š_</p>
<ul>
<li><p>ioctl(fd,RTC_ALM_SET, &amp;rtc_tm);<br>è®¾ç½®alarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ï¼Œä¸è¶…è¿‡24å°æ—¶ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºstructrtc_timeç»“æ„ä½“ï¼Œè¯»å–æ—¶ä¼šå¿½ç•¥å¹´æœˆæ—¥ä¿¡æ¯ã€‚alarmä¸­æ–­ä¸wakeupalarmä¸­æ–­åªèƒ½åŒæ—¶ä½¿ç”¨1ä¸ªï¼Œä»¥æœ€åä¸€æ¬¡è®¾å®šä¸ºå‡†ã€‚</p>
<ul>
<li>ioctl(fd,RTC_ALM_READ, &amp;rtc_tm)<br>è¯»å–alarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ã€‚</li>
</ul>
</li>
<li><p>ioctl(fd,RTC_WKALM_SET, &amp;alarm);<br>è®¾ç½®wakeupalarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ï¼Œ wakeupalarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»å¯ä»¥åœ¨æœªæ¥çš„ä»»æ„æ—¶åˆ»ã€‚alarmä¸­æ–­ä¸wakeupalarmä¸­æ–­åªèƒ½åŒæ—¶ä½¿ç”¨1ä¸ªï¼Œä»¥æœ€åä¸€æ¬¡è®¾å®šä¸ºå‡†ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_WKALM_RD, &amp;alarm);<br>è¯»å–wakeupalarmä¸­æ–­çš„è§¦å‘æ—¶åˆ»ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_IRQP_SET, tmp);<br>è®¾ç½®å‘¨æœŸä¸­æ–­çš„é¢‘ç‡ï¼Œtmpçš„å€¼å¿…é¡»æ˜¯2çš„å¹‚ï¼ŒéRootç”¨æˆ·æ— æ³•ä½¿ç”¨64HZä»¥ä¸Šçš„å‘¨æœŸä¸­æ–­ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_IRQP_READ, &amp;tmp);<br>è¯»å–å‘¨æœŸä¸­æ–­çš„é¢‘ç‡ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_SET_TIME, &amp;rtc_tm)<br>æ›´æ–°RTCèŠ¯ç‰‡çš„å½“å‰æ—¶é—´ã€‚</p>
</li>
<li><p>ioctl(fd,RTC_RD_TIME, &amp;rtc_tm);<br>è¯»å–RTCç¡¬ä»¶ä¸­çš„å½“å‰æ—¶é—´ã€‚</p>
</li>
</ul>
</li>
<li><p>ä»¥openæ“ä½œä¸ºä¾‹ï¼Œåœ¨ç”¨æˆ·å±‚å¯¹/devä¸‹è®¾å¤‡æ‰§è¡Œopenä¼šè¢«è½¬å‘è‡³<code>rtc_dev_open(struct inode *inode, struct file *file)</code>å‡½æ•°ï¼Œé€šè¿‡err<code>= ops-&gt;open ? ops-&gt;open(rtc-&gt;dev.parent) : 0;</code>åˆ¤æ–­é©±åŠ¨ç¨‹åºæ˜¯å¦é€šè¿‡è¿æ¥çš„rtc_class_opsç»“æ„ä½“å®ç°äº†openå‡½æ•°ï¼Œé©±åŠ¨ç¨‹åºå®ç°äº†openå‡½æ•°ï¼Œåˆ™å°†openæ“ä½œè½¬å‘è‡³é©±åŠ¨ç¨‹åºã€‚</p>
</li>
</ul>
<h4 id="sys"><a href="#sys" class="headerlink" title="/sys"></a>/sys</h4><ul>
<li>/sys/class/rtc/rtcnä¸‹é¢çš„sysfsæ¥å£æä¾›äº†æ“ä½œrtcå±æ€§çš„æ–¹æ³•ï¼Œæ‰€æœ‰çš„æ—¥æœŸæ—¶é—´éƒ½æ˜¯å¢™ä¸Šæ—¶é—´ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿæ—¶é—´ã€‚<ul>
<li>date:    RTCæä¾›çš„æ—¥æœŸ</li>
<li>hctosys:    å¦‚æœåœ¨å†…æ ¸é…ç½®é€‰é¡¹ä¸­é…ç½®äº†CONFIG_RTC_HCTOSYSï¼ŒRTCä¼šåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™æä¾›ç³»ç»Ÿæ—¶é—´ï¼Œè¿™ç§æƒ…å†µä¸‹è¿™ä¸ªä½å°±æ˜¯1,å¦åˆ™ä¸º0</li>
<li>max_user_freq:    éç‰¹æƒç”¨æˆ·å¯ä»¥ä»RTCå¾—åˆ°çš„æœ€å¤§ä¸­æ–­é¢‘</li>
<li>name:     RTCçš„åå­—ï¼Œä¸sysfsç›®å½•ç›¸å…³</li>
<li>since_epoch:    ä»çºªå…ƒå¼€å§‹æ‰€ç»å†çš„ç§’æ•°</li>
<li>time:    RTCæä¾›çš„æ—¶é—´</li>
<li>wakealarm:    å”¤é†’æ—¶é—´çš„æ—¶é—´äº‹ä»¶ã€‚ è¿™æ˜¯ä¸€ç§å•æ¬¡çš„å”¤é†’äº‹ä»¶ï¼Œæ‰€ä»¥å¦‚æœè¿˜éœ€è¦å”¤é†’ï¼Œåœ¨å”¤é†’å‘ç”Ÿåå¿…é¡»å¤ä½ã€‚è¿™ä¸ªåŸŸçš„æ•°æ®ç»“æ„æˆ–è€…æ˜¯ä»çºªå…ƒå¼€å§‹ç»å†çš„å¦™æ•°ï¼Œæˆ–è€…æ˜¯ç›¸å¯¹çš„ç§’æ•°</li>
</ul>
</li>
</ul>
<h4 id="proc"><a href="#proc" class="headerlink" title="/proc"></a>/proc</h4><ul>
<li>/proc/driver/rtcä¸‹åªå¯¹åº”ç¬¬ä¸€ä¸ªrtcè®¾å¤‡ï¼Œä¸sysfsä¸‹ç›¸æ¯”ï¼Œè¯¥è®¾å¤‡æš´éœ²æ›´å¤šä¿¡æ¯</li>
<li>å¯¹åº”æˆªå›¾<br><img src="https://my.mixtape.moe/qbuavl.jpg" alt=""></li>
</ul>
<h3 id="RTCå­ç³»ç»Ÿæµ‹è¯•"><a href="#RTCå­ç³»ç»Ÿæµ‹è¯•" class="headerlink" title="RTCå­ç³»ç»Ÿæµ‹è¯•"></a>RTCå­ç³»ç»Ÿæµ‹è¯•</h3><p><strong>Hwclockå‘½ä»¤æˆ–ä½¿ç”¨æµ‹è¯•æ–‡ä»¶ã€‚</strong></p>
<ul>
<li>Hwclockå‘½ä»¤å¯ä»¥æ‰§è¡Œæœ€ç®€å•çš„RTCæµ‹è¯•ã€‚å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹<ul>
<li>hwclock #æŸ¥çœ‹RTCæ—¶é—´</li>
<li>hwclock -set -date=â€07/07/17 10:10â€ #è®¾ç½®ç¡¬ä»¶RTCæ—¶é—´ï¼ˆæœˆ/æ—¥/å¹´ æ—¶:åˆ†:ç§’ï¼‰</li>
<li>hwclock -w #ç³»ç»Ÿæ—¶é—´åŒæ­¥è‡³RTC</li>
<li>hwclock -s #åŒæ­¥RTCåˆ°ç³»ç»Ÿæ—¶é—´</li>
</ul>
</li>
<li>Linuxå†…æ ¸æä¾›äº†RTCå­ç³»ç»Ÿçš„æµ‹è¯•ç¤ºä¾‹æ–‡ä»¶ï¼Œä½äºtools/testing/selftests/timers/rtctest.cï¼ŒåŒ…å«äº†åŸºäºioctlå‘½ä»¤çš„å®Œæ•´æµ‹è¯•ã€‚</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;æ­£å¼å¼€å§‹è®©äººå´©æºƒçš„linuxç³»åˆ—ï¼Œå¸Œæœ›è‡ªå·±èƒ½å†™å®Œã€‚&lt;br&gt;å…ˆæ‹¿rtcå¼€åˆ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è¿™é‡Œæˆ‘å°½å¯èƒ½è®°å½•ä¸‹æ€ç»´çš„ç»†èŠ‚ï¼Œè€Œä¸æ˜¯ä»…å±€é™äºä»£ç ï¼Œå¸Œæœ›è‡ªå·±èƒ½é¢†ä¼šLinuxå†…æ ¸å¼€å‘è€…çš„æƒ³æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å†…æ ¸ç‰ˆæœ¬ï¼šlinux4.1&lt;/p&gt;
    
    </summary>
    
      <category term="Linuxç¬”è®°" scheme="http://yoursite.com/categories/Linux%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="rtc" scheme="http://yoursite.com/tags/rtc/"/>
    
  </entry>
  
  <entry>
    <title>linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰</title>
    <link href="http://yoursite.com/2017/08/15/linux%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E6%97%B6%E9%97%B4%E5%AD%90%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://yoursite.com/2017/08/15/linuxç¬”è®°â€”â€”æ—¶é—´å­ç³»ç»Ÿï¼ˆä¸€ï¼‰/</id>
    <published>2017-08-15T09:52:16.000Z</published>
    <updated>2017-09-10T01:36:52.140Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li>ss</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;ss&lt;/li&gt;
&lt;/ul&gt;

    
    </summary>
    
      <category term="Linuxç¬”è®°" scheme="http://yoursite.com/categories/Linux%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="timer" scheme="http://yoursite.com/tags/timer/"/>
    
  </entry>
  
  <entry>
    <title>Linuxå†…æ ¸Cè¯­è¨€ä¸­çš„é¢å‘å¯¹è±¡</title>
    <link href="http://yoursite.com/2017/07/11/Linux%E5%86%85%E6%A0%B8C%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
    <id>http://yoursite.com/2017/07/11/Linuxå†…æ ¸Cè¯­è¨€ä¸­çš„é¢å‘å¯¹è±¡/</id>
    <published>2017-07-11T02:17:11.000Z</published>
    <updated>2017-09-10T01:36:14.773Z</updated>
    
    <content type="html"><![CDATA[<ul>
<li><p>è½¬è½½è‡ªâ€Blog of UnicornXâ€ (<a href="http://unicornx.github.io/" target="_blank" rel="external">http://unicornx.github.io/</a>)</p>
</li>
<li><p>é¢å‘å¯¹è±¡çš„æ€æƒ³åœ¨cè¯­è¨€ä¸­çš„åº”ç”¨ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°æ‰çŸ¥é“cè¯­è¨€è¿˜èƒ½è¿™ä¹ˆç”¨ã€‚ã€‚ã€‚</p>
</li>
</ul>
<hr>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul>
<li>è¯­è¨€åªæ˜¯å·¥å…·ï¼Œé‡è¦çš„æ˜¯æ€æƒ³ã€‚ä½†æ˜¯ï¼ï¼Cè¯­è¨€ç”¨é¢å‘å¯¹è±¡ï¼Ÿï¼Ÿçœ‹äº†å†…æ ¸ä»£ç ï¼ŒçœŸç»™é‚£äº›å†™Linuxã€å†…æ ¸çš„å¤§ç¥è·ªäº†ã€‚ã€‚ã€‚</li>
<li>å½“ç„¶å› ä¸ºCè¯­è¨€çš„å±€é™æ€§ï¼Œå¹¶éå®Œå…¨é¢å‘å¯¹è±¡çš„å®ç°ï¼Œç§æœ‰æˆå‘˜ç­‰å°±æ²¡æœ‰äº†ã€‚</li>
</ul>
<h3 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h3><ul>
<li>æ—¢ç±»åœ¨Cè¯­è¨€ä¸­çš„å®ç°ï¼Œå®é™…ä¸Šæ˜¯ struct + å‡½æ•°ä½“ = å‡½æ•°è¡¨<br>ç»“æ„ä½“é‡Œä¸å…è®¸å­˜åœ¨æˆå‘˜å‡½æ•°ï¼Œä½†æ˜¯æ¢æˆæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆæ˜¯å¯ä»¥æ»´ã€‚</li>
<li>ç¤ºä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">struct foo_operations &#123;</div><div class="line">	void (*op_a) (struct foo *, loff_t, int);</div><div class="line">  void (*op_b) (struct foo *, char __user *, size_t, loff_t *);</div><div class="line">  void (*op_c) (struct foo *, const char __user *, size_t, loff_t *);</div><div class="line">  &#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><ul>
<li>è¿™ä¸ªç®€å•ç‚¹ï¼Œ struct é‡Œé¢å¥— struct ï¼Œè­¦å‘Šç†Ÿæ‚‰cè¯­è¨€çš„åº”è¯¥éƒ½æ¸…é™¤ã€‚ã€‚ã€‚è¿™é‡Œæ²¡æœ‰çˆ¶ç±»å­ç±»çš„ä¸¥æ ¼åŒºåˆ†ï¼Œå®é™…ä¸Šæ˜¯å®Œå…¨è‡ªç”±çš„ã€‚</li>
<li>ç¤ºä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">struct foo &#123;</div><div class="line">  int a;</div><div class="line">  int b;</div><div class="line">  int c;</div><div class="line">  struct foo_operations ops;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h3><ul>
<li>è¿™ä¸ªæ˜¯æœ€æœ‰æ„æ€çš„ï¼Œcè¯­è¨€ä¸­ä¸¥æ ¼è§„å®šåŒä¸€ä¸ª.cæ–‡ä»¶/å·¥ç¨‹ä¸­ä¸èƒ½å­˜åœ¨é‡åå‡½æ•°ï¼Œä½†æ˜¯cè¯­è¨€çš„ç²¾å-æŒ‡é’ˆç»™äº†æ€è·¯ï¼Œå€ŸåŠ©ç»“æ„ä½“ï¼Œæˆ‘å‡½æ•°åä¸å˜ï¼Œæ¯æŒ‡å‘ä¸åŒçš„ç»“æ„ä½“å˜é‡å°±è¡Œäº†ã€‚ã€‚ã€‚è™½ç„¶è¿˜æ˜¯å¾ˆéº»çƒ¦ã€‚ã€‚</li>
<li>ç¤ºä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">struct foo a;</div><div class="line">a-&gt;ops = ops1;</div><div class="line">a-&gt;ops-&gt;op_a(a);</div><div class="line">//åˆ‡æ¢</div><div class="line">a-&gt;ops = ops2;</div><div class="line">a-&gt;ops-&gt;op_a(a);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h3><ul>
<li>å†…æ ¸å†…å¤§é‡è¿ç”¨é“¾è¡¨ï¼Œå¼€å§‹ä¸æ¸…æ¥šçœŸæ˜¯å¤´æ™•ã€‚ã€‚</li>
<li><p>ç¤ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">   struct list_head &#123;</div><div class="line">struct list_head *next, *prev;</div><div class="line"> &#125;;</div></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæŒ‡å‘è‡ªèº«çš„ç»“æ„ä½“ï¼ŒåŒ…å«ä¸‹ä¸€ä¸ªä¸è‡ªèº«çš„æŒ‡é’ˆã€‚<br>ä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">struct A_LIST &#123;</div><div class="line">  data_t            data;</div><div class="line">  struct list_head    *list;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>offsetofå®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define offsetof(type, member) (size_t)&amp;(((type*)0)-&gt;member)</div></pre></td></tr></table></figure>
<p>offsetofæ˜¯ç”¨æ¥åˆ¤æ–­ç»“æ„ä½“ä¸­æˆå‘˜çš„åç§»ä½ç½®</p>
</li>
<li><p>container<em>of</em>å®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#define container_of(ptr, type, member) (&#123; \</div><div class="line">   const typeof( ((type *)0)-&gt;member ) *__mptr = (ptr); \</div><div class="line">   (type *)( (char *)__mptr - offsetof(type,member) );&#125;)</div></pre></td></tr></table></figure>
<p>æ ¹æ®ä¸€ä¸ªç»“æ„ä½“å˜é‡ä¸­çš„ä¸€ä¸ªåŸŸæˆå‘˜å˜é‡çš„æŒ‡é’ˆæ¥è·å–æŒ‡å‘æ•´ä¸ªç»“æ„ä½“å˜é‡çš„æŒ‡é’ˆ..é“¾è¡¨å…ƒç´ å¸¸ç”¨</p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;p&gt;è½¬è½½è‡ªâ€Blog of UnicornXâ€ (&lt;a href=&quot;http://unicornx.github.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://unicornx.github.io/&lt;/a&gt;)&lt;/p&gt;
&lt;
    
    </summary>
    
      <category term="Linuxç¬”è®°" scheme="http://yoursite.com/categories/Linux%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="cè¯­è¨€" scheme="http://yoursite.com/tags/c%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>Androidç¬”è®°â€”ä¹è”ç½‘ä¸Šä¼ æ•°æ® TCPé•¿è¿æ¥æ€»ç»“</title>
    <link href="http://yoursite.com/2017/06/11/Android%E7%AC%94%E8%AE%B0-%E4%B9%90%E8%81%94%E7%BD%91%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE%20TCP%E9%95%BF%E8%BF%9E%E6%8E%A5%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2017/06/11/Androidç¬”è®°-ä¹è”ç½‘ä¸Šä¼ æ•°æ® TCPé•¿è¿æ¥æ€»ç»“/</id>
    <published>2017-06-11T04:00:00.000Z</published>
    <updated>2017-06-11T14:55:38.908Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>èµ„æ–™æ¥æºå¦‚ä¸‹</p>
<ul>
<li>ä¹è”ç½‘</li>
</ul>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 2.2.3 </li>
</ul>
<p>å¯¼è¯­</p>
<ul>
<li>æ¯•è®¾ä¸­çš„ä¹è”ç½‘éƒ¨åˆ†,è®°å½•ä»¥ä¾›å¤ä¹ </li>
<li>å¼€æºåœ¨githubä¸Š</li>
<li><a href="https://github.com/Jasper-1024/HbuLeWei" target="_blank" rel="external">https://github.com/Jasper-1024/HbuLeWei</a></li>
</ul>
<hr>
<h2 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h2><ul>
<li>ä½¿ç”¨okhttpä¸Šä¼ æ•°æ®ã€‚</li>
<li>Tcpé•¿è¿æ¥å®ç°æ–¹å‘æ§åˆ¶</li>
<li>ä»¥ä»£ç ä¸ºä¸»</li>
</ul>
<h2 id="ç›¸å…³æ•™ç¨‹"><a href="#ç›¸å…³æ•™ç¨‹" class="headerlink" title="ç›¸å…³æ•™ç¨‹"></a>ç›¸å…³æ•™ç¨‹</h2><ul>
<li><p>okhttpå…¥é—¨</p>
<blockquote>
<p><a href="http://blog.csdn.net/biezhihua/article/details/50603624" target="_blank" rel="external">http://blog.csdn.net/biezhihua/article/details/50603624</a></p>
</blockquote>
</li>
<li><p>ä¹è”ç½‘</p>
<blockquote>
<p><a href="https://www.lewei50.com/dev/doc/176" target="_blank" rel="external">https://www.lewei50.com/dev/doc/176</a><br><a href="https://www.lewei50.com/dev/doc/155" target="_blank" rel="external">https://www.lewei50.com/dev/doc/155</a></p>
</blockquote>
</li>
<li><p>Tcpé•¿è¿æ¥</p>
<blockquote>
<p><a href="http://ls15114843569.blog.51cto.com/11015399/1767195" target="_blank" rel="external">http://ls15114843569.blog.51cto.com/11015399/1767195</a></p>
</blockquote>
</li>
<li><p>ç®€æ˜“ä¸Šä¼ </p>
<blockquote>
<p><a href="http://ls15114843569.blog.51cto.com/11015399/1767195" target="_blank" rel="external">http://ls15114843569.blog.51cto.com/11015399/1767195</a></p>
</blockquote>
</li>
</ul>
<h2 id="ä¸Šä¼ æ•°æ®"><a href="#ä¸Šä¼ æ•°æ®" class="headerlink" title="ä¸Šä¼ æ•°æ®"></a>ä¸Šä¼ æ•°æ®</h2><ul>
<li><p>APIä»‹ç»</p>
<blockquote>
<p><a href="https://www.lewei50.com/dev/apiinfo/3" target="_blank" rel="external">https://www.lewei50.com/dev/apiinfo/3</a></p>
</blockquote>
</li>
<li><p>APIæµ‹è¯•</p>
<blockquote>
<p><a href="https://www.lewei50.com/dev/apitest/3" target="_blank" rel="external">https://www.lewei50.com/dev/apitest/3</a></p>
</blockquote>
</li>
<li><p>åœ°å€ï¼š<a href="http://www.lewei50.com/api/v1/gateway/updatesensors/ä½ çš„ç½‘å…³å·" target="_blank" rel="external">http://www.lewei50.com/api/v1/gateway/updatesensors/ä½ çš„ç½‘å…³å·</a></p>
<p>POSTæ–¹å¼</p>
<p>éœ€è¦é…ç½®headerå¤´ Userkey</p>
</li>
<li><p>æ•°æ®å‘é€/è¿”å›æ–¹å¼JSON</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  &#123;</div><div class="line">      <span class="attr">"Name"</span>:<span class="string">"T1"</span>,</div><div class="line">      <span class="attr">"Value"</span>:<span class="string">"1"</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">      <span class="attr">"Name"</span>:<span class="string">"01H1"</span>,</div><div class="line">      <span class="attr">"Value"</span>:<span class="string">"96.2"</span></div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>è¿”å›æ ¼å¼</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"Successful"</span>: <span class="literal">true</span>, </div><div class="line">  <span class="attr">"Message"</span>: <span class="literal">null</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>okhttp POST ä¼ æ„Ÿå™¨æ•°æ® è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">	<span class="comment">//è¿”å›æ•°æ®å¤„ç†</span></div><div class="line">  <span class="keyword">public</span> okhttp3.Callback callback = <span class="keyword">new</span> okhttp3.Callback() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">          <span class="comment">//è¿”å›æœåŠ¡å™¨å†…å®¹</span></div><div class="line">          String responsedata = response.body().string();</div><div class="line">          LogUtil.d(<span class="string">"okHttp"</span>, responsedata);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</div><div class="line">          <span class="comment">//å¼‚å¸¸å¤„ç†</span></div><div class="line">          LogUtil.d(<span class="string">"okHttp"</span>, <span class="string">"POSTé”™è¯¯"</span>);</div><div class="line">      &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line"><span class="comment">//å†…éƒ¨ç±»</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Http</span> </span>&#123;</div><div class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MediaType MEDIA_TYPE_MARKDOWN</div><div class="line">              = MediaType.parse(<span class="string">"text/x-markdown; charset=utf-8"</span>);</div><div class="line"><span class="comment">//POSTæ•°æ®ï¼ŒæŒ‡å®šæ¥æ”¶å›æ‰</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">postData</span><span class="params">(String sensor_name, String sensor_data, okhttp3.Callback callback)</span> </span>&#123;</div><div class="line">          OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</div><div class="line">          <span class="keyword">final</span> String value =</div><div class="line">                  <span class="string">"["</span> +</div><div class="line">                          <span class="string">"    &#123;"</span> +</div><div class="line">                          <span class="string">"        \"Name\":\""</span> + sensor_name + <span class="string">"\","</span> +</div><div class="line">                          <span class="string">"        \"Value\":\""</span> + sensor_data + <span class="string">"\""</span> +</div><div class="line">                          <span class="string">"    &#125;"</span> +</div><div class="line">                          <span class="string">"]"</span>;</div><div class="line">          RequestBody requestBody = <span class="keyword">new</span> RequestBody() &#123;</div><div class="line">              <span class="meta">@Override</span></div><div class="line">              <span class="function"><span class="keyword">public</span> MediaType <span class="title">contentType</span><span class="params">()</span> </span>&#123;</div><div class="line">                  <span class="keyword">return</span> MEDIA_TYPE_MARKDOWN;</div><div class="line">              &#125;</div><div class="line"></div><div class="line">              <span class="meta">@Override</span></div><div class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(BufferedSink sink)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">                  sink.write(value.getBytes());</div><div class="line">              &#125;</div><div class="line">          &#125;;</div><div class="line">          Request request = <span class="keyword">new</span> Request.Builder()</div><div class="line">                  .url(<span class="string">"http://www.lewei50.com/api/V1/gateway/UpdateSensors/01"</span>)</div><div class="line">                  .header(<span class="string">"userkey"</span>, <span class="string">"ä½ çš„userkey"</span>)</div><div class="line">                  .post(requestBody)</div><div class="line">                  .build();</div><div class="line">          client.newCall(request).enqueue(callback);</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>å®é™…ä½¿ç”¨ æ”¾åœ¨ä¸€ä¸ªåå°æœåŠ¡å†…ï¼Œè°ƒç”¨ç›¸å½“ç®€å•<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Http.postData(<span class="string">"PM2.5"</span>, <span class="string">"ä½ çš„æ•°æ®è½¬ä¸ºString"</span>, callback);</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Tcpé•¿è¿æ¥ï¼Œè¿œç¨‹æ§åˆ¶"><a href="#Tcpé•¿è¿æ¥ï¼Œè¿œç¨‹æ§åˆ¶" class="headerlink" title="Tcpé•¿è¿æ¥ï¼Œè¿œç¨‹æ§åˆ¶"></a>Tcpé•¿è¿æ¥ï¼Œè¿œç¨‹æ§åˆ¶</h2><ul>
<li>é¦–å…ˆå‚è€ƒ<a href="https://wenku.baidu.com/view/f3457b63dd3383c4bb4cd2f0.html" target="_blank" rel="external">ä¹è”ç½‘åå‘æ§åˆ¶æ•™ç¨‹</a>ï¼Œæ–°å»ºä¸€ä¸ªæ§åˆ¶å™¨ï¼Œè¿™é‡Œä»¥å¼€å…³ä¸ºä¾‹ã€‚</li>
<li>åŸç†æ˜¯ä¸æœåŠ¡å™¨ä¿æŒä¸€ä¸ªTCPé•¿è¿æ¥ï¼Œä¸åˆ°40såˆ·æ–°ä¸€æ¬¡ï¼Œä»¥æ­¤ä¿æŒé€šé“ï¼Œä¸è¢«æ§åˆ¶æ®µé€šä¿¡ï¼Œå‘é€æ§åˆ¶ä¿¡æ¯ã€‚</li>
<li><p>Tcpé•¿è¿æ¥å‚è€ƒäº†@å¢¨è¿¹æµéŸ¶çš„<a href="http://blog.cocoper.com/2017/01/21/Android/Common/2017-01-21-Android%E5%9F%BA%E4%BA%8ETcp%E5%8D%8F%E8%AE%AE%E7%9A%84Socket%E9%95%BF%E9%93%BE%E6%8E%A5%E5%B0%81%E8%A3%85/" target="_blank" rel="external">AndroidåŸºäºTcpåè®®çš„Socketé•¿é“¾æ¥å°è£…</a></p>
</li>
<li><p>åœ°å€ tcp.lewei50.com<br>ç«¯å£å· 9960<br>å¿ƒè·³åŒ…é—´éš” 1minä»¥å†…</p>
</li>
<li><p>å‘é€/æ¥æ”¶æ•°æ®æ ¼å¼ Json<br>æœ¬åœ°å‘é€æ•°æ®æ ¼å¼</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"></div><div class="line">  "method": "update",</div><div class="line"></div><div class="line">  "gatewayNo": "ä½ çš„ç½‘å…³å·",</div><div class="line"></div><div class="line">  "userkey": "ä½ çš„userkey"</div><div class="line"></div><div class="line">&#125;&amp;^!</div></pre></td></tr></table></figure>
<p>æœåŠ¡å™¨å‘é€æ§åˆ¶å‘½ä»¤æ ¼å¼ï¼Œæ•°æ®å¤„ç†æ—¶éœ€è¦å»æ‰å­—ç¬¦ä¸²æœ€åçš„&amp;^! </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&#123;</div><div class="line"></div><div class="line">"method":"send",</div><div class="line"></div><div class="line">"gatewayNo":"01",</div><div class="line"></div><div class="line">"userkey":"6d16ddb3c58c4e448a7e15e7acxxxxxx",</div><div class="line"></div><div class="line">"f":" updateSensor",</div><div class="line"></div><div class="line">"p1":"D1",</div><div class="line"></div><div class="line">"p2":"1"</div><div class="line"></div><div class="line">&#125;&amp;^!</div></pre></td></tr></table></figure>
<p>æœ¬åœ°å“åº”æ§åˆ¶å‘½ä»¤åè¿”å›æ•°æ®æ ¼å¼</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"></div><div class="line"><span class="attr">"method"</span>:<span class="string">"response"</span>,</div><div class="line"></div><div class="line"><span class="attr">"result"</span>:&#123;</div><div class="line">	</div><div class="line">  <span class="attr">"successful"</span>:<span class="literal">true</span>,</div><div class="line">  </div><div class="line">  <span class="attr">"message"</span>:<span class="string">"ok!"</span>,</div><div class="line">  </div><div class="line">  <span class="attr">"data"</span>:[&#123;</div><div class="line">	    </div><div class="line">       <span class="attr">"id"</span>:<span class="string">"D1"</span>,</div><div class="line">      </div><div class="line">  	<span class="attr">"value"</span>:<span class="string">"1"</span></div><div class="line">  	</div><div class="line">    &#125;,</div><div class="line">  </div><div class="line">&#125;&amp;^!</div></pre></td></tr></table></figure>
</li>
<li><p>TCPè¿æ¥ç±»  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TcpSocketHelper</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> String mTag = <span class="string">"TcpSocketHelper"</span>;</div><div class="line">  <span class="keyword">private</span> Socket socket;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> _connect;</div><div class="line">  <span class="keyword">private</span> ReceiveThread mReceiveThread;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> receiveStop;</div><div class="line">  <span class="keyword">private</span> Date lastKeepAliveOkTime;</div><div class="line">  <span class="keyword">private</span> OnRecivedListener mRecivedListener;</div><div class="line">  <span class="comment">//åœ°å€</span></div><div class="line">  <span class="keyword">private</span> String mIpAddr = <span class="string">"http://tcp.lewei50.com"</span>;</div><div class="line">  <span class="comment">//ç«¯å£</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> mPort = <span class="number">9960</span>;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * å¼€å¯é“¾æ¥socket</div><div class="line">   * <span class="doctag">@param</span> ipAddr</div><div class="line">   * <span class="doctag">@param</span> port</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startConnect</span><span class="params">(String ipAddr, <span class="keyword">int</span> port)</span></span>&#123;</div><div class="line">      LogUtil.d(mTag, <span class="string">"å‡†å¤‡é“¾æ¥..."</span>);</div><div class="line">      <span class="keyword">this</span>.mIpAddr = ipAddr;</div><div class="line">      <span class="keyword">this</span>.mPort = port;</div><div class="line">      InetAddress serverAddr;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">          socket = <span class="keyword">new</span> Socket(ipAddr, port);</div><div class="line">          LogUtil.d(mTag, <span class="string">"å‡†å¤‡é“¾æ¥..."</span>);</div><div class="line">          _connect = <span class="keyword">true</span>;</div><div class="line">          mReceiveThread = <span class="keyword">new</span> ReceiveThread();</div><div class="line">          receiveStop = <span class="keyword">false</span>;</div><div class="line">          mReceiveThread.start();</div><div class="line">          LogUtil.d(mTag, <span class="string">"é“¾æ¥æˆåŠŸ..."</span>);</div><div class="line"></div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">          LogUtil.d(mTag, <span class="string">"é“¾æ¥å‡ºé”™..."</span> + e.getMessage());</div><div class="line">          e.printStackTrace();</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * å…³é—­é“¾æ¥</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeConnect</span><span class="params">()</span></span>&#123;</div><div class="line">      <span class="keyword">if</span> (socket != <span class="keyword">null</span>)&#123;</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">              socket.close();</div><div class="line">              socket = <span class="keyword">null</span>;</div><div class="line">          &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">              e.printStackTrace();</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * ä¿æŒå¿ƒè·³</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">KeepAlive</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="comment">// åˆ¤æ–­socketæ˜¯å¦å·²æ–­å¼€,æ–­å¼€å°±é‡è¿</span></div><div class="line">      <span class="keyword">if</span> (lastKeepAliveOkTime != <span class="keyword">null</span>) &#123;</div><div class="line">          LogUtil.d(mTag, <span class="string">"ä¸Šæ¬¡å¿ƒè·³æˆåŠŸæ—¶é—´:"</span>+ DateFormat.format(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>, lastKeepAliveOkTime));</div><div class="line">          Date now = Calendar.getInstance().getTime();</div><div class="line">          <span class="keyword">long</span> between = (now.getTime() - lastKeepAliveOkTime.getTime());<span class="comment">// å¾—åˆ°ä¸¤è€…çš„æ¯«ç§’æ•°</span></div><div class="line">          <span class="keyword">if</span> (between &gt; <span class="number">60</span> * <span class="number">1000</span>) &#123;</div><div class="line">              LogUtil.d(mTag, <span class="string">"å¿ƒè·³å¼‚å¸¸è¶…è¿‡40,é‡æ–°è¿æ¥:"</span>);</div><div class="line">              lastKeepAliveOkTime = <span class="keyword">null</span>;</div><div class="line">              socket = <span class="keyword">null</span>;</div><div class="line">          &#125;</div><div class="line"></div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">          lastKeepAliveOkTime = Calendar.getInstance().getTime();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (!checkIsAlive()) &#123;</div><div class="line">          LogUtil.d(mTag, <span class="string">"é“¾æ¥å·²æ–­å¼€,é‡æ–°è¿æ¥."</span>);</div><div class="line">          startConnect(mIpAddr, mPort);</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * æ­¤æ–¹æ³•æ˜¯æ£€æµ‹æ˜¯å¦è¿æ¥</div><div class="line">   * <span class="doctag">@return</span></div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkIsAlive</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (socket == <span class="keyword">null</span>||!socket.isConnected())</div><div class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line"></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * å‘é€æ•°æ®çš„æ–¹æ³•</div><div class="line">   * <span class="doctag">@param</span> msg</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendmessage</span><span class="params">(String msg)</span> </span>&#123;</div><div class="line">      <span class="keyword">boolean</span> isAlive = checkIsAlive();</div><div class="line">      <span class="keyword">if</span> (!isAlive)</div><div class="line">          <span class="keyword">return</span>;</div><div class="line">      LogUtil.d(mTag, <span class="string">"å‡†å¤‡å‘é€æ¶ˆæ¯:"</span> + msg);</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">          <span class="keyword">if</span> (socket != <span class="keyword">null</span> &amp;&amp; socket.isConnected()) &#123;</div><div class="line">              <span class="keyword">if</span> (!socket.isOutputShutdown()) &#123;</div><div class="line"></div><div class="line">                  <span class="comment">//2.å¾—åˆ°socketè¯»å†™æµ</span></div><div class="line">                  OutputStream os=socket.getOutputStream();</div><div class="line">                  <span class="comment">//true:æ˜¯å¦è‡ªåŠ¨flush</span></div><div class="line">                  PrintWriter outStream=<span class="keyword">new</span> PrintWriter(os, <span class="keyword">true</span>);</div><div class="line">                  outStream.print(msg);</div><div class="line">                  outStream.flush();</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">          LogUtil.d(mTag, <span class="string">"å‘é€æˆåŠŸ!"</span>);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">          e.printStackTrace();</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * è®¾ç½®æ¥æ”¶æ•°æ®ç›‘å¬å™¨</div><div class="line">   * <span class="doctag">@param</span> mRecivedListener</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setmRecivedListener</span><span class="params">(OnRecivedListener mRecivedListener)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.mRecivedListener = mRecivedListener;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * æ•°æ®æ¥æ”¶çº¿ç¨‹</div><div class="line">   */</div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">ReceiveThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">          <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">              <span class="keyword">try</span> &#123;</div><div class="line">                  sleep(<span class="number">2000</span>);</div><div class="line">                    <span class="comment">// åˆ¤æ–­ Socket æ˜¯å¦å¤„äºè¿æ¥çŠ¶æ€</span></div><div class="line">                  <span class="keyword">if</span> (socket != <span class="keyword">null</span> &amp;&amp; socket.isConnected()) &#123;</div><div class="line">                      <span class="comment">// å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡å™¨ç«¯çš„å“åº”ï¼Œè¯»å–æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯çš„è¾“å…¥æµ</span></div><div class="line">                      InputStream isRead = socket.getInputStream();</div><div class="line">                      <span class="comment">// ç¼“å†²åŒº</span></div><div class="line">                      <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[isRead.available()];</div><div class="line">                      <span class="comment">// è¯»å–ç¼“å†²åŒº</span></div><div class="line">                      isRead.read(buffer);</div><div class="line">                      <span class="comment">// è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></div><div class="line">                      String responseInfo = <span class="keyword">new</span> String(buffer);</div><div class="line">                      <span class="comment">// æ—¥å¿—ä¸­è¾“å‡º</span></div><div class="line">                      <span class="keyword">if</span>(responseInfo != <span class="keyword">null</span>&amp;&amp;!responseInfo.equals(<span class="string">""</span>))&#123;</div><div class="line">                          LogUtil.d(<span class="string">"TcpManager"</span>, <span class="string">"è¿”å›ï¼š"</span>+responseInfo);</div><div class="line">                          mRecivedListener.onRecived(responseInfo);</div><div class="line">                      &#125;</div><div class="line"></div><div class="line">                      lastKeepAliveOkTime = Calendar.getInstance().getTime();</div><div class="line">                      KeepAlive();</div><div class="line"></div><div class="line">                      <span class="keyword">continue</span>;</div><div class="line">                  &#125; <span class="keyword">else</span> &#123;</div><div class="line">                      <span class="keyword">if</span> (socket != <span class="keyword">null</span>)</div><div class="line">                          LogUtil.d(mTag, <span class="string">"é“¾æ¥çŠ¶æ€:"</span> + socket.isConnected());</div><div class="line">                  &#125;</div><div class="line"></div><div class="line">              &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                  LogUtil.d(mTag, <span class="string">"ç›‘å¬å‡ºé”™:"</span> + e.toString());</div><div class="line">                  e.printStackTrace();</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨,åŒ…è£…åœ¨ä¸€ä¸ªåå°serviceä¸­ï¼Œåœ¨serviceä¸­å®ç°TcpSocketHelperçš„onRecivedæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">  //tcpè¿”å›ä¿¡æ¯</div><div class="line">  @Override</div><div class="line">  public void onRecived(String data) &#123;</div><div class="line">      LogUtil.d(&quot;okHttpService&quot;, data);</div><div class="line">      //å¤„ç†æœåŠ¡å™¨å‘å›çš„æ•°æ®      </div><div class="line">  &#125;</div><div class="line"></div><div class="line">TcpSocketHelper tcpSocketHelper  = new TcpSocketHelper();</div><div class="line">tcpSocketHelper.startConnect(&quot;tcp.lewei50.com&quot;, 9960);</div><div class="line">//è®¾ç½®ç›‘å¬</div><div class="line">tcpSocketHelper.setmRecivedListener(this);</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>å‘é€å¿ƒè·³åŒ…<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">String value =</div><div class="line">          <span class="string">"    &#123;"</span> +</div><div class="line">                  <span class="string">"        \"method\":\"update\","</span> +</div><div class="line">                  <span class="string">"        \"gatewayNo\":\"01\","</span> +</div><div class="line">                  <span class="string">"        \"userkey\":\"ä½ çš„userkey\""</span> +</div><div class="line">                  <span class="string">"    &#125;&amp;^!"</span>;</div><div class="line"> <span class="comment">//å‘é€æ•°æ®</span></div><div class="line"> tcpSocketHelper.sendmessage(value);</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>å¤„ç†æ•°æ® åœ¨serviceçš„onRecivedä¸­</p>
</li>
<li><p>æœ¬åœ°å¤„ç†å®Œæ¯•åï¼Œå‘æœåŠ¡å™¨è¿”å›è¢«æ§åˆ¶å™¨çŠ¶æ€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String value5 = <span class="string">"&#123;\"method\":\"response\",\"result\":&#123;\"successful\":true,\"message\":\"ok!\",\"data\":[&#123;\"id\":\"D1\",\"value \":\"1\"&#125;]&#125;&#125;&amp;^! "</span>;</div><div class="line"> </div><div class="line">tcpSocketHelper.sendmessage(value6);</div></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;èµ„æ–™æ¥æºå¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¹è”ç½‘&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–ç¨‹ç¯å¢ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Android Studio 2.2.3 &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¼è¯­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯•è®¾ä¸­çš„ä¹è”ç½‘éƒ¨åˆ†,è®°å½•ä»¥ä¾›å¤ä¹ &lt;/li&gt;
&lt;l
    
    </summary>
    
      <category term="Androidç¬”è®°" scheme="http://yoursite.com/categories/Android%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
      <category term="æ¯•è®¾" scheme="http://yoursite.com/tags/%E6%AF%95%E8%AE%BE/"/>
    
  </entry>
  
  <entry>
    <title>Androidç¬”è®°-è‡ªç”¨MVPæ¡†æ¶</title>
    <link href="http://yoursite.com/2017/05/08/Android%E7%AC%94%E8%AE%B0-%E8%87%AA%E7%94%A8MVP%E6%A1%86%E6%9E%B6/"/>
    <id>http://yoursite.com/2017/05/08/Androidç¬”è®°-è‡ªç”¨MVPæ¡†æ¶/</id>
    <published>2017-05-08T04:00:00.000Z</published>
    <updated>2017-05-09T15:19:29.284Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>èµ„æ–™æ¥æºå¦‚ä¸‹</p>
<ul>
<li>ç½‘ç»œ</li>
</ul>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 2.2.3 </li>
</ul>
<p>å¯¼è¯­</p>
<ul>
<li>è½¬çœ¼åˆšç”¨ä¸Šæ‰‹çš„MVPåˆä¸ç¬¦åˆéœ€æ±‚äº†ï¼Œè¿˜æ˜¯æ€»ç»“ä¸€ä¸‹ï¼Œç»§ç»­MVVMå§ã€‚</li>
</ul>
<hr>
<h3 id="èµ·"><a href="#èµ·" class="headerlink" title="èµ·"></a>èµ·</h3><ul>
<li><p>ä¸»è¦å†…å®¹æ˜¯è½¬è½½ï¼Œæ­å»ºå°å·¥ç¨‹åº”è¯¥è¶³å¤Ÿäº†ã€‚<br><a href="http://blog.csdn.net/dantestones/article/details/50899235" target="_blank" rel="external">Android mvp æ¶æ„çš„è‡ªè¿°</a><br><a href="http://blog.csdn.net/dantestones/article/details/51445208" target="_blank" rel="external">å¦‚ä½•æ›´é«˜æ•ˆçš„ä½¿ç”¨MVPä»¥åŠå®˜æ–¹MVPæ¶æ„è§£æ</a></p>
</li>
<li><p>æ¡†æ¶å¼€æºåœ¨GitHub åœ°å€<a href="https://github.com/Jasper-1024/MvpTest" target="_blank" rel="external">ç‚¹æˆ‘ç›´è¾¾</a></p>
</li>
<li><p>å¥½ï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼</p>
</li>
</ul>
<hr>
<h3 id="MVC-MVP-MVVM"><a href="#MVC-MVP-MVVM" class="headerlink" title="MVC MVP MVVM"></a>MVC MVP MVVM</h3><ul>
<li>çœç•¥200è¡Œï¼Œè¯¦æƒ…çœ‹<a href="https://www.tianmaying.com/tutorial/AndroidMVC" target="_blank" rel="external">Android Appçš„è®¾è®¡æ¶æ„ï¼šMVC,MVP,MVVMä¸æ¶æ„ç»éªŒè°ˆ</a></li>
<li>å†ç´¯èµ˜å±äºæ‰ä¹¦è¢‹äº†ï¼Œä½œè€…å†™çš„æ˜¯å¾ˆç”¨å¿ƒï¼Œæ©ï¼ŒMVVMä¹Ÿæœ‰ã€‚</li>
</ul>
<h3 id="æ¡†æ¶è¯¦è§£"><a href="#æ¡†æ¶è¯¦è§£" class="headerlink" title="æ¡†æ¶è¯¦è§£"></a>æ¡†æ¶è¯¦è§£</h3><ul>
<li><p>æ•´ä¸ªæ¡†æ¶æˆªå›¾<br>  <img src="http://cdn5.snapgram.co/images/2017/05/09/ScreenShot_20170509215208.png" alt="ScreenShot_20170509215208.png"></p>
</li>
<li><p>æ•´ä½“å±‚æ¬¡æ¯”è¾ƒæ˜ç¡®äº†ï¼ŒBaseClass é‡Œå­˜æ”¾åŸºç±»ï¼ŒModelå±‚å­˜æ”¾æ•°æ®å­˜å‚¨æœ‰å…³ç±»ã€Presenterå±‚å­˜æ”¾é€»è¾‘ä»£ç ã€Viewå±‚å­˜æ”¾Activityã€framentç­‰ã€‚</p>
</li>
<li>è¿™ä¸ªæ¡†æ¶æ˜¯ç”±MVPåœ¨Androidä¸­åº”ç”¨å­˜åœ¨çš„é—®é¢˜è€Œæ­å»ºçš„ï¼ŒåŸºç±»ä¸­ä»£ç ä¹Ÿç”±æ­¤è€Œæ¥ã€‚</li>
</ul>
<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><ul>
<li><p>presenterä¸€ç›´æŒæœ‰Activityå¯¹è±¡å¯¼è‡´çš„å†…å­˜æ³„æ¼é—®é¢˜</p>
<ul>
<li>ä½¿ç”¨mvpçš„æ—¶å€™ï¼Œpresenterä¼šæŒæœ‰viewï¼Œå¦‚æœpresenteræœ‰åå°å¼‚æ­¥çš„é•¿æ—¶é—´çš„åŠ¨ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¿™æ—¶å¦‚æœè¿”å›é€€å‡ºäº†Activityï¼Œåå°å¼‚æ­¥çš„åŠ¨ä½œä¸ä¼šç«‹å³åœæ­¢ï¼Œè¿™é‡Œå°±ä¼šæœ‰å†…å­˜æ³„æ¼çš„éšæ‚£ã€‚</li>
<li>éœ€è¦ä¸€ä¸ªé”€æ¯viewçš„æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯åœ¨åŸºç±»ä¸­å®Œæˆçš„ã€‚</li>
</ul>
</li>
<li><p>presenterç»‘å®šå’Œè§£ç»‘ç¹ç</p>
<ul>
<li>ä¸€èˆ¬ä¸€ä¸ªpresenterå¯¹åº”ä¸€ä¸ªActivityï¼Œä¸€èˆ¬åº”ç”¨å†…å­˜åœ¨å¤šä¸ªActiivityï¼Œç»‘å®šä¸è§£ç»‘ç›¸å½“ç¹çã€‚</li>
<li>ç»Ÿä¸€åœ¨ Basepresenter ä¸ BaseActivityä¸­è¿›è¡Œï¼ŒåŒæ—¶è§£å†³å†…å­˜æ³„æ¼é—®é¢˜ï¼Œè¿˜æœ‰å…¶ä»–å¸¸ç”¨å†…å®¹ä¸€å¹¶æ·»åŠ ã€‚</li>
</ul>
</li>
<li><p>presenter ä¸ Model çš„é€šä¿¡é—®é¢˜ã€‚</p>
<ul>
<li>presenterå·²ç»ä¸Viewå±‚ å¼ºè€¦åˆäº†ï¼Œæ¡†æ¶ä¸­éœ€è¦è§£è€¦presenter ä¸ Model ï¼Œä½¿ç”¨å¼‚æ­¥é€šä¿¡ã€‚Handleç­‰éƒ½å¤ªå¤æ‚äº†ã€‚ã€‚ã€‚</li>
<li>å¼€å§‹æ²¡æœ‰ä»€ä¹ˆå¥½çš„è§£å†³åŠæ³•ï¼Œç›´åˆ°é‡åˆ°äº†EventBusï¼Œå½“ç„¶EventBusä¹Ÿä¸æ˜¯ä¸‡èƒ½è§£å†³æ–¹æ¡ˆï¼Œè·¨è¿›ç¨‹ï¼Œè¿˜æ˜¯è¦å¦è¾Ÿè¹Šå¾„ï¼Œä¸è¿‡EventBusè¶³å¤Ÿè‡ªå·±å†™ç€å®Œäº†ã€‚è¿˜æœ‰Rxjavaï¼Œæ©ï¼Œè¿˜åœ¨ç©ç€ï¼Œæ²¡æå¤ªæ‡‚ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><ul>
<li>BasePresenter<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePresenter</span>&lt;<span class="title">Viewinterface</span>&gt; </span>&#123;</div><div class="line">   <span class="comment">//ä¼ å…¥æ³›å‹</span></div><div class="line">   <span class="keyword">public</span> Viewinterface mView;</div><div class="line">   <span class="comment">//ç»‘å®š</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attach</span><span class="params">(Viewinterface mView)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.mView = mView;</div><div class="line">   &#125;</div><div class="line">   <span class="comment">//è§£ç»‘ï¼Œé˜²æ­¢viewä¸ºç©ºæ˜¯å†…å­˜æ³„æ¼</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dettach</span><span class="params">()</span> </span>&#123;</div><div class="line">       mView = <span class="keyword">null</span>;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>BaseActivity<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> &lt;<span class="title">Viewinterface</span>,<span class="title">mPresenter</span> <span class="keyword">extends</span> <span class="title">BasePresenter</span>&lt;<span class="title">Viewinterface</span>&gt;&gt;<span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">   <span class="comment">//è·å–Presenterå¯¹è±¡</span></div><div class="line">   <span class="keyword">public</span> mPresenter mpresenter;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">       <span class="comment">//Presenterå®ä¾‹åŒ–</span></div><div class="line">       mpresenter = initPresenter();</div><div class="line">       <span class="comment">//æ‰“å°å½“å‰activity</span></div><div class="line">       LogUtil.d(<span class="string">"Activity"</span>, getClass().getSimpleName()+<span class="string">"onCreate"</span>);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="comment">//é‡æ–°åˆ·æ–°æ—¶é‡æ–°ç»‘å®šview</span></div><div class="line">       mpresenter.attach((Viewinterface) <span class="keyword">this</span>);</div><div class="line">       <span class="keyword">super</span>.onResume();</div><div class="line">       LogUtil.d(<span class="string">"Activity"</span>, getClass().getSimpleName()+<span class="string">"onResume"</span>);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="comment">//è§£ç»‘presenteræŒæœ‰çš„view</span></div><div class="line">       mpresenter.dettach();</div><div class="line">       <span class="keyword">super</span>.onDestroy();</div><div class="line">       LogUtil.d(<span class="string">"Activity"</span>, getClass().getSimpleName()+<span class="string">"onDestroy"</span>);</div><div class="line">   &#125;</div><div class="line"></div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span>  <span class="keyword">abstract</span> mPresenter <span class="title">initPresenter</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Presenter<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Presenter</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>mPresenter<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mPresenter</span> <span class="keyword">extends</span> <span class="title">BasePresenter</span>&lt;<span class="title">Viewif</span>&gt; <span class="keyword">implements</span> <span class="title">Presenter</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> Model mModel;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">mPresenter</span><span class="params">(Viewif view)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.attach(view);</div><div class="line">       <span class="keyword">this</span>.mModel = <span class="keyword">new</span> mModel();</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>BaseView</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseView</span>&lt;<span class="title">T</span>&gt;  </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Viewif </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Viewif</span> <span class="keyword">extends</span> <span class="title">BaseView</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>MainActivity<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span>&lt;<span class="title">Viewif</span>, <span class="title">mPresenter</span>&gt; <span class="keyword">implements</span> <span class="title">Viewif</span></span>&#123;</div><div class="line"></div><div class="line">   Presenter presenter;</div><div class="line">   <span class="comment">//Presenteråˆå§‹åŒ–</span></div><div class="line">   <span class="function"><span class="keyword">public</span> mPresenter <span class="title">initPresenter</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">new</span> mPresenter(<span class="keyword">this</span>);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">       <span class="comment">//presenteråˆå§‹åŒ–</span></div><div class="line">       presenter = mpresenter;</div><div class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">       setContentView(R.layout.activity_main);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>LogUtil<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtil</span> </span>&#123;</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VERBOSE = <span class="number">1</span>;<span class="comment">//å•°å—¦ï¼Œç­‰çº§æœ€ä½çš„</span></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEBUG = <span class="number">2</span>;<span class="comment">//è°ƒè¯•</span></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INFO = <span class="number">3</span>;<span class="comment">//ä¿¡æ¯</span></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> WARN = <span class="number">4</span>;<span class="comment">//è­¦å‘Š</span></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ERROR = <span class="number">5</span>;<span class="comment">//é”™è¯¯</span></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NOTHING = <span class="number">6</span>;<span class="comment">//ä»€ä¹ˆä¹Ÿä¸æ‰“å°å‡ºæ¥</span></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> level = VERBOSE;<span class="comment">//LEVEL:æ ‡å‡†</span></div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">v</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (level &lt;= VERBOSE) &#123;<span class="comment">//å¦‚æœå¤§äºæˆ–è€…ç­‰äºå®šä¹‰çš„æ ‡å‡†å°±æ‰“å°å‡ºæ¥</span></div><div class="line">           Log.v(tag, msg);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (level &lt;= DEBUG) &#123;</div><div class="line">           Log.d(tag, msg);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (level &lt;= INFO) &#123;</div><div class="line">           Log.i(tag, msg);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (level &lt;= WARN) &#123;</div><div class="line">           Log.w(tag, msg);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(String tag, String msg)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (level &lt;= ERROR) &#123;</div><div class="line">           Log.e(tag, msg);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;èµ„æ–™æ¥æºå¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘ç»œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–ç¨‹ç¯å¢ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Android Studio 2.2.3 &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¼è¯­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è½¬çœ¼åˆšç”¨ä¸Šæ‰‹çš„MVPåˆä¸ç¬¦åˆéœ€æ±‚äº†ï¼Œè¿˜æ˜¯æ€»ç»“ä¸€ä¸‹ï¼Œ
    
    </summary>
    
      <category term="Androidç¬”è®°" scheme="http://yoursite.com/categories/Android%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Androidç¬”è®°â€”è“ç‰™ä¸²å£(BlueTooth+EventBus)</title>
    <link href="http://yoursite.com/2017/04/17/Android%E7%AC%94%E8%AE%B0-%E8%93%9D%E7%89%99%E4%B8%B2%E5%8F%A3%E4%B8%80%E7%A7%8D%E6%96%B9%E6%A1%88BlueTooth+EventBus/"/>
    <id>http://yoursite.com/2017/04/17/Androidç¬”è®°-è“ç‰™ä¸²å£ä¸€ç§æ–¹æ¡ˆBlueTooth+EventBus/</id>
    <published>2017-04-17T04:00:00.000Z</published>
    <updated>2017-06-11T12:40:33.649Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>èµ„æ–™æ¥æºå¦‚ä¸‹</p>
<ul>
<li>ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ)</li>
</ul>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 2.2.3 </li>
</ul>
<p>å¯¼è¯­</p>
<ul>
<li>æ¯•è®¾ä¸­çš„è“ç‰™éƒ¨åˆ†,è®°å½•ä»¥ä¾›å¤ä¹ </li>
</ul>
<hr>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h3><ul>
<li><p>Androidåº”ç”¨ ä¸ Hc-05 è“ç‰™æ¨¡å—è¿æ¥,å•ç‰‡æœºä¸ Android ç«¯ å¯ä»¥é€šè¿‡ä¸²å£æ­£å¸¸æ”¶å‘æ•°æ®.</p>
</li>
<li><p>é¢„ç•™è¶³å¤Ÿçµæ´»çš„æ¥å£, Android åº”ç”¨ä¸­å¯ä»¥åœ¨ä»»æ„ä½ç½®è·å–åˆ°è“ç‰™æ•°æ®</p>
</li>
<li><p>Activityåˆ‡æ¢æ—¶,è“ç‰™è¿æ¥ä¸æ–­å¼€.</p>
</li>
</ul>
<h3 id="ç”¨åˆ°çš„å¼€æºåº“-çŸ¥è¯†ç‚¹èµ„æ–™-ç®€ä»‹-æ¥æº"><a href="#ç”¨åˆ°çš„å¼€æºåº“-çŸ¥è¯†ç‚¹èµ„æ–™-ç®€ä»‹-æ¥æº" class="headerlink" title="ç”¨åˆ°çš„å¼€æºåº“/çŸ¥è¯†ç‚¹èµ„æ–™ ç®€ä»‹/æ¥æº"></a>ç”¨åˆ°çš„å¼€æºåº“/çŸ¥è¯†ç‚¹èµ„æ–™ ç®€ä»‹/æ¥æº</h3><ul>
<li><p>è“ç‰™:<br><a href="https://developer.android.com/guide/topics/connectivity/bluetooth.html" target="_blank" rel="external">Android API æŒ‡å—</a></p>
<blockquote>
<p><a href="https://developer.android.com/guide/topics/connectivity/bluetooth.html" target="_blank" rel="external">https://developer.android.com/guide/topics/connectivity/bluetooth.html</a></p>
</blockquote>
</li>
<li><p>EventBus:<br><a href="https://github.com/greenrobot/EventBus" target="_blank" rel="external">EventBus-GitHub</a> æ˜¯ä¸€ä¸ªAndroidç«¯ä¼˜åŒ–çš„publish/subscribeæ¶ˆæ¯æ€»çº¿,ç”¨æ¥æ›¿ä»£ Intent ã€   Handler ã€ Broadcast ç­‰åœ¨ Actvity ã€ Fragment ã€ Service ç­‰ç»„ä»¶ä¹‹é—´ä¼ é€’ä¿¡æ¯ . EventBus å¯ä»¥ä¼ é€’ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡,ç®€å•é«˜æ•ˆ, <strong>æ³¨æ„ EventBus åªèƒ½åœ¨å¤šçº¿ç¨‹ä¹‹é—´ä¼ é€’æ¶ˆæ¯,æ— æ³•åœ¨ä¸åŒè¿›ç¨‹ä¹‹é—´ä¼ é€’æ¶ˆæ¯</strong> ,EventBus 3.0 ä»¥åè¿›ä¸€æ­¥ç®€åŒ–äº†ä¼ é€’æ–¹å¼,çœŸçš„æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ä¸€ä¸ªå¼€æºåº“!</p>
<p>å‚è€ƒèµ„æ–™å¦‚ä¸‹:</p>
<p><a href="http://www.jianshu.com/p/acfe78296bb5" target="_blank" rel="external">EventBus 3.0åˆæ¢: å…¥é—¨ä½¿ç”¨åŠå…¶ä½¿ç”¨ å®Œå…¨è§£æ</a></p>
<p> <a href="http://www.jianshu.com/p/1eaca34e5314" target="_blank" rel="external">EventBus3(3.0.0)æºç è§£æ</a></p>
</li>
</ul>
<hr>
<h2 id="åŸºç¡€éƒ¨åˆ†"><a href="#åŸºç¡€éƒ¨åˆ†" class="headerlink" title="åŸºç¡€éƒ¨åˆ†"></a>åŸºç¡€éƒ¨åˆ†</h2><ul>
<li>è“ç‰™ ä¸ EventBus åŸºç¡€éƒ¨åˆ†</li>
</ul>
<h3 id="BlueTooth"><a href="#BlueTooth" class="headerlink" title="BlueTooth"></a>BlueTooth</h3><hr>
<ul>
<li>å¤‡æ³¨ : è¿™é‡Œä½¿ç”¨çš„æ˜¯ ä¼ ç»Ÿè“ç‰™ å³ è“ç‰™4.0ä»¥å‰ç‰ˆæœ¬, è€Œä¸æ˜¯ è“ç‰™4.0 ( bleä½åŠŸè€—è“ç‰™)åŠä»¥åç‰ˆæœ¬ </li>
</ul>
<hr>
<ul>
<li>Android å¯¹ Bluetooth åšäº†å¾ˆå¥½çš„å°è£…,æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒè½»æ¾çš„åœ¨ Android Bluetooth API ä¸Šè¿›è¡Œå¼€å‘.</li>
<li>Androidä¸­æ‰€æœ‰è“ç‰™APIå‡æ¥è‡ª android.bluetooth åŒ…</li>
</ul>
<h4 id="BlueToothåŸºç¡€"><a href="#BlueToothåŸºç¡€" class="headerlink" title="BlueToothåŸºç¡€"></a>BlueToothåŸºç¡€</h4><ul>
<li><p>BluetoothAdapter æœ¬åœ°è“ç‰™é€‚é…å™¨<br>BluetoothAdapter æ˜¯æ‰€æœ‰è“ç‰™äº¤äº’çš„å…¥å£ç‚¹, åœ¨åˆå§‹åŒ–è“ç‰™åŠè“ç‰™é…å¯¹é˜¶æ®µä½¿ç”¨<br>1.å‘ç°å…¶ä»–è“ç‰™è®¾å¤‡<br>2.æŸ¥è¯¢ç»‘å®šï¼ˆé…å¯¹ï¼‰è®¾å¤‡çš„åˆ—è¡¨<br>3.ä½¿ç”¨å·²çŸ¥çš„ MAC åœ°å€å®ä¾‹åŒ– BluetoothDevice<br>4.åˆ›å»º BluetoothServerSocket ä¾¦å¬æ¥è‡ªå…¶ä»–è®¾å¤‡çš„é€šä¿¡ã€‚</p>
</li>
<li><p>BluetoothDevice è¿œç¨‹è“ç‰™è®¾å¤‡<br>å«æœ‰è¯¥è®¾å¤‡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚è®¾å¤‡çš„åç§°ã€åœ°å€ã€ç±»å’Œç»‘å®šçŠ¶æ€ç­‰ã€‚</p>
</li>
<li><p>BluetoothSocket è“ç‰™å¥—æ¥å­—æ¥å£ï¼ˆä¸ TCP Socket ç›¸ä¼¼ï¼‰<br>ä¸ BluetoothDevice é…åˆå»ºç«‹è¿œç¨‹è¿æ¥,å…è®¸åº”ç”¨é€šè¿‡ InputStream å’Œ OutputStream ä¸å…¶ä»–è“ç‰™è®¾å¤‡äº¤æ¢æ•°æ®.</p>
</li>
</ul>
<h4 id="åˆå§‹åŒ–è“ç‰™"><a href="#åˆå§‹åŒ–è“ç‰™" class="headerlink" title="åˆå§‹åŒ–è“ç‰™"></a>åˆå§‹åŒ–è“ç‰™</h4><ul>
<li><p>å£°æ˜è“ç‰™æƒé™<br>Android åº”ç”¨ä½¿ç”¨è“ç‰™å‰éƒ½éœ€è¦å£°æ˜è“ç‰™æƒé™<br>ä¸€èˆ¬åªéœ€è¦  BLUETOOTH æƒé™å³å¯,ä½†æ˜¯è€ƒè™‘åˆ°ä¹‹åæœ‰æ›´å¤šçš„éœ€æ±‚,éœ€è¦æ›´æ”¹ç³»ç»Ÿè“ç‰™è®¾ç½®,ç”±æ­¤éœ€è¦ BLUETOOTH<em>ADMIN æƒé™</em>ä¹Ÿä¸€èµ·å£°æ˜</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;manifest ... &gt;</div><div class="line">&lt;uses-permission android:name="android.permission.BLUETOOTH" /&gt;</div><div class="line">&lt;uses-permission android:name="android.permission.BLUETOOTH_ADMIN" /&gt;</div><div class="line">...</div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>è“ç‰™è®¾å¤‡å¯ç”¨æ€§  è·å– BluetoothAdapter<br>è·å– BluetoothAdapterï¼Œéœ€è¦é™æ€ getDefaultAdapter() æ–¹æ³•ã€‚getDefaultAdapter() ä¼šè¿”å›ä¸€ä¸ªè¡¨ç¤ºè®¾å¤‡è‡ªèº«çš„è“ç‰™é€‚é…å™¨çš„ BluetoothAdapter è®¾å¤‡ä¸æ”¯æŒè“ç‰™ åˆ™è¿”å› null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">BluetoothAdapter mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();</div><div class="line"><span class="keyword">if</span> (mBluetoothAdapter == <span class="keyword">null</span>) &#123;</div><div class="line">  <span class="comment">// è“ç‰™ä¸å¯ç”¨æ“ä½œ</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>å¼€å¯è“ç‰™<br>BluetoothAdapter çš„ .isEnabled() å¯ä»¥åˆ¤æ–­ç³»ç»Ÿè“ç‰™æ˜¯å¦å¼€å¯.<br>æ²¡æœ‰å¼€å¯æ—¶ startActivityForResult() å‘é€åŒ…å«  ACTION_REQUEST_ENABLE  çš„ Intent è¯·æ±‚ç³»ç»Ÿå¼€å¯è“ç‰™,å¹¶åœ¨ onActivityResult() è¿”å›çš„æ•°æ®ä¸­ RESULT_CANCELED è¡¨ç¤ºå¼€å¯å¤±è´¥ RESULT_OK  è¡¨ç¤ºå¼€å¯æˆåŠŸ,è¿™é‡Œæˆ‘ä»¬åªæ£€æµ‹å¼€å¯å¤±è´¥æƒ…å†µ,å¹¶æç¤ºç”¨æˆ· </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (!mBluetoothAdapter.isEnabled()) &#123;</div><div class="line">  Intent enableBtIntent = <span class="keyword">new</span> Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);</div><div class="line">  startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);</div><div class="line">&#125;</div><div class="line"></div><div class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (requestCode == REQUEST_ENABLE_BT &amp;&amp; resultCode == RESULT_CANCELED) &#123;</div><div class="line">          Toast.makeText(MyApplication.getContext(),R.string.Bluetooth_openfail, Toast.LENGTH_SHORT).show();</div><div class="line">      &#125;</div><div class="line">      BluetoothAdapter mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();</div><div class="line">      <span class="keyword">if</span> (mBluetoothAdapter == <span class="keyword">null</span>) &#123;</div><div class="line">          <span class="comment">//è®¾å¤‡ä¸æ”¯æŒè“ç‰™æ—¶å¤„ç†</span></div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥è¯¢å·²é…å¯¹çš„è®¾å¤‡<br>è°ƒç”¨ getBondedDevices(),è¿”å›å·²é…å¯¹è®¾å¤‡çš„ä¸€ç»„ BluetoothDevice.ä¹‹åä½¿ç”¨forå¾ªç¯éå†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Set&lt;BluetoothDevice&gt; pairedDevices = mBluetoothAdapter.getBondedDevices();</div><div class="line"><span class="keyword">if</span> (pairedDevices.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">//é‡æ–°åŠ è½½bluetoothDeviceList</span></div><div class="line">        bluetoothDeviceList.clear();</div><div class="line">        <span class="comment">//BluetoothDeviceåˆ—è¡¨å¾ªç¯</span></div><div class="line">        <span class="keyword">for</span> (BluetoothDevice device : pairedDevices) &#123;</div><div class="line">          bluetoothDeviceList.add(device);</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>æ‰«æè®¾å¤‡<br>æŸ¥æ‰¾è®¾å¤‡æ˜¯éå¸¸è€—è´¹ç³»ç»Ÿèµ„æºçš„äº‹é¡¹ï¼Œéœ€è¦å®‰æ’åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¿™é‡Œæ²¡æœ‰ç”¨åˆ°ï¼Œç”±éœ€è¦è¯·å‚è€ƒGoogleå®˜æ–¹è“ç‰™æ•™ç¨‹</p>
</li>
<li><p>è¿æ¥è®¾å¤‡<br>è“ç‰™åˆ†ä¸»ä»æœºï¼Œé“¾æ¥ä¸ºæœåŠ¡å™¨/å®¢æˆ·ç«¯ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯è¿æ¥ä¸ºå®¢æˆ·ç«¯ã€‚</p>
<ul>
<li>é¦–å…ˆè·å–è¿œç¨‹è®¾å¤‡çš„ BluetoothDevice å¯¹è±¡ï¼Œå³åœ¨é€‰æ‹©è®¾å¤‡é˜¶æ®µçš„BluetoothDevice</li>
<li>è°ƒç”¨ createRfcommSocketToServiceRecord(UUID) è·å– BluetoothSocketï¼ŒUUIDé€šç”¨å”¯ä¸€è¯†åˆ«ç  åœ¨è“ç‰™ä¸­å…·ä½“æ˜¯ä»€ä¹ˆæ²¡æœ‰å¾ˆå¥½çš„è§£é‡Šã€‚è¿™é‡Œçš„å€¼å–çš„æ˜¯<br><code>&quot;00001101-0000-1000-8000-00805F9B34FB&quot;</code></li>
<li>è°ƒç”¨ connect() å‘èµ·è¿æ¥,é˜»å¡è°ƒç”¨ï¼Œéœ€è¦åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//è“ç‰™è¿æ¥å­çº¿ç¨‹</span></div><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothSocket mmSocket;</div><div class="line"></div><div class="line">    <span class="comment">//è§£æå‡½æ•°</span></div><div class="line">    ConnectThread(BluetoothDevice bluetoothDevice) &#123;</div><div class="line">        <span class="comment">// ä½¿ç”¨ä¸€ä¸ªä¸­é—´å˜é‡ tmp</span></div><div class="line">        <span class="comment">// mmSocket ç±»å‹æ˜¯ final</span></div><div class="line"></div><div class="line">        BluetoothSocket tmp = <span class="keyword">null</span>;</div><div class="line">        <span class="comment">// è·å– BluetoothSocket</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// MY_UUID is the app's UUID string, also used by the server code</span></div><div class="line">            tmp = bluetoothDevice.createRfcommSocketToServiceRecord(UUID.fromString(MyApplication.MY_UUID));</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException ignored) &#123;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//èµ‹å€¼ç»™ mmSocket</span></div><div class="line">        mmSocket = tmp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// å…³é—­è“ç‰™æ‰«æ</span></div><div class="line">        MyApplication.getBluetoothAdapter().cancelDiscovery();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// é€šè¿‡ socket è¿æ¥åˆ°è®¾å¤‡. connect() ä¼šä¸€ç›´æ‰§è¡Œç›´åˆ°æˆåŠŸè¿æ¥æˆ–è€…æŠ›å‡ºå¼‚å¸¸</span></div><div class="line">            mmSocket.connect();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException connectException) &#123;</div><div class="line">            <span class="comment">//æ— æ³•è¿æ¥åˆ°è“ç‰™,å…³é—­è¿æ¥å¹¶é€€å‡º</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                mmSocket.close();</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//æ²¡æœ‰æ­£å¸¸å…³é—­</span></div><div class="line">            <span class="keyword">catch</span> (IOException ignored) &#123;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Do work to manage the connection (in a separate thread)</span></div><div class="line">        mConnectedThread = <span class="keyword">new</span> ConnectedThread(mmSocket);</div><div class="line">        mConnectedThread.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å…³é—­è“ç‰™è¿æ¥</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            mmSocket.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException ignored) &#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>ç®¡ç†è¿æ¥<br>è·å–BluetoothSocket<br>è·å– InputStream å’Œ OutputStreamï¼Œ getInputStream() å’Œ getOutputStream() æ¥å¤„ç†æ•°æ®ä¼ è¾“ã€‚read(byte[]) å’Œ write(byte[]) è¯»å–æ•°æ®å¹¶å†™å…¥åˆ°æµå¼ä¼ è¾“ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectedThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">      <span class="comment">//BluetoothSocket</span></div><div class="line">      <span class="keyword">private</span> <span class="keyword">final</span> BluetoothSocket mmSocket;</div><div class="line">      <span class="comment">//è¾“å…¥æµ</span></div><div class="line">      <span class="keyword">private</span> <span class="keyword">final</span> InputStream mmInStream;</div><div class="line">      <span class="comment">//è¾“å‡ºæµ</span></div><div class="line">      <span class="keyword">private</span> <span class="keyword">final</span> OutputStream mmOutStream;</div><div class="line"></div><div class="line">      ConnectedThread(BluetoothSocket socket) &#123;</div><div class="line">          <span class="comment">//ä¼ å…¥BluetoothSocketï¼Œå®ä¾‹åŒ–mmSocket</span></div><div class="line">          mmSocket = socket;</div><div class="line">          <span class="comment">//è¾“å…¥/è¾“å‡ºæµ ä¸­é—´å˜é‡</span></div><div class="line">          InputStream tmpIn = <span class="keyword">null</span>;</div><div class="line">          OutputStream tmpOut = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">          <span class="comment">// è¾“å…¥è¾“å‡ºæµå®ä¾‹åŒ–</span></div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">              tmpIn = socket.getInputStream();</div><div class="line">              tmpOut = socket.getOutputStream();</div><div class="line">          &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">              e.printStackTrace();</div><div class="line">          &#125;</div><div class="line">          mmInStream = tmpIn;</div><div class="line">          mmOutStream = tmpOut;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">          <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">          <span class="keyword">int</span> bytes;</div><div class="line">          <span class="comment">// è¿æ¥æˆåŠŸæ—¶</span></div><div class="line">          <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">              <span class="keyword">try</span> &#123;</div><div class="line">                  <span class="comment">// åœ¨InputStreamè¯»æ•°æ®</span></div><div class="line">                  bytes = mmInStream.read();</div><div class="line">                  <span class="comment">//å‘é€æ•°æ®</span></div><div class="line">                  Events.bluetooth_Recycle bluetooth_recycle = <span class="keyword">new</span> Events.bluetooth_Recycle();</div><div class="line">                  bluetooth_recycle.s = bytes;</div><div class="line">                  bluetooth_recycle.bytes = String.valueOf((<span class="keyword">char</span>) bytes);</div><div class="line">                  EventBus.getDefault().post(bluetooth_recycle);</div><div class="line">              &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                  <span class="keyword">break</span>;</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">//å†™æ–¹æ³•</span></div><div class="line">      <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">              mmOutStream.write(bytes);</div><div class="line">          &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">              e.printStackTrace();</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">//å…³é—­æµè¿æ¥</span></div><div class="line">      <span class="function"><span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">              mmSocket.close();</div><div class="line">          &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="EventBus"><a href="#EventBus" class="headerlink" title="EventBus"></a>EventBus</h3><ul>
<li>ç›´æ¥æ”¾é“¾æ¥äº†<blockquote>
<p><a href="http://www.jianshu.com/p/a040955194fc" target="_blank" rel="external">http://www.jianshu.com/p/a040955194fc</a><br><a href="http://www.jianshu.com/p/acfe78296bb5" target="_blank" rel="external">http://www.jianshu.com/p/acfe78296bb5</a><br><a href="http://www.ff50.net/view/40565212977623506063.html" target="_blank" rel="external">http://www.ff50.net/view/40565212977623506063.html</a></p>
</blockquote>
</li>
</ul>
<h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><ul>
<li><p>è“ç‰™è¿æ¥å­çº¿ç¨‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">      <span class="keyword">private</span> <span class="keyword">final</span> BluetoothSocket mmSocket;</div><div class="line"></div><div class="line">      <span class="comment">//è§£æå‡½æ•°</span></div><div class="line">      ConnectThread(BluetoothDevice bluetoothDevice) &#123;</div><div class="line">          <span class="comment">// ä½¿ç”¨ä¸€ä¸ªä¸­é—´å˜é‡ tmp</span></div><div class="line">          <span class="comment">// mmSocket ç±»å‹æ˜¯ final</span></div><div class="line"></div><div class="line">          BluetoothSocket tmp = <span class="keyword">null</span>;</div><div class="line">          <span class="comment">// è·å– BluetoothSocket</span></div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">              <span class="comment">// MY_UUID is the app's UUID string, also used by the server code</span></div><div class="line">              tmp = bluetoothDevice.createRfcommSocketToServiceRecord(UUID.fromString(MyApplication.MY_UUID));</div><div class="line">          &#125; <span class="keyword">catch</span> (IOException ignored) &#123;</div><div class="line">          &#125;</div><div class="line">          <span class="comment">//èµ‹å€¼ç»™ mmSocket</span></div><div class="line">          mmSocket = tmp;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">          <span class="comment">// å…³é—­è“ç‰™æ‰«æ</span></div><div class="line">          MyApplication.getBluetoothAdapter().cancelDiscovery();</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">              <span class="comment">// é€šè¿‡ socket è¿æ¥åˆ°è®¾å¤‡. connect() ä¼šä¸€ç›´æ‰§è¡Œç›´åˆ°æˆåŠŸè¿æ¥æˆ–è€…æŠ›å‡ºå¼‚å¸¸</span></div><div class="line">              mmSocket.connect();</div><div class="line">          &#125; <span class="keyword">catch</span> (IOException connectException) &#123;</div><div class="line">              <span class="comment">//æ— æ³•è¿æ¥åˆ°è“ç‰™,å…³é—­è¿æ¥å¹¶é€€å‡º</span></div><div class="line">              <span class="keyword">try</span> &#123;</div><div class="line">                  mmSocket.close();</div><div class="line">              &#125;</div><div class="line">              <span class="comment">//æ²¡æœ‰æ­£å¸¸å…³é—­</span></div><div class="line">              <span class="keyword">catch</span> (IOException ignored) &#123;</div><div class="line">              &#125;</div><div class="line">              <span class="keyword">return</span>;</div><div class="line">          &#125;</div><div class="line">          <span class="comment">// Do work to manage the connection (in a separate thread)</span></div><div class="line">          mConnectedThread = <span class="keyword">new</span> ConnectedThread(mmSocket);</div><div class="line">          mConnectedThread.start();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">/**</span></div><div class="line">       * å…³é—­è“ç‰™è¿æ¥</div><div class="line">       */</div><div class="line">      <span class="function"><span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">              mmSocket.close();</div><div class="line">          &#125; <span class="keyword">catch</span> (IOException ignored) &#123;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ç®¡ç†è¿æ¥å­çº¿ç¨‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">//ç®¡ç†è¿æ¥å­çº¿ç¨‹</span></div><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectedThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">    <span class="comment">//BluetoothSocket</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothSocket mmSocket;</div><div class="line">    <span class="comment">//è¾“å…¥æµ</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InputStream mmInStream;</div><div class="line">    <span class="comment">//è¾“å‡ºæµ</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OutputStream mmOutStream;</div><div class="line"></div><div class="line">    ConnectedThread(BluetoothSocket socket) &#123;</div><div class="line">        <span class="comment">//ä¼ å…¥BluetoothSocketï¼Œå®ä¾‹åŒ–mmSocket</span></div><div class="line">        mmSocket = socket;</div><div class="line">        <span class="comment">//è¾“å…¥/è¾“å‡ºæµ ä¸­é—´å˜é‡</span></div><div class="line">        InputStream tmpIn = <span class="keyword">null</span>;</div><div class="line">        OutputStream tmpOut = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        <span class="comment">// è¾“å…¥è¾“å‡ºæµå®ä¾‹åŒ–</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            tmpIn = socket.getInputStream();</div><div class="line">            tmpOut = socket.getOutputStream();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        mmInStream = tmpIn;</div><div class="line">        mmOutStream = tmpOut;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">        <span class="keyword">int</span> bytes;</div><div class="line">        <span class="comment">// è¿æ¥æˆåŠŸæ—¶</span></div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="comment">// åœ¨InputStreamè¯»æ•°æ®</span></div><div class="line">                bytes = mmInStream.read();</div><div class="line">                <span class="comment">//å‘é€æ•°æ®</span></div><div class="line">                Events.bluetooth_Recycle bluetooth_recycle = <span class="keyword">new</span> Events.bluetooth_Recycle();</div><div class="line">                bluetooth_recycle.s = bytes;</div><div class="line">                bluetooth_recycle.bytes = String.valueOf((<span class="keyword">char</span>) bytes);</div><div class="line">                EventBus.getDefault().post(bluetooth_recycle);</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//å†™æ–¹æ³•</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            mmOutStream.write(bytes);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//å…³é—­æµè¿æ¥</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            mmSocket.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>è¿æ¥è“ç‰™<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//è¿æ¥çº¿ç¨‹</span></div><div class="line"><span class="keyword">private</span> ConnectThread mConnectThread;</div><div class="line"><span class="comment">//ç®¡ç†è¿æ¥è¿›ç¨‹</span></div><div class="line"><span class="keyword">private</span> ConnectedThread mConnectedThread;</div><div class="line"></div><div class="line"><span class="comment">//åˆ›å»ºè¿æ¥å­çº¿ç¨‹</span></div><div class="line">mConnectThread = <span class="keyword">new</span> ConnectThread(bluetoothDevice);</div><div class="line"><span class="comment">//å¯åŠ¨è¿æ¥å­çº¿ç¨‹</span></div><div class="line">mConnectThread.start();</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>å‘è“ç‰™å†™å…¥æ•°æ®<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//å‘é€æ•°æ®String,        ä¸»çº¿ç¨‹            ä¼˜å…ˆçº§4       éç²˜æ€§äº‹ä»¶</span></div><div class="line"><span class="meta">@Subscribe</span>(threadMode = ThreadMode.MAIN, priority = <span class="number">4</span>, sticky = <span class="keyword">false</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(Events.bluetooth_Send bluetoothSend)</span> </span>&#123;</div><div class="line">    String bytes = bluetoothSend.bytes;</div><div class="line">    mConnectedThread.write(bytes.getBytes());</div><div class="line">    LogUtil.d(Tag, <span class="string">"onEvent:Send"</span> + bluetoothSend.bytes);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>æ¥æ”¶æ•°æ®å¤„ç†<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">//æ•°æ®è½¬æ¢                åå°è¿›ç¨‹            ä¼˜å…ˆçº§3       éç²˜æ€§äº‹ä»¶</span></div><div class="line"><span class="meta">@Subscribe</span>(threadMode = ThreadMode.BACKGROUND, priority = <span class="number">3</span>, sticky = <span class="keyword">false</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(Events.bluetooth_Transformers bluetoothTransformers)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> bytes = bluetoothTransformers.bytes;</div><div class="line">    <span class="comment">//å¤„ç†æ•°æ®</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;èµ„æ–™æ¥æºå¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–ç¨‹ç¯å¢ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Android Studio 2.2.3 &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¼è¯­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯•è®¾ä¸­çš„è“ç‰™éƒ¨åˆ†,è®°å½•ä»¥ä¾›å¤ä¹ &lt;/
    
    </summary>
    
      <category term="Androidç¬”è®°" scheme="http://yoursite.com/categories/Android%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
      <category term="æ¯•è®¾" scheme="http://yoursite.com/tags/%E6%AF%95%E8%AE%BE/"/>
    
      <category term="BlueTooth" scheme="http://yoursite.com/tags/BlueTooth/"/>
    
  </entry>
  
  <entry>
    <title>ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ï¼ˆä¸‰ï¼‰â€”â€”VPSå®‰å…¨åŠ å›º</title>
    <link href="http://yoursite.com/2017/04/08/VPS%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E6%95%99%E7%A8%8B3/"/>
    <id>http://yoursite.com/2017/04/08/VPSç§‘å­¦ä¸Šç½‘æ•™ç¨‹3/</id>
    <published>2017-04-08T09:52:16.000Z</published>
    <updated>2017-10-30T15:15:01.464Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">æ›´æ–°</div><div class="line"><span class="number">2017.04</span>.<span class="number">08</span>  VPSæ—¥å¸¸ä¸€äº›å®‰å…¨æªæ–½</div><div class="line"><span class="number">2017.08</span>.<span class="number">22</span>  æ›´æ–°å®‰å…¨æªæ–½ï¼Œè¯»è€…åé¦ˆï¼Œæ²¡æœ‰debiançš„ï¼Œè¿™é‡ŒåŠ ä¸Šã€‚</div><div class="line"><span class="number">2017.10</span>.<span class="number">30</span>  çº æ­£é”™è¯¯,æ’ç‰ˆ.</div></pre></td></tr></table></figure>
<hr>
<ul>
<li><p>å¯¼è¯­<br>ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ç³»åˆ—ï¼Œå¾ˆä¹…æ²¡æœ‰æ›´æ–°æ–°å†…å®¹äº†ã€‚æ›´æ–°å¸¸ç”¨å®‰å…¨æªæ–½ï¼Œè‡³å°‘ä¿è¯ï¼Œä¸ä¼šè¢«è½»æ˜“çš„å½“ä½œè‚‰é¸¡ã€‚éƒ½æ˜¯ä¸€äº›å¸¸ç”¨çš„å®‰å…¨æªæ–½ã€‚</p>
</li>
<li><p>ç³»ç»Ÿç¯å¢ƒï¼šCentOS/debian 7</p>
</li>
</ul>
<hr>
<h2 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h2><ul>
<li>æœ‰ä¸¤ç§æ–¹æ¡ˆ<ul>
<li>å½»åº•å…³é—­SSHç™»é™†ï¼Œæ”¹ä¸ºå¯†é’¥ç™»é™†ï¼Œå®‰å…¨æ€§æœ€é«˜ï¼Œä½†é…ç½®è¾ƒä¸ºå¤æ‚</li>
<li>ä¿®æ”¹SSHç™»é™†ç«¯å£ï¼ŒåŒæ—¶å¼€æ”¾é»˜è®¤ç«¯å£ï¼Œå°†çˆ†ç ´ ssh å¯†ç çš„ IP å°åœ<h3 id="å¯†é’¥ç™»é™†"><a href="#å¯†é’¥ç™»é™†" class="headerlink" title="å¯†é’¥ç™»é™†"></a>å¯†é’¥ç™»é™†</h3></li>
</ul>
</li>
<li>ä¸»è¦æ­¥éª¤åœ¨è¿™é‡Œ,æœ‰æ—¶é—´å†æ›´æ–°<blockquote>
<p><a href="https://ttt.tt/104/" target="_blank" rel="external">https://ttt.tt/104/</a></p>
</blockquote>
</li>
</ul>
<h3 id="ä¿®æ”¹ç«¯å£"><a href="#ä¿®æ”¹ç«¯å£" class="headerlink" title="ä¿®æ”¹ç«¯å£"></a>ä¿®æ”¹ç«¯å£</h3><ul>
<li><p>CentOS å‘½ä»¤ å¦‚ä¸‹ï¼Œä»¥ä¸‹æ˜¯å°† SSH ç«¯å£æ”¹ä¸º 999 ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed -i &apos;s/#Port 22/Port 999/g&apos; /etc/ssh/sshd_config</div></pre></td></tr></table></figure>
<ul>
<li><p>debianéœ€è¦æ‰“å¼€/etc/ssh/sshd<em>config </em>æ–‡ä»¶ï¼Œä¿®æ”¹å…¶ä¸­çš„portåé¢çš„æ•°å­—,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano /etc/ssh/sshd_config</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹å…¶ä¸­çš„portåé¢çš„æ•°å­—ï¼Œä¸ºä½ è¦sshç™»é™†çš„ç«¯å£ï¼Œcltrl + xä¿å­˜ï¼Œå›è½¦é€€å‡ºã€‚</p>
</li>
</ul>
</li>
</ul>
<h2 id="fail2ban"><a href="#fail2ban" class="headerlink" title="fail2ban"></a>fail2ban</h2><ul>
<li><p>fail2ban æ˜¯ Linux ä¸Šçš„ä¸€ä¸ªè‘—åçš„å…¥ä¾µä¿æŠ¤çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä¼šç›‘æ§å¤šä¸ªç³»ç»Ÿçš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ£€æµ‹åˆ°çš„ä»»ä½•å¯ç–‘çš„è¡Œä¸ºè‡ªåŠ¨è§¦å‘ä¸åŒçš„é˜²å¾¡åŠ¨ä½œã€‚å°†å°è¯•çˆ†ç ´ ssh å¯†ç çš„ IP å°åœï¼Œé»˜è®¤10åˆ†é’Ÿã€‚</p>
</li>
<li><p>è¯¦ç»†é…ç½®å®‰è£…æ–¹æ³•åœ¨å¦‚ä¸‹ç½‘å€ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤é…ç½®å³å¯ã€‚</p>
<blockquote>
<p><a href="https://linux.cn/article-5067-1.html" target="_blank" rel="external">https://linux.cn/article-5067-1.html</a></p>
</blockquote>
</li>
<li><p>å®‰è£… fail2ban<br>CentOS éœ€è¦æå‰ <a href="https://linux.cn/article-2324-1.html" target="_blank" rel="external"> è®¾ç½® EPEL ä»“åº“ </a><br>ä»¥ root ç”¨æˆ·ç™»é™†ï¼Œé root ç”¨æˆ·éœ€è¦ å‘½ä»¤å‰ å¢åŠ  sudo</p>
<p>å®‰è£…å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//CentOS</div><div class="line">yum install fail2ban</div><div class="line">//Debian / ubuntu</div><div class="line">apt-get install fail2ban</div></pre></td></tr></table></figure>
</li>
<li><p>å…¶ä»–å‘½ä»¤</p>
<ul>
<li><p>é‡å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service fail2ban restart</div></pre></td></tr></table></figure>
</li>
<li><p>éªŒè¯çŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fail2ban-client ping</div></pre></td></tr></table></figure>
<p>è¿”å›</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Server replied: pong</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ï¼ˆdebianä¸ç”¨å‰é¢éªŒè¯å®Œæˆï¼Œå·²åŠ å…¥å¼€æœºå¯åŠ¨ï¼‰</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// CentOS/RHEL 6</div><div class="line">chkconfig fail2ban on</div><div class="line">// CentOS/RHEL 7</div><div class="line">systemctl enable fail2ban</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ç¦ç”¨Linuxå¤šä½™ç«¯å£"><a href="#ç¦ç”¨Linuxå¤šä½™ç«¯å£" class="headerlink" title="ç¦ç”¨Linuxå¤šä½™ç«¯å£"></a>ç¦ç”¨Linuxå¤šä½™ç«¯å£</h2><ul>
<li>å…³é—­å¤šä½™ç«¯å£æ˜¯æ°¸è¿œæ­£ç¡®çš„é€‰æ‹©ï¼åªç•™ä¸‹å¸¸ç”¨ç«¯å£ å’Œ SSRç«¯å£</li>
<li><p>é…ç½®  iptables <strong>è­¦å‘Š iptables é…ç½®ä¸æ˜¯ä¸€èˆ¬çš„å¤æ‚ï¼Œè°¨æ…æ“ä½œ</strong></p>
</li>
<li><p>æ¸…ç©ºé»˜è®¤è§„åˆ™</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -F</div></pre></td></tr></table></figure>
</li>
<li><p>å…è®¸22ç«¯å£ï¼Œç»™æš´åŠ›ç ´è§£ç•™ç‚¹ç©ºé—´ //doge</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</div><div class="line">iptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</div></pre></td></tr></table></figure>
</li>
<li><p>å…è®¸53ç«¯å£ udp ï¼Œä¸€èˆ¬ç”¨åšDNSæœåŠ¡å™¨ï¼Œå¦‚æœä½ ä¸éœ€è¦åˆ™å¿½ç•¥æ­¤æ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -A OUTPUT -p udp --dport 53 -j ACCEPT</div><div class="line">iptables -A INPUT -p udp --sport 53 -j ACCEPT</div></pre></td></tr></table></figure>
</li>
<li><p>å…è®¸æœ¬æœºè®¿é—®æœ¬æœº</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -A INPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT</div><div class="line">iptables -A OUTPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>å…è®¸çœŸæ­£ SSH ç«¯å£</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -A INPUT -p tcp -s 0/0 --dport 999 -j ACCEPT</div><div class="line">iptables -A OUTPUT -p tcp --sport 999 -m state --state ESTABLISHED -j ACCEPT</div></pre></td></tr></table></figure>
</li>
<li><p>å…è®¸ 80 443 ç«¯å£ï¼Œhttp å’Œ https</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">iptables -A INPUT -p tcp -s 0/0 --dport 80 -j ACCEPT</div><div class="line">iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</div><div class="line">iptables -A INPUT -p tcp -s 0/0 --dport 443 -j ACCEPT</div><div class="line">iptables -A OUTPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT</div></pre></td></tr></table></figure>
</li>
<li><p>å…è®¸ SSRç«¯å£ ä»¥888 xxx ä¸ºä¾‹ ä½ æœ‰å‡ ä¸ªç«¯å£ï¼Œå°±æ·»åŠ å‡ ä¸ª</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">iptables -A INPUT -p tcp -s 0/0 --dport 888 -j ACCEPT</div><div class="line">iptables -A OUTPUT -p tcp --sport 888 -m state --state ESTABLISHED -j ACCEPT</div><div class="line"></div><div class="line">iptables -A INPUT -p tcp -s 0/0 --dport xxx -j ACCEPT</div><div class="line">iptables -A OUTPUT -p tcp --sport xxx -m state --state ESTABLISHED -j ACCEPT</div></pre></td></tr></table></figure>
</li>
<li><p>CentOS ä¿å­˜é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">iptables-save &gt; /etc/sysconfig/iptables</div><div class="line">``` </div><div class="line">é‡è½½ iptables</div></pre></td></tr></table></figure>
<p>iptables -L</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">  </div><div class="line">* debian 7 ä¿å­˜é…ç½®</div></pre></td></tr></table></figure>
<p>iptables-save &gt; /etc/iptables-rules<br>ip6tables-save &gt; /etc/ip6tables-rules</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">éšåä¿®æ”¹/etc/network/interfacesæ–‡ä»¶ï¼Œæœ€ååŠ å…¥</div></pre></td></tr></table></figure>
<p>pre-up iptables-restore &lt; /etc/iptables-rules<br>pre-up ip6tables-restore &lt; /etc/ip6tables-rules</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  é‡å¯æ‰§è¡Œ`iptables -L`ï¼Œçœ‹åˆ°é…ç½®å·²ç”Ÿæ•ˆã€‚</div><div class="line"></div><div class="line">## å®‰è£… CSF é˜²ç«å¢™</div><div class="line">* å‘½ä»¤</div></pre></td></tr></table></figure>
<p>rm -fv csf.tgz<br>wget <a href="http://download.configserver.com/csf.tgz" target="_blank" rel="external">http://download.configserver.com/csf.tgz</a><br>tar -xzf csf.tgz<br>cd csf<br>sh install.sh<br>//ä½¿ç”¨ä¸‹è¾¹çš„å‘½ä»¤æ¥éªŒè¯csfæ­£ç¡®å®‰è£…å¹¶å·²ç»è¿è¡Œ<br>perl /usr/local/csf/bin/csftest.pl</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">## autoban è¡¥ä¸ï¼ˆ8.22ï¼‰æ¨è</div><div class="line">* æ¥è‡ªssåŸä½œè€…@clowwindy çš„è¡¥ä¸ï¼Œbanæ‰é‚£äº›å°è¯•ç ´è¯‘sså¯†ç çš„ipï¼Œåœ¨æ­¤å¯¹åŸä½œè€…è¡¨ç¤ºæ•¬æ„ï¼</div><div class="line">* åŸç†æ˜¯åŒä¸€ä¸ªipå‡ºç°3æ¬¡ä»¥ä¸Šå°è¯•ç ´è¯‘sså¯†ç ä¼šè¢«æ°¸ä¹…banæ‰ï¼Œssrä¹Ÿå¯ç”¨</div><div class="line">* æµ‹è¯•åªåœ¨debian 7ä¸Šè¿›è¡Œï¼Œéœ€è¦pythonç¯å¢ƒï¼Œä½†æ˜¯é€šè¿‡ç§‹æ°´é€¸å†°è„šæœ¬å®‰è£…ssr å·²ç»å®‰è£…å¥½äº†pythonç¯å¢ƒã€‚</div><div class="line"></div><div class="line">* ä»¥ä¸‹å†…å®¹å‚è€ƒ</div><div class="line">  &gt;https://plus.google.com/104980438521301094845/posts/9zypCffhdZu</div><div class="line"></div><div class="line">---</div><div class="line"></div><div class="line">* ä¸‹è½½è„šæœ¬</div></pre></td></tr></table></figure>
<p>wget <a href="https://raw.githubusercontent.com/Jasper-1024/shadowsocksr/manyuser/utils/autoban.py" target="_blank" rel="external">https://raw.githubusercontent.com/Jasper-1024/shadowsocksr/manyuser/utils/autoban.py</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">  </div><div class="line">* ssrè¿è¡Œ</div></pre></td></tr></table></figure>
<p>python autoban.py &lt; /var/log/shadowsocksr.log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  æŸ¥çœ‹å“ªäº›ipè¯•å›¾è¿æ¥ç ´è§£ssrå¯†ç ã€‚åŸç‰ˆsså°†logæ–‡ä»¶è·¯å¾„æ›¿æ¢å³å¯ã€‚</div><div class="line">  </div><div class="line">* è‡ªåŠ¨ban ip</div><div class="line">  ç¼–è¾‘/etc/init.d/rc.localï¼ŒåŠ å…¥</div></pre></td></tr></table></figure>
<p>python /root/autoban.py &lt; /var/log/shadowsocksr.log</p>
<p>nohup tail -F /var/log/shadowsocksr.log | python /root/autoban.py &gt;log 2&gt;log &amp;<br>```<br>ä¿å­˜é€€å‡ºå³å¯ã€‚</p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight vim&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;
    
    </summary>
    
      <category term="ç§‘å­¦ä¸Šç½‘" scheme="http://yoursite.com/categories/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="VPS" scheme="http://yoursite.com/tags/VPS/"/>
    
  </entry>
  
  <entry>
    <title>Androidç¬”è®°â€”ä»¿ç»¿è‰²å®ˆæŠ¤å—œç¡æ¨¡å¼é€šçŸ¥</title>
    <link href="http://yoursite.com/2017/03/07/Android%E7%AC%94%E8%AE%B0%E2%80%94%E4%BB%BF%E7%BB%BF%E8%89%B2%E5%AE%88%E6%8A%A4%E5%97%9C%E7%9D%A1%E6%A8%A1%E5%BC%8F%E9%80%9A%E7%9F%A5/"/>
    <id>http://yoursite.com/2017/03/07/Androidç¬”è®°â€”ä»¿ç»¿è‰²å®ˆæŠ¤å—œç¡æ¨¡å¼é€šçŸ¥/</id>
    <published>2017-03-07T04:00:00.000Z</published>
    <updated>2017-03-15T01:51:24.740Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>èµ„æ–™æ¥æºå¦‚ä¸‹</p>
<ul>
<li>ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ)</li>
<li><a href="https://developer.android.com/training/notify-user/index.html" target="_blank" rel="external">Android  Training Notifying the User</a></li>
<li><a href="https://developer.android.com/guide/topics/ui/notifiers/notifications.html#CreateNotification" target="_blank" rel="external">Android API é€šçŸ¥</a></li>
<li><a href="https://www.oschina.net/question/234345_40111" target="_blank" rel="external">ã€Androidã€‘çŠ¶æ€æ é€šçŸ¥Notificationã€NotificationManagerè¯¦è§£</a></li>
</ul>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 2.2.3 </li>
</ul>
<p>å¯¼è¯­</p>
<ul>
<li>OneTapDozeé‡åˆ°çš„ç¬¬ä¸€ä¸ªéš¾é¢˜ï¼Œé¡ºå¸¦è®°å½•Android é€šçŸ¥ç›¸å…³å†…å®¹</li>
</ul>
<hr>
<h2 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h2><ul>
<li><p>ç»¿è‰²å®ˆæŠ¤è¿›å…¥dozeæ¨¡å¼åï¼Œä¼šåœ¨é€šçŸ¥æ åˆ›å»ºä¸€ä¸ªè®¡æ—¶é€šçŸ¥ å¦‚ä¸‹å›¾<br><img src="http://cdn3.snapgram.co/imgs/2017/03/07/Screenshot_20170307-231118.png" alt="Screenshot_20170307-231118.png"></p>
</li>
<li><p>é€€å‡ºdozeæ¨¡å¼åï¼Œä¼šæŒ‡ç¤ºè¿›å…¥dozeå’Œé€€å‡ºdozeçš„æ—¶é—´æ®µã€‚<br><img src="http://cdn4.snapgram.co/images/2017/03/07/Screenshot_20170307-231132.png" alt="Screenshot_20170307-231132.png"></p>
</li>
<li><p>æˆ‘ä»¬è¦ä»¿ç…§çš„æ ·å¼å°±æ˜¯è¿™æ ·ï¼Œè¿›å…¥é€€å‡ºdozeï¼Œå¯¹åº”åˆ›å»ºé€šçŸ¥çš„ä»£ç éƒ½åœ¨dozeæ¨¡å¼æ”¹å˜çš„Broadcastä¸­ã€‚</p>
</li>
</ul>
<h2 id="åŸºç¡€éƒ¨åˆ†"><a href="#åŸºç¡€éƒ¨åˆ†" class="headerlink" title="åŸºç¡€éƒ¨åˆ†"></a>åŸºç¡€éƒ¨åˆ†</h2><h3 id="åˆ›å»ºé€šçŸ¥"><a href="#åˆ›å»ºé€šçŸ¥" class="headerlink" title="åˆ›å»ºé€šçŸ¥"></a>åˆ›å»ºé€šçŸ¥</h3><ul>
<li>è¡Œæ–‡å‰ï¼š<br>Androidæ¯æ¬¡ç‰ˆæœ¬å‡ ä¹éƒ½ä¼šæœ‰é€šçŸ¥APIçš„æ”¹åŠ¨ï¼Œä¸åŒç‰ˆæœ¬ä¹‹é—´é€šçŸ¥å…¼å®¹æ€§å¾ˆæ˜¯é—®é¢˜ï¼Œä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨support_v7 åº“ä¸­çš„NotificationCompat.Builderä»£æ›¿Notification.BuilderäºŒè€…ä½¿ç”¨æ–¹å¼ç›¸åŒ</li>
</ul>
<hr>
<ul>
<li><p>æ¶‰åŠåˆ°çš„ä¸¤ä¸ªç±»</p>
<ul>
<li>NotificationManager</li>
<li>Notification (supportåº“ä¸­å¯¹åº”NotificationCompat)</li>
</ul>
</li>
<li><p>NotificationManager</p>
<ul>
<li>çŠ¶æ€æ é€šçŸ¥çš„ç®¡ç†ç±»ï¼Œè´Ÿè´£å‘é€šçŸ¥ã€æ¸…é™¤é€šçŸ¥ç­‰ </li>
<li>NotificationManager æ˜¯ä¸€ä¸ªç³»ç»ŸServiceï¼Œå¿…é¡»é€šè¿‡ getSystemService()æ–¹æ³•æ¥è·å–</li>
</ul>
</li>
<li><p>Notification</p>
<ul>
<li>å…·ä½“çš„çŠ¶æ€æ é€šçŸ¥å¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®iconã€æ–‡å­—ã€æç¤ºå£°éŸ³ã€æŒ¯åŠ¨ç­‰å‚æ•°</li>
<li>ä¸€ä¸ªBuilderå¯¹è±¡è‡³å°‘åŒ…å«ä¸‰ä¸ªæ–¹é¢<ul>
<li>ä¸€ä¸ªå°å›¾æ ‡ï¼Œé€šè¿‡setSmallIcon()æ–¹æ³•è®¾ç½®ã€‚</li>
<li>é€šçŸ¥æ ‡é¢˜ï¼Œé€šè¿‡setContentTitle()æ–¹æ³•è®¾ç½®ã€‚</li>
<li>è¯¦ç»†æ–‡æœ¬ï¼Œé€šè¿‡setContentText()æ–¹æ³•è®¾ç½®ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p>ç®€å•ç¤ºä¾‹</p>
<ul>
<li><p>åˆ›å»ºé€šçŸ¥æ„å»ºå™¨<br> ä»£ç </p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Notification notification = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>)</div><div class="line">           .setContentTitle(<span class="string">"è¿™æ˜¯é€šçŸ¥æ ‡é¢˜"</span>)</div><div class="line">           .setContentText(<span class="string">"è¿™æ˜¯é€šçŸ¥å†…å®¹"</span>)</div><div class="line">           <span class="comment">//è¿™é‡Œä½¿ç”¨çš„æ˜¯åº”ç”¨å›¾æ ‡ï¼Œä¸€èˆ¬æ²¡äººè¿™ä¹ˆå¹²ï¼Œå°±æ˜¯ä¸ºäº†æ–¹ä¾¿</span></div><div class="line">           .setSmallIcon(R.mipmap.ic_launcher)</div><div class="line">           .build();</div></pre></td></tr></table></figure>
<ul>
<li><p>å‘å¸ƒé€šçŸ¥</p>
<ul>
<li>è·å¾—NotificationManagerçš„å®ä¾‹</li>
<li>ä½¿ç”¨notify()æ–¹æ³•å‘å¸ƒé€šçŸ¥ã€‚åœ¨è°ƒç”¨notify()æ–¹æ³•  æŒ‡å®šé€šçŸ¥çš„IDï¼Œ(IDç”¨äºé€šçŸ¥æ›´æ–°)  åŠ è½½Notificationå®ä¾‹</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> mNotificationId = <span class="number">001</span>;</div><div class="line"></div><div class="line">NotificationManager manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</div><div class="line">manager.notify(mNotificationId, notification);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>æ•ˆæœå¦‚ä¸‹</p>
<ul>
<li>android 7.0 / 6.0 /4.0 é€šè¿‡</li>
<li><img src="http://cdn1.snapgram.co/imgs/2017/02/02/ScreenShot_20170202173430.png" alt="ScreenShot_20170202173430.png"></li>
</ul>
</li>
</ul>
<h3 id="æ›´æ–°é€šçŸ¥"><a href="#æ›´æ–°é€šçŸ¥" class="headerlink" title="æ›´æ–°é€šçŸ¥"></a>æ›´æ–°é€šçŸ¥</h3><ul>
<li><p>å¯ä»¥åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„NotificationCompatå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åœ¨åŸNotificationCompatå¯¹è±¡åŸºç¡€ä¸Šä¿®æ”¹ï¼Œæœ€ååªè¦ .notify æ–¹æ³•ä¸­å¯¹åº”åŒä¸€ä¸ª mNotificationId ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æ›´æ–°å·²æœ‰é€šçŸ¥ï¼Œä»£ç ä¸åœ¨ç´¯èµ˜ã€‚</p>
</li>
<li><p>åŸºç¡€éƒ¨åˆ†åˆ°æ­¤ï¼Œè¶³çŸ£</p>
</li>
</ul>
<h2 id="æ­£é¢˜"><a href="#æ­£é¢˜" class="headerlink" title="æ­£é¢˜"></a>æ­£é¢˜</h2><ul>
<li>å®ç°æ—¶é—´æ®µçš„æ˜¾ç¤ºï¼Œè‚¯å®šä¼šä¿å­˜ç³»ç»Ÿè¿›å…¥doze é€€å‡ºdozeå¯¹åº”çš„æ—¶é—´ç‚¹ã€‚å†è®¡ç®—å‡ºä¸­é—´ç»å†çš„æ—¶é—´ã€‚</li>
</ul>
<h3 id="æå–ç³»ç»Ÿæ—¶é—´"><a href="#æå–ç³»ç»Ÿæ—¶é—´" class="headerlink" title="æå–ç³»ç»Ÿæ—¶é—´"></a>æå–ç³»ç»Ÿæ—¶é—´</h3><ul>
<li><p>java.util.Date<br>è¿™é‡Œç”¨åˆ°äº†javaä¸­çš„ æ—¶é—´ç±»å‹ java.util.Date<br>java.util.Date æ˜¯javaä¸­å¸¸ç”¨æ—¶é—´ç±»å‹ï¼Œå¯ä»¥è¢«SimpleDateFormatæ ¼å¼åŒ–format() æŒ‡å®šè¾“å‡ºçš„æ—¶é—´æ ¼å¼<br>æ¯”å¦‚æˆ‘ä»¬éœ€è¦ å°æ—¶ï¼šåˆ†ï¼šç§’<br><code>SimpleDateFormat scanf = new SimpleDateFormat(&quot;HH:mm:ss&quot;);</code><br><code>scanf.format(java.util.Date)</code> å³å¯ã€‚</p>
</li>
<li><p>æå‰å½“å‰ç³»ç»Ÿæ—¶é—´</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">java.util.Date time_after = <span class="keyword">null</span>;</div><div class="line">time_after = <span class="keyword">new</span> java.util.Date(System.currentTimeMillis());</div></pre></td></tr></table></figure>
</li>
<li><p>è®¡ç®—æ—¶é—´å·®<br>ç†è®ºä¸Šæ˜¯ä¸¤ä¸ªæ—¶é—´ç›¸å‡å†æ ¼å¼åŒ–è¾“å‡ºå³å¯ï¼Œå¯æƒœæ²¡æˆï¼ŒåŸå› è¿˜æ²¡æ‰¾åˆ°ã€‚äºæ˜¯åœŸåŠæ³•ï¼š</p>
<ul>
<li>è°ƒç”¨ .getTime() æ–¹æ³•ï¼Œå°† java.util.Date è½¬åŒ–ä¸ºæ¯«ç§’è®¡æ—¶(long)</li>
<li>å–ä¸¤è€…å·®å€¼</li>
<li>è½¬åŒ–ä¸º æ—¶é—´é•¿çŸ­ å­—ç¬¦ä¸²è¿”å›ï¼Œ</li>
<li>ä»£ç å¦‚ä¸‹<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"> size = (time_after.getTime() - time_befor.getTime());</div><div class="line"> string = scanf.format(time_befor) + <span class="string">"-"</span> + scanf.format(time_after) + <span class="string">"="</span>+ trform(size);</div><div class="line">      </div><div class="line"> <span class="function">String <span class="title">trform</span><span class="params">(<span class="keyword">long</span> size)</span> </span>&#123;</div><div class="line"> <span class="keyword">long</span> day, hour, min, secone;</div><div class="line"> </div><div class="line"> day = size / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>);          <span class="comment">//ä»¥å¤©æ•°ä¸ºå•ä½å–æ•´</span></div><div class="line"> hour = (size / (<span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>) - day * <span class="number">24</span>);             <span class="comment">//ä»¥å°æ—¶ä¸ºå•ä½å–æ•´</span></div><div class="line"> min = ((size / (<span class="number">60</span> * <span class="number">1000</span>)) - day * <span class="number">24</span> * <span class="number">60</span> - hour * <span class="number">60</span>);    <span class="comment">//ä»¥åˆ†é’Ÿä¸ºå•ä½å–æ•´</span></div><div class="line"> secone = (size / <span class="number">1000</span> - day * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> - hour * <span class="number">60</span> * <span class="number">60</span> - min * <span class="number">60</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (day != <span class="number">0</span>) &#123;</div><div class="line">   <span class="keyword">return</span> day + <span class="string">"d"</span> + hour + <span class="string">"h"</span> + min + <span class="string">"m"</span> + secone + <span class="string">"s"</span>;</div><div class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hour != <span class="number">0</span>) &#123;</div><div class="line">         <span class="keyword">return</span> hour + <span class="string">"h"</span> + min + <span class="string">"m"</span> + secone + <span class="string">"s"</span>;</div><div class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (min != <span class="number">0</span>) &#123;</div><div class="line">         <span class="keyword">return</span> min + <span class="string">"m"</span> + secone + <span class="string">"s"</span>;</div><div class="line">     &#125; <span class="keyword">else</span> &#123;</div><div class="line">         <span class="keyword">return</span> secone + <span class="string">"s"</span>;</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="é€šçŸ¥æ‰©å±•å¸ƒå±€"><a href="#é€šçŸ¥æ‰©å±•å¸ƒå±€" class="headerlink" title="é€šçŸ¥æ‰©å±•å¸ƒå±€"></a>é€šçŸ¥æ‰©å±•å¸ƒå±€</h3><ul>
<li><p>åœ¨å¦‚ä¸‹å›¾ç‰‡ä¸­ï¼Œå¯ä»¥å‘ç°ï¼Œé€šçŸ¥åœ¨å‘å‡ºåï¼Œåªé»˜è®¤æ˜¾ç¤ºæœ€è¿‘ä¸€æ¬¡çš„æ—¶é—´è®°å½•ï¼Œå…¶ä»–æ—¶é—´è®°å½•å¯ä»¥åœ¨æ­¤æ¡é€šçŸ¥ä¸Šä¸‹æ»‘æŸ¥çœ‹ã€‚æ˜æ˜¾ä¸åŸºç¡€éƒ¨åˆ†ä¸åŒã€‚<br><img src="http://cdn4.snapgram.co/images/2017/03/07/Screenshot_20170307-231132.png" alt="Screenshot_20170307-231132.png"></p>
</li>
<li><p>æ­¤å¤„åº”ç”¨äº† Builder.setStyle() æ‹“å±•å¸ƒå±€ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ç”¨äºæ‹“å±•é€šçŸ¥æ˜¾ç¤ºèŒƒå›´</p>
</li>
</ul>
<hr>
<h4 id="ä½¿ç”¨æ‰©å±•å¸ƒå±€"><a href="#ä½¿ç”¨æ‰©å±•å¸ƒå±€" class="headerlink" title="ä½¿ç”¨æ‰©å±•å¸ƒå±€"></a>ä½¿ç”¨æ‰©å±•å¸ƒå±€</h4><ul>
<li>ä½¿ç”¨æ‹“å±•å¸ƒå±€<ul>
<li>æ„å»ºä¸€ä¸ª inboxStyle å¯¹è±¡</li>
<li>.addLineæ–¹æ³•  æ·»åŠ  String  inboxStyle è¡Œ</li>
<li>ä½¿ç”¨ Builder.setStyle( inboxStyle )åŠ è½½åˆ°é€šçŸ¥</li>
<li>ç­‰å¾…é€šçŸ¥å‘å¸ƒå³å¯ã€‚</li>
</ul>
</li>
<li><p>ç®€å•ä¾‹ç¨‹å¦‚ä¸‹ </p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//åˆ›å»º inboxStyle</span></div><div class="line"> NotificationCompat.InboxStyle inboxStyle = <span class="keyword">new</span> NotificationCompat.InboxStyle();</div><div class="line"> <span class="comment">//æ·»åŠ  String è¡Œ ï¼Œå‰ææ˜¯ æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ª String</span></div><div class="line"> inboxStyle.addLine(string);</div><div class="line"> <span class="comment">// åœ¨notification è®¾ç½®    inboxStyle åœ¨ä¸€å † build é‡Œé¢</span></div><div class="line"> .setStyle(inboxStyle)</div></pre></td></tr></table></figure>
</li>
<li><p>æ¸…é™¤åŸæœ‰å†…å®¹ï¼Œå‘å¸ƒæ–°çš„ inboxStyle åªéœ€è¦ <code>inboxStyle = new NotificationCompat.InboxStyle();</code></p>
</li>
</ul>
<h3 id="Dozeæ¨¡å¼æ”¹å˜å¹¿æ’­"><a href="#Dozeæ¨¡å¼æ”¹å˜å¹¿æ’­" class="headerlink" title="Dozeæ¨¡å¼æ”¹å˜å¹¿æ’­"></a>Dozeæ¨¡å¼æ”¹å˜å¹¿æ’­</h3><h2 id="å¯¹åº”-ACTION-DEVICE-IDLE-MODE-CHANGED"><a href="#å¯¹åº”-ACTION-DEVICE-IDLE-MODE-CHANGED" class="headerlink" title="* å¯¹åº” ACTION_DEVICE_IDLE_MODE_CHANGED"></a>* å¯¹åº” <code>ACTION_DEVICE_IDLE_MODE_CHANGED</code></h2><ul>
<li>å‘ï¼šåªèƒ½åŠ¨æ€æ³¨å†Œï¼Œé™æ€æ³¨å†Œæ— æ•ˆï¼Œå…·ä½“ä»£ç ä¸­<code>powermanger.ACTION_DEVICE_IDLE_MODE_CHANGED</code> éœ€è¦å®ä¾‹åŒ– PowerManger ï¼Œè€Œ PowerManger åˆæ˜¯ä¸ Activityç»‘å®šï¼Œæ‰€ä»¥åªæœ‰åº”ç”¨ä¿æŒåå°å­˜æ´»æ—¶æ‰ä¼šè¿›å…¥å¹¿æ’­ã€‚</li>
<li>ä¾‹ç¨‹å¦‚ä¸‹<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å®ä¾‹åŒ– PowerManager</span></div><div class="line">PowerManager powermanger = (PowerManager) getApplicationContext().getSystemService(Context.POWER_SERVICE);</div><div class="line"><span class="comment">//åŠ¨æ€æ³¨å†Œå¹¿æ’­</span></div><div class="line">intentFilter = <span class="keyword">new</span> IntentFilter();</div><div class="line">intentFilter.addAction(powermanger.ACTION_DEVICE_IDLE_MODE_CHANGED);</div><div class="line"><span class="comment">//idlemodechage æ˜¯ BroadcastReceiver </span></div><div class="line">idlemodechage = <span class="keyword">new</span> IdleModeChange();</div><div class="line">registerReceiver(idlemodechage, intentFilter);</div></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;èµ„æ–™æ¥æºå¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/training/notify-user/index.html&quot; target=&quot;_blank&quot; rel=
    
    </summary>
    
      <category term="Androidç¬”è®°" scheme="http://yoursite.com/categories/Android%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Androidç¬”è®°â€”ContentResolver</title>
    <link href="http://yoursite.com/2017/01/19/Android%E7%AC%94%E8%AE%B0-ContentResolver/"/>
    <id>http://yoursite.com/2017/01/19/Androidç¬”è®°-ContentResolver/</id>
    <published>2017-01-19T04:00:00.000Z</published>
    <updated>2017-01-28T13:24:28.091Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>èµ„æ–™æ¥æºå¦‚ä¸‹</p>
<ul>
<li>ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ)</li>
<li><a href="http://www.jianshu.com/p/57798618bd90" target="_blank" rel="external">android6.0è¿è¡Œæ—¶æƒé™è¯¦è§£</a></li>
</ul>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 2.2.3 </li>
</ul>
<p>å¯¼è¯­</p>
<ul>
<li>å†…å®¹æä¾›å™¨æ˜¯å®‰å…¨çš„åº”ç”¨é—´å…±äº«æ•°æ®é€”å¾„ï¼Œåœ¨æ­£å¼è¿›å…¥ä¹‹å‰éœ€è¦äº†è§£ä¸€ä¸‹ Android è‡ª6.0ä»¥æ¥æƒé™çš„å˜åŒ–</li>
</ul>
<hr>
<h2 id="Android-æƒé™è¯¦è§£"><a href="#Android-æƒé™è¯¦è§£" class="headerlink" title="Android æƒé™è¯¦è§£"></a>Android æƒé™è¯¦è§£</h2><hr>
<p>èµ„æ–™æ¥æºï¼š</p>
<ul>
<li><a href="http://www.jianshu.com/p/57798618bd90" target="_blank" rel="external">android6.0è¿è¡Œæ—¶æƒé™è¯¦è§£</a></li>
<li><a href="https://developer.android.com/guide/topics/security/permissions.html" target="_blank" rel="external">Develop-API Guides-ç³»ç»Ÿæƒé™</a></li>
<li>ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ)</li>
</ul>
<hr>
<h3 id="Androidæƒé™ä»‹ç»"><a href="#Androidæƒé™ä»‹ç»" class="headerlink" title="Androidæƒé™ä»‹ç»"></a>Androidæƒé™ä»‹ç»</h3><ul>
<li><p>Android æ˜¯ä¸€ä¸ªæƒé™åˆ†éš”çš„æ“ä½œç³»ç»Ÿ<br>æ¯ä¸ªåº”ç”¨ç³»ç»Ÿæ ‡è¯†ï¼ˆLinux ç”¨æˆ· ID å’Œç»„ IDï¼‰ä¸åŒã€‚ç³»ç»Ÿå„éƒ¨åˆ†æ ‡è¯†äº¦ä¸ç›¸åŒã€‚Linux æ®æ­¤å°†ä¸åŒçš„åº”ç”¨ä»¥åŠåº”ç”¨ä¸ç³»ç»Ÿåˆ†éš”å¼€æ¥ã€‚<br>æ›´è¯¦ç»†çš„å®‰å…¨åŠŸèƒ½é€šè¿‡â€œæƒé™â€æä¾›ï¼Œæƒé™ ä¼šé™åˆ¶ç‰¹å®šè¿›ç¨‹å¯ä»¥æ‰§è¡Œçš„å…·ä½“æ“ä½œï¼Œå¹¶ä¸”æ ¹æ® URI æƒé™æˆæƒä¸´æ—¶è®¿é—®ç‰¹å®šçš„æ•°æ®æ®µ</p>
</li>
<li><p>æƒé™å£°æ˜<br>æœ€å¸¸è§çš„æƒé™å£°æ˜åœ¨ AndroidManifest.xml æ–‡ä»¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªuses-permission æ ‡è®°, </p>
<ul>
<li>ä¾‹å¦‚ å£°æ˜çŸ­ä¿¡æƒé™ <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">package</span>=<span class="string">"com.android.app.myapp"</span> &gt;</div><div class="line">  <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.RECEIVE_SMS"</span> /&gt;</span></div><div class="line">  ...</div><div class="line">  <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>android 6.0 æƒé™æœºåˆ¶<br>android 6.0ä¹‹å‰ æƒé™åŠåœ¨å®‰è£…çš„æ—¶å€™ï¼Œæ ¹æ®æƒé™å£°æ˜äº§ç”Ÿä¸€ä¸ªæƒé™åˆ—è¡¨ï¼Œç”¨æˆ·åªæœ‰åœ¨åŒæ„ä¹‹åæ‰èƒ½å®Œæˆappçš„å®‰è£…ã€‚<br>android 6.0 ä»¥å å¼•å…¥äº†  è¿è¡Œæ—¶æƒé™ åŠŸèƒ½ï¼Œåº”ç”¨æ‰€éœ€æƒé™ä¸å†ä¸€æ¬¡æ€§åœ¨å®‰è£…æ—¶ç”³è¯·ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶éœ€è¦ç”¨åˆ°é‚£ç§æƒé™å‘ç”¨æˆ·ç”³è¯·ï¼ŒåŒæ—¶ç”¨æˆ·ä¹Ÿå¯ä»¥éšæ—¶å–æ¶ˆè¯¥æˆæƒ</p>
</li>
<li><p>æƒé™åˆ†ç±»</p>
<ul>
<li>Normal Permissions(æ™®é€šæƒé™)<br>ä¸æ¶‰åŠç”¨æˆ·éšç§ï¼Œä¸éœ€è¦ç”¨æˆ·è¿›è¡Œæˆæƒçš„ï¼Œä¾‹å¦‚ æ‰‹æœºéœ‡åŠ¨ã€è®¿é—®ç½‘ç»œç­‰</li>
<li>Dangerous Permission(å±é™©æƒé™)<br>æ¶‰åŠåˆ°ç”¨æˆ·éšç§çš„ï¼Œéœ€è¦ç”¨æˆ·è¿›è¡Œæˆæƒï¼Œä¾‹å¦‚ è¯»å–sdcardã€è®¿é—®é€šè®¯å½•ç­‰<br><a href="https://developer.android.com/guide/topics/security/permissions.html" target="_blank" rel="external">å±é™©æƒé™ç»„</a>å¦‚è¡¨1</li>
</ul>
</li>
</ul>
<h3 id="åº”ç”¨è¿è¡Œæ—¶ç”³è¯·æƒé™ï¼ˆé€‚ç”¨äº-Android6-0-åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰"><a href="#åº”ç”¨è¿è¡Œæ—¶ç”³è¯·æƒé™ï¼ˆé€‚ç”¨äº-Android6-0-åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰" class="headerlink" title="åº”ç”¨è¿è¡Œæ—¶ç”³è¯·æƒé™ï¼ˆé€‚ç”¨äº Android6.0 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰"></a>åº”ç”¨è¿è¡Œæ—¶ç”³è¯·æƒé™ï¼ˆé€‚ç”¨äº Android6.0 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰</h3><ul>
<li>é€šè¿‡ä¸€ä¸ªç®€å•çš„å®ä¾‹æ¥è¯´æ˜è¿‡ç¨‹<h4 id="å®ä¾‹ï¼š"><a href="#å®ä¾‹ï¼š" class="headerlink" title="å®ä¾‹ï¼š"></a>å®ä¾‹ï¼š</h4></li>
<li><p>æ‹¨æ‰“ç”µè¯ CALL<em>PHONE  </em>æƒé™ä¸ºä¾‹ </p>
<ul>
<li>æƒé™å£°æ˜<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.CALL_PHONE"</span>/&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>æ‹¨æ‰“10010</p>
<ul>
<li>ä»£ç å¦‚ä¸‹ æ„å»ºä¸€ä¸ªéšå¼intent å¯åŠ¨æ‹¨æ‰“ç”µè¯<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_CALL);</div><div class="line">intent.setData(Uri.parse(<span class="string">"tel:10010"</span>));</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>åœ¨ä¸»ç•Œé¢ä¸Šæ·»åŠ ä¸€ä¸ªButton åœ¨å…¶onClickæ–¹æ³•ä¸­æ‹¨æ‰“ç”µè¯ï¼Œè¿è¡Œç¨‹åº!</li>
</ul>
<hr>
<ul>
<li>åœ¨Anâ€™dâ€™roid 6.0 ä»¥ä¸‹ç‰ˆæœ¬ä¸­ ç”µè¯éƒ½å¯ä»¥æ­£å¸¸æ‹¨å‡ºã€‚Android 6.0 ä»¥ä¸Šç‰ˆæœ¬ä¸­ åˆ™å¯èƒ½ä¼šåº”ç”¨å´©æºƒ/æ— ååº”ï¼ŒæŸ¥çœ‹logcatçš„æ‰“å°æ—¥å¿—å¯ä»¥çœ‹åˆ° â€œPermission Denialâ€æƒé™è¢«ç¦æ­¢çš„ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥å°è¯•ä½¿ç”¨ è¿è¡Œæ—¶ç”³è¯·æƒé™</li>
</ul>
<hr>
<ul>
<li>æ£€æŸ¥æ˜¯å¦å·²è·å¾—æˆæƒ<br>int  checkSelfPermission(Context context, String permission)æ–¹æ³• <ul>
<li>Context context context<br>String permission  æƒé™å…·ä½“åç§°<br>æ‰“ç”µè¯å¯¹åº” Manifest.permission.CALL<em>PHONE   </em></li>
<li>æ–¹æ³•è¿”å›  PERMISSION_GRANTED  /   PERMISSION_DENIED</li>
<li>ä¾‹ç¨‹<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(ContextCompat.checkSelfPermission</div><div class="line">(MainActivity.<span class="keyword">this</span>,Manifest.permission.CALL_PHONE) </div><div class="line">!=PackageManager.PERMISSION_GRANTED)</div><div class="line">&#123;</div><div class="line">         ;</div><div class="line">&#125;<span class="keyword">else</span> &#123;</div><div class="line">         ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>ç”³è¯·æƒé™<br>void ActivityCompat.requestPermissions (Activity activity, String[] permissions, int requestCode)æ–¹æ³•</p>
<ul>
<li><p>Activity activity  Activityå®ä¾‹<br>String[] permissions  è¯·æ±‚æƒé™å<br>int requestCode è¯·æ±‚ç ï¼Œå¤§äº0å³å¯ï¼Œå¯¹åº”åœ¨onRequestPermissionsResult å›æ‰æ–¹æ³•ä¸­çš„requestCode</p>
</li>
<li><p>ä¾‹ç¨‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ActivityCompat.requestPermissions(MainActivity.<span class="keyword">this</span>,</div><div class="line"><span class="keyword">new</span> String[]&#123;Manifest.permission.CALL_PHONE&#125;,<span class="number">1</span> );</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>æˆæƒåå›æ‰<br>æ— è®ºç”¨æˆ·æ˜¯å¦æˆæƒéƒ½ä¼šè¿›å…¥å›æ‰æ–¹æ³•ï¼Œéœ€è¦é‡å†™è¯¥æ–¹æ³•ã€‚<br>void onRequestPermissionsResult (int requestCode, String[] permissions, int[] grantResults)æ–¹æ³•</p>
<ul>
<li><p>int requestCode    åœ¨ requestPermissions ä¸­ä¼ å…¥çš„è¯·æ±‚ç <br>String[] permissions   è¯·æ±‚çš„æƒé™ï¼Œä¸ä¸ºç©º<br>int[] grantResults        æˆæƒç»“æœ åªæœ‰ PERMISSION_GRANTED  / PERMISSION_DENIED ä¸¤ä¸ªå€¼</p>
</li>
<li><p>ä¾‹ç¨‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, String[] permissions, <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (requestCode) &#123;</div><div class="line">    	<span class="comment">//è¯·æ±‚ç  1</span></div><div class="line">        <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">            <span class="comment">//æˆæƒç»“æœ(int) çš„ é•¿åº¦æ˜¯å¦å¤§äº0  ä¸ä¸Š æˆæƒç»“æœæ˜¯å¦ç­‰äº  PackageManager.PERMISSION_GRANTED </span></div><div class="line">            <span class="keyword">if</span> (grantResults.length &gt; <span class="number">0</span> &amp;&amp; grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED) &#123;</div><div class="line">            <span class="comment">//æˆæƒé€šè¿‡æ‰§è¡Œ</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">//æˆæƒæ²¡æœ‰é€šè¿‡  </span></div><div class="line">            &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>å½“ç”¨æˆ·æ‹’ç»åå†æ¬¡è¯¢é—®<br>  boolean ActivityCompat.shouldShowRequestPermissionRationale(Activity activity, String permission)             ï¼ˆçœŸå¿ƒå¤ªé•¿äº†ï¼‰</p>
<ul>
<li>Activity activity  Activityå®ä¾‹<br>String permission   æƒé™åç§°<br>åº”ç”¨ç¬¬ä¸€æ¬¡éœ€è¦æˆæƒæ—¶,ç”¨æˆ·æˆæƒï¼Œè¯¥æ–¹æ³•è¿”å›falseã€‚å½“ç”¨æˆ·æ‹’ç»æˆæƒ,ä¸‹æ¬¡éœ€è¦è¯¥æƒé™æ—¶,è¯¥æ–¹æ³•ä¼šè¿”å›true</li>
<li>ä¾‹ç¨‹<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">if</span> (ActivityCompat.shouldShowRequestPermissionRationale</div><div class="line">(PermissionActivity.<span class="keyword">this</span>,Manifest.permission.READ_CONTACTS))</div><div class="line">&#123;</div><div class="line"><span class="comment">//ç¬¬äºŒæ¬¡è¯¢é—®ç”¨æˆ·æ˜¯å¦æˆæƒ</span></div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line"><span class="comment">//ç”¨æˆ·ä¾æ—§æ‹’ç»åæ“ä½œ</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>ä¾‹ç¨‹æºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">      setContentView(R.layout.activity_main);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Button</span><span class="params">(View view)</span></span>&#123;</div><div class="line">      <span class="keyword">if</span>(ContextCompat.checkSelfPermission(MainActivity.<span class="keyword">this</span>,Manifest.permission.CALL_PHONE) != PackageManager.PERMISSION_GRANTED)&#123;</div><div class="line">          ActivityCompat.requestPermissions(MainActivity.<span class="keyword">this</span>, <span class="keyword">new</span> String[]&#123;Manifest.permission.CALL_PHONE&#125;,<span class="number">1</span> );</div><div class="line">      &#125;<span class="keyword">else</span> &#123;</div><div class="line">          call();</div><div class="line">      &#125;</div><div class="line"></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">          Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_CALL);</div><div class="line">          intent.setData(Uri.parse(<span class="string">"tel:10010"</span>));</div><div class="line">          startActivity(intent);</div><div class="line">      &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</div><div class="line">          e.printStackTrace();</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, String[] permissions, <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</div><div class="line">      <span class="keyword">switch</span> (requestCode) &#123;</div><div class="line">          <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">              <span class="keyword">if</span> (grantResults.length &gt; <span class="number">0</span> &amp;&amp; grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED) &#123;</div><div class="line">                  call();</div><div class="line">              &#125; <span class="keyword">else</span> &#123;</div><div class="line">                  Toast.makeText(<span class="keyword">this</span>, <span class="string">"You denied the permission"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">              &#125;</div><div class="line">              <span class="keyword">break</span>;</div><div class="line">          <span class="keyword">default</span>:</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">     <span class="attr">android:onClick</span>=<span class="string">"Button"</span></div><div class="line">     <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">     <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">     <span class="attr">android:text</span>=<span class="string">"Hello World!"</span> /&gt;</div></pre></td></tr></table></figure></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;èµ„æ–™æ¥æºå¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/57798618bd90&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android6.0è¿è¡Œæ—¶
    
    </summary>
    
      <category term="Androidç¬”è®°" scheme="http://yoursite.com/categories/Android%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Androidç¬”è®°â€”æ•°æ®ä¿å­˜</title>
    <link href="http://yoursite.com/2017/01/14/Android%E7%AC%94%E8%AE%B0-%E6%95%B0%E6%8D%AE%E4%BF%9D%E5%AD%98/"/>
    <id>http://yoursite.com/2017/01/14/Androidç¬”è®°-æ•°æ®ä¿å­˜/</id>
    <published>2017-01-14T04:00:00.000Z</published>
    <updated>2017-01-14T13:30:28.259Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>èµ„æ–™æ¥æºå¦‚ä¸‹</p>
<ul>
<li>ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ)</li>
</ul>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 2.2.3 </li>
</ul>
<hr>
<h2 id="Android-ä¸­çš„ä¸»è¦æ•°æ®å­˜å‚¨"><a href="#Android-ä¸­çš„ä¸»è¦æ•°æ®å­˜å‚¨" class="headerlink" title="Android ä¸­çš„ä¸»è¦æ•°æ®å­˜å‚¨"></a>Android ä¸­çš„ä¸»è¦æ•°æ®å­˜å‚¨</h2><ul>
<li><p>æœ‰ä¸‰ç§</p>
</li>
<li><p>ä¿å­˜é”®å€¼é›†<br> è¦ä¿å­˜çš„ç›¸å¯¹è¾ƒå°é”®å€¼é›†åˆï¼Œä½¿ç”¨ SharedPreferences</p>
</li>
<li><p>ä¿å­˜æ–‡ä»¶<br>ä½¿ç”¨ Android æ–‡ä»¶ç³»ç»Ÿé€šè¿‡ File API è¯»å–å’Œå†™å…¥æ–‡ä»¶ï¼Œé€‚åˆæŒ‰å¼€å§‹åˆ°ç»“æŸçš„é¡ºåºä¸è·³è¿‡åœ°è¯»å–æˆ–å†™å…¥å¤§é‡æ•°æ®ã€‚ ä¾‹å¦‚ï¼Œå›¾ç‰‡æ–‡ä»¶æˆ–é€šè¿‡ç½‘ç»œäº¤æ¢çš„ä»»ä½•å†…å®¹</p>
</li>
<li><p>åœ¨ SQL æ•°æ®åº“ä¸­ä¿å­˜æ•°æ®<br>Androidå†…å»ºçš„SQLite æ•°æ®åº“å­˜å‚¨é‡å¤æˆ–ç»“æ„åŒ–æ•°æ®</p>
</li>
</ul>
<hr>
<ul>
<li>PSï¼šè¿™é‡Œå¦‚æœæ²¡æœ‰å­¦è¿‡ SQL æ•°æ®åº“ä½¿ç”¨ï¼Œæ¨èLitePal</li>
<li>Androidå¼€æºæ•°æ®åº“<a href="https://github.com/LitePalFramework/LitePal#latest-downloads/" target="_blank" rel="external">LitePal</a>  ï¼šéƒ­éœ–(ç¬¬ä¸€è¡Œä»£ç ä½œè€…)</li>
<li>è¯¦ç»†ä»‹ç»åœ¨è¿™é‡Œ<a href="http://www.jianshu.com/p/557682e0a9f0" target="_blank" rel="external">ï¼ˆæ‡’äººå¿…å¤‡ï¼‰Androidå¼€æºæ•°æ®åº“LitePal</a></li>
</ul>
<hr>
<h3 id="ä¿å­˜é”®å€¼é›†"><a href="#ä¿å­˜é”®å€¼é›†" class="headerlink" title="ä¿å­˜é”®å€¼é›†"></a>ä¿å­˜é”®å€¼é›†</h3><ul>
<li>æƒ³è¦ä¿å­˜çš„ç›¸å¯¹è¾ƒå°é”®å€¼é›†åˆ</li>
<li><p>è°ƒç”¨SharedPreferences</p>
</li>
<li><p>é¦–å…ˆï¼šè·å–SharedPreferencesçš„å¥æŸ„<br>ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ªå…±äº«å‚æ•°æ–‡ä»¶æˆ–è®¿é—®ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å…±äº«å‚æ•°æ–‡ä»¶ã€‚<br>å…·ä½“é€”å¾„æœ‰ä¸‰æ¡</p>
<ul>
<li><p>getSharedPreferences (String name, int mode)</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šSharedPreferencesçš„åç§°ï¼Œç¬¬äºŒä¸ªï¼šå‚æ•°æŒ‡å®šæ“ä½œæ¨¡å¼</li>
<li>éœ€è¦åˆ›å»º/è¯»å– å¤šä¸ªå…±äº«å‚æ•°æ–‡ä»¶æ—¶ä½¿ç”¨ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æ‹¥æœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡è¯†ç¬¦é€šè¿‡è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°è·å¾—å…±äº«å‚æ•°å¯¹è±¡ã€‚å¯ä»¥é€šè¿‡APPä¸­çš„ä»»æ„Contextå¯¹è±¡è°ƒç”¨å®ƒã€‚</li>
<li>ç¤ºä¾‹<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æŒ‡å®šSharedPreferencesåç§°ä¸ºdata  æ¨¡å¼ä¸ºMODE_PRIVATEï¼šåªæœ‰å½“å‰ç¨‹åºæ‰æœ‰æƒé™è¯»å–/ä¿®æ”¹</span></div><div class="line">SharedPreferences sharedPref = getSharedPreferences(<span class="string">"data"</span>, MODE_PRIVATE);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>getPreferences (int mode)</p>
<ul>
<li>å‚æ•°ï¼šæŒ‡å®šæ“ä½œæ¨¡å¼</li>
<li>åªåˆ›å»º Activity çš„ä¸€ä¸ªSharedPreferencesã€‚åœ¨Activity ä¸­ä½¿ç”¨ã€‚ æ–¹æ³•ä¼šæ£€ç´¢å±äºè¯¥ Activity çš„é»˜è®¤å…±äº«é¦–é€‰é¡¹æ–‡ä»¶ï¼Œæ— éœ€æä¾›åç§°</li>
<li>ç¤ºä¾‹<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æ¨¡å¼ï¼šMODE_PRIVATEï¼šåªæœ‰å½“å‰ç¨‹åºæ‰æœ‰æƒé™è¯»å–/ä¿®æ”¹</span></div><div class="line">SharedPreferences sharedPref = getActivity().getPreferences(Context.MODE_PRIVATE);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>getDefaultSharedPreferences(context)</p>
<ul>
<li>å‚æ•°ï¼šcontext</li>
<li>è‡ªåŠ¨ä»¥æ¡£æœŸåº”ç”¨ç¨‹åºåŒ…åä½œä¸ºå‰ç¼€å‘½åSharedPreferencesæ–‡ä»¶</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>å†™å…¥æ•°æ®åˆ°å…±äº«å‚æ•°ä¸­<ul>
<li>SharedPreferences è°ƒç”¨ edit() åˆ›å»ºä¸€ä¸ª SharedPreferences.Editor<br>ä½¿ç”¨è¯¸å¦‚ putInt() å’Œ putString() æ–¹æ³•å†™å…¥çš„é”®å’Œå€¼<br>æœ€åè°ƒç”¨commit() ä»¥ä¿å­˜æ›´æ”¹<br>ä¹Ÿå¯è°ƒç”¨apply() ä¿å­˜æ›´æ”¹</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>commit() ä¸ apply() ç›¸åŒ/åŒºåˆ«</li>
<li>ç›¸åŒ<ul>
<li>éƒ½æ˜¯æäº¤preferenceä¿®æ”¹æ•°æ®</li>
</ul>
</li>
<li>åŒºåˆ«<ul>
<li>applyæ²¡æœ‰è¿”å›å€¼  commitè¿”å›booleanè¡¨æ˜ä¿®æ”¹æ˜¯å¦æäº¤æˆåŠŸ</li>
<li>applyæ˜¯å°†æ“ä½œæäº¤åˆ°å†…å­˜ï¼Œè€Œåå¼‚æ­¥çœŸæ­£æäº¤åˆ°æ–‡ä»¶<br> commitæ˜¯åŒæ­¥çš„æäº¤åˆ°æ–‡ä»¶<br> å¤šä¸ªcommitåŒæ—¶æäº¤ï¼Œäº’ç›¸ç­‰å¾…ï¼Œæ•ˆç‡è¾ƒä½<br> applyç›´æ¥è¦†ç›–ï¼Œæ•ˆç‡è¾ƒé«˜<ul>
<li>applyæ²¡æœ‰ä»»ä½•é”™è¯¯æç¤ºï¼Œåªæ˜¯æäº¤çš„åŠ¨ä½œ</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>ç¤ºä¾‹<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//åˆ›å»º .edit()</span></div><div class="line">SharedPreferences.Editor editor = sharedPref.edit();</div><div class="line"><span class="comment">//å†™å…¥å­—ç¬¦ä¸²ã€‚key-å€¼ TextView</span></div><div class="line">editor.putString(<span class="string">"TextView"</span>,<span class="string">"hello"</span>);</div><div class="line"><span class="comment">//ä¿å­˜æ›´æ”¹</span></div><div class="line">editor.commit();</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>ä»å…±äº«å‚æ•°ä¸­è¯»å–æ•°æ®<ul>
<li>è·å–SharedPreferencesçš„å¥æŸ„<br>æ–¹å¼åŒä¸Š</li>
<li>è°ƒç”¨æ¯”å¦‚getInt()æˆ–getString()æ–¹æ³•ï¼Œç„¶åä¼ å…¥é”®å€¼ï¼Œå¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªé»˜è®¤å€¼</li>
<li>ç¤ºä¾‹<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//è·å–SharedPreferencesçš„å¥æŸ„</span></div><div class="line">SharedPreferences sharedPreferences = getSharedPreferences(<span class="string">"data"</span>,MODE_PRIVATE);</div><div class="line"><span class="comment">//è¯»å–é”®å€¼å¯¹åº”æ•°æ®</span></div><div class="line">String text = sharedPreferences.getString(<span class="string">"TextView"</span>,<span class="string">""</span>);</div><div class="line"><span class="comment">//æ‰“å°åˆ°logä¸­ éªŒè¯</span></div><div class="line">Log.d(<span class="string">"data"</span>,text);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="ä¿å­˜åˆ°æ–‡ä»¶"><a href="#ä¿å­˜åˆ°æ–‡ä»¶" class="headerlink" title="ä¿å­˜åˆ°æ–‡ä»¶"></a>ä¿å­˜åˆ°æ–‡ä»¶</h3><ul>
<li>Android è®¾å¤‡æœ‰ä¸¤ä¸ªæ–‡ä»¶å­˜å‚¨åŒºåŸŸï¼š å†…éƒ¨å­˜å‚¨ å’Œ å¤–éƒ¨å­˜å‚¨<br>Android è®¾å¤‡æ—©æœŸå†…ç½®çš„éæ˜“å¤±æ€§å†…å­˜ï¼ˆå†…éƒ¨å­˜å‚¨ï¼‰ï¼Œä»¥åŠç§»åŠ¨å­˜å‚¨ä»‹è´¨ å¾®å‹ SD å¡ç­‰ï¼ˆå¤–éƒ¨å­˜å‚¨ï¼‰<br>ä»»ä½•Androidè®¾å¤‡å§‹ç»ˆæœ‰ä¸¤ä¸ªå­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”æ— è®ºå¤–éƒ¨å­˜å‚¨è®¾å¤‡æ˜¯å¦å¯ç§»åŠ¨ï¼ŒAPI çš„è¡Œä¸ºå‡ä¸€è‡´</li>
</ul>
<ul>
<li>Androidçš„æ–‡ä»¶å­˜å‚¨æ˜¯ä»¥javaæµä¸ºåŸºç¡€ï¼Œå¹¶ä¼˜åŒ–äº†ä¸€äº›æ“ä½œã€‚javaæµä¸å±äºæœ¬æ–‡èŒƒå›´ã€‚</li>
<li>æ¶‰åŠjavaæµéƒ¨åˆ†å‚è€ƒ<a href="http://androidtoast.iteye.com/blog/1172673" target="_blank" rel="external">Androidæ–‡ä»¶IOè¯¦è§£</a></li>
</ul>
<h4 id="å†…éƒ¨å­˜å‚¨"><a href="#å†…éƒ¨å­˜å‚¨" class="headerlink" title="å†…éƒ¨å­˜å‚¨"></a>å†…éƒ¨å­˜å‚¨</h4><h4 id="ä¿å­˜åˆ°å†…éƒ¨å­˜å‚¨"><a href="#ä¿å­˜åˆ°å†…éƒ¨å­˜å‚¨" class="headerlink" title="ä¿å­˜åˆ°å†…éƒ¨å­˜å‚¨"></a>ä¿å­˜åˆ°å†…éƒ¨å­˜å‚¨</h4><ul>
<li>æŸä¸€åº”ç”¨å¯¹å…¶å†…éƒ¨å­˜å‚¨ å§‹ç»ˆå…·æœ‰ è¿›è¡Œè¯»å†™çš„æƒé™ï¼Œè€Œæ— éœ€å£°æ˜ä»»ä½•æƒé™ï¼Œåœ¨ Android Nä¹‹å‰ï¼Œå†…éƒ¨æ–‡ä»¶å¯ä»¥é€šè¿‡æ”¾å®½æƒé™è®©å…¶ä»–åº”ç”¨è®¿é—®ã€‚<strong>ä½†æ˜¯æä¸æ¨èä»¥è¿™ç§æ–¹å¼å…±äº«æ–‡ä»¶</strong></li>
</ul>
<ul>
<li><p>ç®€å•å®ä¾‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String inputText)</span></span>&#123;</div><div class="line">      <span class="comment">//æ–°å»ºä¸€ä¸ªFileOutputStreamå¯¹è±¡(å­—èŠ‚æµ)</span></div><div class="line">      FileOutputStream out = <span class="keyword">null</span>;</div><div class="line">      <span class="comment">//æ–°å»ºä¸€ä¸ªBufferedWriter (å­—ç¬¦æµ)</span></div><div class="line">      BufferedWriter writer = <span class="keyword">null</span>;</div><div class="line">      <span class="keyword">try</span>&#123;</div><div class="line">          <span class="comment">//out å®ä¾‹åŒ–</span></div><div class="line">          out = openFileOutput(<span class="string">"data"</span>,Context.MODE_PRIVATE);</div><div class="line">          <span class="comment">//OutputStreamWrit  å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµ</span></div><div class="line">          <span class="comment">//å­—ç¬¦æµç»‘å®šBufferedWriter(ç¼“å†²åŒº)</span></div><div class="line">          writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(out));</div><div class="line">          <span class="comment">//å†™å…¥åˆ°æ–‡ä»¶</span></div><div class="line">          writer.write(inputText);</div><div class="line">      &#125;<span class="keyword">catch</span> (IOException e )&#123;</div><div class="line">          e.printStackTrace();</div><div class="line">      &#125; <span class="keyword">finally</span> &#123;</div><div class="line">          <span class="keyword">try</span>&#123;</div><div class="line">              <span class="comment">//å¦‚æœå†™å…¥æˆåŠŸ</span></div><div class="line">              <span class="keyword">if</span> (writer != <span class="keyword">null</span>) &#123;</div><div class="line">              	<span class="comment">//å…³é—­æµ</span></div><div class="line">                  writer.close();</div><div class="line">              &#125;</div><div class="line">          &#125;<span class="keyword">catch</span> (IOException e)&#123;</div><div class="line">              e.printStackTrace();</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>FileOutputStreamï¼š</p>
<ul>
<li>ç»§æ‰¿è‡ª OutputStream ç”¨äºæ–‡ä»¶å¤„ç†çš„èŠ‚ç‚¹æµ</li>
<li>ç”¨äºå†™å…¥åŸå§‹å­—èŠ‚æµåˆ°æ–‡ä»¶</li>
</ul>
</li>
<li><p>FileOutputStream openFileOutput (String name, int mode)</p>
<ul>
<li>è¿”å›FileOutputStreamå¯¹è±¡</li>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶å</li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ“ä½œæ¨¡å¼ï¼Œæœ‰4ç§å–å€¼<ul>
<li>MODE<em>PRIVATE(é»˜è®¤)</em>å½“åŒä¸€æ–‡ä»¶åå­˜åœ¨æ—¶è¦†ç›–åŸæ–‡ä»¶</li>
<li>MODE<em>APPEND  </em>å½“åŒåæ–‡ä»¶å­˜åœ¨æ—¶ï¼Œåœ¨åŸæ–‡ä»¶æœ«å°¾è¿½åŠ </li>
<li>å…¶ä½™ä¸¤ç§å‡åœ¨android4.2åŠä»¥ä¸Šç‰ˆæœ¬ä¸­åºŸå¼ƒ</li>
</ul>
</li>
</ul>
</li>
<li><p>OutputStreamWrit</p>
<ul>
<li>ç»§æ‰¿è‡ª Writer </li>
<li>å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµ</li>
</ul>
</li>
<li><p>BufferedWriter </p>
<ul>
<li>ç»§æ‰¿è‡ªWriter </li>
<li>ç»‘å®šå­—ç¬¦è¾“å‡ºæµï¼Œæé«˜å…·ä½“çš„æµå¯¹è±¡çš„æ•ˆç‡</li>
<li>.flush()æ–¹æ³• å¯¹ç¼“å†²åŒºè¿›è¡Œåˆ·æ–°ï¼Œè®©æ•°æ®åˆ°ç›®çš„åœ°</li>
<li>.close();æ–¹æ³• å…³é—­ç¼“å†²åŒºï¼Œå³å…³é—­ç»‘å®šçš„æµ</li>
</ul>
</li>
</ul>
<h5 id="ä»å†…éƒ¨å­˜å‚¨è¯»å–æ–‡ä»¶"><a href="#ä»å†…éƒ¨å­˜å‚¨è¯»å–æ–‡ä»¶" class="headerlink" title="ä»å†…éƒ¨å­˜å‚¨è¯»å–æ–‡ä»¶"></a>ä»å†…éƒ¨å­˜å‚¨è¯»å–æ–‡ä»¶</h5><ul>
<li><p>ç®€å•å®ä¾‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">load</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//æ–°å»ºFileInputStreamå¯¹è±¡</span></div><div class="line">     FileInputStream in = <span class="keyword">null</span>;</div><div class="line">     <span class="comment">//æ–°å»º BufferedReaderå¯¹è±¡</span></div><div class="line">     BufferedReader reader = <span class="keyword">null</span>;</div><div class="line">     <span class="comment">//æ–°å»ºä¸€ä¸ªStringBuilder ç©º</span></div><div class="line">      content = <span class="keyword">new</span> StringBuilder();</div><div class="line">     <span class="keyword">try</span>&#123;</div><div class="line">     	<span class="comment">//FileInputStreamå¯¹è±¡å®ä¾‹åŒ–</span></div><div class="line">         in = openFileInput(<span class="string">"data"</span>);</div><div class="line">         <span class="comment">//å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµ</span></div><div class="line">         <span class="comment">//ç¼“å†²æµç»‘å®šå­—ç¬¦æµ</span></div><div class="line">         reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in));</div><div class="line">         <span class="comment">//ç©º String</span></div><div class="line">         String line = <span class="string">""</span>;</div><div class="line">         <span class="comment">//è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦è¯»å–å®Œæˆ</span></div><div class="line">         <span class="keyword">while</span>((line = reader.readLine())!=<span class="keyword">null</span>)&#123;</div><div class="line">         	<span class="comment">//è¯»å–å†…å®¹æ·»åŠ åˆ° StringBuilder å¯¹è±¡ä¸­   </span></div><div class="line">             content.append(line);</div><div class="line">         &#125;</div><div class="line">     &#125;<span class="keyword">catch</span> (IOException e)&#123;</div><div class="line">         e.printStackTrace();</div><div class="line">     &#125;</div><div class="line">     <span class="keyword">finally</span> &#123;</div><div class="line">         <span class="keyword">if</span>(reader != <span class="keyword">null</span>)&#123;</div><div class="line">             <span class="keyword">try</span>&#123;</div><div class="line">             	<span class="comment">//å…³é—­æµ</span></div><div class="line">                 reader.close();</div><div class="line">             &#125;<span class="keyword">catch</span> (IOException e)&#123;</div><div class="line">                 e.printStackTrace();</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line">     &#125;</div><div class="line">     <span class="comment">//å°†è¯»å–ç»“æœ ç”±StringBuilderè½¬æ¢ä¸ºString å¹¶è¿”å›</span></div><div class="line">     <span class="keyword">return</span> content.toString();</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>FileInputStream</p>
<ul>
<li>ç»§æ‰¿è‡ª InputStreamï¼Œç”¨äºæ–‡ä»¶å¤„ç†çš„èŠ‚ç‚¹æµ</li>
<li>ä»æ–‡ä»¶ä¸­è¯»å–</li>
</ul>
</li>
<li><p>FileInputStream openFileInput(String filename)</p>
<ul>
<li>è¿”å›FileInputStreamå¯¹è±¡</li>
<li>å‚æ•°ä¸º è¯»å–çš„æ–‡ä»¶å</li>
</ul>
</li>
<li><p>InputStreamRead</p>
<ul>
<li>å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµ</li>
</ul>
</li>
<li><p>BufferedReader</p>
<ul>
<li>ç¼“å†²æµ</li>
</ul>
</li>
</ul>
<h4 id="å¤–éƒ¨å­˜å‚¨"><a href="#å¤–éƒ¨å­˜å‚¨" class="headerlink" title="å¤–éƒ¨å­˜å‚¨"></a>å¤–éƒ¨å­˜å‚¨</h4><ul>
<li>å å‘</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;èµ„æ–™æ¥æºå¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€è¡Œä»£ç (ç¬¬äºŒç‰ˆ)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–ç¨‹ç¯å¢ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Android Studio 2.2.3 &lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&quot;Android-ä¸­çš„ä¸»è¦æ•°æ®å­˜å‚¨&quot;&gt;&lt;a hr
    
    </summary>
    
      <category term="Androidç¬”è®°" scheme="http://yoursite.com/categories/Android%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="å­¦ä¹ è®°å½•" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>2016æ€»ç»“</title>
    <link href="http://yoursite.com/2016/12/31/2016%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2016/12/31/2016æ€»ç»“/</id>
    <published>2016-12-31T04:00:11.000Z</published>
    <updated>2016-12-31T14:50:12.906Z</updated>
    
    <content type="html"><![CDATA[<h3 id="2016"><a href="#2016" class="headerlink" title="2016"></a>2016</h3><ul>
<li>æ‰¾åˆ°äº†å…´è¶£-Androidå¼€å§‹æ­£å¼å­¦ä¹ ã€‚</li>
<li>æ­å»ºäº†è‡ªå·±çš„blogï¼Œè™½ç„¶å‘¨å›´äººæ²¡äººå…³æ³¨ï¼Œæœ‰ä¸€ç¯‡æ—¥å­çš„é˜…è¯»é‡è¿‡äº†1ä¸‡ï¼Œè¿˜æ˜¯å¾ˆæƒŠå–œçš„</li>
<li>åµŒå…¥å¼å·¥ä½œæ²¡ç”¨æ‰¾åˆ°æ»¡æ„çš„ï¼Œåªèƒ½è¯´ç­‰æ˜¥æ‹› Andoidçš„å®ä¹ ï¼Œè¿™æ®µæ—¶é—´åŠªåŠ›æé«˜è‡ªå·±ï¼Œ</li>
<li>æ”¾å¼ƒäº†è€ƒç ”</li>
<li>å¿ƒæƒ…èµ°è¿‡äº†ç±»ä¼¼æŠ‘éƒçš„ç»å†ï¼Œå¯¹ä½“åˆ¶ç§ç§å„æœ‰çœ‹æ³•ï¼Œæ˜¯å¯¹æ˜¯é”™ï¼Œè®©æ—¶é—´è§è¯</li>
</ul>
<hr>
<h3 id="2017"><a href="#2017" class="headerlink" title="2017"></a>2017</h3><ul>
<li>å¸Œæœ›æœ‰è‡ªå·±çš„æ”¶å…¥ï¼Œç»æµç›¸å¯¹è‡ªç”±ä¸€ç‚¹</li>
<li>è°ˆä¸€æ®µæ‹çˆ±ï¼Œé‡åˆ°åˆé€‚çš„å¥³å­©å§</li>
<li>Androidçš„è·¯ä¸Šï¼Œé¡ºåˆ©ä¸€ç‚¹å§</li>
<li>ä¸ç»™è‡ªå·±è®¾å®šé™åˆ¶ï¼Œèµ°ä¸€æ­¥å†èµ°ä¸€æ­¥</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;2016&quot;&gt;&lt;a href=&quot;#2016&quot; class=&quot;headerlink&quot; title=&quot;2016&quot;&gt;&lt;/a&gt;2016&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ‰¾åˆ°äº†å…´è¶£-Androidå¼€å§‹æ­£å¼å­¦ä¹ ã€‚&lt;/li&gt;
&lt;li&gt;æ­å»ºäº†è‡ªå·±çš„blogï¼Œè™½ç„¶å‘¨å›´äººæ²¡äººå…³æ³¨ï¼Œæœ‰ä¸€ç¯‡æ—¥å­
    
    </summary>
    
      <category term="éš" scheme="http://yoursite.com/categories/%E9%9A%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>Android Studioä¼˜åŒ–ç¼–è¯‘é€Ÿåº¦</title>
    <link href="http://yoursite.com/2016/12/25/Android%20Studio%E4%BC%98%E5%8C%96%E7%BC%96%E8%AF%91%E9%80%9F%E5%BA%A6/"/>
    <id>http://yoursite.com/2016/12/25/Android Studioä¼˜åŒ–ç¼–è¯‘é€Ÿåº¦/</id>
    <published>2016-12-25T04:00:00.000Z</published>
    <updated>2016-12-25T14:51:15.768Z</updated>
    
    <content type="html"><![CDATA[<hr>
<p>èµ„æ–™æ¥æºå¦‚ä¸‹</p>
<ul>
<li><a href="http://www.jianshu.com/p/1c878c10a6bb" target="_blank" rel="external">http://www.jianshu.com/p/1c878c10a6bb</a></li>
<li><a href="http://www.jianshu.com/p/9b8ef61b7cdb" target="_blank" rel="external">http://www.jianshu.com/p/9b8ef61b7cdb</a></li>
<li><a href="http://www.jianshu.com/p/64d9a52aebbf" target="_blank" rel="external">http://www.jianshu.com/p/64d9a52aebbf</a></li>
</ul>
<p>ç¼–ç¨‹ç¯å¢ƒ</p>
<ul>
<li>Android Studio 2.2.3</li>
</ul>
<p>å¯¼è¯­</p>
<ul>
<li>ssdç›˜å®¹é‡ä¸å¤Ÿäº†ï¼Œé‡è£…ç³»ç»Ÿï¼Œéšä¾¿é‡æ–°å®‰è£…äº†Android Studio è®°å½•ä¸€è¾¹ä¼˜åŒ–è¿‡ç¨‹</li>
</ul>
<hr>
<h2 id="æœ€é‡è¦çš„-æœ‰ä¸€ä¸ªè‰¯å¥½çš„æ¢¯å­-å…¨å±€ç¿»å¢™"><a href="#æœ€é‡è¦çš„-æœ‰ä¸€ä¸ªè‰¯å¥½çš„æ¢¯å­-å…¨å±€ç¿»å¢™" class="headerlink" title="æœ€é‡è¦çš„ æœ‰ä¸€ä¸ªè‰¯å¥½çš„æ¢¯å­+å…¨å±€ç¿»å¢™"></a>æœ€é‡è¦çš„ æœ‰ä¸€ä¸ªè‰¯å¥½çš„æ¢¯å­+å…¨å±€ç¿»å¢™</h2><ul>
<li>å¤§éƒ¨åˆ†Android Studioå®‰è£…çš„é—®é¢˜,å°±åŸºæœ¬ä¸ä¼šå‡ºç°</li>
</ul>
<h4 id="å¼€å¯gradleå•ç‹¬çš„å®ˆæŠ¤è¿›ç¨‹"><a href="#å¼€å¯gradleå•ç‹¬çš„å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="å¼€å¯gradleå•ç‹¬çš„å®ˆæŠ¤è¿›ç¨‹"></a>å¼€å¯gradleå•ç‹¬çš„å®ˆæŠ¤è¿›ç¨‹</h4><ul>
<li><p>åœ¨C:\Users.gradleç›®å½•(userç›®å½•å³å½“å‰ç”¨æˆ·ä¸åŒç”µè„‘ä¸€èˆ¬ä¸åŒ)ä¸‹æ–°å»º gradle.propertiesæ–‡ä»¶<br>å¤åˆ¶ä¸‹é¢çš„ä»£ç </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">org.gradle.daemon=true  </div><div class="line">org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=800m  </div><div class="line">-XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</div><div class="line">org.gradle.parallel=true  </div><div class="line">org.gradle.configureondemand=true</div></pre></td></tr></table></figure>
<p>åº”è¯¥æ˜¯å¢å¤§äº†gradle è¿è¡Œçš„ java è™šæ‹Ÿæœºçš„å¤§å°ï¼Œæˆ‘çš„ç”µè„‘æ˜¯8gå†…å­˜ï¼Œè¿™ä¸ªé…ç½®æ•ˆæœæœ€å¥½</p>
</li>
</ul>
<h4 id="æ‰©å¤§Android-Studio-è¿è¡Œå†…å­˜"><a href="#æ‰©å¤§Android-Studio-è¿è¡Œå†…å­˜" class="headerlink" title="æ‰©å¤§Android Studio è¿è¡Œå†…å­˜"></a>æ‰©å¤§Android Studio è¿è¡Œå†…å­˜</h4><ul>
<li><p>æ‰¾åˆ°Android Studioå®‰è£…ç›®å½•ä¸‹çš„binæ–‡ä»¶å¤¹<br>æ‰¾åˆ°studio64.exe.vmoptionså’Œstudio.exe.vmoptionsæ–‡ä»¶(64ä½)<br>studio.exe.vmoptionså’Œstudio.exe.vmoptionsæ–‡ä»¶(32ä½)</p>
</li>
<li><p>åˆ†åˆ«ç¼–è¾‘æ–‡ä»¶,æ”¹åŠ¨3ä¸ªåœ°æ–¹å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-Xms1024m</div><div class="line">-Xmx2048m</div><div class="line">-XX:MaxPermSize=800m</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Android-Studio-è®¾ç½®"><a href="#Android-Studio-è®¾ç½®" class="headerlink" title="Android Studio è®¾ç½®"></a>Android Studio è®¾ç½®</h4><ul>
<li><p>Command-line Optionä¸å¡«<br><img src="http://cdn2.snapgram.co/imgs/2016/12/25/ScreenShot_20161225224242.png" alt="ScreenShot_20161225224242.png"></p>
</li>
<li><p>gradle ç¦»çº¿æ¨¡å¼<br>å‹¾é€‰Office Workï¼Œæˆ‘è¿™é‡Œæµ‹è¯•æ˜¯é€Ÿåº¦åŸºæœ¬ä¸å˜ï¼Œä½†æ˜¯ç½‘ä¸Šæœ‰äººæµ‹è¯•æ˜¯æ•ˆæœç›¸å·®å¾ˆå¤šï¼ŒåŸå› ä¸æ˜ï¼Œå¯èƒ½æ˜¯ç½‘ç»œä¸€ç›´å…¨å±€ç¿»å¢™çš„å…³ç³»<br><img src="http://cdn1.snapgram.co/imgs/2016/12/25/ScreenShot_20161225224455.png" alt="ScreenShot_20161225224455.png"></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;èµ„æ–™æ¥æºå¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/1c878c10a6bb&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/1c878c10
    
    </summary>
    
      <category term="Androidç¬”è®°" scheme="http://yoursite.com/categories/Android%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
  </entry>
  
</feed>
